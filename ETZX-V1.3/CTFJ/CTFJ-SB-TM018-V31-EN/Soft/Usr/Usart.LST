C51 COMPILER V9.00   USART                                                                 02/18/2019 14:13:11 PAGE 1   


C51 COMPILER V9.00, COMPILATION OF MODULE USART
OBJECT MODULE PLACED IN Usart.OBJ
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE Usart.c LARGE BROWSE DEBUG OBJECTEXTEND

line level    source

   1          /*
   2          ************************Copyright(c)************************
   3          *                                  ºþÄÏÒ»ÌØµç×Ó¹É·ÝÓÐÏÞ¹«Ë¾
   4          *                               All Rights Reserved
   5          *                                        
   6          *
   7          *-----------------------ÎÄ¼þÐÅÏ¢---------------------------
   8          *ÎÄ¼þÃû³Æ               :Uart.c
   9          *ÎÄ¼þÃèÊö               :´®¿ÚÇý¶¯³ÌÐò
  10          *´´½¨ÈË                 :ÒüÔËÍ¬
  11          *´´½¨ÈÕÆÚ               :2009-4-6
  12          *°æ±¾ºÅ                 :V1.0
  13          *×¢ÊÍ                   :                                       
  14          *----------------------------------------------------------
  15          *ÐÞ¸ÄÈË                         :
  16          *ÐÞ¸ÄÈÕÆÚ                       :
  17          *°æ±¾ºÅ                 :
  18          *×¢ÊÍ                   :
  19          ***********************************************************
  20          */
  21          #define _IN_USART_
  22          #include "config.h"
  23          
  24          //´®¿Ú±äÁ¿¶¨Òå
  25          STUsartCfg  xdata stUsartCfg[1];
  26          #define IncRxPtr(byPort,addr)           (addr=(addr+1)%stUsartCfg[byPort].uiRecBufSize)
  27          #define IncTxPtr(byPort,addr)           (addr=(addr+1)%stUsartCfg[byPort].uiSndBufSize)
  28          
  29          
  30          
  31          uint8   xdata byUsart0RecBuf[UART0_RX_BUF_SIZE];
  32          
  33          
  34          
  35          bit bUsart0RecFinish    = 0;
  36          bit bRS485DataError             =0;
  37          
  38          
  39          /**********************************************************
  40          *º¯ÊýÃû³Æ                       :UsartInit      
  41          *º¯ÊýÃèÊö               :´®¿Ú³õÊ¼»¯º¯Êý
  42          *ÊäÈë²ÎÊý               :
  43          *·µ»ØÖµ                         :
  44          *È«¾Ö±äÁ¿                       :
  45          *µ÷ÓÃÄ£¿é                       :
  46          ***********************************************************
  47          *´´½¨ÈË                 :ÒüÔËÍ¬
  48          *´´½¨ÈÕÆÚ                       :2009-4-6
  49          ***********************************************************
  50          *ÐÞ¸ÄÈË                         :
  51          *ÐÞ¸ÄÈÕÆÚ               :
  52          *×¢ÊÍ                   :
  53          **********************************************************/
  54          void UsartInit(void)
  55          {
C51 COMPILER V9.00   USART                                                                 02/18/2019 14:13:11 PAGE 2   

  56   1              AUXR    &=      ~BRTR;          //Í£Ö¹¶ÀÁ¢²¨ÌØÂÊ·¢ÉúÆ÷ 
  57   1              
  58   1              //rxdÅäÖÃÎª¸ß×èÊäÈëÌ¬
  59   1              P3M0 &= 0xfe;
  60   1              P3M1 |= 0x01;
  61   1              
  62   1              //´®¿Ú0³õÊ¼»¯
  63   1              stUsartCfg[0].pbyRecBuf = byUsart0RecBuf;
  64   1              stUsartCfg[0].pbySndBuf = NULL;
  65   1              stUsartCfg[0].byRecState=0;
  66   1              stUsartCfg[0].uiRecPosition=0;
  67   1              stUsartCfg[0].uiRecLen=0;
  68   1              stUsartCfg[0].byRecCount=0;     
  69   1              stUsartCfg[0].uiSndLen  = stUsartCfg[0].uiSndPos  = 0;
  70   1              
  71   1              SCON=0X50;              //¹¤×÷·½Ê½1
  72   1              
  73   1      /*      TMOD&=0X0F;             //TO·½Ê½²»±ä
  74   1              TMOD|=0X20;             //T1 ·½Ê½2 :8Î»×Ô¶¯ÖØÔØ
  75   1              TL1     =       0XF6;           //²¨ÌØÂÊ4800  ÔÚ18.432M¾§ÕñµÄÇé¿öÏÂ
  76   1              TH1     =       TL1;
  77   1          PCON&=      ~SMOD;   //  ;²¨ÌØÂÊ±¶ÔöÑ¡Ôñ            smod=0
  78   1              AUXR |= T1x12;          //1TÄ£Ê½,×îºó²¨ÌØÂÊÎª:4800*12=57.6K
  79   1          TF1=0;
  80   1          TR1=1;*/
  81   1          PCON&=      ~SMOD;   //  ;²¨ÌØÂÊ±¶ÔöÑ¡Ôñ            smod=0
  82   1          AUXR        |=      S1BRS;  //ÌØÓÃ²¨ÌØÂÊ·¢ÉúÆ÷
  83   1          
  84   1              if(stLocalControl.stEepromCfgData.uiRs485Brt>=2400)
  85   1              {
  86   2                      AUXR    |=      BRTx12;         //BRTX12=1; 1TÄ£Ê½,×îºó²¨ÌØÂÊÎª:4800*12=57.6K
  87   2      //              BRT     =       0XF6;
  88   2                      BRT= 256-(Fosc/32/stLocalControl.stEepromCfgData.uiRs485Brt     );
  89   2                      
  90   2              
  91   2      }
  92   1              else
  93   1              {
  94   2                      AUXR    &=      ~BRTx12;        //BRTX12=0; 12TÄ£Ê½
  95   2      //              BRT     =       0XF6;
  96   2                      BRT= 256-(Fosc/32/12/stLocalControl.stEepromCfgData.uiRs485Brt  );              
  97   2              }   
  98   1      
  99   1              AUXR    |=      BRTR;           //Æô¶¯¶ÀÁ¢²¨ÌØÂÊ·¢ÉúÆ÷
 100   1              
 101   1              RI=0;
 102   1              TI=0;
 103   1              REN=1;
 104   1              ES=1;
 105   1      }
 106          /**********************************************************
 107          *º¯ÊýÃû³Æ                       :UART0(void)    
 108          *º¯ÊýÃèÊö               :´®¿Ú0ÖÐ¶Ïº¯Êý
 109          *ÊäÈë²ÎÊý               :
 110          *·µ»ØÖµ                         :
 111          *È«¾Ö±äÁ¿                       :stUsartCfg
 112          *µ÷ÓÃÄ£¿é                       :
 113          ***********************************************************
 114          *´´½¨ÈË                 :ÒüÔËÍ¬
 115          *´´½¨ÈÕÆÚ                       :2009-4-6
 116          ***********************************************************
 117          *ÐÞ¸ÄÈË                         :
C51 COMPILER V9.00   USART                                                                 02/18/2019 14:13:11 PAGE 3   

 118          *ÐÞ¸ÄÈÕÆÚ               :
 119          *×¢ÊÍ                   :
 120          **********************************************************/
 121          #pragma disable
 122          void UART0(void) interrupt UART_INTNO
 123          {
 124   1              uint8 byTemp;
 125   1              if(RI==1)
 126   1              {  
 127   2                      RI=0;
 128   2                      byTemp=SBUF;
 129   2                      if(stUsartCfg[0].uiRecPosition!=0)      //²»ÊÇÆðÊ¼×Ö½Ú
 130   2                      {
 131   3                              if(stUsartCfg[0].byRecTimeout==0)
 132   3                              {//³¬Ê±µ½ÁË
 133   4                                      stUsartCfg[0].byRecState=0;
 134   4                                      stUsartCfg[0].uiRecPosition=0;
 135   4                                      return;
 136   4                              }
 137   3                      }
 138   2                      stUsartCfg[0].byRecTimeout=5;   //ÓÖ¿ªÊ¼¶¨Ê±
 139   2                      byUsart0RecBuf[stUsartCfg[0].uiRecPosition++] = byTemp;         
 140   2                      switch(stUsartCfg[0].byRecState)
 141   2                      {
 142   3                              case 0:                                                         
 143   3                                      if(byTemp == START_BYTE1)
 144   3                                      {
 145   4                                              stUsartCfg[0].byRecState = 1;
 146   4      //                                      byCount = 7;
 147   4                                              stUsartCfg[0].byRecCount = 6;
 148   4                                      }
 149   3                                      else
 150   3                                      {
 151   4                                              stUsartCfg[0].uiRecPosition = 0;
 152   4                                      }
 153   3                                      break;
 154   3                              case 1:                                                         
 155   3                                      if(--stUsartCfg[0].byRecCount == 0)
 156   3                                      {       //ÊÕÍêµØÖ·Êý¾Ý                                                                                                                                          
 157   4                                              stUsartCfg[0].byRecState = 2;
 158   4                                              stUsartCfg[0].byRecCount = 3;                                           
 159   4                                      }
 160   3                                      break;                          
 161   3                              case 2:                         
 162   3                                      stUsartCfg[0].byRecCount--;
 163   3                                      if(stUsartCfg[0].byRecCount == 1)
 164   3                                      {       
 165   4                                              stUsartCfg[0].uiRecLen = byTemp<<8; 
 166   4                                      }
 167   3                                      else if(stUsartCfg[0].byRecCount == 0)
 168   3                                      {       //½ÓÊÕÍêÊý¾Ý³¤¶È
 169   4                                              //stUsartCfg[0].uiRecLen += (byTemp << 8);                      //»ñÈ¡Êý¾ÝÓò³¤¶ÈÖµ
 170   4                                              stUsartCfg[0].uiRecLen += byTemp;
 171   4                                              if(stUsartCfg[0].uiRecLen <= MAX_UART0_DATA_LEN)                                        
 172   4                                              {       //Êý¾Ý³¤¶È·ûºÏÒªÇó
 173   5                                                      stUsartCfg[0].byRecState = 3;
 174   5                                                      stUsartCfg[0].uiRecLen += 2;                                                                                                            
 175   5                                              }
 176   4                                              else
 177   4                                              {
 178   5                                                      stUsartCfg[0].byRecState = 0;
 179   5                                                      stUsartCfg[0].uiRecPosition = 0;
C51 COMPILER V9.00   USART                                                                 02/18/2019 14:13:11 PAGE 4   

 180   5                                              }                                                                               
 181   4                                      }
 182   3                                      break;                  
 183   3                              case 3:                         
 184   3                                      if(--stUsartCfg[0].uiRecLen == 0)
 185   3                                      {       //½ÓÊÕÍêËùÓÐÊý¾Ý
 186   4                                              if(END_BYTE == byTemp)
 187   4                                              {       //½áÊøÎ»ÕýÈ·
 188   5                                                      bUsart0RecFinish=1;
 189   5                                              }
 190   4                                              stUsartCfg[0].byRecState = 0;
 191   4                                              stUsartCfg[0].uiRecPosition = 0;                        
 192   4                                      }
 193   3                                      break;                  
 194   3                              default:
 195   3                                      stUsartCfg[0].byRecState = 0;
 196   3                                      stUsartCfg[0].uiRecPosition = 0;
 197   3                                      break;          
 198   3                      }
 199   2              }
 200   1              else if(TI==1)
 201   1              {
 202   2                      TI=0;
 203   2                      stUsartCfg[0].uiSndLen--;
 204   2                      stUsartCfg[0].uiSndPos++;
 205   2                      if(stUsartCfg[0].uiSndLen!=0)
 206   2                      {
 207   3                              SBUF = stUsartCfg[0].pbySndBuf[stUsartCfg[0].uiSndPos]; 
 208   3                              
 209   3                      }
 210   2              }
 211   1      } 
 212          
 213          
 214          /**********************************************************
 215          *º¯ÊýÃû³Æ                       :UART1(void)    
 216          *º¯ÊýÃèÊö               :´®¿Ú2ÖÐ¶Ïº¯Êý
 217          *ÊäÈë²ÎÊý               :
 218          *·µ»ØÖµ                         :
 219          *È«¾Ö±äÁ¿                       :stUsartCfg
 220          *µ÷ÓÃÄ£¿é                       :
 221          ***********************************************************
 222          *´´½¨ÈË                 :ÒüÔËÍ¬
 223          *´´½¨ÈÕÆÚ                       :2009-4-6
 224          ***********************************************************
 225          *ÐÞ¸ÄÈË                         :
 226          *ÐÞ¸ÄÈÕÆÚ               :
 227          *×¢ÊÍ                   :
 228          **********************************************************/
 229          #pragma disable
 230          void UART1(void) interrupt UART2_INTNO
 231          {
 232   1              if(S2CON&S2RI)
 233   1              {
 234   2                      S2CON &= ~S2RI;
 235   2              }
 236   1              else if(S2CON&S2TI)
 237   1              {
 238   2                      S2CON &= ~S2TI;
 239   2              }
 240   1      }
 241          
C51 COMPILER V9.00   USART                                                                 02/18/2019 14:13:11 PAGE 5   

 242          /**********************************************************
 243          *º¯ÊýÃû³Æ                       :GetPskCrc      
 244          *º¯ÊýÃèÊö               :¼ÆËãÊý¾ÝèåÀÛ¼ÓÐ£ÑéºÍ
 245          *ÊäÈë²ÎÊý               :pstDataFreq:´ý¼ÆËãµÄÊý¾ÝèåÖ¸Õë
 246          *·µ»ØÖµ                         :ÀÛ¼ÓÐ£ÑéºÍ
 247          *È«¾Ö±äÁ¿                       :stUsartCfg
 248          *µ÷ÓÃÄ£¿é                       :
 249          ***********************************************************
 250          *´´½¨ÈË                 :ÒüÔËÍ¬
 251          *´´½¨ÈÕÆÚ                       :2009-4-6
 252          ***********************************************************
 253          *ÐÞ¸ÄÈË                         :
 254          *ÐÞ¸ÄÈÕÆÚ               :
 255          *×¢ÊÍ                   :
 256          **********************************************************/
 257          uint8 GetPskCrc(pSTUartFreq pstDataFreq)
 258          {
 259   1              uint8  *pbyData;
 260   1              uint16 uiLen;
 261   1              uint8  byCrc = 0;
 262   1              
 263   1              pbyData = &(pstDataFreq->bySndSecAddr);
 264   1              uiLen = pstDataFreq->uiLen + HEAD_SIZE;
 265   1              while(uiLen--)
 266   1              {
 267   2                      byCrc += *pbyData++;
 268   2              }       
 269   1              return(byCrc);
 270   1      }
 271          /**********************************************************
 272          *º¯ÊýÃû³Æ                       :CheckPsk       
 273          *º¯ÊýÃèÊö               :¼ìÑéÊý¾Ý°üµÄÕýÈ·ÐÍ
 274          *ÊäÈë²ÎÊý               :pstDataFreq:´ýÐ£ÑéµÄÊý¾ÝèåÖ¸Õë
 275          *·µ»ØÖµ                         :true:Êý¾Ý°üÕýÈ·,false:Êý¾Ý°üÓÐÎó
 276          *È«¾Ö±äÁ¿                       :
 277          *µ÷ÓÃÄ£¿é                       :
 278          ***********************************************************
 279          *´´½¨ÈË                 :ÒüÔËÍ¬
 280          *´´½¨ÈÕÆÚ                       :2009-4-6
 281          ***********************************************************
 282          *ÐÞ¸ÄÈË                         :
 283          *ÐÞ¸ÄÈÕÆÚ               :
 284          *×¢ÊÍ                   :
 285          **********************************************************/
 286          uint8 CheckPsk(pSTUartFreq pstDataFreq)
 287          {
 288   1              uint8* pbyData;
 289   1              uint16 uiLen;
 290   1              uint8  byCrc = 0;
 291   1              
 292   1              pbyData = &(pstDataFreq->bySndSecAddr);
 293   1              uiLen = pstDataFreq->uiLen + HEAD_SIZE;
 294   1              while(uiLen--)
 295   1              {
 296   2                      byCrc += *pbyData++;
 297   2              }
 298   1              if(byCrc != *pbyData)
 299   1              {
 300   2                      return(false);
 301   2              }
 302   1              return(true);   
 303   1      }
C51 COMPILER V9.00   USART                                                                 02/18/2019 14:13:11 PAGE 6   

 304          
 305          /**********************************************************
 306          *º¯ÊýÃû³Æ                       :Usart0Manager  
 307          *º¯ÊýÃèÊö               :´®¿Ú0¹ÜÀíº¯Êý
 308          *ÊäÈë²ÎÊý               :
 309          *·µ»ØÖµ                         :
 310          *È«¾Ö±äÁ¿                       :stUsartCfg,stLocalControl
 311          *µ÷ÓÃÄ£¿é                       :
 312          ***********************************************************
 313          *´´½¨ÈË                 :ÒüÔËÍ¬
 314          *´´½¨ÈÕÆÚ                       :2009-4-6
 315          ***********************************************************
 316          *ÐÞ¸ÄÈË                         :
 317          *ÐÞ¸ÄÈÕÆÚ               :
 318          *×¢ÊÍ                   :
 319          **********************************************************/
 320          void Usart0RecDeal(void)
 321          {               
 322   1              pSTUartFreq pstDataFreq;
 323   1              uint16 xdata uiDataLen;
 324   1              uint8 xdata i;
 325   1      
 326   1              uiDataLen = byUsart0RecBuf[LEN_HIGH_POSITION]*256+byUsart0RecBuf[LEN_LOW_POSITION];
 327   1      
 328   1              stLocalControl.stBusDealFreq.bySndSecAddr = stLocalControl.stEepromCfgData.bySelfSecAddr;
 329   1              stLocalControl.stBusDealFreq.bySndRoomAddr = stLocalControl.stEepromCfgData.bySelfRoomAddr;
 330   1              stLocalControl.stBusDealFreq.bySndBedAddr = stLocalControl.stEepromCfgData.bySelfBedAddr;
 331   1              pstDataFreq = (pSTUartFreq)byUsart0RecBuf;
 332   1      
 333   1      
 334   1      
 335   1              if((pstDataFreq->byRecSecAddr == stLocalControl.stEepromCfgData.bySelfSecAddr)&&
 336   1                      (pstDataFreq->byRecRoomAddr == stLocalControl.stEepromCfgData.bySelfRoomAddr)&&
 337   1                      (pstDataFreq->byRecBedAddr == stLocalControl.stEepromCfgData.bySelfBedAddr)&&
 338   1                      (pstDataFreq->byCmd == CMD_SB_LCD_DISPLAY_DATA))
 339   1              {//ÊÇ±¾»úµØÖ·
 340   2              
 341   2                      if(uiDataLen>=5)
 342   2                      {       
 343   3                              if(!CheckPsk(pstDataFreq))      
 344   3                              {//Êý¾ÝÖ¡³ö´í
 345   4                                      stLocalControl.stBusDealFreq.byCmd = CMD_SB_DATA_ANSWER;        
 346   4                                      stLocalControl.stBusDealFreq.byRecSecAddr = 0X00;
 347   4                                      Bus0OutputData(&(stLocalControl.stBusDealFreq.bySndSecAddr));   
 348   4                              }
 349   3                              else
 350   3                              {       
 351   4                                      if(byUsart0RecBuf[DATA_POSITION4] == 0x01)      //Ò»´®ÐÅÏ¢½áÊø          
 352   4                                      {//»Ö¸´MICÔ­À´µÄ×´Ì¬
 353   5                                              MIC_CTRL=MicCtrlState;
 354   5                                      }
 355   4                                      
 356   4                                      switch(byUsart0RecBuf[DATA_POSITION1])  //ÐÅÏ¢ÀàÐÍ
 357   4                                      {                       
 358   5                                              case DIET_TYPE:
 359   5                                                      if(byUsart0RecBuf[DATA_POSITION2] == 0x01)      
 360   5                                                      {//µÚÒ»Ö¡Êý¾Ý
 361   6                                                              SpiNormalMode();
 362   6                                                              WREN();
 363   6                                                              Block_Erase_32K(DIET_DATA_START_ADDR);
 364   6                                                              Wait_Busy();
 365   6                                                              AAI_Write1(DIET_DATA_START_ADDR,&(byUsart0RecBuf[DATA_POSITION5]),uiDataLen-5);
C51 COMPILER V9.00   USART                                                                 02/18/2019 14:13:11 PAGE 7   

 366   6                                                              stLocalControl.uiDietDataLen = (uiDataLen-5);
 367   6                                                              
 368   6                                                              //AAI_Write(DIET_LENGTH_ADDR,(uint8 *)(&(stLocalControl.uiDietDataLen)),2);     //±£´æÕæÕýµÄÊý¾Ý³¤¶È ,Ô
             -­ÓÐ´ËÐÅÏ¢³¤¶È¸²¸Ç
 369   6                                                              SpiLcdMode();
 370   6                                                      }
 371   5                                                      else 
 372   5                                                      {       //²»½øÐÐ²Á³ýÐ´
 373   6                                                              SpiNormalMode();
 374   6                                                              AAI_Write1(DIET_DATA_START_ADDR+stLocalControl.uiDietDataLen,&(byUsart0RecBuf[DATA_POSITION5]),uiDa
             -taLen-5);
 375   6                                                              stLocalControl.uiDietDataLen  += (uiDataLen-5);         //¼ÓÊý¾Ý³¤¶È
 376   6                                                              SpiLcdMode();
 377   6                                                      }
 378   5      
 379   5                                                      if(byUsart0RecBuf[DATA_POSITION4] == 0x01)
 380   5                                                      {//½áÊø±êÖ¾
 381   6                                                              SpiNormalMode();
 382   6                                                              AAI_Write(DIET_LENGTH_ADDR,(uint8 *)(&(stLocalControl.uiDietDataLen)),2);       //±£´æÊý¾Ý³¤¶È
 383   6                                                              SpiLcdMode();
 384   6                                                              if(stLocalControl.byDisplayFace != TALK_FACE)
 385   6                                                              {
 386   7                                                                      DisplayedLen=0;
 387   7                                                                      ShowFace(DIET_TYPE);                                                            
 388   7                                                                      stLocalControl.uiLcdDisplayInfoTime = LCD_DISPLAY_INFO_TIME;
 389   7                                                              }
 390   6                                                      }
 391   5                                                      break;
 392   5      
 393   5                                              case PRESCRIPTION_TYPE:
 394   5                                                      if(byUsart0RecBuf[DATA_POSITION2] == 0x01)      
 395   5                                                      {//µÚÒ»Ö¡Êý¾Ý
 396   6                                                              WREN();
 397   6                                                              Block_Erase_32K(PRESCRIPTION_DATA_START_ADDR);
 398   6                                                              Wait_Busy();                                                    
 399   6                                                              AAI_Write1(PRESCRIPTION_DATA_START_ADDR,&(byUsart0RecBuf[DATA_POSITION5]),uiDataLen-5);                                 
 400   6                                                              stLocalControl.uiPrescriptionDataLen = uiDataLen-5;
 401   6                                                              
 402   6                                                              //AAI_Write(PRESCRIPTION_LENGTH_ADDR,(uint8 *)(&(stLocalControl.uiPrescriptionDataLen)),2);     //±£´æÕ
             -æÕýµÄÊý¾Ý³¤¶È ,Ô­ÓÐ´ËÐÅÏ¢³¤¶È¸²¸Ç
 403   6                                                      }
 404   5                                                      else 
 405   5                                                      {       //²»½øÐÐ²Á³ýÐ´
 406   6                                                              AAI_Write1(PRESCRIPTION_DATA_START_ADDR+stLocalControl.uiPrescriptionDataLen,&(byUsart0RecBuf[DATA_
             -POSITION5]),uiDataLen-5);
 407   6                                                              stLocalControl.uiPrescriptionDataLen  += (uiDataLen-5);         //¼ÓÊý¾Ý³¤¶È                                            
 408   6                                                      }
 409   5      
 410   5                                                      if(byUsart0RecBuf[DATA_POSITION4] == 0x01)
 411   5                                                      {//½áÊø±êÖ¾
 412   6                                                              AAI_Write(PRESCRIPTION_LENGTH_ADDR,(uint8 *)(&(stLocalControl.uiPrescriptionDataLen)),2);       //±£´æÊý¾
             -Ý³¤¶È
 413   6                                                              if(stLocalControl.byDisplayFace !=TALK_FACE)
 414   6                                                              {
 415   7                                                                      DisplayedLen=0;
 416   7                                                                      ShowFace(PRESCRIPTION_TYPE);                                                            
 417   7                                                                      stLocalControl.uiLcdDisplayInfoTime = LCD_DISPLAY_INFO_TIME;
 418   7                                                              }
 419   6                                                      }
 420   5                                                      break;
 421   5                                              case PROMPT_INFO_TYPE:
 422   5                                                      if(byUsart0RecBuf[DATA_POSITION2] == 0x01)      
C51 COMPILER V9.00   USART                                                                 02/18/2019 14:13:11 PAGE 8   

 423   5                                                      {//µÚÒ»Ö¡Êý¾Ý
 424   6                                                              WREN();
 425   6                                                              Block_Erase_32K(PROMPT_DATA_START_ADDR);
 426   6                                                              Wait_Busy();                                                    
 427   6                                                              AAI_Write1(PROMPT_DATA_START_ADDR,&(byUsart0RecBuf[DATA_POSITION5]),uiDataLen-5);                                       
 428   6                                                              stLocalControl.uiPromptDataLen = uiDataLen-5;
 429   6                                                              
 430   6                                                              //AAI_Write(PROMPT_LENGTH_ADDR,(uint8 *)(&(stLocalControl.uiPromptDataLen)),2); //±£´æÕæÕýµÄÊý¾Ý³¤¶
             -È ,Ô­ÓÐ´ËÐÅÏ¢³¤¶È¸²¸Ç
 431   6                                                      }
 432   5                                                      else 
 433   5                                                      {       //²»½øÐÐ²Á³ýÐ´
 434   6                                                              AAI_Write1(PROMPT_DATA_START_ADDR+stLocalControl.uiPromptDataLen,&(byUsart0RecBuf[DATA_POSITION5]),
             -uiDataLen-5);
 435   6                                                              stLocalControl.uiPromptDataLen  += (uiDataLen-5);               //¼ÓÊý¾Ý³¤¶È
 436   6                                                      }
 437   5                                                      
 438   5                                                      if(byUsart0RecBuf[DATA_POSITION4] == 0x01)
 439   5                                                      {//½áÊø±êÖ¾
 440   6                                                              AAI_Write(PROMPT_LENGTH_ADDR,(uint8 *)(&(stLocalControl.uiPromptDataLen)),2);   //±£´æÊý¾Ý³¤¶È
 441   6                                                              if(stLocalControl.byDisplayFace !=TALK_FACE)
 442   6                                                              {
 443   7                                                                      DisplayedLen=0;
 444   7                                                                      ShowFace(PROMPT_INFO_TYPE);
 445   7                                                                      stLocalControl.uiLcdDisplayInfoTime = LCD_DISPLAY_INFO_TIME;
 446   7                                                              }
 447   6                                                      }
 448   5                                                      break;
 449   5                                                      
 450   5                                      }
 451   4                                      memset(byUsart0RecBuf,0x00,UART0_RX_BUF_SIZE);
 452   4                                      
 453   4                                      stLocalControl.stBusDealFreq.byCmd = CMD_SB_DATA_ANSWER; 
 454   4                                      stLocalControl.stBusDealFreq.byRecSecAddr = 0X01;
 455   4                                      Bus0OutputData(&(stLocalControl.stBusDealFreq.bySndSecAddr));
 456   4                      
 457   4                              }               
 458   3                      }       
 459   2                      else
 460   2                      {//Êý¾Ý³¤¶È²»Ïà·û
 461   3                              stLocalControl.stBusDealFreq.byCmd = CMD_SB_DATA_ANSWER;        
 462   3                              stLocalControl.stBusDealFreq.byRecSecAddr = 0X00;
 463   3                              Bus0OutputData(&(stLocalControl.stBusDealFreq.bySndSecAddr));   
 464   3                      }               
 465   2              }               
 466   1      }
*** WARNING C280 IN LINE 324 OF USART.C: 'i': unreferenced local variable
 467          
 468          void Send_Data(uint8 *Databuf,uint8 xdata l)
 469          { 
 470   1      #if DEBUG==1
                  uint8 xdata i;
                      WDT_CONTR = 0x3d;       //Î¹¹·
                  ES=0;
                      for(i=0;i<l;i++)
                   {
                         SBUF=*Databuf;
                     while(!TI);
                         TI=0;
                         Databuf++;
                       }
                      ES=1;
C51 COMPILER V9.00   USART                                                                 02/18/2019 14:13:11 PAGE 9   

              #endif
 483   1      
 484   1      /*
 485   1      #if DEBUG==1
 486   1              stUsartCfg[0].uiSndLen=l;
 487   1              stUsartCfg[0].uiSndPos=0;
 488   1              stUsartCfg[0].pbySndBuf=Databuf;
 489   1              SBUF=stUsartCfg[0].pbySndBuf[0];
 490   1      #endif
 491   1      */
 492   1      }
*** WARNING C280 IN LINE 468 OF USART.C: 'Databuf': unreferenced local variable
*** WARNING C280 IN LINE 468 OF USART.C: 'l': unreferenced local variable
 493          
 494          
 495          void Send_Data_Byte(uint8 SendData)
 496          { 
 497   1      #if DEBUG==1
                  ES=0;
              
                  SBUF=SendData;
                  while(!TI);
                  TI=0;
                      ES=1;
              #endif  
 505   1      
 506   1      /*      
 507   1      #if DEBUG==1
 508   1              stUsartCfg[0].uiSndLen=1;
 509   1              stUsartCfg[0].uiSndPos=0; 
 510   1              SBUF=SendData;
 511   1      #endif  
 512   1      */
 513   1      }
*** WARNING C280 IN LINE 495 OF USART.C: 'SendData': unreferenced local variable


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   1627    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =    283      24
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =      2    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  4 WARNING(S),  0 ERROR(S)
