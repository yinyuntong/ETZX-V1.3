C51 COMPILER V9.00   SPI                                                                   02/18/2019 14:13:10 PAGE 1   


C51 COMPILER V9.00, COMPILATION OF MODULE SPI
OBJECT MODULE PLACED IN SPI.OBJ
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE SPI.C LARGE BROWSE DEBUG OBJECTEXTEND

line level    source

   1          /*
   2          ************************Copyright(c)************************
   3          *                                  湖南一特电子股份有限公司
   4          *                               All Rights Reserved
   5          *                                        
   6          *
   7          *-----------------------文件信息---------------------------
   8          *文件名称               :SPI.c
   9          *文件描述               :SPI驱动程序
  10          *创建人                 :尹运同
  11          *创建日期               :2008-9-22
  12          *版本号                 :V1.0
  13          *注释                                                           
  14          *----------------------------------------------------------
  15          *修改人                         :
  16          *修改日期                       :
  17          *版本号                 :
  18          *注释                   :
  19          ***********************************************************
  20          */
  21          #define _IN_SPI_
  22          #include "config.h"
  23          
  24                                  
  25           
  26          /**********************************************************
  27          *函数名称                       :SpiInit
  28          *函数描述               :SPI接口初始化
  29          *输入参数               :
  30          *返回值                         :       
  31          *全局变量                       :
  32          *调用模块                       :
  33          ***********************************************************
  34          *创建人                 :尹运同
  35          *创建日期                       :2008-9-22
  36          ***********************************************************
  37          *修改人                         :
  38          *修改日期               :
  39          *注释                   :
  40          **********************************************************/
  41          void SpiNormalMode(void)
  42          {       
  43   1              //工作模式设置,主动模式,低位在前,Fosc/4,起始下降沿采样  
  44   1              //SPCTL |=      (SSIG|SPEN|DORD|MSTR|CPOL|CPHA|SPSPEEDHH);
  45   1              //工作模式设置,主动模式,高位在前,Fosc/4,起始下降沿采样
  46   1              SPCTL   =       (SSIG|SPEN|MSTR|CPOL|CPHA|SPSPEEDHH);
  47   1              SPSTAT |= (SPIF|WCOL);
  48   1              IE2 &= ~ESPI;
  49   1              MISO =1;//输入
  50   1      }
  51          
  52          
  53          
  54          void SpiLcdMode(void)
  55          {
C51 COMPILER V9.00   SPI                                                                   02/18/2019 14:13:10 PAGE 2   

  56   1      
  57   1              //工作模式设置,主动模式,高位在前,Fosc/4,CPOL=0:时钟空闲时为低电平,CPHA=0:数据在CLK的上升沿采样
  58   1              SPCTL   =       (SSIG|SPEN|MSTR/*|CPOL|CPHA*/|SPSPEEDHH);
  59   1              SPSTAT |= (SPIF|WCOL);
  60   1              IE2 &= ~ESPI;
  61   1              MISO =1;//输入
  62   1      
  63   1      
  64   1      }
  65          
  66          
  67          
  68          /**********************************************************
  69          *函数名称                       :SpiInt
  70          *函数描述               :SPI中断服务程序
  71          *输入参数               :
  72          *返回值                         :       
  73          *全局变量                       :
  74          *调用模块                       :
  75          ***********************************************************
  76          *创建人                 :尹运同
  77          *创建日期                       :2008-9-22
  78          ***********************************************************
  79          *修改人                         :
  80          *修改日期               :
  81          *注释                   :
  82          **********************************************************/
  83          
  84          void SpiInt(void) interrupt SPI_INTNO           //9号中断
  85          {
  86   1              SPSTAT |= SPIF;         //清标志
  87   1              IE2 &= ~ESPI;
  88   1      }
  89          
  90          
  91          /**********************************************************
  92          *函数名称                       :SPI_WriteByte  
  93          *函数描述               :写一个字节
  94          *输入参数               :dat:要写入的数据
  95          *返回值                         :       
  96          *全局变量                       :
  97          *调用模块                       :
  98          ***********************************************************
  99          *创建人                 :尹运同
 100          *创建日期                       :2008-9-22
 101          ***********************************************************
 102          *修改人                         :
 103          *修改日期               :
 104          *注释                   :
 105          **********************************************************/
 106          uint8 SPI_WriteByte(unsigned char dat)
 107          {
 108   1              WDT_CONTR = 0x3d;       //喂狗
 109   1              SPDAT=dat;                                              
 110   1              while((SPSTAT & SPIF) == 0x00);                                         //等待发送完成 
 111   1              SPSTAT  |=      SPIF;//SPI传输完成标志,当SPI中断使能时会触发SPI中断请求,需要用软件向此位写"1"来清0
 112   1              return(SPDAT);  
 113   1      }
 114          
 115          


C51 COMPILER V9.00   SPI                                                                   02/18/2019 14:13:10 PAGE 3   

MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =     47    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
