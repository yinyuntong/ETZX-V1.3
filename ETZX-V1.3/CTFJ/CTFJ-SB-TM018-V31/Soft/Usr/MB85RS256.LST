C51 COMPILER V8.08   MB85RS256                                                             05/11/2011 16:44:30 PAGE 1   


C51 COMPILER V8.08, COMPILATION OF MODULE MB85RS256
OBJECT MODULE PLACED IN MB85RS256.OBJ
COMPILER INVOKED BY: D:\Keil\C51\BIN\C51.EXE MB85RS256.C LARGE BROWSE DEBUG OBJECTEXTEND

line level    source

   1          /*
   2          ************************Copyright(c)************************
   3          *                                  湖南一特电子股份有限公司
   4          *                               All Rights Reserved
   5          *                                        
   6          *
   7          *-----------------------文件信息---------------------------
   8          *文件名称               :MB85RS256.c
   9          *文件描述               :MB85RS256铁电存储器驱动
  10          *创建人                 :尹运同
  11          *创建日期               :2008-9-22
  12          *版本号                 :V1.0
  13          *注释                   :
  14          *----------------------------------------------------------
  15          *修改人                         :
  16          *修改日期                       :
  17          *版本号                 :
  18          *注释                   :
  19          ***********************************************************
  20          */
  21          #define _IN_MB5RS256_
  22          #include "config.h"
  23                  
  24          
  25          unsigned char xdata FRAM_BUFF[20];
  26          
  27          
  28          void delay_nus(unsigned char i);
  29          void delay_nms(unsigned char i);
  30          
  31          
  32          /**********************************************************
  33          *函数名称                       :FRAM_INIT      
  34          *函数描述               :MB85RS256初始化函数
  35          *输入参数               :
  36          *返回值                         :       
  37          *全局变量                       :
  38          *调用模块                       :SPI_WriteByte
  39          ***********************************************************
  40          *创建人                 :尹运同
  41          *创建日期                       :2008-9-22
  42          ***********************************************************
  43          *修改人                         :
  44          *修改日期               :
  45          *注释                   :
  46          **********************************************************/
  47          void FRAM_INIT(void)
  48          {
  49   1               MB85RS_CS = 0;
  50   1               SPI_WriteByte(0x06);    //写使能
  51   1               MB85RS_CS = 1;               
  52   1               delay_nus(10);
  53   1               
  54   1               MB85RS_CS = 0;
  55   1               SPI_WriteByte(0x01);    //写状态寄存器
C51 COMPILER V8.08   MB85RS256                                                             05/11/2011 16:44:30 PAGE 2   

  56   1               SPI_WriteByte(0x02);     //WEL等于1
  57   1               MB85RS_CS = 1; 
  58   1               delay_nus(10);
  59   1               
  60   1               MB85RS_CS = 0;
  61   1               SPI_WriteByte(0x06);
  62   1               MB85RS_CS = 1; 
  63   1               delay_nus(10);
  64   1               
  65   1               MB85RS_CS = 0; 
  66   1               SPI_WriteByte(0x05);    //读状态寄存器
  67   1               FRAM_BUFF[5]=SPDAT;
  68   1               MB85RS_CS = 1; 
  69   1      }
  70          
  71          
  72          /**********************************************************
  73          *函数名称                       :FRAM_Write     
  74          *函数描述               :MB85RS256写操作
  75          *输入参数               :Addr:地址
  76                                                   Len:长度
  77          *返回值                         :       
  78          *全局变量                       :
  79          *调用模块                       :SPI_WriteByte
  80          ***********************************************************
  81          *创建人                 :尹运同
  82          *创建日期                       :2008-9-22
  83          ***********************************************************
  84          *修改人                         :
  85          *修改日期               :
  86          *注释                   :
  87          **********************************************************/
  88          void FRAM_Write(unsigned int Addr,uint8 *p,unsigned int Len)
  89          {
  90   1               unsigned int i;
  91   1               
  92   1               MB85RS_CS = 0; 
  93   1               delay_nus(10);
  94   1               SPI_WriteByte(0x06);   //写使能
  95   1               delay_nus(10);
  96   1               MB85RS_CS = 1;
  97   1               
  98   1               MB85RS_CS = 0; 
  99   1               delay_nus(10);
 100   1               SPI_WriteByte(0x02);   //写内存
 101   1               SPI_WriteByte( (unsigned char)(Addr>>8) );
 102   1               SPI_WriteByte( (unsigned char) Addr );
 103   1               for(i=0;i<Len;i++)
 104   1               {
 105   2                       SPI_WriteByte(*(p+i));
 106   2               }
 107   1               delay_nus(10);
 108   1               MB85RS_CS = 1; 
 109   1               
 110   1      }
 111          
 112          /**********************************************************
 113          *函数名称                       :FRAM_Read      
 114          *函数描述               :MB85RS256读操作
 115          *输入参数               :Addr:地址
 116                                                   Len:长度
 117          *返回值                         :       
C51 COMPILER V8.08   MB85RS256                                                             05/11/2011 16:44:30 PAGE 3   

 118          *全局变量                       :
 119          *调用模块                       :SPI_WriteByte
 120          ***********************************************************
 121          *创建人                 :尹运同
 122          *创建日期                       :2008-9-22
 123          ***********************************************************
 124          *修改人                         :
 125          *修改日期               :
 126          *注释                   :
 127          **********************************************************/
 128          void FRAM_Read(unsigned int Addr,uint8 *p,unsigned int Len)
 129          {
 130   1               unsigned int i;
 131   1               
 132   1               MB85RS_CS = 0; 
 133   1               delay_nus(10);
 134   1               SPI_WriteByte(0x03);           //读内存
 135   1               SPI_WriteByte( (unsigned char)(Addr>>8) );
 136   1               SPI_WriteByte( (unsigned char) Addr );
 137   1               for(i=0;i<Len;i++)
 138   1               {
 139   2                       SPI_WriteByte(0xf0);   //输入8个时钟
 140   2                       *(p+i) = SPDAT;
 141   2               }
 142   1               delay_nus(10);
 143   1      
 144   1           SPI_WriteByte(WRSR);
 145   1           SPI_WriteByte(0x8E);        
 146   1               MB85RS_CS = 1 ;
 147   1      }
 148          
 149          
 150          uint8 FRAM_Read_Byte(unsigned int Addr)
 151          { 
 152   1               uint8 xdata ReadData;
 153   1               MB85RS_CS = 0; 
 154   1               delay_nus(10);
 155   1               SPI_WriteByte(0x03);           //读内存
 156   1               SPI_WriteByte( (unsigned char)(Addr>>8) );
 157   1               SPI_WriteByte( (unsigned char) Addr );
 158   1      
 159   1               SPI_WriteByte(0xf0);   //输入8个时钟
 160   1               ReadData = SPDAT;
 161   1               delay_nus(10);
 162   1               MB85RS_CS = 1 ;
 163   1               return(ReadData);
 164   1      }
 165          /**********************************************************
 166          *函数名称                       :FRAM_TEST      
 167          *函数描述               :MB85RS256测试操作
 168          *输入参数               :
 169          *返回值                         :       
 170          *全局变量                       :
 171          *调用模块                       :SPI_WriteByte  FRAM_Read
 172          ***********************************************************
 173          *创建人                 :尹运同
 174          *创建日期                       :2008-9-22
 175          ***********************************************************
 176          *修改人                         :
 177          *修改日期               :
 178          *注释                   :
 179          **********************************************************/
C51 COMPILER V8.08   MB85RS256                                                             05/11/2011 16:44:30 PAGE 4   

 180          void FRAM_TEST(void)
 181          {
 182   1               unsigned char i;
 183   1      
 184   1               FRAM_BUFF[0]=0x55;
 185   1               FRAM_BUFF[1]=0x00;
 186   1               FRAM_BUFF[2]=0x12;
 187   1               FRAM_BUFF[3]=0x34;
 188   1               
 189   1               FRAM_Write(0x7002,FRAM_BUFF,4);
 190   1               for(i=0;i<20;i++) FRAM_BUFF[i]=0;
 191   1               delay_nms(10);
 192   1               
 193   1               FRAM_Read(0x7002,FRAM_BUFF,4);
 194   1               delay_nms(10);
 195   1      }
 196          
 197          
 198          /**********************************************************
 199          *函数名称                       :delay_nms      
 200          *函数描述               :毫秒级延时操作
 201          *输入参数               :i:延时的ms数
 202          *返回值                         :       
 203          *全局变量                       :
 204          *调用模块                       :
 205          ***********************************************************
 206          *创建人                 :尹运同
 207          *创建日期                       :2008-9-22
 208          ***********************************************************
 209          *修改人                         :
 210          *修改日期               :
 211          *注释                   :
 212          **********************************************************/
 213          void delay_nms(unsigned char i)
 214          {
 215   1              unsigned int j;
 216   1      
 217   1              for(;i>0;i--)
 218   1              {
 219   2                      for(j=5000;j>0;j--);
 220   2              }
 221   1               
 222   1      }
 223          
 224          
 225          /**********************************************************
 226          *函数名称                       :delay_nus      
 227          *函数描述               :纳秒级延时操作
 228          *输入参数               :i:延时的us数
 229          *返回值                         :       
 230          *全局变量                       :
 231          *调用模块                       :
 232          ***********************************************************
 233          *创建人                 :尹运同
 234          *创建日期                       :2008-9-22
 235          ***********************************************************
 236          *修改人                         :
 237          *修改日期               :
 238          *注释                   :
 239          **********************************************************/
 240          void delay_nus(unsigned char i)
 241          {
C51 COMPILER V8.08   MB85RS256                                                             05/11/2011 16:44:30 PAGE 5   

 242   1              unsigned char j;
 243   1      
 244   1              for(;i>0;i--)
 245   1              {
 246   2                      for(j=2;j>0;j--);
 247   2              }
 248   1               
 249   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    492    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =     20      21
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
