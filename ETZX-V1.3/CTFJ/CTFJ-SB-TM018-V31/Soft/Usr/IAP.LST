C51 COMPILER V9.00   IAP                                                                   02/18/2019 11:32:45 PAGE 1   


C51 COMPILER V9.00, COMPILATION OF MODULE IAP
OBJECT MODULE PLACED IN IAP.OBJ
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE IAP.c LARGE BROWSE DEBUG OBJECTEXTEND

line level    source

   1          /*
   2          ************************Copyright(c)************************
   3          *                                  湖南一特电子股份有限公司
   4          *                               All Rights Reserved
   5          *                                        
   6          *
   7          *-----------------------文件信息---------------------------
   8          *文件名称               :IAP.c
   9          *文件描述               :写Flash驱动
  10          *创建人                 :尹运同
  11          *创建日期               :2008-9-22
  12          *版本号                 :V1.0
  13          *注释                   :采用STC系列CPU,该类型CPU将内部Flash作
  14                                               EEProm使用,擦除需以扇区为单位,在进行
  15                                               IAP操作过程中,CPU按照设定的时间挂起,
  16                                               此时CPU不能够进行任何工作
  17          *----------------------------------------------------------
  18          *修改人                         :
  19          *修改日期                       :
  20          *版本号                 :
  21          *注释                   :
  22          ***********************************************************
  23          */
  24          #define _IN_IAP_
  25          #include "config.h"
  26                  
  27          /**********************************************************
  28          *函数名称                       :EnableIAP      
  29          *函数描述               :使能IAP操作
  30          *输入参数               :byCmd:使能IAP操作的类型
  31          *返回值                         :       
  32          *全局变量                       :
  33          *调用模块                       :
  34          ***********************************************************
  35          *创建人                 :尹运同
  36          *创建日期                       :2008-9-22
  37          ***********************************************************
  38          *修改人                         :
  39          *修改日期               :
  40          *注释                   :
  41          **********************************************************/
  42          void EnableIAP(uint8 byCmd)
  43          {
  44   1              ISP_CONTR = (IAP_WAIT_TIME|0x80);
  45   1              ISP_CMD = byCmd;
  46   1      }
  47          /**********************************************************
  48          *函数名称                       :DisableIAP     
  49          *函数描述               :禁止IAP操作
  50          *输入参数               :
  51          *返回值                         :       
  52          *全局变量                       :
  53          *调用模块                       :
  54          ***********************************************************
  55          *创建人                 :尹运同
C51 COMPILER V9.00   IAP                                                                   02/18/2019 11:32:45 PAGE 2   

  56          *创建日期                       :2008-9-22
  57          ***********************************************************
  58          *修改人                         :
  59          *修改日期               :
  60          *注释                   :
  61          **********************************************************/
  62          void DisableIAP(void)
  63          {
  64   1              ISP_CONTR = 0x00;
  65   1              ISP_CMD = 0x00;
  66   1              ISP_TRIG = 0x00;
  67   1      }
  68          /**********************************************************
  69          *函数名称                       :IapWriteByte   
  70          *函数描述               :IAP在指定地址写入一个字节数据
  71          *输入参数               :uiAddr:待写入的地址,byData:待写入的字节数据
  72          *返回值                         :       
  73          *全局变量                       :
  74          *调用模块                       :
  75          ***********************************************************
  76          *创建人                 :尹运同
  77          *创建日期                       :2008-9-22
  78          ***********************************************************
  79          *修改人                         :
  80          *修改日期               :
  81          *注释                   :
  82          **********************************************************/
  83          void IapWriteByte(uint16 uiAddr, uint8 byData)
  84          {
  85   1              ISP_DATA = byData;
  86   1              ISP_ADDRH = (uint8)(uiAddr >> 8);
  87   1              ISP_ADDRL = (uint8)(uiAddr);
  88   1              ISP_TRIG = 0x5a;
  89   1              ISP_TRIG = 0xa5;                                                                                //送入触发命令
  90   1      }
  91          /**********************************************************
  92          *函数名称                       :IapReadByte    
  93          *函数描述               :IAP在读取指定地址的一个字节数据
  94          *输入参数               :uiAddr:待读取的地址
  95          *返回值                         :ISP_DATA:读取到的字节数据      
  96          *全局变量                       :
  97          *调用模块                       :
  98          ***********************************************************
  99          *创建人                 :尹运同
 100          *创建日期                       :2008-9-22
 101          ***********************************************************
 102          *修改人                         :
 103          *修改日期               :
 104          *注释                   :
 105          **********************************************************/
 106          uint8 IapReadByte(uint16 uiAddr)
 107          { 
 108   1              ISP_ADDRH = (uint8)(uiAddr >> 8);
 109   1              ISP_ADDRL = (uint8)(uiAddr);                                    
 110   1              ISP_TRIG = 0x5a;
 111   1              ISP_TRIG = 0xa5;                                                                                //送入触发命令 
 112   1              return(ISP_DATA);
 113   1      }
 114          /**********************************************************
 115          *函数名称                       :IapErase       
 116          *函数描述               :IAP擦除指定地址所在的扇区(不需要扇区地
 117                                                   址对齐
C51 COMPILER V9.00   IAP                                                                   02/18/2019 11:32:45 PAGE 3   

 118          *输入参数               :uiAddr:待擦除扇区的其中一个地址
 119          *返回值                         :       
 120          *全局变量                       :
 121          *调用模块                       :
 122          ***********************************************************
 123          *创建人                 :尹运同
 124          *创建日期                       :2008-9-22
 125          ***********************************************************
 126          *修改人                         :
 127          *修改日期               :
 128          *注释                   :
 129          **********************************************************/
 130          void IapErase(uint16 uiAddr)
 131          {       
 132   1              ISP_ADDRH = (uint8)(uiAddr >> 8);
 133   1              ISP_ADDRL = (uint8)(uiAddr);                                    
 134   1              ISP_TRIG = 0x5a;
 135   1              ISP_TRIG = 0xa5;                                                                                //送入触发命令 
 136   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =     74    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
