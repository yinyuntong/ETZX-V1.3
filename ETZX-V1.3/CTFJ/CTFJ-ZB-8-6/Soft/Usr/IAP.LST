C51 COMPILER V9.00   IAP                                                                   02/15/2019 08:58:12 PAGE 1   


C51 COMPILER V9.00, COMPILATION OF MODULE IAP
OBJECT MODULE PLACED IN IAP.OBJ
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE IAP.c LARGE BROWSE DEBUG OBJECTEXTEND TABS(2)

line level    source

   1          /*
   2          ************************Copyright(c)************************
   3          *            湖南一特电子股份有限公司
   4          *             All Rights Reserved
   5          *              
   6          *
   7          *-----------------------文件信息---------------------------
   8          *文件名称         :IAP.c
   9          *文件描述       :写Flash驱动
  10          *创建人         :尹运同
  11          *创建日期       :2008-9-22
  12          *版本号           :V1.0
  13          
  14          *----------------------------------------------------------
  15          *修改人       :
  16          *修改日期       :
  17          *版本号           :
  18          *注释         :
  19          ***********************************************************
  20          */
  21          #define _IN_IAP_
  22          #include "config.h"
  23            
  24          /**********************************************************
  25          *函数名称     :EnableIAP  
  26          *函数描述         :使能IAP操作
  27          *输入参数       :byCmd:使能IAP操作的类型
  28          *返回值       :     
  29          *全局变量     :
  30          *调用模块       :
  31          ***********************************************************
  32          *创建人           :尹运同
  33          *创建日期     :2008-9-22
  34          ***********************************************************
  35          *修改人         :
  36          *修改日期       :
  37          *注释           :
  38          **********************************************************/
  39          void EnableIAP(uint8 byCmd)
  40          {
  41   1        ISP_CONTR = (IAP_WAIT_TIME|0x80);
  42   1        ISP_CMD = byCmd;
  43   1      }
  44          /**********************************************************
  45          *函数名称     :DisableIAP 
  46          *函数描述         :禁止IAP操作
  47          *输入参数       :
  48          *返回值       :     
  49          *全局变量     :
  50          *调用模块       :
  51          ***********************************************************
  52          *创建人           :尹运同
  53          *创建日期     :2008-9-22
  54          ***********************************************************
  55          *修改人         :
C51 COMPILER V9.00   IAP                                                                   02/15/2019 08:58:12 PAGE 2   

  56          *修改日期       :
  57          *注释           :
  58          **********************************************************/
  59          void DisableIAP(void)
  60          {
  61   1        ISP_CONTR = 0x00;
  62   1        ISP_CMD = 0x00;
  63   1        ISP_TRIG = 0x00;
  64   1      }
  65          /**********************************************************
  66          *函数名称     :IapWriteByte 
  67          *函数描述         :IAP在指定地址写入一个字节数据
  68          *输入参数       :uiAddr:待写入的地址,byData:待写入的字节数据
  69          *返回值       :     
  70          *全局变量     :
  71          *调用模块       :
  72          ***********************************************************
  73          *创建人           :尹运同
  74          *创建日期     :2008-9-22
  75          ***********************************************************
  76          *修改人         :
  77          *修改日期       :
  78          *注释           :
  79          **********************************************************/
  80          void IapWriteByte(uint16 uiAddr, uint8 byData)
  81          {
  82   1        ISP_DATA = byData;
  83   1        ISP_ADDRH = (uint8)(uiAddr >> 8);
  84   1        ISP_ADDRL = (uint8)(uiAddr);
  85   1        ISP_TRIG = 0x46;
  86   1        ISP_TRIG = 0xb9;                    //送入触发命令
  87   1      }
  88          /**********************************************************
  89          *函数名称     :IapReadByte  
  90          *函数描述         :IAP在读取指定地址的一个字节数据
  91          *输入参数       :uiAddr:待读取的地址
  92          *返回值       :ISP_DATA:读取到的字节数据    
  93          *全局变量     :
  94          *调用模块       :
  95          ***********************************************************
  96          *创建人           :尹运同
  97          *创建日期     :2008-9-22
  98          ***********************************************************
  99          *修改人         :
 100          *修改日期       :
 101          *注释           :
 102          **********************************************************/
 103          uint8 IapReadByte(uint16 uiAddr)
 104          { 
 105   1        ISP_ADDRH = (uint8)(uiAddr >> 8);
 106   1        ISP_ADDRL = (uint8)(uiAddr);          
 107   1        ISP_TRIG = 0x46;
 108   1        ISP_TRIG = 0xb9;                    //送入触发命令 
 109   1        return(ISP_DATA);
 110   1      }
 111          /**********************************************************
 112          *函数名称     :IapErase 
 113          *函数描述         :IAP擦除指定地址所在的扇区(不需要扇区地
 114                     址对齐
 115          *输入参数       :uiAddr:待擦除扇区的其中一个地址
 116          *返回值       : 
 117          *全局变量     :
C51 COMPILER V9.00   IAP                                                                   02/15/2019 08:58:12 PAGE 3   

 118          *调用模块       :
 119          ***********************************************************
 120          *创建人           :尹运同
 121          *创建日期     :2008-9-22
 122          ***********************************************************
 123          *修改人         :
 124          *修改日期       :
 125          *注释           :
 126          **********************************************************/
 127          void IapErase(uint16 uiAddr)
 128          {   
 129   1        ISP_ADDRH = (uint8)(uiAddr >> 8);
 130   1        ISP_ADDRL = (uint8)(uiAddr);          
 131   1        ISP_TRIG = 0x46;
 132   1        ISP_TRIG = 0xb9;                    //送入触发命令 
 133   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =     74    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
