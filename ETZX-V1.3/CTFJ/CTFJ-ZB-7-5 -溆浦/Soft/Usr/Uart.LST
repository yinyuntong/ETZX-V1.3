C51 COMPILER V8.08   UART                                                                  01/26/2011 09:34:32 PAGE 1   


C51 COMPILER V8.08, COMPILATION OF MODULE UART
OBJECT MODULE PLACED IN Uart.OBJ
COMPILER INVOKED BY: D:\Program Files\Keil\C51\BIN\C51.EXE Uart.c BROWSE DEBUG OBJECTEXTEND CODE LISTINCLUDE SYMBOLS

line level    source

   1          /*
   2          ************************Copyright(c)************************
   3          *                                  ºþÄÏÒ»ÌØµç×Ó¹É·ÝÓÐÏÞ¹«Ë¾
   4          *                               All Rights Reserved
   5          *                                        
   6          *
   7          *-----------------------ÎÄ¼þÐÅÏ¢---------------------------
   8          *ÎÄ¼þÃû³Æ               :Uart.c
   9          *ÎÄ¼þÃèÊö               :´®¿ÚÇý¶¯³ÌÐò
  10          *´´½¨ÈË                 :ÒüÔËÍ¬
  11          *´´½¨ÈÕÆÚ               :2009-4-6
  12          *°æ±¾ºÅ                 :V1.0
  13          *×¢ÊÍ                   :                                       
  14          *----------------------------------------------------------
  15          *ÐÞ¸ÄÈË                         :
  16          *ÐÞ¸ÄÈÕÆÚ                       :
  17          *°æ±¾ºÅ                 :
  18          *×¢ÊÍ                   :
  19          ***********************************************************
  20          */
  21          #define _IN_USART_
  22          #include "config.h"
   1      =1  /*
   2      =1  ************************Copyright(c)************************
   3      =1  *                                  ºþÄÏÒ»ÌØµç×Ó¹É·ÝÓÐÏÞ¹«Ë¾
   4      =1  *                               All Rights Reserved
   5      =1  *                                        
   6      =1  *
   7      =1  *-----------------------ÎÄ¼þÐÅÏ¢---------------------------
   8      =1  *ÎÄ¼þÃû³Æ               :config.h
   9      =1  *ÎÄ¼þÃèÊö               :ÅäÖÃÍ·ÎÄ¼þ
  10      =1  *´´½¨ÈË                 :ÒüÔËÍ¬
  11      =1  *´´½¨ÈÕÆÚ               :2008-9-22
  12      =1  *°æ±¾ºÅ                 :V1.0
  13      =1  *×¢ÊÍ                   :                                       
  14      =1  *----------------------------------------------------------
  15      =1  *ÐÞ¸ÄÈË                         :
  16      =1  *ÐÞ¸ÄÈÕÆÚ                       :
  17      =1  *°æ±¾ºÅ                 :
  18      =1  *×¢ÊÍ                   :
  19      =1  ***********************************************************
  20      =1  */
  21      =1  //ÏµÍ³Í·ÎÄ¼þ
  22      =1  #pragma REGPARMS          
  23      =1  #include <intrins.h>
   1      =2  /*--------------------------------------------------------------------------
   2      =2  INTRINS.H
   3      =2  
   4      =2  Intrinsic functions for C51.
   5      =2  Copyright (c) 1988-2004 Keil Elektronik GmbH and Keil Software, Inc.
   6      =2  All rights reserved.
   7      =2  --------------------------------------------------------------------------*/
   8      =2  
   9      =2  #ifndef __INTRINS_H__
  10      =2  #define __INTRINS_H__
C51 COMPILER V8.08   UART                                                                  01/26/2011 09:34:32 PAGE 2   

  11      =2  
  12      =2  extern void          _nop_     (void);
  13      =2  extern bit           _testbit_ (bit);
  14      =2  extern unsigned char _cror_    (unsigned char, unsigned char);
  15      =2  extern unsigned int  _iror_    (unsigned int,  unsigned char);
  16      =2  extern unsigned long _lror_    (unsigned long, unsigned char);
  17      =2  extern unsigned char _crol_    (unsigned char, unsigned char);
  18      =2  extern unsigned int  _irol_    (unsigned int,  unsigned char);
  19      =2  extern unsigned long _lrol_    (unsigned long, unsigned char);
  20      =2  extern unsigned char _chkfloat_(float);
  21      =2  extern void          _push_    (unsigned char _sfr);
  22      =2  extern void          _pop_     (unsigned char _sfr);
  23      =2  
  24      =2  #endif
  25      =2  
  24      =1  #include <absacc.h>
   1      =2  /*--------------------------------------------------------------------------
   2      =2  ABSACC.H
   3      =2  
   4      =2  Direct access to 8051, extended 8051 and Philips 80C51MX memory areas.
   5      =2  Copyright (c) 1988-2002 Keil Elektronik GmbH and Keil Software, Inc.
   6      =2  All rights reserved.
   7      =2  --------------------------------------------------------------------------*/
   8      =2  
   9      =2  #ifndef __ABSACC_H__
  10      =2  #define __ABSACC_H__
  11      =2  
  12      =2  #define CBYTE ((unsigned char volatile code  *) 0)
  13      =2  #define DBYTE ((unsigned char volatile data  *) 0)
  14      =2  #define PBYTE ((unsigned char volatile pdata *) 0)
  15      =2  #define XBYTE ((unsigned char volatile xdata *) 0)
  16      =2  
  17      =2  #define CWORD ((unsigned int volatile code  *) 0)
  18      =2  #define DWORD ((unsigned int volatile data  *) 0)
  19      =2  #define PWORD ((unsigned int volatile pdata *) 0)
  20      =2  #define XWORD ((unsigned int volatile xdata *) 0)
  21      =2  
  22      =2  
  23      =2  #ifdef __CX51__
           =2 #define FVAR(object, addr)   (*((object volatile far *) (addr)))
           =2 #define FARRAY(object, base) ((object volatile far *) (base))
           =2 #define FCVAR(object, addr)   (*((object const far *) (addr)))
           =2 #define FCARRAY(object, base) ((object const far *) (base))
           =2 #else
  29      =2  #define FVAR(object, addr)    (*((object volatile far *) ((addr)+0x10000L)))
  30      =2  #define FCVAR(object, addr)   (*((object const far *) ((addr)+0x810000L)))
  31      =2  #define FARRAY(object, base)  ((object volatile far *) ((base)+0x10000L))
  32      =2  #define FCARRAY(object, base) ((object const far *) ((base)+0x810000L))
  33      =2  #endif
  34      =2  
  35      =2  #endif
  25      =1  #include <stdio.h>
   1      =2  /*--------------------------------------------------------------------------
   2      =2  STDIO.H
   3      =2  
   4      =2  Prototypes for standard I/O functions.
   5      =2  Copyright (c) 1988-2002 Keil Elektronik GmbH and Keil Software, Inc.
   6      =2  All rights reserved.
   7      =2  --------------------------------------------------------------------------*/
   8      =2  
   9      =2  #ifndef __STDIO_H__
  10      =2  #define __STDIO_H__
C51 COMPILER V8.08   UART                                                                  01/26/2011 09:34:32 PAGE 3   

  11      =2  
  12      =2  #ifndef EOF
  13      =2   #define EOF -1
  14      =2  #endif
  15      =2  
  16      =2  #ifndef NULL
  17      =2   #define NULL ((void *) 0)
  18      =2  #endif
  19      =2  
  20      =2  #ifndef _SIZE_T
  21      =2   #define _SIZE_T
  22      =2   typedef unsigned int size_t;
  23      =2  #endif
  24      =2  
  25      =2  #pragma SAVE
  26      =2  #pragma REGPARMS
  27      =2  extern char _getkey (void);
  28      =2  extern char getchar (void);
  29      =2  extern char ungetchar (char);
  30      =2  extern char putchar (char);
  31      =2  extern int printf   (const char *, ...);
  32      =2  extern int sprintf  (char *, const char *, ...);
  33      =2  extern int vprintf  (const char *, char *);
  34      =2  extern int vsprintf (char *, const char *, char *);
  35      =2  extern char *gets (char *, int n);
  36      =2  extern int scanf (const char *, ...);
  37      =2  extern int sscanf (char *, const char *, ...);
  38      =2  extern int puts (const char *);
  39      =2  
  40      =2  #pragma RESTORE
  41      =2  
  42      =2  #endif
  43      =2  
  26      =1  #include <string.h>
   1      =2  /*--------------------------------------------------------------------------
   2      =2  STRING.H
   3      =2  
   4      =2  String functions.
   5      =2  Copyright (c) 1988-2002 Keil Elektronik GmbH and Keil Software, Inc.
   6      =2  All rights reserved.
   7      =2  --------------------------------------------------------------------------*/
   8      =2  
   9      =2  #ifndef __STRING_H__
  10      =2  #define __STRING_H__
  11      =2  
  12      =2  #ifndef _SIZE_T
           =2  #define _SIZE_T
           =2  typedef unsigned int size_t;
           =2 #endif
  16      =2  
  17      =2  #ifndef NULL
           =2  #define NULL ((void *) 0L)
           =2 #endif
  20      =2  
  21      =2  #pragma SAVE
  22      =2  #pragma REGPARMS
  23      =2  extern char *strcat (char *s1, char *s2);
  24      =2  extern char *strncat (char *s1, char *s2, int n);
  25      =2  
  26      =2  extern char strcmp (char *s1, char *s2);
  27      =2  extern char strncmp (char *s1, char *s2, int n);
  28      =2  
C51 COMPILER V8.08   UART                                                                  01/26/2011 09:34:32 PAGE 4   

  29      =2  extern char *strcpy (char *s1, char *s2);
  30      =2  extern char *strncpy (char *s1, char *s2, int n);
  31      =2  
  32      =2  extern int strlen (char *);
  33      =2  
  34      =2  extern char *strchr (const char *s, char c);
  35      =2  extern int strpos (const char *s, char c);
  36      =2  extern char *strrchr (const char *s, char c);
  37      =2  extern int strrpos (const char *s, char c);
  38      =2  
  39      =2  extern int strspn (char *s, char *set);
  40      =2  extern int strcspn (char *s, char *set);
  41      =2  extern char *strpbrk (char *s, char *set);
  42      =2  extern char *strrpbrk (char *s, char *set);
  43      =2  extern char *strstr  (char *s, char *sub);
  44      =2  extern char *strtok  (char *str, const char *set);
  45      =2  
  46      =2  extern char memcmp (void *s1, void *s2, int n);
  47      =2  extern void *memcpy (void *s1, void *s2, int n);
  48      =2  extern void *memchr (void *s, char val, int n);
  49      =2  extern void *memccpy (void *s1, void *s2, char val, int n);
  50      =2  extern void *memmove (void *s1, void *s2, int n);
  51      =2  extern void *memset  (void *s, char val, int n);
  52      =2  #pragma RESTORE
  53      =2  
  54      =2  #endif
  27      =1  #include <math.h> 
   1      =2  /*--------------------------------------------------------------------------
   2      =2  MATH.H
   3      =2  
   4      =2  Prototypes for mathematic functions.
   5      =2  Copyright (c) 1988-2002 Keil Elektronik GmbH and Keil Software, Inc.
   6      =2  All rights reserved.
   7      =2  --------------------------------------------------------------------------*/
   8      =2  
   9      =2  #ifndef __MATH_H__
  10      =2  #define __MATH_H__
  11      =2  
  12      =2  #pragma SAVE
  13      =2  #pragma REGPARMS
  14      =2  extern char  cabs  (char  val);
  15      =2  extern int    abs  (int   val);
  16      =2  extern long  labs  (long  val);
  17      =2  extern float fabs  (float val);
  18      =2  extern float sqrt  (float val);
  19      =2  extern float exp   (float val);
  20      =2  extern float log   (float val);
  21      =2  extern float log10 (float val);
  22      =2  extern float sin   (float val);
  23      =2  extern float cos   (float val);
  24      =2  extern float tan   (float val);
  25      =2  extern float asin  (float val);
  26      =2  extern float acos  (float val);
  27      =2  extern float atan  (float val);
  28      =2  extern float sinh  (float val);
  29      =2  extern float cosh  (float val);
  30      =2  extern float tanh  (float val);
  31      =2  extern float atan2 (float y, float x);
  32      =2  
  33      =2  extern float ceil  (float val);
  34      =2  extern float floor (float val);
  35      =2  extern float modf  (float val, float *n);
C51 COMPILER V8.08   UART                                                                  01/26/2011 09:34:32 PAGE 5   

  36      =2  extern float fmod  (float x, float y);
  37      =2  extern float pow   (float x, float y);
  38      =2  
  39      =2  #pragma RESTORE
  40      =2  
  41      =2  #endif
  28      =1  #include "STC12C56.H"
   1      =2  /*------------------------------------------------*/
   2      =2  /* --- ºê¾§¿Æ¼¼ STCMCU ---------------------------*/
   3      =2  /* --- Mobile: (86)13922805190 -------------------*/
   4      =2  /* --- Fax: 86-755-82944243 ----------------------*/
   5      =2  /* --- Tel: 86-755-82948412 ----------------------*/
   6      =2  /* --- Web: www.STCMCU.com -----------------------*/
   7      =2  /* ÊÊÓÃÓÚ: STC12C56xx    STC12LE56xx  ------------*/
   8      =2  /* ------- STC12C56xxAD  STC12LE56xxAD  ----------*/
   9      =2  /*------------------------------------------------*/
  10      =2  
  11      =2  #ifndef __STC12C56_H__
  12      =2  #define __STC12C56_H__
  13      =2  
  14      =2  //////////////////////////////////////////////////////////////////////////////////////////////////////////
             -//////
  15      =2  
  16      =2  sfr  PSW        =   0xd0;       //³ÌÐò×´Ì¬×Ö            Bit7    Bit6    Bit5    Bit4    Bit3    Bit2    Bi
             -t1    Bit0
  17      =2                                  //Î»ÃèÊö                CY      AC      F0      RS1     RS0     OV      F1
             -      P
  18      =2                                  //³õÊ¼Öµ=0000,0000      0       0       0       0       0       0       0 
             -      0
  19      =2  
  20      =2  sbit CY         =   PSW^7;      //½øÎ»±êÖ¾
  21      =2  sbit AC         =   PSW^6;      //¸¨Öú½øÎ»±êÖ¾
  22      =2  sbit F0         =   PSW^5;      //ÓÃ»§±êÖ¾
  23      =2  sbit RS1        =   PSW^4;      //¼Ä´æÆ÷×éÑ¡ÔñÎ»1
  24      =2  sbit RS0        =   PSW^3;      //¼Ä´æÆ÷×éÑ¡ÔñÎ»0
  25      =2  sbit OV         =   PSW^2;      //Òç³ö±êÖ¾
  26      =2  sbit P          =   PSW^0;      //ACCµÄÅ¼Ð£ÑéÎ»
  27      =2  
  28      =2  /////////////////////////////////
  29      =2  
  30      =2  sfr  ACC        =   0xe0;       //ÀÛ¼ÓÆ÷                Bit7    Bit6    Bit5    Bit4    Bit3    Bit2    Bi
             -t1    Bit0
  31      =2                                  //³õÊ¼Öµ=0000,0000      0       0       0       0       0       0       0 
             -      0
  32      =2  
  33      =2  sbit ACC7       =   ACC^7;      //ÀÛ¼ÓÆ÷µÚ7Î»
  34      =2  sbit ACC6       =   ACC^6;      //ÀÛ¼ÓÆ÷µÚ6Î»
  35      =2  sbit ACC5       =   ACC^5;      //ÀÛ¼ÓÆ÷µÚ5Î»
  36      =2  sbit ACC4       =   ACC^4;      //ÀÛ¼ÓÆ÷µÚ4Î»
  37      =2  sbit ACC3       =   ACC^3;      //ÀÛ¼ÓÆ÷µÚ3Î»
  38      =2  sbit ACC2       =   ACC^2;      //ÀÛ¼ÓÆ÷µÚ2Î»
  39      =2  sbit ACC1       =   ACC^1;      //ÀÛ¼ÓÆ÷µÚ1Î»
  40      =2  sbit ACC0       =   ACC^0;      //ÀÛ¼ÓÆ÷µÚ0Î»
  41      =2  
  42      =2  /////////////////////////////////
  43      =2  
  44      =2  sfr  B          =   0xf0;       //B¼Ä´æÆ÷               Bit7    Bit6    Bit5    Bit4    Bit3    Bit2    Bi
             -t1    Bit0
  45      =2                                  //³õÊ¼Öµ=0000,0000      0       0       0       0       0       0       0 
             -      0
  46      =2  
  47      =2  /////////////////////////////////
C51 COMPILER V8.08   UART                                                                  01/26/2011 09:34:32 PAGE 6   

  48      =2  
  49      =2  sfr  SP         =   0x81;       //¶ÑÕ»Ö¸Õë              Bit7    Bit6    Bit5    Bit4    Bit3    Bit2    Bi
             -t1    Bit0
  50      =2                                  //³õÊ¼Öµ=0000,0111      0       0       0       0       0       1       1 
             -      1
  51      =2  
  52      =2  /////////////////////////////////
  53      =2  
  54      =2  sfr  DPL        =   0x82;       //Êý¾ÝÖ¸ÕëµÍ×Ö½Ú        Bit7    Bit6    Bit5    Bit4    Bit3    Bit2    Bi
             -t1    Bit0
  55      =2                                  //³õÊ¼Öµ=0000,0000      0       0       0       0       0       0       0 
             -      0
  56      =2  
  57      =2  /////////////////////////////////
  58      =2  
  59      =2  sfr  DPH        =   0x83;       //Êý¾ÝÖ¸Õë¸ß×Ö½Ú        Bit7    Bit6    Bit5    Bit4    Bit3    Bit2    Bi
             -t1    Bit0
  60      =2                                  //³õÊ¼Öµ=0000,0000      0       0       0       0       0       0       0 
             -      0
  61      =2  
  62      =2  //////////////////////////////////////////////////////////////////////////////////////////////////////////
             -//////
  63      =2  
  64      =2  sfr  PCON       =   0x87;       //µçÔ´¿ØÖÆ¼Ä´æÆ÷        Bit7    Bit6    Bit5    Bit4    Bit3    Bit2    Bi
             -t1    Bit0
  65      =2                                  //Î»ÃèÊö                SMOD    SMOD0   LVDF    POF     GF1     GF0     PD
             -      IDL
  66      =2                                  //³õÊ¼Öµ=0011,0000      0       0       1       1       0       0       0 
             -      0
  67      =2  
  68      =2  #define SMOD        0x80        //´®¿Ú²¨ÌØÂÊ±¶ËÙÎ»,ÖÃ1¿ÉÊ¹²¨ÌØÂÊ¿ì1±¶
  69      =2  #define SMOD0       0x40        //FE/SM0Ñ¡ÔñÎ»,0:SCON.7ÎªSM0 1:SCON.7ÎªFE
  70      =2  #define LVDF        0x20        //µÍÑ¹¼ì²âÖÐ¶ÏÇëÇóÎ»,ÓÉÓ²¼þÖÃ1,ÐèÓÉÈí¼þÇå0
  71      =2  #define POF         0x10        //ÉÏµç¸´Î»±êÖ¾Î»,ÉÏµçÊ±ÓÉÓ²¼þÖÃ1,ÐèÓÉÈí¼þÇå0
  72      =2  #define GF1         0x08        //Í¨ÓÃ±êÖ¾Î»1
  73      =2  #define GF0         0x04        //Í¨ÓÃ±êÖ¾Î»0
  74      =2  #define PD          0x02        //µôµç¿ØÖÆÎ»,Ð´1¿ÉÒÔÊ¹MCU½øÈëPowerDownÄ£Ê½
  75      =2  #define IDL         0x01        //¿ÕÏÐ¿ØÖÆÎ»,Ð´1¿ÉÒÔÊ¹MCU½øÈëIdleÄ£Ê½
  76      =2  
  77      =2  /////////////////////////////////
  78      =2  
  79      =2  sfr  WAKE_CLKO  =   0x8f;       //µôµç»½ÐÑ/Ê±ÖÓÊä³ö¿ØÖÆ Bit7    Bit6    Bit5    Bit4    Bit3    Bit2    Bi
             -t1    Bit0
  80      =2                                  //Î»ÃèÊö          PCAWAKEUP RXDPINIE T1PINIE T0PINIE    -       -      T1V
             -LKO  T0CLKO
  81      =2                                  //³õÊ¼Öµ=0000,xx00      0       0       0       0       x       x       0 
             -      0
  82      =2  
  83      =2  #define PCAWAKEUP   0x80        //ÔÊÐíPCAµÄÉÏÉýÑØ/ÏÂ½µÑØÖÐ¶Ï»½ÐÑµôµçMCU
  84      =2  #define RXD_PIN_IE  0x40        //ÔÊÐíRXD(P3.0)ÏÂ½µÑØÖÃÎ»RIÖÐ¶ÏÊ±»½ÐÑµôµçMCU(±ØÐë´ò¿ªÏàÓ¦ÖÐ¶Ï)
  85      =2  #define T1_PIN_IE   0x20        //ÔÊÐíT1(P3.5)ÏÂ½µÑØÖÃÎ»T1ÖÐ¶ÏÊ±»½ÐÑµôµçMCU(±ØÐë´ò¿ªÏàÓ¦ÖÐ¶Ï)
  86      =2  #define T0_PIN_IE   0x10        //ÔÊÐíT0(P3.4)ÏÂ½µÑØÖÃÎ»T0ÖÐ¶ÏÊ±»½ÐÑµôµçMCU(±ØÐë´ò¿ªÏàÓ¦ÖÐ¶Ï)
  87      =2  #define T1CLKOEN    0x02        //´ò¿ªP3.5½ÅµÄ¶¨Ê±Æ÷1Ê±ÖÓÒç³öÂö³å,Êä³öµÄÊ±ÖÓÆµÂÊÎª1/2±¶µÄT1Òç³öÂÊ
  88      =2  #define T0CLKOEN    0x01        //´ò¿ªP3.4½ÅµÄ¶¨Ê±Æ÷0Ê±ÖÓÒç³öÂö³å,Êä³öµÄÊ±ÖÓÆµÂÊÎª1/2±¶µÄT0Òç³öÂÊ
  89      =2  
  90      =2  /////////////////////////////////
  91      =2  
  92      =2  sfr  CLK_DIV    =   0xc7;       //Ê±ÖÓ·ÖÆµ¼Ä´æÆ÷        Bit7    Bit6    Bit5    Bit4    Bit3    Bit2    Bi
             -t1    Bit0
  93      =2                                  //Î»ÃèÊö                -       -       -       -       -       CLKS2   CL
             -KS1   CLKS0
  94      =2                                  //³õÊ¼Öµ=xxxx,x000      x       x       x       x       x       0       0 
C51 COMPILER V8.08   UART                                                                  01/26/2011 09:34:32 PAGE 7   

             -      0
  95      =2  
  96      =2  #define FOSCD1      0x00        //ÏµÍ³Ê±ÖÓÎªFosc
  97      =2  #define FOSCD2      0x01        //ÏµÍ³Ê±ÖÓÎªFosc/2
  98      =2  #define FOSCD4      0x02        //ÏµÍ³Ê±ÖÓÎªFosc/4
  99      =2  #define FOSCD8      0x03        //ÏµÍ³Ê±ÖÓÎªFosc/8
 100      =2  #define FOSCD16     0x04        //ÏµÍ³Ê±ÖÓÎªFosc/16
 101      =2  #define FOSCD32     0x05        //ÏµÍ³Ê±ÖÓÎªFosc/32
 102      =2  #define FOSCD64     0x06        //ÏµÍ³Ê±ÖÓÎªFosc/64
 103      =2  #define FOSCD128    0x07        //ÏµÍ³Ê±ÖÓÎªFosc/128
 104      =2  
 105      =2  /////////////////////////////////
 106      =2  
 107      =2  sfr  WDT_CONTR  =   0xe1;       //¿´ÃÅ¹·¶¨Ê±Æ÷¿ØÖÆÆ÷    Bit7    Bit6    Bit5    Bit4    Bit3    Bit2    Bi
             -t1    Bit0
 108      =2                                  //Î»ÃèÊö             WDT_FLAG   -       EN_WDT  CLR_WDT IDL_WDT PS2     PS
             -1     PS0
 109      =2                                  //³õÊ¼Öµ=0x00,0000      0       x       0       0       0       0       0 
             -      0
 110      =2  
 111      =2  #define WDT_FLAG    0x80        //¿´ÃÅ¹·¸´Î»±êÖ¾,µ±¿´ÃÅ¹·Òç³ö²úÉú¸´Î»ºó,Ó²¼þ×Ô¶¯ÖÃ1,ÐèÒªÓÉÈí¼þÇå0
 112      =2  #define EN_WDT      0x20        //Èí¼þÊ¹ÄÜ¿´ÃÅ¹·,´ò¿ªºó²»ÄÜÓÃÈí¼þµÄ·½Ê½¹Ø±Õ
 113      =2  #define CLR_WDT     0x10        //Çå¿´ÃÅ¹·¶¨Ê±Æ÷
 114      =2  #define IDLE_WDT    0x08        //IDLEÄ£Ê½ÏÂ,¿´ÃÅ¹·¶¨Ê±Æ÷ÊÇ·ñ¼ÌÐø¼ÆÊ±
 115      =2  
 116      =2  //////////////////////////////////////////////////////////////////////////////////////////////////////////
             -//////
 117      =2  
 118      =2  sfr  AUXR       =   0x8e;       //¸¨Öú¼Ä´æÆ÷            Bit7    Bit6    Bit5    Bit4    Bit3    Bit2    Bi
             -t1    Bit0
 119      =2                                  //Î»ÃèÊö                T0x12   T1x12   UM0x6   EADCI   ESPI    ELVDI   - 
             -      -
 120      =2                                  //³õÊ¼Öµ=0000,00xx      0       0       0       0       0       0       x 
             -      x
 121      =2  
 122      =2  #define T0x12       0x80        //¶¨Ê±Æ÷0Ê±ÖÓ¿ØÖÆ,0:Fosc/12(´«Í³µÄ12·ÖÆµ) 1:Fosc/1(1TÄ£Ê½,²»·ÖÆµ,¼´12±¶ÓÚ´
             -«Í³ËÙ¶È)
 123      =2  #define T1x12       0x40        //¶¨Ê±Æ÷1Ê±ÖÓ¿ØÖÆ,0:Fosc/12(´«Í³µÄ12·ÖÆµ) 1:Fosc/1(1TÄ£Ê½,²»·ÖÆµ,¼´12±¶ÓÚ´
             -«Í³ËÙ¶È)
 124      =2  #define UR0x6       0x20        //´®¿ÚÄ£Ê½0µÄÊ±ÖÓ¿ØÖÆ,0:Fosc/12(´«Í³µÄ12·ÖÆµ) 1:Fosc/2(2·ÖÆµ,,¼´6±¶ÓÚ´«Í³Ë
             -Ù¶È)
 125      =2  #define EADCI       0x10        //Ê¹ÄÜADCÖÐ¶ÏÎ»
 126      =2  #define ESPI        0x08        //Ê¹ÄÜSPIÖÐ¶ÏÎ»
 127      =2  #define ELVDI       0x04        //Ê¹ÄÜLVDÖÐ¶ÏÎ»
 128      =2  
 129      =2  //////////////////////////////////////////////////////////////////////////////////////////////////////////
             -//////
 130      =2  
 131      =2  sfr  P0         =   0x80;       //I/O¶Ë¿Ú0              Bit7    Bit6    Bit5    Bit4    Bit3    Bit2    Bi
             -t1    Bit0
 132      =2                                  //Î»ÃèÊö                -       -       -       -       P0.3    P0.2    P0
             -.1    P0.0
 133      =2                                  //³õÊ¼Öµ=xxxx,1111      x       x       x       x       1       1       1 
             -      1
 134      =2  
 135      =2  sbit P03        =   P0^3;       //I/O¿ÚP0.3
 136      =2  sbit P02        =   P0^2;       //I/O¿ÚP0.2
 137      =2  sbit P01        =   P0^1;       //I/O¿ÚP0.1
 138      =2  sbit P00        =   P0^0;       //I/O¿ÚP0.0
 139      =2  
 140      =2  /////////////////////////////////
 141      =2  
C51 COMPILER V8.08   UART                                                                  01/26/2011 09:34:32 PAGE 8   

 142      =2  sfr  P1         =   0x90;       //I/O¶Ë¿Ú0              Bit7    Bit6    Bit5    Bit4    Bit3    Bit2    Bi
             -t1    Bit0
 143      =2                                  //Î»ÃèÊö                P1.7    P1.6    P1.5    P1.4    P1.3    P1.2    P1
             -.1    P1.0
 144      =2                                  //³õÊ¼Öµ=1111,1111      1       1       1       1       1       1       1 
             -      1
 145      =2  
 146      =2  sbit P17        =   P1^7;       //I/O¿ÚP1.7
 147      =2  sbit P16        =   P1^6;       //I/O¿ÚP1.6
 148      =2  sbit P15        =   P1^5;       //I/O¿ÚP1.5
 149      =2  sbit P14        =   P1^4;       //I/O¿ÚP1.4
 150      =2  sbit P13        =   P1^3;       //I/O¿ÚP1.3
 151      =2  sbit P12        =   P1^2;       //I/O¿ÚP1.2
 152      =2  sbit P11        =   P1^1;       //I/O¿ÚP1.1
 153      =2  sbit P10        =   P1^0;       //I/O¿ÚP1.0
 154      =2  
 155      =2  sbit ADCIN7     =   P1^7;       //ADCÍ¨µÀ7µÄÄ£ÄâÐÅºÅÊäÈë½Å
 156      =2  sbit ADCIN6     =   P1^6;       //ADCÍ¨µÀ6µÄÄ£ÄâÐÅºÅÊäÈë½Å
 157      =2  sbit ADCIN5     =   P1^5;       //ADCÍ¨µÀ5µÄÄ£ÄâÐÅºÅÊäÈë½Å
 158      =2  sbit ADCIN4     =   P1^4;       //ADCÍ¨µÀ4µÄÄ£ÄâÐÅºÅÊäÈë½Å
 159      =2  sbit ADCIN3     =   P1^3;       //ADCÍ¨µÀ3µÄÄ£ÄâÐÅºÅÊäÈë½Å
 160      =2  sbit ADCIN2     =   P1^2;       //ADCÍ¨µÀ2µÄÄ£ÄâÐÅºÅÊäÈë½Å
 161      =2  sbit ADCIN1     =   P1^1;       //ADCÍ¨µÀ1µÄÄ£ÄâÐÅºÅÊäÈë½Å
 162      =2  sbit ADCIN0     =   P1^0;       //ADCÍ¨µÀ0µÄÄ£ÄâÐÅºÅÊäÈë½Å
 163      =2  
 164      =2  sbit SPISCLK    =   P1^7;       //SPI×ÜÏßµÄÊ±ÖÓ½Å
 165      =2  sbit SPIMISO    =   P1^6;       //SPI×ÜÏßµÄÖ÷³ö´ÓÈë½Å
 166      =2  sbit SPIMOSI    =   P1^5;       //SPI×ÜÏßµÄÖ÷Èë´Ó³ö½Å
 167      =2  sbit SPISS      =   P1^4;       //SPI×ÜÏßµÄ´Ó»úÑ¡Ôñ½Å
 168      =2  
 169      =2  sbit T1CLKO     =   P1^1;       //¶¨Ê±Æ÷1Ê±ÖÓÒç³öÂö³åÊä³ö½Å
 170      =2  sbit T0CLKO     =   P1^0;       //¶¨Ê±Æ÷0Ê±ÖÓÒç³öÂö³åÊä³ö½Å
 171      =2  
 172      =2  /////////////////////////////////
 173      =2  
 174      =2  sfr  P2         =   0xa0;       //I/O¶Ë¿Ú2              Bit7    Bit6    Bit5    Bit4    Bit3    Bit2    Bi
             -t1    Bit0
 175      =2                                  //Î»ÃèÊö                P2.7    P2.6    P2.5    P2.4    P2.3    P2.2    P2
             -.1    P2.0
 176      =2                                  //³õÊ¼Öµ=1111,1111      1       1       1       1       1       1       1 
             -      1
 177      =2  
 178      =2  sbit P27        =   P2^7;       //I/O¿ÚP2.7
 179      =2  sbit P26        =   P2^6;       //I/O¿ÚP2.6
 180      =2  sbit P25        =   P2^5;       //I/O¿ÚP2.5
 181      =2  sbit P24        =   P2^4;       //I/O¿ÚP2.4
 182      =2  sbit P23        =   P2^3;       //I/O¿ÚP2.3
 183      =2  sbit P22        =   P2^2;       //I/O¿ÚP2.2
 184      =2  sbit P21        =   P2^1;       //I/O¿ÚP2.1
 185      =2  sbit P20        =   P2^0;       //I/O¿ÚP2.0
 186      =2  
 187      =2  sbit CEX3       =   P2^4;       //±È½Ï/²¶»ñ/PWM3Íâ²¿Òý½Å
 188      =2  sbit CEX2       =   P2^0;       //±È½Ï/²¶»ñ/PWM2Íâ²¿Òý½Å
 189      =2  
 190      =2  /////////////////////////////////
 191      =2  
 192      =2  sfr  P3         =   0xb0;       //I/O¶Ë¿Ú3              Bit7    Bit6    Bit5    Bit4    Bit3    Bit2    Bi
             -t1    Bit0
 193      =2                                  //Î»ÃèÊö                P3.7    -       P3.5    P3.4    P3.3    P3.2    P3
             -.1    P3.0
 194      =2                                  //³õÊ¼Öµ=1x11,1111      1       x       1       1       1       1       1 
             -      1
C51 COMPILER V8.08   UART                                                                  01/26/2011 09:34:32 PAGE 9   

 195      =2  
 196      =2  sbit P37        =   P3^7;       //I/O¿ÚP3.7
 197      =2  sbit P35        =   P3^5;       //I/O¿ÚP3.5
 198      =2  sbit P34        =   P3^4;       //I/O¿ÚP3.4
 199      =2  sbit P33        =   P3^3;       //I/O¿ÚP3.3
 200      =2  sbit P32        =   P3^2;       //I/O¿ÚP3.2
 201      =2  sbit P31        =   P3^1;       //I/O¿ÚP3.1
 202      =2  sbit P30        =   P3^0;       //I/O¿ÚP3.0
 203      =2  
 204      =2  sbit RXD        =   P3^0;       //´®¿Ú1µÄÊý¾Ý½ÓÊÕ¿Ú
 205      =2  sbit TXD        =   P3^1;       //´®¿Ú1µÄÊý¾Ý·¢ËÍ¿Ú
 206      =2  sbit INT0       =   P3^2;       //Íâ²¿ÖÐ¶Ï0µÄÐÅºÅÊäÈë¿Ú
 207      =2  sbit INT1       =   P3^3;       //Íâ²¿ÖÐ¶Ï1µÄÐÅºÅÊä³ö¿Ú
 208      =2  sbit T0         =   P3^4;       //¶¨Ê±Æ÷0µÄÍâ²¿ÐÅºÅÊäÈë¿Ú
 209      =2  sbit T1         =   P3^5;       //¶¨Ê±Æ÷1µÄÍâ²¿ÐÅºÅÊäÈë¿Ú
 210      =2  
 211      =2  sbit CEX0       =   P3^7;       //±È½Ï/²¶»ñ/PWM0Íâ²¿Òý½Å
 212      =2  sbit CEX1       =   P3^5;       //±È½Ï/²¶»ñ/PWM1Íâ²¿Òý½Å
 213      =2  sbit ECI        =   P3^4;       //±È½Ï/²¶»ñ/PWMÄ£¿éµÄÍâ²¿Ê±ÖÓÊäÈë½Å(×î´óÖµÎªFosc/2)
 214      =2  
 215      =2  /////////////////////////////////
 216      =2  
 217      =2  sfr  P1M0       =   0x91;       //I/O¿Ú1Ä£Ê½¿ØÖÆÆ÷1     Bit7    Bit6    Bit5    Bit4    Bit3    Bit2    Bi
             -t1    Bit0
 218      =2                                  //³õ/Ê¼Öµ=0000,0000     0       0       0       0       0       0       0 
             -      0
 219      =2  
 220      =2  /////////////////////////////////
 221      =2  
 222      =2  sfr  P1M1       =   0x92;       //I/O¿Ú1Ä£Ê½¿ØÖÆÆ÷0     Bit7    Bit6    Bit5    Bit4    Bit3    Bit2    Bi
             -t1    Bit0
 223      =2                                  //³õÊ¼Öµ=0000,0000      0       0       0       0       0       0       0 
             -      0
 224      =2  
 225      =2  /////////////////////////////////
 226      =2  
 227      =2  sfr  P0M0       =   0x93;       //I/O¿Ú0Ä£Ê½¿ØÖÆÆ÷1     Bit7    Bit6    Bit5    Bit4    Bit3    Bit2    Bi
             -t1    Bit0
 228      =2                                  //³õÊ¼Öµ=0000,0000      0       0       0       0       0       0       0 
             -      0
 229      =2  
 230      =2  /////////////////////////////////
 231      =2  
 232      =2  sfr  P0M1       =   0x94;       //I/O¿Ú0Ä£Ê½¿ØÖÆÆ÷0     Bit7    Bit6    Bit5    Bit4    Bit3    Bit2    Bi
             -t1    Bit0
 233      =2                                  //³õÊ¼Öµ=0000,0000      0       0       0       0       0       0       0 
             -      0
 234      =2  
 235      =2  /////////////////////////////////
 236      =2  
 237      =2  sfr  P2M0       =   0x95;       //I/O¿Ú2Ä£Ê½¿ØÖÆÆ÷1     Bit7    Bit6    Bit5    Bit4    Bit3    Bit2    Bi
             -t1    Bit0
 238      =2                                  //³õÊ¼Öµ=0000,0000      0       0       0       0       0       0       0 
             -      0
 239      =2  
 240      =2  /////////////////////////////////
 241      =2  
 242      =2  sfr  P2M1       =   0x96;       //I/O¿Ú2Ä£Ê½¿ØÖÆÆ÷0     Bit7    Bit6    Bit5    Bit4    Bit3    Bit2    Bi
             -t1    Bit0
 243      =2                                  //³õÊ¼Öµ=0000,0000      0       0       0       0       0       0       0 
             -      0
 244      =2  
C51 COMPILER V8.08   UART                                                                  01/26/2011 09:34:32 PAGE 10  

 245      =2  /////////////////////////////////
 246      =2  
 247      =2  sfr  P3M0       =   0xb1;       //I/O¿Ú3Ä£Ê½¿ØÖÆÆ÷1     Bit7    Bit6    Bit5    Bit4    Bit3    Bit2    Bi
             -t1    Bit0
 248      =2                                  //³õ/Ê¼Öµ=0000,0000     0       0       0       0       0       0       0 
             -      0
 249      =2  
 250      =2  /////////////////////////////////
 251      =2  
 252      =2  sfr  P3M1       =   0xb2;       //I/O¿Ú3Ä£Ê½¿ØÖÆÆ÷0     Bit7    Bit6    Bit5    Bit4    Bit3    Bit2    Bi
             -t1    Bit0
 253      =2                                  //³õÊ¼Öµ=0000,0000      0       0       0       0       0       0       0 
             -      0
 254      =2  
 255      =2  /////////////////////////////////
 256      =2  
 257      =2  // PxM0 PxM1
 258      =2  //  0    0     ×¼Ë«Ïò¿Ú
 259      =2  //  0    1     Ç¿ÍÆÍìÊä³ö
 260      =2  //  1    0     ¸ß×èÊäÈëÌ¬
 261      =2  //  1    1     ¿ªÂ©Êä³ö
 262      =2  
 263      =2  //////////////////////////////////////////////////////////////////////////////////////////////////////////
             -//////
 264      =2  
 265      =2  sfr  IE         =   0xa8;       //ÖÐ¶ÏÊ¹ÄÜ¼Ä´æÆ÷        Bit7    Bit6    Bit5    Bit4    Bit3    Bit2    Bi
             -t1    Bit0
 266      =2                                  //Î»ÃèÊö                EA   EPCA_LVD EADC_SPI  ES      ET1     EX1     ET
             -0     EX0
 267      =2                                  //³õÊ¼Öµ=0000,0000      0       0       0       0       0       0       0 
             -      0
 268      =2  
 269      =2  sbit EA         =   IE^7;       //×ÜÖÐ¶Ï¿ª¹Ø
 270      =2  sbit EPCA_LVD   =   IE^6;       //PCAºÍLVD×ÜÖÐ¶ÏÊ¹ÄÜÎ»,Òª´ò¿ªPCA/LVDÖÐ¶Ï,»¹ÐèÒªÊ¹ÄÜCCAPMn.ECCFn/AUXR.ELVDI
 271      =2  sbit EADC_SPI   =   IE^5;       //ADCºÍSPI×ÜÖÐ¶ÏÊ¹ÄÜÎ»,Òª´ò¿ªADC/SPIÖÐ¶Ï,»¹ÐèÒªÊ¹ÄÜAUXR.EADCI/AUXR.ESPII
 272      =2  sbit ES         =   IE^4;       //´®¿ÚÖÐ¶ÏÊ¹ÄÜÎ»
 273      =2  sbit ET1        =   IE^3;       //¶¨Ê±Æ÷1ÖÐ¶ÏÊ¹ÄÜÎ»
 274      =2  sbit EX1        =   IE^2;       //Íâ²¿ÖÐ¶Ï1ÖÐ¶ÏÊ¹ÄÜÎ»
 275      =2  sbit ET0        =   IE^1;       //¶¨Ê±Æ÷0ÖÐ¶ÏÊ¹ÄÜÎ»
 276      =2  sbit EX0        =   IE^0;       //Íâ²¿ÖÐ¶Ï0ÖÐ¶ÏÊ¹ÄÜÎ»
 277      =2  
 278      =2  /////////////////////////////////
 279      =2  
 280      =2  #define X0_INTNO    0           //Íâ²¿ÖÐ¶Ï0ÖÐ¶ÏºÅ,Èë¿ÚµØÖ·Îª0003H
 281      =2  #define T0_INTNO    1           //¶¨Ê±Æ÷0ÖÐ¶ÏºÅ,Èë¿ÚµØÖ·Îª000BH
 282      =2  #define X1_INTNO    2           //Íâ²¿ÖÐ¶Ï1ÖÐ¶ÏºÅ,Èë¿ÚµØÖ·Îª0013H
 283      =2  #define T1_INTNO    3           //¶¨Ê±Æ÷1ÖÐ¶ÏºÅ,Èë¿ÚµØÖ·Îª001BH
 284      =2  #define UART_INTNO  4           //´®¿ÚÖÐ¶ÏºÅ,Èë¿ÚµØÖ·Îª0023H
 285      =2  #define ADC_SPI_INTNO   5       //SPI/ADCÖÐ¶ÏºÅ,Èë¿ÚµØÖ·Îª002BH
 286      =2  #define PCA_LVD_INTNO   6       //PCA/LVDÖÐ¶ÏºÅ,Èë¿ÚµØÖ·Îª0033H
 287      =2  
 288      =2  /////////////////////////////////
 289      =2  
 290      =2  sfr  IPH        =   0xb7;       //ÖÐ¶ÏÓÅÏÈ¼¶¼Ä´æÆ÷¸ßÎ»  Bit7    Bit6    Bit5    Bit4    Bit3    Bit2    Bi
             -t1    Bit0
 291      =2                                  //Î»ÃèÊö                -    PCA_LVDH PADC_SPIH PSH     PT1H    PX1H    PT
             -0H    PX0H
 292      =2                                  //³õÊ¼Öµ=x000,0000      x       0       0       0       0       0       0 
             -      0
 293      =2  
 294      =2  #define PPCA_LVDH   0x40        //PCA/LVDÖÐ¶ÏÓÅÏÈ¼¶¿ØÖÆ¸ßÎ»
 295      =2  #define PADC_SPIH   0x20        //ADC/SPIÖÐ¶ÏÓÅÏÈ¼¶¿ØÖÆ¸ßÎ»
C51 COMPILER V8.08   UART                                                                  01/26/2011 09:34:32 PAGE 11  

 296      =2  #define PSH         0x10        //´®¿ÚÖÐ¶ÏÓÅÏÈ¼¶¿ØÖÆ¸ßÎ»
 297      =2  #define PT1H        0x08        //¶¨Ê±Æ÷1ÖÐ¶ÏÓÅÏÈ¼¶¿ØÖÆ¸ßÎ»
 298      =2  #define PX1H        0x04        //Íâ²¿ÖÐ¶Ï1ÖÐ¶ÏÓÅÏÈ¼¶¿ØÖÆ¸ßÎ»
 299      =2  #define PT0H        0x02        //¶¨Ê±Æ÷0ÖÐ¶ÏÓÅÏÈ¼¶¿ØÖÆ¸ßÎ»
 300      =2  #define PX0H        0x01        //Íâ²¿ÖÐ¶Ï0ÖÐ¶ÏÓÅÏÈ¼¶¿ØÖÆ¸ßÎ»
 301      =2  
 302      =2  /////////////////////////////////
 303      =2  
 304      =2  sfr  IP         =   0xb8;       //ÖÐ¶ÏÓÅÏÈ¼¶¼Ä´æÆ÷      Bit7    Bit6    Bit5    Bit4    Bit3    Bit2    Bi
             -t1    Bit0
 305      =2                                  //Î»ÃèÊö                -    PPCA_LVD PADC_SPI  PS      PT1     PX1     PT
             -0     PX0
 306      =2                                  //³õÊ¼Öµ=x000,0000      x       0       0       0       0       0       0 
             -      0
 307      =2  
 308      =2  sbit PPCA_LVD   =   IP^6;       //PCA/LVDÖÐ¶ÏÓÅÏÈ¼¶¿ØÖÆµÍÎ»
 309      =2  sbit PADC_SPI   =   IP^5;       //ADC/SPIÖÐ¶ÏÓÅÏÈ¼¶¿ØÖÆµÍÎ»
 310      =2  sbit PS         =   IP^4;       //´®¿ÚÖÐ¶ÏÓÅÏÈ¼¶¿ØÖÆµÍÎ»
 311      =2  sbit PT1        =   IP^3;       //¶¨Ê±Æ÷1ÖÐ¶ÏÓÅÏÈ¼¶¿ØÖÆµÍÎ»
 312      =2  sbit PX1        =   IP^2;       //Íâ²¿ÖÐ¶Ï1ÖÐ¶ÏÓÅÏÈ¼¶¿ØÖÆµÍÎ»
 313      =2  sbit PT0        =   IP^1;       //¶¨Ê±Æ÷0ÖÐ¶ÏÓÅÏÈ¼¶¿ØÖÆµÍÎ»
 314      =2  sbit PX0        =   IP^0;       //Íâ²¿ÖÐ¶Ï0ÖÐ¶ÏÓÅÏÈ¼¶¿ØÖÆµÍÎ»
 315      =2  
 316      =2  //////////////////////////////////////////////////////////////////////////////////////////////////////////
             -//////
 317      =2  
 318      =2  sfr  TCON       =   0x88;       //¶¨Ê±Æ÷0/1¿ØÖÆ¼Ä´æÆ÷   Bit7    Bit6    Bit5    Bit4    Bit3    Bit2    Bi
             -t1    Bit0
 319      =2                                  //Î»ÃèÊö                TF1     TR1     TF0     TR0     IE1     IT1     IE
             -0     IT0
 320      =2                                  //³õÊ¼Öµ=0000,0000      0       0       0       0       0       0       0 
             -      0
 321      =2  
 322      =2  sbit TF1        = TCON^7;       //¶¨Ê±Æ÷1Òç³ö±êÖ¾,ÓÉÓ²¼þÖÃ1,¿ÉÓÉÈí¼þÇå0»òÕßÔÚÖÐ¶Ï´¦Àí³ÌÐòÍê³ÉºóÓÉÓ²¼þ×Ô¶¯Ç
             -å0
 323      =2  sbit TR1        = TCON^6;       //¶¨Ê±Æ÷1µÄÆô¶¯¿ØÖÆÎ»,1:Æô¶¯¶¨Ê±Æ÷ 0:Í£Ö¹¶¨Ê±Æ÷
 324      =2  sbit TF0        = TCON^5;       //¶¨Ê±Æ÷0Òç³ö±êÖ¾,ÓÉÓ²¼þÖÃ1,¿ÉÓÉÈí¼þÇå0»òÕßÔÚÖÐ¶Ï´¦Àí³ÌÐòÍê³ÉºóÓÉÓ²¼þ×Ô¶¯Ç
             -å0
 325      =2  sbit TR0        = TCON^4;       //¶¨Ê±Æ÷0µÄÆô¶¯¿ØÖÆÎ»,1:Æô¶¯¶¨Ê±Æ÷ 0:Í£Ö¹¶¨Ê±Æ÷
 326      =2  sbit IE1        = TCON^3;       //Íâ²¿ÖÐ¶Ï1µÄÖÐ¶ÏÇëÇóÎ»,ÓÉÓ²¼þÖÃ1,¿ÉÓÉÈí¼þÇå0»òÕßÔÚÖÐ¶Ï´¦Àí³ÌÐòÍê³ÉºóÓÉÓ²¼
             -þ×Ô¶¯Çå0
 327      =2  sbit IT1        = TCON^2;       //Íâ²¿ÖÐ¶Ï1µÄ´¥·¢ÀàÐÍ,0:µÍµçÆ½´¥·¢Íâ²¿ÖÐ¶Ï 1:ÏÂ½µÑØ´¥·¢Íâ²¿ÖÐ¶Ï
 328      =2  sbit IE0        = TCON^1;       //Íâ²¿ÖÐ¶Ï0µÄÖÐ¶ÏÇëÇóÎ»,ÓÉÓ²¼þÖÃ1,¿ÉÓÉÈí¼þÇå0»òÕßÔÚÖÐ¶Ï´¦Àí³ÌÐòÍê³ÉºóÓÉÓ²¼
             -þ×Ô¶¯Çå0
 329      =2  sbit IT0        = TCON^0;       //Íâ²¿ÖÐ¶Ï0µÄ´¥·¢ÀàÐÍ,0:µÍµçÆ½´¥·¢Íâ²¿ÖÐ¶Ï 1:ÏÂ½µÑØ´¥·¢Íâ²¿ÖÐ¶Ï
 330      =2  
 331      =2  /////////////////////////////////
 332      =2  
 333      =2  sfr  TMOD       =   0x89;       //¶¨Ê±Æ÷0/1Ä£Ê½¼Ä´æÆ÷   Bit7    Bit6    Bit5    Bit4    Bit3    Bit2    Bi
             -t1    Bit0
 334      =2                                  //Î»ÃèÊö                GATE    C/T#    M1      M0      GATE    C/T#    M1
             -      M0
 335      =2                                  //³õÊ¼Öµ=0000,0000      0       0       0       0       0       0       0 
             -      0
 336      =2  
 337      =2  #define GATE1       0x80        //¶¨Ê±Æ÷1Æô¶¯¿ØÖÆÎ»,0:TR1Îª1Ê±Æô¶¯¶¨Ê±Æ÷1 1:TR1Îª1ÇÒINT1Îª¸ßµçÆ½Ê±²ÅÆô¶¯¶¨
             -Ê±Æ÷1
 338      =2  #define C_T1        0x40        //¶¨Ê±Æ÷/¼ÆÊýÆ÷Ñ¡ÔñÎ»,0:¶¨Ê±Æ÷(Ê±ÖÓÔ´ÎªÄÚ²¿Ê±ÖÓ) 1:¼ÆÊýÆ÷(Ê±ÖÓÔ´ÎªT1Òý½ÅµÄ
             -Íâ²¿Ê±ÖÓ)
 339      =2  #define T1_M0       0x00        //¶¨Ê±Æ÷1²Ù×÷Ä£Ê½0:13Î»¶¨Ê±Æ÷
 340      =2  #define T1_M1       0x10        //¶¨Ê±Æ÷1²Ù×÷Ä£Ê½1:16Î»¶¨Ê±Æ÷
 341      =2  #define T1_M2       0x20        //¶¨Ê±Æ÷1²Ù×÷Ä£Ê½2:8Î»×Ô¶¯ÖØÔØ¶¨Ê±Æ÷
C51 COMPILER V8.08   UART                                                                  01/26/2011 09:34:32 PAGE 12  

 342      =2  #define T1_M3       0x30        //¶¨Ê±Æ÷1²Ù×÷Ä£Ê½3:¶¨Ê±Æ÷1Í£Ö¹
 343      =2  #define GATE0       0x08        //¶¨Ê±Æ÷1Æô¶¯¿ØÖÆÎ»,0:TR0Îª1Ê±Æô¶¯¶¨Ê±Æ÷1 1:TR0Îª1ÇÒINT0Îª¸ßµçÆ½Ê±²ÅÆô¶¯¶¨
             -Ê±Æ÷0
 344      =2  #define C_T0        0x04        //¶¨Ê±Æ÷/¼ÆÊýÆ÷Ñ¡ÔñÎ»,0:¶¨Ê±Æ÷(Ê±ÖÓÔ´ÎªÄÚ²¿Ê±ÖÓ) 1:¼ÆÊýÆ÷(Ê±ÖÓÔ´ÎªT0Òý½ÅµÄ
             -Íâ²¿Ê±ÖÓ)
 345      =2  #define T0_M0       0x00        //¶¨Ê±Æ÷0²Ù×÷Ä£Ê½0:13Î»¶¨Ê±Æ÷
 346      =2  #define T0_M1       0x01        //¶¨Ê±Æ÷0²Ù×÷Ä£Ê½1:16Î»¶¨Ê±Æ÷
 347      =2  #define T0_M2       0x02        //¶¨Ê±Æ÷0²Ù×÷Ä£Ê½2:8Î»×Ô¶¯ÖØÔØ¶¨Ê±Æ÷
 348      =2  #define T0_M3       0x03        //¶¨Ê±Æ÷0²Ù×÷Ä£Ê½3:TL0ºÍTH0ÎªÁ½×é¶ÀÁ¢8Î»¶¨Ê±Æ÷
 349      =2  
 350      =2  /////////////////////////////////
 351      =2  
 352      =2  sfr  TL0        = 0x8a;         //¶¨Ê±Æ÷0µÄµÍ8Î»¼ÆÊýÖµ  Bit7    Bit6    Bit5    Bit4    Bit3    Bit2    Bi
             -t1    Bit0
 353      =2                                  //³õÊ¼Öµ=0000,0000      0       0       0       0       0       0       0 
             -      0
 354      =2  
 355      =2  /////////////////////////////////
 356      =2  
 357      =2  sfr  TL1        = 0x8b;         //¶¨Ê±Æ÷1µÄµÍ8Î»¼ÆÊýÖµ  Bit7    Bit6    Bit5    Bit4    Bit3    Bit2    Bi
             -t1    Bit0
 358      =2                                  //³õÊ¼Öµ=0000,0000      0       0       0       0       0       0       0 
             -      0
 359      =2  
 360      =2  /////////////////////////////////
 361      =2  
 362      =2  sfr  TH0        = 0x8c;         //¶¨Ê±Æ÷0µÄ¸ß8Î»¼ÆÊýÖµ  Bit7    Bit6    Bit5    Bit4    Bit3    Bit2    Bi
             -t1    Bit0
 363      =2                                  //³õÊ¼Öµ=0000,0000      0       0       0       0       0       0       0 
             -      0
 364      =2  
 365      =2  /////////////////////////////////
 366      =2  
 367      =2  sfr  TH1        = 0x8d;         //¶¨Ê±Æ÷1µÄ¸ß8Î»¼ÆÊýÖµ  Bit7    Bit6    Bit5    Bit4    Bit3    Bit2    Bi
             -t1    Bit0
 368      =2                                  //³õÊ¼Öµ=0000,0000      0       0       0       0       0       0       0 
             -      0
 369      =2  
 370      =2  //////////////////////////////////////////////////////////////////////////////////////////////////////////
             -//////
 371      =2  
 372      =2  sfr  SCON       =   0x98;       //´®¿Ú¿ØÖÆ¼Ä´æÆ÷        Bit7    Bit6    Bit5    Bit4    Bit3    Bit2    Bi
             -t1    Bit0
 373      =2                                  //Î»ÃèÊö                SM0/FE  SM1     SM2     REN     TB8     RB8     TI
             -      Ri
 374      =2                                  //³õÊ¼Öµ=0000,0000      0       0       0       0       0       0       0 
             -      0
 375      =2  
 376      =2  sbit FE         =   SCON^7;     //Ö¡´íÎó¼ì²âÎ»,µ±´®¿ÚÄ£¿éÔÚ½ÓÊÕÊý¾ÝÊ±Ã»ÓÐ¼ì²âµ½ÕýÈ·µÄÍ£Ö¹Î»Ê±,FE±»Ó²¼þÖÃ1,
             -ÐèÒªÓÉÈí¼þÀ´Çå0(µ±SMOD0Îª1Ê±,FEÓÐÐ§)
 377      =2  sbit SM0        =   SCON^7;     //´®¿ÚÄ£Ê½ÉèÖÃÎ»
 378      =2  sbit SM1        =   SCON^6;     //SM0/SM1=0/0:ÒÆÎ»¼Ä´æÆ÷ 0/1:8Î»¿É±ä²¨ÌØÂÊ 1/0:9Î»¹Ì¶¨²¨ÌØÂÊ 1/1:9Î»¿É±ä²¨
             -ÌØÂÊ
 379      =2  sbit SM2        =   SCON^5;     //×Ô¶¯µØÖ·Ê¶±ðÊ¹ÄÜÎ»
 380      =2  sbit REN        =   SCON^4;     //Ê¹ÄÜ´®¿Ú½ÓÊÕÄ£¿é
 381      =2  sbit TB8        =   SCON^3;     //·¢ËÍµÄµÚ9Î»Êý¾Ý
 382      =2  sbit RB8        =   SCON^2;     //½ÓÊÕµÄµÚ9Î»Êý¾Ý
 383      =2  sbit TI         =   SCON^1;     //·¢ËÍÍê³ÉÖÐ¶Ï±êÖ¾
 384      =2  sbit RI         =   SCON^0;     //½ÓÊÕÍê³ÉÖÐ¶Ï±êÖ¾
 385      =2  
 386      =2  /////////////////////////////////
 387      =2  
C51 COMPILER V8.08   UART                                                                  01/26/2011 09:34:32 PAGE 13  

 388      =2  sfr  SBUF       =   0x99;       //´®¿Ú½ÓÊÕ/·¢ËÍÊý¾Ý     Bit7    Bit6    Bit5    Bit4    Bit3    Bit2    Bi
             -t1    Bit0
 389      =2                                  //³õÊ¼Öµ=xxxx,xxxx      x       x       x       x       x       x       x 
             -      x
 390      =2  
 391      =2  /////////////////////////////////
 392      =2  
 393      =2  sfr  SADDR      =   0xa9;       //´®¿ÚÉè±¸´ÓµØÖ·¼Ä´æÆ÷  Bit7    Bit6    Bit5    Bit4    Bit3    Bit2    Bi
             -t1    Bit0
 394      =2                                  //³õÊ¼Öµ=0000,0000      0       0       0       0       0       0       0 
             -      0
 395      =2  
 396      =2  /////////////////////////////////
 397      =2  
 398      =2  sfr  SADEN      =   0xb9;       //´®¿ÚÉè±¸´ÓµØÖ·ÆÁ±ÎÎ»  Bit7    Bit6    Bit5    Bit4    Bit3    Bit2    Bi
             -t1    Bit0
 399      =2                                  //³õÊ¼Öµ=0000,0000      0       0       0       0       0       0       0 
             -      0
 400      =2  
 401      =2  //////////////////////////////////////////////////////////////////////////////////////////////////////////
             -//////
 402      =2  
 403      =2  sfr  ADC_CONTR  =   0xc5;       //ADC¿ØÖÆ¼Ä´æÆ÷         Bit7    Bit6    Bit5    Bit4    Bit3    Bit2    Bi
             -t1    Bit0
 404      =2                                  //Î»ÃèÊö            ADC_POWER  SPEED1 SPEED0 ADC_FLAG ADC_START CHS2    CH
             -S1    CHS0
 405      =2                                  //³õÊ¼Öµ=0000,0000      0       0       0       0       0       0       0 
             -      0
 406      =2  
 407      =2  #define ADC_POWER   0x80        //ADCÄ£¿éµçÔ´¿ØÖÆÎ»
 408      =2  #define ADC_SPEEDLL 0x00        //Ã¿´Î×ª»»ÐèÒª1080¸öÊ±ÖÓÖÜÆÚ
 409      =2  #define ADC_SPEEDL  0x20        //Ã¿´Î×ª»»ÐèÒª810¸öÊ±ÖÓÖÜÆÚ
 410      =2  #define ADC_SPEEDH  0x40        //Ã¿´Î×ª»»ÐèÒª540¸öÊ±ÖÓÖÜÆÚ
 411      =2  #define ADC_SPEEDHH 0x60        //Ã¿´Î×ª»»ÐèÒª270¸öÊ±ÖÓÖÜÆÚ
 412      =2  #define ADC_FLAG    0x10        //ADC×ª»»Íê³É±êÖ¾
 413      =2  #define ADC_START   0x08        //ADC¿ªÊ¼×ª»»¿ØÖÆÎ»
 414      =2  #define ADC_CHS2    0x04        //ADCÍ¨µÀÑ¡ÔñÎ»2
 415      =2  #define ADC_CHS1    0x02        //ADCÍ¨µÀÑ¡ÔñÎ»1
 416      =2  #define ADC_CHS0    0x01        //ADCÍ¨µÀÑ¡ÔñÎ»0
 417      =2  
 418      =2  /////////////////////////////////
 419      =2  
 420      =2  sfr  ADC_DATA   =   0xc6;       //ADC½á¹û¸ß×Ö½Ú         Bit7    Bit6    Bit5    Bit4    Bit3    Bit2    Bi
             -t1    Bit0
 421      =2                                  //³õÊ¼Öµ=0000,0000      0       0       0       0       0       0       0 
             -      0
 422      =2  
 423      =2  /////////////////////////////////
 424      =2  
 425      =2  sfr  ADC_LOW2   =   0xbe;       //ADC½á¹ûµÍ×Ö½Ú         Bit7    Bit6    Bit5    Bit4    Bit3    Bit2    Bi
             -t1    Bit0
 426      =2                                  //³õÊ¼Öµ=0000,0000      0       0       0       0       0       0       0 
             -      0
 427      =2  
 428      =2  //////////////////////////////////////////////////////////////////////////////////////////////////////////
             -//////
 429      =2  
 430      =2  sfr  ISP_DATA   =   0xe2;       //ISPÊý¾Ý¼Ä´æÆ÷         Bit7    Bit6    Bit5    Bit4    Bit3    Bit2    Bi
             -t1    Bit0
 431      =2                                  //³õÊ¼Öµ=1111,1111      1       1       1       1       1       1       1 
             -      1
 432      =2  
C51 COMPILER V8.08   UART                                                                  01/26/2011 09:34:32 PAGE 14  

 433      =2  /////////////////////////////////
 434      =2  
 435      =2  sfr  ISP_ADDRH  =   0xe3;       //ISPµØÖ·¸ßÎ»¼Ä´æÆ÷     Bit7    Bit6    Bit5    Bit4    Bit3    Bit2    Bi
             -t1    Bit0
 436      =2                                  //³õÊ¼Öµ=0000,0000      0       0       0       0       0       0       0 
             -      0
 437      =2  
 438      =2  /////////////////////////////////
 439      =2  
 440      =2  sfr  ISP_ADDRL  =   0xe4;       //ISPµØÖ·µÍÎ»¼Ä´æÆ÷     Bit7    Bit6    Bit5    Bit4    Bit3    Bit2    Bi
             -t1    Bit0
 441      =2                                  //³õÊ¼Öµ=0000,0000      0       0       0       0       0       0       0 
             -      0
 442      =2  
 443      =2  /////////////////////////////////
 444      =2  
 445      =2  sfr  ISP_CMD    =   0xe5;       //ISPÃüÁî¼Ä´æÆ÷         Bit7    Bit6    Bit5    Bit4    Bit3    Bit2    Bi
             -t1    Bit0
 446      =2                                  //³õÊ¼Öµ=xxxx,xx00      x       x       x       x       x       x       0 
             -      0
 447      =2  
 448      =2  #define ISP_IDLE    0x00        //ISP´ý»úÃüÁî
 449      =2  #define ISP_READ    0x01        //ISP¶Á×Ö½ÚÊý¾ÝÃüÁî
 450      =2  #define ISP_PROGRAM 0x02        //ISP×Ö½Ú±à³ÌÃüÁî
 451      =2  #define ISP_ERASE   0x03        //ISPÉÈÇø²Á³ýÃüÁî(Ã¿ÉÈÇø512×Ö½Ú))
 452      =2  
 453      =2  /////////////////////////////////
 454      =2  
 455      =2  sfr  ISP_TRIG   =   0xe6;       //ISPÃüÁî´¥·¢¼Ä´æÆ÷     Bit7    Bit6    Bit5    Bit4    Bit3    Bit2    Bi
             -t1    Bit0
 456      =2                                  //³õÊ¼Öµ=xxxx,xxxx      x       x       x       x       x       x       x 
             -      x
 457      =2  
 458      =2  #define ISP_TRIG0   0x46        //ISP¹¦ÄÜ´¥·¢ÃüÁî1
 459      =2  #define ISP_TRIG1   0xb9        //ISP¹¦ÄÜ´¥·¢ÃüÁî2
 460      =2  
 461      =2  /////////////////////////////////
 462      =2  
 463      =2  sfr  ISP_CONTR  =   0xe7;       //ISP¿ØÖÆ¼Ä´æÆ÷         Bit7    Bit6    Bit5    Bit4    Bit3    Bit2    Bi
             -t1    Bit0
 464      =2                                  //Î»ÃèÊö                ISPEN   SWBS    SWRST   CMD_FAIL -      WT2     WT
             -1     WT0
 465      =2                                  //³õÊ¼Öµ=0000,0000      0       0       0       0       0       0       0 
             -      0
 466      =2  
 467      =2  #define ISPEN       0x80        //ISPÊ¹ÄÜ¿ª¹Ø
 468      =2  #define SWBS        0x40        //ÈíÆô¶¯Ñ¡Ôñ,0:´ÓÓÃ»§APÆô¶¯ 1:´ÓISPÆô¶¯
 469      =2  #define SWRST       0x20        //´¥·¢Èí¼þ¸´Î»
 470      =2  #define CMD_FAIL    0x10        //ISPÃüÁîÊ§°Ü±êÖ¾
 471      =2  
 472      =2  //////////////////////////////////////////////////////////////////////////////////////////////////////////
             -//////
 473      =2  
 474      =2  sfr  SPSTAT     =   0x84;       //SPI×´Ì¬¼Ä´æÆ÷         Bit7    Bit6    Bit5    Bit4    Bit3    Bit2    Bi
             -t1    Bit0
 475      =2                                  //Î»ÃèÊö                SPIF    WCOL    -       -       -       -       - 
             -      -
 476      =2                                  //³õÊ¼Öµ=11xx,xxxx      1       1       x       x       x       x       x 
             -      x
 477      =2  
 478      =2  #define SPIF        0x80        //SPI´«ÊäÍê³É±êÖ¾,µ±SPIÖÐ¶ÏÊ¹ÄÜÊ±»á´¥·¢SPIÖÐ¶ÏÇëÇó,ÐèÒªÓÃÈí¼þÏò´ËÎ»Ð´"1"À´
             -Çå0
C51 COMPILER V8.08   UART                                                                  01/26/2011 09:34:32 PAGE 15  

 479      =2  #define WCOL        0x40        //SPIÐ´³åÍ»±êÖ¾,ÐèÒªÓÃÈí¼þÏò´ËÎ»Ð´"1"À´Çå0
 480      =2  
 481      =2  /////////////////////////////////
 482      =2  
 483      =2  sfr  SPCTL      =   0x85;       //SPI¿ØÖÆ¼Ä´æÆ÷         Bit7    Bit6    Bit5    Bit4    Bit3    Bit2    Bi
             -t1    Bit0
 484      =2                                  //Î»ÃèÊö                SSIG    SPEN    DORD    MSTR    CPOL    CPHA    SP
             -R1    SPR0
 485      =2                                  //³õÊ¼Öµ=0000,0100      0       0       0       0       0       1       0 
             -      0
 486      =2  
 487      =2  #define SSIG        0x80        //SSºöÂÔÎ»,1:ÓÉMSTRÈ·¶¨Ö÷/´Ó 0:ÓÉSS½ÅÈ·¶¨Ö÷/´Ó
 488      =2  #define SPEN        0x40        //SPIÄ£¿éÊ¹ÄÜÎ»
 489      =2  #define DORD        0x20        //SPIÊý¾ÝË³Ðò,1:LSB(ÏÈÊÕ/·¢×îµÍÎ») 0:MSB(ÏÈÊÕ/·¢×î¸ßÎ»)
 490      =2  #define MSTR        0x10        //Ö÷/´ÓÄ£Ê½Ñ¡ÔñÎ»
 491      =2  #define CPOL        0x08        //SPIÊ±ÖÓ¼«ÐÔ
 492      =2  #define CPHA        0x04        //SPIÏàÎ»Ñ¡Ôñ
 493      =2  #define SPSPEEDHH   0x00        //×î¿ìµÄËÙ¶È,CPU_CLK/4
 494      =2  #define SPSPEEDH    0x01        //×î¿ìµÄËÙ¶È,CPU_CLK/16
 495      =2  #define SPSPEEDL    0x02        //×î¿ìµÄËÙ¶È,CPU_CLK/64
 496      =2  #define SPSPEEDLL   0x03        //×î¿ìµÄËÙ¶È,CPU_CLK/128
 497      =2  
 498      =2  /////////////////////////////////
 499      =2  
 500      =2  sfr  SPDAT      =   0x86;       //SPIÊý¾Ý¼Ä´æÆ÷         Bit7    Bit6    Bit5    Bit4    Bit3    Bit2    Bi
             -t1    Bit0
 501      =2                                  //³õÊ¼Öµ=0000,0000      0       0       0       0       0       0       0 
             -      0
 502      =2  
 503      =2  //////////////////////////////////////////////////////////////////////////////////////////////////////////
             -//////
 504      =2  
 505      =2  sfr  CCON       =   0xd8;       //PCA¿ØÖÆ¼Ä´æÆ÷         Bit7    Bit6    Bit5    Bit4    Bit3    Bit2    Bi
             -t1    Bit0
 506      =2                                  //Î»ÃèÊö                CF      CR      -       -       CCF3    CCF2    CC
             -F1    CCF0
 507      =2                                  //³õÊ¼Öµ=00xx,0000      0       0       x       x       0       0       0 
             -      0
 508      =2  
 509      =2  sbit CF         =   CCON^7;     //PCA¼ÆÊýÆ÷Òç³ö±êÖ¾,µ±PCAÖÐ¶ÏÊ¹ÄÜÊ±»á´¥·¢PCAÖÐ¶ÏÇëÇó,ÐèÒªÓÃÈí¼þÇå0
 510      =2  sbit CR         =   CCON^6;     //PCA¼ÆÊýÆ÷Æô¶¯¿ØÖÆÎ»,Ð´"1"Æô¶¯¶«¼ÆÊýÆ÷
 511      =2  sbit CCF3       =   CCON^3;     //PCAÄ£¿é3ÖÐ¶Ï±êÖ¾,ÐèÒªÓÃÈí¼þÇå0
 512      =2  sbit CCF2       =   CCON^2;     //PCAÄ£¿é2ÖÐ¶Ï±êÖ¾,ÐèÒªÓÃÈí¼þÇå0
 513      =2  sbit CCF1       =   CCON^1;     //PCAÄ£¿é1ÖÐ¶Ï±êÖ¾,ÐèÒªÓÃÈí¼þÇå0
 514      =2  sbit CCF0       =   CCON^0;     //PCAÄ£¿é0ÖÐ¶Ï±êÖ¾,ÐèÒªÓÃÈí¼þÇå0
 515      =2  
 516      =2  /////////////////////////////////
 517      =2  
 518      =2  sfr  CMOD       =   0xd9;       //PCAÄ£Ê½¼Ä´æÆ÷         Bit7    Bit6    Bit5    Bit4    Bit3    Bit2    Bi
             -t1    Bit0
 519      =2                                  //Î»ÃèÊö                CIDL    -       -       -       CPS2    CPS1    CP
             -S0    ECF
 520      =2                                  //³õÊ¼Öµ=0xxx,0000      0       x       x       x       0       0       0 
             -      0
 521      =2  
 522      =2  #define CIDL        0x80        //¼ÆÊ±Æ÷ÕóÁÐ¿ÕÏÐ¿ØÖÆ,0:¿ÕÏÐÄ£Ê½ÏÂPCA¼ÌÐø¹¤×÷ 1:¿ÕÏÐÄ£Ê½ÏÂPCAÍ£Ö¹¹¤×÷
 523      =2  #define PCACLK0     0x00        //Fosc/12
 524      =2  #define PCACLK1     0x02        //Fosc/2
 525      =2  #define PCACLK2     0x04        //¶¨Ê±Æ÷0µÄÒç³öÂÊ
 526      =2  #define PCACLK3     0x06        //ECIÍâ²¿Ê±ÖÓ
 527      =2  #define PCACLK4     0x08        //Fosc/1
 528      =2  #define PCACLK5     0x0a        //Fosc/4
C51 COMPILER V8.08   UART                                                                  01/26/2011 09:34:32 PAGE 16  

 529      =2  #define PCACLK6     0x0c        //Fosc/6
 530      =2  #define PCACLK7     0x0e        //Fosc/8
 531      =2  #define ECF         0x01        //PCA¼ÆÊýÆ÷Òç³öÖÐ¶ÏÔÊÐíÎ»
 532      =2  
 533      =2  /////////////////////////////////
 534      =2  
 535      =2  sfr  CCAPM0     =   0xda;       //PCAÄ£¿é0Ä£Ê½¼Ä´æÆ÷    Bit7    Bit6    Bit5    Bit4    Bit3    Bit2    Bi
             -t1    Bit0
 536      =2                                  //Î»ÃèÊö                -       ECOM0   CAPP0   CAPN0   MAT0    TOG0    PW
             -M0    ECCF0
 537      =2                                  //³õÊ¼Öµ=x000,0000      x       0       0       0       0       0       0 
             -      0
 538      =2  
 539      =2  #define PCA0_ECOM   0x40        //Ê¹ÄÜ±È½ÏÆ÷0
 540      =2  #define PCA0_CAPP   0x20        //Ê¹ÄÜPCAÄ£¿é0µÄÉÏÉýÑØ²¶»ñ
 541      =2  #define PCA0_CAPN   0x10        //Ê¹ÄÜPCAÄ£¿é0µÄÏÂ½µÑØ²¶»ñ
 542      =2  #define PCA0_MAT    0x08        //Æ¥ÅäÊ¹ÄÜ,µ±PCAµÄ¼ÆÊýÖµÓëÄ£¿é0Éè¶¨µÄÖµÏàÆ¥ÅäÊ±,ÖÃCCON.CCF0
 543      =2  #define PCA0_TOG    0x04        //·­×ª¿ØÖÆÎ»,µ±PCAµÄ¼ÆÊýÖµÓëÄ£¿é0Éè¶¨µÄÖµÏàÆ¥ÅäÊ±,·­×ªCEX0µÄµçÆ½
 544      =2  #define PCA0_PWM    0x02        //Âö¿íµ÷ÖÆÄ£Ê½,Ê¹ÄÜCEX0ÎªÂö¿íµ÷ÖÆÊä³ö¿Ú
 545      =2  #define PCA0_ECCF   0x01        //Ê¹ÄÜCCF0ÖÐ¶Ï
 546      =2  
 547      =2  /////////////////////////////////
 548      =2  
 549      =2  sfr  CCAPM1     =   0xdb;       //PCAÄ£¿é1Ä£Ê½¼Ä´æÆ÷    Bit7    Bit6    Bit5    Bit4    Bit3    Bit2    Bi
             -t1    Bit0
 550      =2                                  //Î»ÃèÊö                -       ECOM1   CAPP1   CAPN1   MAT1    TOG1    PW
             -M1    ECCF1
 551      =2                                  //³õÊ¼Öµ=x000,0000      x       0       0       0       0       0       0 
             -      0
 552      =2  
 553      =2  #define PCA1_ECOM   0x40        //Ê¹ÄÜ±È½ÏÆ÷1
 554      =2  #define PCA1_CAPP   0x20        //Ê¹ÄÜPCAÄ£¿é1µÄÉÏÉýÑØ²¶»ñ
 555      =2  #define PCA1_CAPN   0x10        //Ê¹ÄÜPCAÄ£¿é1µÄÏÂ½µÑØ²¶»ñ
 556      =2  #define PCA1_MAT    0x08        //Æ¥ÅäÊ¹ÄÜ,µ±PCAµÄ¼ÆÊýÖµÓëÄ£¿é1Éè¶¨µÄÖµÏàÆ¥ÅäÊ±,ÖÃCCON.CCF1
 557      =2  #define PCA1_TOG    0x04        //·­×ª¿ØÖÆÎ»,µ±PCAµÄ¼ÆÊýÖµÓëÄ£¿é1Éè¶¨µÄÖµÏàÆ¥ÅäÊ±,·­×ªCEX1µÄµçÆ½
 558      =2  #define PCA1_PWM    0x02        //Âö¿íµ÷ÖÆÄ£Ê½,Ê¹ÄÜCEX1ÎªÂö¿íµ÷ÖÆÊä³ö¿Ú
 559      =2  #define PCA1_ECCF   0x01        //Ê¹ÄÜCCF1ÖÐ¶Ï
 560      =2  
 561      =2  /////////////////////////////////
 562      =2  
 563      =2  sfr  CCAPM2     =   0xdc;       //PCAÄ£¿é2Ä£Ê½¼Ä´æÆ÷    Bit7    Bit6    Bit5    Bit4    Bit3    Bit2    Bi
             -t1    Bit0
 564      =2                                  //Î»ÃèÊö                -       ECOM2   CAPP2   CAPN2   MAT2    TOG2    PW
             -M2    ECCF2
 565      =2                                  //³õÊ¼Öµ=x000,0000      x       0       0       0       0       0       0 
             -      0
 566      =2  
 567      =2  #define PCA2_ECOM   0x40        //Ê¹ÄÜ±È½ÏÆ÷2
 568      =2  #define PCA2_CAPP   0x20        //Ê¹ÄÜPCAÄ£¿é2µÄÉÏÉýÑØ²¶»ñ
 569      =2  #define PCA2_CAPN   0x10        //Ê¹ÄÜPCAÄ£¿é2µÄÏÂ½µÑØ²¶»ñ
 570      =2  #define PCA2_MAT    0x08        //Æ¥ÅäÊ¹ÄÜ,µ±PCAµÄ¼ÆÊýÖµÓëÄ£¿é2Éè¶¨µÄÖµÏàÆ¥ÅäÊ±,ÖÃCCON.CCF2
 571      =2  #define PCA2_TOG    0x04        //·­×ª¿ØÖÆÎ»,µ±PCAµÄ¼ÆÊýÖµÓëÄ£¿é2Éè¶¨µÄÖµÏàÆ¥ÅäÊ±,·­×ªCEX2µÄµçÆ½
 572      =2  #define PCA2_PWM    0x02        //Âö¿íµ÷ÖÆÄ£Ê½,Ê¹ÄÜCEX2ÎªÂö¿íµ÷ÖÆÊä³ö¿Ú
 573      =2  #define PCA2_ECCF   0x01        //Ê¹ÄÜCCF2ÖÐ¶Ï
 574      =2  
 575      =2  /////////////////////////////////
 576      =2  
 577      =2  sfr  CCAPM3     =   0xdd;       //PCAÄ£¿é3Ä£Ê½¼Ä´æÆ÷    Bit7    Bit6    Bit5    Bit4    Bit3    Bit2    Bi
             -t1    Bit0
 578      =2                                  //Î»ÃèÊö                -       ECOM3   CAPP3   CAPN3   MAT3    TOG3    PW
             -M3    ECCF3
 579      =2                                  //³õÊ¼Öµ=x000,0000      x       0       0       0       0       0       0 
C51 COMPILER V8.08   UART                                                                  01/26/2011 09:34:32 PAGE 17  

             -      0
 580      =2  
 581      =2  #define PCA3_ECOM   0x40        //Ê¹ÄÜ±È½ÏÆ÷3
 582      =2  #define PCA3_CAPP   0x20        //Ê¹ÄÜPCAÄ£¿é3µÄÉÏÉýÑØ²¶»ñ
 583      =2  #define PCA3_CAPN   0x10        //Ê¹ÄÜPCAÄ£¿é3µÄÏÂ½µÑØ²¶»ñ
 584      =2  #define PCA3_MAT    0x08        //Æ¥ÅäÊ¹ÄÜ,µ±PCAµÄ¼ÆÊýÖµÓëÄ£¿é3Éè¶¨µÄÖµÏàÆ¥ÅäÊ±,ÖÃCCON.CCF3
 585      =2  #define PCA3_TOG    0x04        //·­×ª¿ØÖÆÎ»,µ±PCAµÄ¼ÆÊýÖµÓëÄ£¿é3Éè¶¨µÄÖµÏàÆ¥ÅäÊ±,·­×ªCEX3µÄµçÆ½
 586      =2  #define PCA3_PWM    0x02        //Âö¿íµ÷ÖÆÄ£Ê½,Ê¹ÄÜCEX3ÎªÂö¿íµ÷ÖÆÊä³ö¿Ú
 587      =2  #define PCA3_ECCF   0x01        //Ê¹ÄÜCCF3ÖÐ¶Ï
 588      =2  
 589      =2  /////////////////////////////////
 590      =2  
 591      =2  //CCAPM0   -   ECOM CAPP CAPN MAT  TOG  PWM  CCF
 592      =2  // 00H     0    0    0    0    0    0    0    0     ÎÞ²Ù×÷,´ý»ú×´Ì¬
 593      =2  // 42H     0    1    0    0    0    0    1    0     8Î»PWMÊä³ö,ÎÞÖÐ¶Ï
 594      =2  // 63H     0    1    1    0    0    0    1    1     8Î»PWMÊä³ö,²úÉúCEX0ÉÏÉýÑØÖÐ¶Ï
 595      =2  // 53H     0    1    0    1    0    0    1    1     8Î»PWMÊä³ö,²úÉúCEX0ÏÂ½µÑØÖÐ¶Ï
 596      =2  // 73H     0    1    1    1    0    0    1    1     8Î»PWMÊä³ö,²úÉúCEX0Ìø±äÖÐ¶Ï
 597      =2  // 20H     0    x    1    0    0    0    0    0     16Î»²¶»ñÄ£Ê½,CEX0ÉÏÉýÑØ´¥·¢²¶»ñ
 598      =2  // 10H     0    x    0    1    0    0    0    0     16Î»²¶»ñÄ£Ê½,CEX0ÏÂ½µÑØ´¥·¢²¶»ñ
 599      =2  // 30H     0    x    1    1    0    0    0    0     16Î»²¶»ñÄ£Ê½,CEX0Ìø±ä´¥·¢²¶»ñ
 600      =2  // 48H     0    1    0    0    1    0    0    0     16Î»Èí¼þ¶¨Ê±Æ÷
 601      =2  // 4CH     0    1    0    0    1    1    0    0     16Î»¸ßËÙÂö³åÊä³ö
 602      =2  
 603      =2  /////////////////////////////////
 604      =2  
 605      =2  sfr  CL         =   0xe9;       //PCA¼ÆÊýÆ÷µÍ8Î»        Bit7    Bit6    Bit5    Bit4    Bit3    Bit2    Bi
             -t1    Bit0
 606      =2                                  //³õÊ¼Öµ=0000,0000      0       0       0       0       0       0       0 
             -      0
 607      =2  
 608      =2  /////////////////////////////////
 609      =2  
 610      =2  sfr  CH         =   0xf9;       //PCA¼ÆÊýÆ÷¸ß8Î»        Bit7    Bit6    Bit5    Bit4    Bit3    Bit2    Bi
             -t1    Bit0
 611      =2                                  //³õÊ¼Öµ=0000,0000      0       0       0       0       0       0       0 
             -      0
 612      =2  
 613      =2  /////////////////////////////////
 614      =2  
 615      =2  sfr  CCAP0L     =   0xea;       //PCAÄ£¿é0¼Ä´æÆ÷µÍ8Î»   Bit7    Bit6    Bit5    Bit4    Bit3    Bit2    Bi
             -t1    Bit0
 616      =2                                  //³õÊ¼Öµ=0000,0000      0       0       0       0       0       0       0 
             -      0
 617      =2  
 618      =2  /////////////////////////////////
 619      =2  
 620      =2  sfr  CCAP1L     =   0xeb;       //PCAÄ£¿é1¼Ä´æÆ÷µÍ8Î»   Bit7    Bit6    Bit5    Bit4    Bit3    Bit2    Bi
             -t1    Bit0
 621      =2                                  //³õÊ¼Öµ=0000,0000      0       0       0       0       0       0       0 
             -      0
 622      =2  
 623      =2  /////////////////////////////////
 624      =2  
 625      =2  sfr  CCAP2L     =   0xec;       //PCAÄ£¿é2¼Ä´æÆ÷µÍ8Î»   Bit7    Bit6    Bit5    Bit4    Bit3    Bit2    Bi
             -t1    Bit0
 626      =2                                  //³õÊ¼Öµ=0000,0000      0       0       0       0       0       0       0 
             -      0
 627      =2  
 628      =2  /////////////////////////////////
 629      =2  
 630      =2  sfr  CCAP3L     =   0xed;       //PCAÄ£¿é3¼Ä´æÆ÷µÍ8Î»   Bit7    Bit6    Bit5    Bit4    Bit3    Bit2    Bi
C51 COMPILER V8.08   UART                                                                  01/26/2011 09:34:32 PAGE 18  

             -t1    Bit0
 631      =2                                  //³õÊ¼Öµ=0000,0000      0       0       0       0       0       0       0 
             -      0
 632      =2  
 633      =2  /////////////////////////////////
 634      =2  
 635      =2  sfr  CCAP0H     =   0xfa;       //PCAÄ£¿é0¼Ä´æÆ÷¸ß8Î»   Bit7    Bit6    Bit5    Bit4    Bit3    Bit2    Bi
             -t1    Bit0
 636      =2                                  //³õÊ¼Öµ=0000,0000      0       0       0       0       0       0       0 
             -      0
 637      =2  
 638      =2  /////////////////////////////////
 639      =2  
 640      =2  sfr  CCAP1H     =   0xfb;       //PCAÄ£¿é1¼Ä´æÆ÷¸ß8Î»   Bit7    Bit6    Bit5    Bit4    Bit3    Bit2    Bi
             -t1    Bit0
 641      =2                                  //³õÊ¼Öµ=0000,0000      0       0       0       0       0       0       0 
             -      0
 642      =2  
 643      =2  /////////////////////////////////
 644      =2  
 645      =2  sfr  CCAP2H     =   0xfc;       //PCAÄ£¿é2¼Ä´æÆ÷¸ß8Î»   Bit7    Bit6    Bit5    Bit4    Bit3    Bit2    Bi
             -t1    Bit0
 646      =2                                  //³õÊ¼Öµ=0000,0000      0       0       0       0       0       0       0 
             -      0
 647      =2  
 648      =2  /////////////////////////////////
 649      =2  
 650      =2  sfr  CCAP3H     =   0xfd;       //PCAÄ£¿é3¼Ä´æÆ÷¸ß8Î»   Bit7    Bit6    Bit5    Bit4    Bit3    Bit2    Bi
             -t1    Bit0
 651      =2                                  //³õÊ¼Öµ=0000,0000      0       0       0       0       0       0       0 
             -      0
 652      =2  
 653      =2  /////////////////////////////////
 654      =2  
 655      =2  sfr  PCA_PWM0   =   0xf2;       //PCA0Ä£Ê½PWM¸¨Öú¼Ä´æÆ÷ Bit7    Bit6    Bit5    Bit4    Bit3    Bit2    Bi
             -t1    Bit0
 656      =2                                  //Î»ÃèÊö                -       -       -       -       -       -       EP
             -C0H   EPC0L
 657      =2                                  //³õÊ¼Öµ=xxxx,xx00      x       x       x       x       x       x       0 
             -      0
 658      =2  
 659      =2  /////////////////////////////////
 660      =2  
 661      =2  sfr  PCA_PWM1   =   0xf3;       //PCA1Ä£Ê½PWM¸¨Öú¼Ä´æÆ÷ Bit7    Bit6    Bit5    Bit4    Bit3    Bit2    Bi
             -t1    Bit0
 662      =2                                  //Î»ÃèÊö                -       -       -       -       -       -       EP
             -C1H   EPC1L
 663      =2                                  //³õÊ¼Öµ=xxxx,xx00      x       x       x       x       x       x       0 
             -      0
 664      =2  
 665      =2  /////////////////////////////////
 666      =2  
 667      =2  sfr  PCA_PWM2   =   0xf4;       //PCA2Ä£Ê½PWM¸¨Öú¼Ä´æÆ÷ Bit7    Bit6    Bit5    Bit4    Bit3    Bit2    Bi
             -t1    Bit0
 668      =2                                  //Î»ÃèÊö                -       -       -       -       -       -       EP
             -C2H   EPC2L
 669      =2                                  //³õÊ¼Öµ=xxxx,xx00      x       x       x       x       x       x       0 
             -      0
 670      =2  
 671      =2  /////////////////////////////////
 672      =2  
 673      =2  sfr  PCA_PWM3   =   0xf5;       //PCA3Ä£Ê½PWM¸¨Öú¼Ä´æÆ÷ Bit7    Bit6    Bit5    Bit4    Bit3    Bit2    Bi
C51 COMPILER V8.08   UART                                                                  01/26/2011 09:34:32 PAGE 19  

             -t1    Bit0
 674      =2                                  //Î»ÃèÊö                -       -       -       -       -       -       EP
             -C3H   EPC3L
 675      =2                                  //³õÊ¼Öµ=xxxx,xx00      x       x       x       x       x       x       0 
             -      0
 676      =2  
 677      =2  //////////////////////////////////////////////////////////////////////////////////////////////////////////
             -//////
 678      =2  
 679      =2  #endif
  29      =1  #define const code
  30      =1  
  31      =1   
  32      =1  #ifndef TRUE
  33      =1  #define TRUE  1
  34      =1  #endif 
  35      =1  #ifndef FALSE
  36      =1  #define FALSE 0
  37      =1  #endif
  38      =1  
  39      =1  
  40      =1  #ifndef true
  41      =1  #define true  1
  42      =1  #endif 
  43      =1  #ifndef false
  44      =1  #define false 0
  45      =1  #endif
  46      =1  
  47      =1  #ifndef STC12C5A
  48      =1  #define STC12C5A 1
  49      =1  #endif
  50      =1  
  51      =1  #ifndef STC90
  52      =1  #define STC90 0
  53      =1  #endif
  54      =1  
  55      =1  //Ö÷Ïß³ÌÃüÁî
  56      =1  #define BUS0_REC                0x10                                                            //×ÜÏß0½ÓÊÕÍê³É
  57      =1  #define BUS0_SND                0x20                                                            //×ÜÏß0·¢ËÍÍê³É
  58      =1  #define BUS1_REC                0x30                                                            //×ÜÏß0½ÓÊÕÍê³É
  59      =1  #define BUS1_SND                0x40                                                            //×ÜÏß0·¢ËÍÍê³É
  60      =1  #define KEY_DOWN                0x50                                                            //°´¼ü°´ÏÂ
  61      =1  #define KEY_UP                  0x60                                                            //°´¼üµ¯Æð
  62      =1  #define KEY_ALWAYS              0x70                                                            //¼ü³£°´ÏÂ
  63      =1  #define TIMER_OUT               0x80                                                            //³¬Ê±ÃüÁî      
  64      =1  #define UART0_CMD               0x90                                            //´®¿Ú0Êý¾ÝÖ¡ÃüÁî
  65      =1  #define UART1_CMD               0xa0                                            //´®¿Ú1Êý¾ÝÖ¡ÃüÁî
  66      =1  
  67      =1  //°´¼ü¶¨Òå
  68      =1  /*#define       SET_KEY_DOWN            0x50                                                    //ÉèÖÃ¼ü°´ÏÂ
  69      =1  #define SET_KEY_ALWAYS          0x70                                                    //ÉèÖÃ¼ü³¤°´
  70      =1  #define SET_KEY_UP                      0x60                                                    //ÉèÖÃ¼üµ¯Æð*/
  71      =1  
  72      =1  #define DEAL_KEY_DOWN           0x51                                                    //´¦Àí¼ü°´ÏÂ
  73      =1  #define DEAL_KEY_ALWAYS         0x71                                                    //´¦Àí¼ü³¤°´
  74      =1  #define DEAL_KEY_UP                     0x61                                                    //´¦Àí¼üµ¯Æð
  75      =1  
  76      =1  #define CALL_KEY_DOWN           0x54                                                    //ºô½Ð¼ü°´ÏÂ
  77      =1  #define CALL_KEY_ALWAYS     0X74                                                        //ºô½Ð¼ü³¤°´
  78      =1  #define CALL_KEY_UP             0X64                                                    //ºô½Ð¼üµ¯Æð
  79      =1  
  80      =1  
C51 COMPILER V8.08   UART                                                                  01/26/2011 09:34:32 PAGE 20  

  81      =1  //°´¼ü¶¨Òå
  82      =1  //#define       SET_KEY                 0x00                                                            //ÉèÖÃ¼ü
  83      =1  #define DEAL_KEY                0x01                                                            //´¦Àí¼ü
  84      =1  //define CALL_KEY               0x02                                                            //ºô½Ð¼ü
  85      =1  #define NO_KEY                  0xff                                                            //ÎÞ¼ü°´ÏÂ
  86      =1  
  87      =1  
  88      =1  
  89      =1  //µÆ¶¨Òå
  90      =1  #define LED_OFF                 0                                                                       //µÆ¹Ø±Õ
  91      =1  #define LED_ON                  1                                                                       //µÆ³£ÁÁ
  92      =1  #define LED_FLASH               2                                                                       //µÆÉÁË¸
  93      =1  #define HAND_LED_ON             0                                                                       //ÊÖ±úµÆÁÁ
  94      =1  #define HAND_LED_OFF    1                                                                       //ÊÖ±úµÆÃð
  95      =1  #define HAND_LED_FLASH  2                                                                       //ÊÖ±úµÆÉÁË¸ 
  96      =1  
  97      =1  
  98      =1  #define WIRELESS_SEC            99                                                                      //ÎÞÏßÇø
  99      =1  #define MOVE_FJ                         255
 100      =1  #define ADD_BED_FJ                      254
 101      =1  
 102      =1  #define IrDA_CMD_NURSE_IN   0x01                                                        //ºìÍâ½Ó¿Ú»¤Ê¿µ½Î»ÃüÁî
 103      =1  #define IrDA_CMD_INSPECTION     0x02                                                    //ºìÍâ½Ó¿Ú²é·¿ÃüÁî
 104      =1  
 105      =1  //¿ØÖÆÒý½Å¶¨Òå
 106      =1  sbit    CGB                     =       P3^7;                                                           //SD¿ØÖÆ½Å
 107      =1  sbit    CBD                     =       P1^0;                                                           //SA¿ØÖÆ½Å 
 108      =1  
 109      =1  sbit    CTA                     =       P3^0;                                                           //MICµÄSA¿ØÖÆ
 110      =1  sbit    CTD                     =       P3^1;                                                           //MICµÄSD¿ØÖÆ
 111      =1  
 112      =1  
 113      =1  sbit    IrDA            =       P3^5;                                                           //ºìÍâ½ÓÊÕÄ£¿éÊäÈë
 114      =1  sbit    MUS                     =       P1^1;                                                           //ÌáÊ¾Òô
 115      =1  
 116      =1  sbit    LR                      =  P1^2;        
 117      =1  sbit    DealKey         = P1^2;                                                                         //´¦ÖÃ¼ü
 118      =1  sbit    LED_DEAL        = P1^2;                                                                         //´¦ÖÃ¼üLEDµÆ
 119      =1  
 120      =1  sbit    MDR                     =       P1^3;                                                           //ÃÅµÆºì
 121      =1  sbit    MDG                     =       P1^4;                                                           //ÃÅµÆÂÌ
 122      =1  
 123      =1  
 124      =1  sbit    KDR             =       P1^5;                                                           //485ÊäÈë¿ØÖÆÒý½Å 
 125      =1  sbit    PW                      =       P1^6;                                                           //¹¦·Å¿ØÖÆÒý½Å
 126      =1  
 127      =1  
 128      =1  #define Bin(b7,b6,b5,b4,b3,b2,b1,b0)    ((b7<<7)|(b6<<6)|(b5<<5)|(b4<<4)|(b3<<3)|(b2<<2)|(b1<<1)|(b0<<0))
 129      =1  
 130      =1  
 131      =1  #define OpenCGB()               {P3M0 |=   Bin(1,0,0,0,0,0,0,0); P3M1 |=   Bin(1,0,0,0,0,0,0,0); CGB = 1;}      //¿ªÂ©
 132      =1  #define CloseCGB()              {P3M0 &= (~Bin(1,0,0,0,0,0,0,0));P3M1 &= (~Bin(1,0,0,0,0,0,0,0));CGB = 1;}      //×¼Ë«ÏòÊäÈ
             -ë
 133      =1  #define OpenCBD()               {P1M0 |=   Bin(0,0,0,0,0,0,0,1); P1M1 |=   Bin(0,0,0,0,0,0,0,1); CBD = 1;}      
 134      =1  #define CloseCBD()              {P1M0 &= (~Bin(0,0,0,0,0,0,0,1));P1M1 &= (~Bin(0,0,0,0,0,0,0,1));CBD = 1;}      
 135      =1  
 136      =1  //°üº¬Í·ÎÄ¼þ
 137      =1  #include "OS_CFG.H"
   1      =2  /*********************************************************************************************************
   2      =2  **                                                             Small RTOS(51)
   3      =2  **                                   The Real-Time Kernel(For Keil c51)
   4      =2  **
C51 COMPILER V8.08   UART                                                                  01/26/2011 09:34:32 PAGE 21  

   5      =2  **                                  (c) Copyright 2002-2002, chenmingji
   6      =2  **                                           All Rights Reserved
   7      =2  **
   8      =2  **                                                  V1.20.0
   9      =2  **
  10      =2  **
  11      =2  **--------------ÎÄ¼þÐÅÏ¢--------------------------------------------------------------------------------
  12      =2  **ÎÄ   ¼þ   Ãû: OS_CFG.H
  13      =2  **´´   ½¨   ÈË: ³ÂÃ÷¼Æ
  14      =2  **×îºóÐÞ¸ÄÈÕÆÚ: 2002Äê12ÔÂ30ÈÕ
  15      =2  **Ãè¡¡      Êö: ex1µÄÏµÍ³ÅäÖÃÎÄ¼þ
  16      =2  **
  17      =2  **--------------ÀúÊ·°æ±¾ÐÅÏ¢----------------------------------------------------------------------------
  18      =2  ** ´´½¨ÈË: ³ÂÃ÷¼Æ
  19      =2  ** °æ  ±¾: V0.50
  20      =2  ** ÈÕ¡¡ÆÚ: 2002Äê2ÔÂ22ÈÕ
  21      =2  ** Ãè¡¡Êö: Ô­Ê¼°æ±¾
  22      =2  **
  23      =2  **------------------------------------------------------------------------------------------------------
  24      =2  ** ÐÞ¸ÄÈË: ³ÂÃ÷¼Æ
  25      =2  ** °æ  ±¾: V1.00
  26      =2  ** ÈÕ¡¡ÆÚ: 2002Äê6ÔÂ20ÈÕ
  27      =2  ** Ãè¡¡Êö: Ê¹ÓÃ»§¿ÉÒÔ½øÐÐ¸ü¶àµÄÅäÖÃ
  28      =2  **
  29      =2  **------------------------------------------------------------------------------------------------------
  30      =2  ** ÐÞ¸ÄÈË: ³ÂÃ÷¼Æ
  31      =2  ** °æ  ±¾: V1.10~1.12.1
  32      =2  ** ÈÕ¡¡ÆÚ: 2002Äê9ÔÂ1ÈÕ~2002Äê12ÔÂ2ÈÕ
  33      =2  ** Ãè¡¡Êö: ¸ù¾ÝÐÂ°æ±¾ÐèÒª¸ü¸ÄÒ»Ð©¶¨Òå
  34      =2  **
  35      =2  **------------------------------------------------------------------------------------------------------
  36      =2  ** ÐÞ¸ÄÈË: ³ÂÃ÷¼Æ
  37      =2  ** °æ  ±¾: V1.20.0
  38      =2  ** ÈÕ¡¡ÆÚ: 2003Äê8ÔÂ3ÈÕ
  39      =2  ** Ãè¡¡Êö: ¸ù¾ÝÐÂ°æ±¾ÐèÒªÔö¼ÓÅäÖÃOSWait_EN£»
  40      =2  **         ¼õÉÙÒ»Ð©¹ØÓÚÖÐ¶ÏÇ¶Ì×µÄÅäÖÃ
  41      =2  **
  42      =2  **--------------µ±Ç°°æ±¾ÐÞ¶©------------------------------------------------------------------------------
  43      =2  ** ÐÞ¸ÄÈË: 
  44      =2  ** ÈÕ¡¡ÆÚ:
  45      =2  ** Ãè¡¡Êö:
  46      =2  **
  47      =2  **------------------------------------------------------------------------------------------------------
  48      =2  ********************************************************************************************************/
  49      =2  
  50      =2  #define OS_MAX_TASKS            6           /* ×î´óÈÎÎñÊý1~16                                           */
  51      =2  #define OS_TICKS_PER_SEC        200         /* ÉùÃ÷1ÃëÏµÍ³ÏµÍ³½ÚÅÄÊý                                    */
  52      =2  #define EN_USER_TICK_TIMER      1           /* ½ûÖ¹(0)»òÔÊÐí(1)ÏµÍ³¶¨Ê±ÖÐ¶Ïµ÷ÓÃÓÃ»§º¯ÊýUserTickTimer()  */
  53      =2  #define EN_TIMER_SHARING        1           /* ½ûÖ¹(0)»òÔÊÐí(1)¶¨Ê±Æ÷ÖÐ¶Ïµ÷ÓÃOSTimeTick()               */
  54      =2  #define TICK_TIMER_SHARING      0           /* ¶¨Òå½øÈë¶àÉÙ´ÎÓ²¼þÖÐ¶ÏÎªÒ»´ÎÏµÍ³¶¨Ê±Æ÷ÈíÖÐ¶Ï             */
  55      =2  #define OSWait_EN               1           /* ½ûÖ¹(0)»òÔÊÐí(1)µ÷ÓÃ¼æÈÝº¯ÊýOSWait  */
  56      =2  
  57      =2  
  58      =2  #define EN_OS_Q                 1           /* ½ûÖ¹(0)»òÔÊÐí(1)ÏûÏ¢¶ÓÁÐ                                 */
  59      =2  #define EN_OS_Q_CHK             0           /* ½ûÖ¹(0)»òÔÊÐí(1)Ð£ÑéÏûÏ¢¶ÓÁÐÖ¸Õë                         */
  60      =2  #define OS_Q_MEM_SEL            idata       /* ÏûÏ¢¶ÓÁÐ´æ´¢¿Õ¼äÑ¡Ôñ£¬keil c51ÓÐÓÃ£¬±ØÐëÎªidata¡¢xdata   */
  61      =2                                              /* ²»ÊÇkeil c51Ê±Ëü±ØÐëÎª¿Õ¸ñ                               */
  62      =2  #define EN_OS_Q_PENT            1           /* ½ûÖ¹(0)»òÔÊÐí(1)µÈ´ý¶ÓÁÐÖÐµÄÏûÏ¢                         */
  63      =2  #define EN_OS_Q_ACCEPT          0           /* ½ûÖ¹(0)»òÔÊÐí(1)ÎÞµÈ´ýµÄ´Ó¶ÓÁÐÖÐÈ¡µÃÏûÏ¢                 */
  64      =2  #define EN_OS_Q_POST            1           /* ½ûÖ¹(0)»òÔÊÐí(1)FIFO·½Ê½Ïò¶ÔÁÐ·¢ËÍÏûÏ¢                   */
  65      =2  #define EN_OS_Q_POST_FRONT      0           /* ½ûÖ¹(0)»òÔÊÐí(1)LIFO·½Ê½Ïò¶ÔÁÐ·¢ËÍÏûÏ¢                   */
  66      =2  #define EN_OS_Q_NMsgs           0           /* ½ûÖ¹(0)»òÔÊÐí(1)È¡µÃ¶ÓÁÐÖÐÏûÏ¢Êý                         */
C51 COMPILER V8.08   UART                                                                  01/26/2011 09:34:32 PAGE 22  

  67      =2  #define EN_OS_Q_SIZE            0           /* ½ûÖ¹(0)»òÔÊÐí(1)È¡µÃ¶ÓÁÐ×ÜÈÝÁ¿                           */
  68      =2  #define EN_OS_Q_FLUSH           0           /* ½ûÖ¹(0)»òÔÊÐí(1)Çå¿Õ¶ÓÁÐ                                 */
  69      =2  
  70      =2  #define EN_OS_SEM               0           /* ½ûÖ¹(0)»òÔÊÐí(1)ÐÅºÅÁ¿                                   */
  71      =2  #define EN_OS_SEM_CHK           0           /* ½ûÖ¹(0)»òÔÊÐí(1)Ð£ÑéÐÅºÅÁ¿Ë÷Òý                           */
  72      =2  #define OS_SEM_MEM_SEL          idata       /* ÐÅºÅÁ¿´¢¿Õ¼äÑ¡Ôñ£¬keil c51ÓÐÓÃ£¬±ØÐëÎªidata¡¢xdata       */
  73      =2                                              /* ²»ÊÇkeil c51Ê±Ëü±ØÐëÎª¿Õ¸ñ                               */
  74      =2  #define OS_MAX_SEMS             0           /* ×î´óÐÅºÅÁ¿ÊýÄ¿                                           */
  75      =2  #define EN_OS_SEM_PENT          1           /* ½ûÖ¹(0)»òÔÊÐí(1)µÈ´ýÐÅºÅÁ¿                               */
  76      =2  #define EN_OS_SEM_ACCEPT        1           /* ½ûÖ¹(0)»òÔÊÐí(1)ÎÞµÈ´ýÇëÇóÐÅºÅÁ¿                         */
  77      =2  #define EN_OS_SEM_POST          1           /* ½ûÖ¹(0)»òÔÊÐí(1)ÖÐ·¢ËÍÐÅºÅÁ¿                             */
  78      =2  #define EN_OS_SEM_QUERY         1           /* ½ûÖ¹(0)»òÔÊÐí(1)²éÑ¯ÐÅºÅÁ¿                               */
  79      =2  
  80      =2  #define EN_OS_MEM               0           /* ½ûÖ¹(0)»òÔÊÐí(1)¶¯Ì¬ÄÚ´æ·ÖÅä                             */
  81      =2  #define EN_OS_MEM_FREE          0           /* ½ûÖ¹(0)»òÔÊÐí(1)ÊÍ·Å¶¯Ì¬·ÖÅäµÄÄÚ´æ                        *
             -/
  82      =2  #define EN_OS_MEM_CHK           1           /* ½ûÖ¹(0)»òÔÊÐí(1)ÄÚ´æ»ØÊÕÊ±ÑéÖ¤ÄÚ´æ¿éÊÇ·ñÓÐÐ§               
             -*/
  83      =2  #define EN_UserMemChkErr        0           /* ½ûÖ¹(0)»òÔÊÐí(1)ÄÚ´æ»ØÊÕÑéÖ¤³ö´íµ÷ÓÃÓÃ»§º¯ÊýUserMemChkErr  
             - */
  84      =2  
  85      =2  #if EN_TIMER_SHARING == 0
           =2 #define TIME_ISR_TASK_ID     COMM_TASK_ID   /* ¶¨ÒåÏµÍ³¶¨Ê±Æ÷ÈíÖÐ¶Ï´¥·¢µÄÈÎÎñID                         */
           =2 #endif
  88      =2  
  89      =2  #ifdef IN_OS_CPU_C 
           =2 #if EN_USER_TICK_TIMER > 0      
           =2 //extern void UserTickTimer(void);            /* ÏµÍ³¶¨Ê±ÖÐ¶ÏÖÐµ÷ÓÃµÄÓÃ»§º¯Êý                             
             -   
           =2 //#define UserTickTimer()       {uiIsrTimerCount+=ISR_INC_COUNT;CCAP0L = (uint8)uiIsrTimerCount;CCAP0H = (uint8
             -)(uiIsrTimerCount>>8);CCF0=0;WDT_CONTR = 0x3a;}   /* ÏµÍ³¶¨Ê±ÖÐ¶ÏÖÐµ÷ÓÃµÄÓÃ»§º¯                                                                */
           =2 
           =2 #endif
           =2 #endif
  96      =2  /*********************************************************************************************************
  97      =2  **                            End Of File
  98      =2  ********************************************************************************************************/
 138      =1  #include "OS_CPU.H"
   1      =2  /*********************************************************************************************************
   2      =2  **                                                             Small RTOS 51
   3      =2  **                                   The Real-Time Kernel For Keil c51
   4      =2  **
   5      =2  **                                  (c) Copyright 2002-2003, chenmingji
   6      =2  **                                           All Rights Reserved
   7      =2  **
   8      =2  **                                                  V1.20.0
   9      =2  **
  10      =2  **
  11      =2  **--------------ÎÄ¼þÐÅÏ¢--------------------------------------------------------------------------------
  12      =2  **ÎÄ   ¼þ   Ãû: OS_CPU.h
  13      =2  **´´   ½¨   ÈË: ³ÂÃ÷¼Æ
  14      =2  **×îºóÐÞ¸ÄÈÕÆÚ:  2003Äê8ÔÂ17ÈÕ
  15      =2  **Ãè¡¡      Êö: Small RTOS 51ÓëCPU(¼È8051ÏµÁÐ)Ïà¹ØµÄCÓïÑÔÍ·ÎÄ¼þ,¶¨ÒåÒ»Ð©ÓëCPUÏà¹ØµÄºê¡£
  16      =2  **
  17      =2  **--------------ÀúÊ·°æ±¾ÐÅÏ¢----------------------------------------------------------------------------
  18      =2  ** ´´½¨ÈË: ³ÂÃ÷¼Æ
  19      =2  ** °æ  ±¾: V0.50
  20      =2  ** ÈÕ¡¡ÆÚ: 2002Äê2ÔÂ22ÈÕ
  21      =2  ** Ãè¡¡Êö: Ô­Ê¼°æ±¾
  22      =2  **
  23      =2  **------------------------------------------------------------------------------------------------------
  24      =2  ** ÐÞ¸ÄÈË: ³ÂÃ÷¼Æ
C51 COMPILER V8.08   UART                                                                  01/26/2011 09:34:32 PAGE 23  

  25      =2  ** °æ  ±¾: V1.00
  26      =2  ** ÈÕ¡¡ÆÚ: 2002Äê6ÔÂ20ÈÕ
  27      =2  ** Ãè¡¡Êö: ÎÞ±ä»¯
  28      =2  **
  29      =2  **------------------------------------------------------------------------------------------------------
  30      =2  ** ÐÞ¸ÄÈË: ³ÂÃ÷¼Æ
  31      =2  ** °æ  ±¾: V1.10~1.12.1
  32      =2  ** ÈÕ¡¡ÆÚ: 2002Äê9ÔÂ1ÈÕ~2002Äê12ÔÂ2ÈÕ
  33      =2  ** Ãè¡¡Êö: ¸ù¾ÝÐÂ°æ±¾ÐèÒªÔö¼ÓÒ»Ð©ºê¶¨Òå
  34      =2  **
  35      =2  **------------------------------------------------------------------------------------------------------
  36      =2  ** ÐÞ¸ÄÈË: ³ÂÃ÷¼Æ
  37      =2  ** °æ  ±¾: V1.20.0
  38      =2  ** ÈÕ¡¡ÆÚ: 2003Äê8ÔÂ17ÈÕ
  39      =2  ** Ãè¡¡Êö: ¸ù¾ÝÐÂ°æ±¾ÐèÒªÔö¼ÓEN_REENTRANT
  40      =2  **
  41      =2  **--------------µ±Ç°°æ±¾ÐÞ¶©------------------------------------------------------------------------------
  42      =2  ** ÐÞ¸ÄÈË: 
  43      =2  ** ÈÕ¡¡ÆÚ:
  44      =2  ** Ãè¡¡Êö:
  45      =2  **
  46      =2  **------------------------------------------------------------------------------------------------------
  47      =2  ********************************************************************************************************/
  48      =2  #define EN_SP2        0                                         /* ½ûÖ¹(0)»òÔÊÐí(1)Èí·ÇÆÁ±ÎÖÐ¶Ï           
             -    */
  49      =2  #define EN_REENTRANT  0                                         /* ½ûÖ¹(0)»òÔÊÐí(1)¹ÜÀíÖØÈëÕ»             
             -    */
  50      =2  
  51      =2  #ifdef __C51__
  52      =2  
  53      =2  //#define idata                                   /* ·Çkeil c51Ê±±ØÐë¼ÓÖ¹ÕâÒ»¾ä                           
             -    */
  54      =2  //#define data                                    /* ·Çkeil c51Ê±±ØÐë¼ÓÖ¹ÕâÒ»¾ä                           
             -    */
  55      =2  //#define xdata                                   /* ·Çkeil c51Ê±±ØÐë¼ÓÖ¹ÕâÒ»¾ä                           
             -    */
  56      =2  //#define reentrant                               /* ·Çkeil c51Ê±±ØÐë¼ÓÖ¹ÕâÒ»¾ä                           
             -    */
  57      =2  //#define small                                   /* ·Çkeil c51Ê±±ØÐë¼ÓÖ¹ÕâÒ»¾ä                           
             -    */
  58      =2  //#define code                                    /* ·Çkeil c51Ê±±ØÐë¼ÓÖ¹ÕâÒ»¾ä                           
             -    */
  59      =2  
  60      =2  typedef unsigned char  uint8;                                   /* ¶¨Òå¿ÉÒÆÖ²µÄÎÞ·ûºÅ8Î»ÕûÊý¹Ø¼ü×Ö        
             -    */
  61      =2  typedef signed   char  int8;                                    /* ¶¨Òå¿ÉÒÆÖ²µÄÓÐ·ûºÅ8Î»ÕûÊý¹Ø¼ü×Ö        
             -    */
  62      =2  typedef unsigned int   uint16;                                  /* ¶¨Òå¿ÉÒÆÖ²µÄÎÞ·ûºÅ16Î»ÕûÊý¹Ø¼ü×Ö       
             -    */
  63      =2  typedef signed   int   int16;                                   /* ¶¨Òå¿ÉÒÆÖ²µÄÓÐ·ûºÅ16Î»ÕûÊý¹Ø¼ü×Ö       
             -    */
  64      =2  typedef unsigned long  uint32;                                  /* ¶¨Òå¿ÉÒÆÖ²µÄÎÞ·ûºÅ32Î»ÕûÊý¹Ø¼ü×Ö       
             -    */
  65      =2  typedef signed   long  int32;                                   /* ¶¨Òå¿ÉÒÆÖ²µÄÓÐ·ûºÅ32Î»ÕûÊý¹Ø¼ü×Ö       
             -    */
  66      =2  
  67      =2  extern void OSCPUInit(void) small;
  68      =2  extern void OSTaskStkInit(void (code * task)(void), void xdata *ptos, uint8 TaskID);
  69      =2  extern void OSTaskStkDel(uint8 TaskID) small;
  70      =2  
  71      =2  #ifndef NULL
           =2 #define NULL 0
C51 COMPILER V8.08   UART                                                                  01/26/2011 09:34:32 PAGE 24  

           =2 #endif
  74      =2  
  75      =2  #define  OS_INT_ENTER() OSIntNesting++, EA = 1
  76      =2  
  77      =2  #define  OS_ENTER_CRITICAL()  EA = 0,Os_Enter_Sum++             /* ½ûÖ¹ÖÐ¶Ï                                     */      
  78      =2  #define  OS_EXIT_CRITICAL()   if (--Os_Enter_Sum==0) EA = 1  /* ÔÊÐíÖÐ¶Ï                                        
             -*/         
  79      =2  
  80      =2  #define  HIGH_BYTE  0                                           /* uint16µÄ¸ßÎ»×Ö½Ú                       
             -       */
  81      =2  #define  LOW_BYTE   1                                           /* uint16µÄµÍÎ»×Ö½Ú                       
             -       */
  82      =2  
  83      =2  #define  OS_TASK_SW()         OSCtxSw()                         /* ÈÎÎñÇÐ»»º¯Êý                           
             -       */
  84      =2  
  85      =2  
  86      =2  #define  IDATA_RAM_SIZE  0x100                                  /* idata´óÐ¡                              
             -      */
  87      =2  
  88      =2  extern void OSCtxSw(void);
  89      =2  extern void OSIntCtxSw(void);
  90      =2  #ifndef IN_OS_CPU_C
  91      =2  extern void OSStartHighRdy(void)  small;
  92      =2  #endif
  93      =2  
  94      =2  #define  Sp2Space       8                                       /* ¸ß¼¶ÖÐ¶Ï£¨Èí·ÇÆÁ±ÎÖÐ¶Ï£©¶ÑÕ»´óÐ¡ EN_SP2
             -Îª0Ê±ÎÞÐ§*/
  95      =2  
  96      =2  #define OS_TIME_ISR     6                                       /* ÏµÍ³¶¨Ê±Æ÷Ê¹ÓÃµÄÖÐ¶Ï                   
             -      */
  97      =2  
  98      =2  #endif
  99      =2  
 100      =2  
 101      =2  
 102      =2  #ifndef __C51__   
           =2 SET_EA   MACRO
           =2              SETB     EA
           =2          ENDM
           =2          
           =2 #endif
 108      =2  
 109      =2  /*********************************************************************************************************
 110      =2  **                            End Of File
 111      =2  ********************************************************************************************************/
 139      =1  #include "..\os\OS.H"
   1      =2  /*********************************************************************************************************
   2      =2  **                                                             Small RTOS(51)
   3      =2  **                                   The Real-Time Kernel(For Keil c51)
   4      =2  **
   5      =2  **                                  (c) Copyright 2002-2003, chenmingji
   6      =2  **                                           All Rights Reserved
   7      =2  **
   8      =2  **                                                  V1.20.0
   9      =2  **
  10      =2  **
  11      =2  **--------------ÎÄ¼þÐÅÏ¢--------------------------------------------------------------------------------
  12      =2  **ÎÄ   ¼þ   Ãû: OS.h
  13      =2  **´´   ½¨   ÈË: ³ÂÃ÷¼Æ
  14      =2  **×îºóÐÞ¸ÄÈÕÆÚ:  2003Äê8ÔÂ17ÈÕ
  15      =2  **Ãè¡¡     Êö: Small RTOS(51) CÓïÑÔÍ·ÎÄ¼þ,¶¨ÒåÒ»Ð©ºêºÍÉùÃ÷Ò»Ð©º¯ÊýºÍ±äÁ¿
C51 COMPILER V8.08   UART                                                                  01/26/2011 09:34:32 PAGE 25  

  16      =2  **
  17      =2  **--------------ÀúÊ·°æ±¾ÐÅÏ¢----------------------------------------------------------------------------
  18      =2  ** ´´½¨ÈË: ³ÂÃ÷¼Æ
  19      =2  ** °æ  ±¾: V0.50~V1.00
  20      =2  ** ÈÕ¡¡ÆÚ: 2002Äê2ÔÂ22ÈÕ~2002Äê6ÔÂ20ÈÕ
  21      =2  ** Ãè¡¡Êö: »ù±¾Íê³ÉSmall RTOSºË
  22      =2  **
  23      =2  **------------------------------------------------------------------------------------------------------
  24      =2  ** ÐÞ¸ÄÈË: ³ÂÃ÷¼Æ
  25      =2  ** °æ  ±¾: V1.10~V1.21
  26      =2  ** ÈÕ¡¡ÆÚ: 2002Äê9ÔÂ1ÈÕ~2003Äê1ÔÂ23ÈÕ
  27      =2  ** Ãè¡¡Êö: ÍêÉÆSmall RTOS
  28      =2  **
  29      =2  **------------------------------------------------------------------------------------------------------
  30      =2  ** ÐÞ¸ÄÈË: ³ÂÃ÷¼Æ
  31      =2  ** °æ  ±¾: V1.20.0
  32      =2  ** ÈÕ¡¡ÆÚ: 2003Äê8ÔÂ17ÈÕ
  33      =2  ** Ãè¡¡Êö: Ôö¼ÓÖ§³ÖÈÎÎñ¶¯Ì¬½¨Á¢ºÍÉ¾³ý£¬º¯Êý¹¦ÄÜÏòÒ»°ãµÄRTOS¿¿Æë
  34      =2  **--------------µ±Ç°°æ±¾ÐÞ¶©------------------------------------------------------------------------------
  35      =2  ** ÐÞ¸ÄÈË: 
  36      =2  ** ÈÕ¡¡ÆÚ:
  37      =2  ** Ãè¡¡Êö:
  38      =2  **
  39      =2  **------------------------------------------------------------------------------------------------------
  40      =2  ********************************************************************************************************/
  41      =2  
  42      =2  #define  OS_VERSION    120                              /* ÏµÍ³°æ±¾ºÅ                                   */
  43      =2  
  44      =2  #define  OSVersion()     OS_VERSION                     /* ·µ»ØÏµÍ³°æ±¾                                 */
  45      =2  #define  OSRunningTaskID() OSTaskID                     /* ·µ»Øµ±Ç°ÈÎÎñID                               */
             - 
  46      =2  
  47      =2  #define K_SIG      1                                    /* µÈ´ýÐÅºÅ                                     */
  48      =2  #define K_TMO      2                                    /* µÈ´ý³¬Ê±                                     */
  49      =2  
  50      =2  #define NOT_OK     255                                  /* ²ÎÊý´íÎó                                     */
  51      =2  #define TMO_EVENT  8                                    /* ³¬Ê±µ½                                       */
  52      =2  #define SIG_EVENT  4                                    /* ÓÐÐÅºÅ                                       */
  53      =2  
  54      =2   
  55      =2  #ifndef IN_OS_CORE
  56      =2  
  57      =2  /* ¼æÈÝV1.21.1°æ±¾µÄºê */
  58      =2  #define OSSendSignal(a)     OSTaskResume((a))
  59      =2  #define OSIntSendSignal(a)  OSTaskResume((a))
  60      =2  #define OSClearSignal(a)    OS_TaskSuspend((a))
  61      =2  #define OSTaskCreate(a, b, c) _OSTaskCreate((c),(a),(b))
  62      =2  
  63      =2  
  64      =2  extern uint8 data OSWaitTick[];
  65      =2  extern uint8 code OSMapTbl[];
  66      =2  extern uint8 data Os_Enter_Sum;
  67      =2  extern uint8 data OSTaskID;
  68      =2  extern uint8 data OSNextTaskID;
  69      =2  extern uint8 data OSIntNesting;
  70      =2  
  71      =2  
  72      =2  extern void OSInit(void) small;
  73      =2  /*********************************************************************************************************
  74      =2  ** º¯ÊýÃû³Æ: OSInit
  75      =2  ** ¹¦ÄÜÃèÊö: ÏµÍ³±äÁ¿³õÊ¼»¯
  76      =2  ** Êä¡¡Èë: ÎÞ
C51 COMPILER V8.08   UART                                                                  01/26/2011 09:34:32 PAGE 26  

  77      =2  ** Êä¡¡³ö: ÎÞ
  78      =2  ** È«¾Ö±äÁ¿: 
  79      =2  ** µ÷ÓÃÄ£¿é: OSCPUInit
  80      =2  ********************************************************************************************************/
  81      =2  
  82      =2  extern void OSStart(void);
  83      =2  /*********************************************************************************************************
  84      =2  ** º¯ÊýÃû³Æ: OSStart
  85      =2  ** ¹¦ÄÜÃèÊö: Æô¶¯¶àÈÎÎñ»·¾³
  86      =2  ** Êä¡¡Èë: ÎÞ
  87      =2  ** Êä¡¡³ö : ÎÞ
  88      =2  ** È«¾Ö±äÁ¿: ÎÞ
  89      =2  ** µ÷ÓÃÄ£¿é: OSFindNextRunningTask,OSStartHighRdy
  90      =2  ********************************************************************************************************/
  91      =2  
  92      =2  extern uint8 _OSTaskCreate(uint8 TaskID, void (code * task)(void), void xdata *ptos) small;
  93      =2  /*********************************************************************************************************
  94      =2  ** º¯ÊýÃû³Æ: _OSTaskCreate
  95      =2  ** ¹¦ÄÜÃèÊö: ´´½¨ÈÎÎñ
  96      =2  ** Êä¡¡Èë: TaskID:ÈÎÎñID
  97      =2  **         task  :ÈÎÎñµØÖ·
  98      =2  **         ptos  :ÈÎÎñ¶ÑÕ»£¬ÔÚ51ÖÐÎªÖØÈëÕ»
  99      =2  ** Êä¡¡³ö: ÎÞ
 100      =2  ** È«¾Ö±äÁ¿: 
 101      =2  ** µ÷ÓÃÄ£¿é: ÎÞ
 102      =2  ********************************************************************************************************/
 103      =2  
 104      =2  extern uint8 OSTaskDel(uint8 TaskID) small;
 105      =2  /*********************************************************************************************************
 106      =2  ** º¯ÊýÃû³Æ: OSTaskDel
 107      =2  ** ¹¦ÄÜÃèÊö: ´´½¨ÈÎÎñ
 108      =2  ** Êä¡¡Èë: TaskID:ÈÎÎñID
 109      =2  ** Êä¡¡³ö: ÎÞ
 110      =2  ** È«¾Ö±äÁ¿: 
 111      =2  ** µ÷ÓÃÄ£¿é: ÎÞ
 112      =2  ********************************************************************************************************/
 113      =2         
 114      =2  extern void OSTaskResume(uint8 TaskID) small;
 115      =2  /*********************************************************************************************************
 116      =2  ** º¯ÊýÃû³Æ: OSTaskResume
 117      =2  ** ¹¦ÄÜÃèÊö: ÖÐ»Ö¸´ÈÎÎñ
 118      =2  ** Êä¡¡Èë: TaskID : ÈÎÎñID
 119      =2  ** Êä¡¡³ö: ÎÞ
 120      =2  ** È«¾Ö±äÁ¿: ÎÞ
 121      =2  ** µ÷ÓÃÄ£¿é: OSSched
 122      =2  ********************************************************************************************************/
 123      =2  
 124      =2  extern void OS_TaskSuspend(uint8 TaskID)    small;
 125      =2  /*********************************************************************************************************
 126      =2  ** º¯ÊýÃû³Æ: OS_TaskSuspend
 127      =2  ** ¹¦ÄÜÃèÊö: Ê¹Ö¸¶¨ÈÎÎñÐÝÃß£¬µ«²»½øÐÐÈÎÎñÇÐ»»
 128      =2  ** Êä¡¡Èë: TaskID : ÈÎÎñID
 129      =2  ** Êä¡¡³ö: ÎÞ
 130      =2  ** È«¾Ö±äÁ¿: OSWaitTick
 131      =2  ** µ÷ÓÃÄ£¿é: ÎÞ
 132      =2  **
 133      =2  ** ×÷¡¡Õß: ³ÂÃ÷¼Æ
 134      =2  ** ÈÕ¡¡ÆÚ: 2002Äê6ÔÂ20ÈÕ
 135      =2  **-------------------------------------------------------------------------------------------------------
 136      =2  ** ÐÞ¸ÄÈË:
 137      =2  ** ÈÕ¡¡ÆÚ:
 138      =2  **-------------------------------------------------------------------------------------------------------
C51 COMPILER V8.08   UART                                                                  01/26/2011 09:34:32 PAGE 27  

 139      =2  ********************************************************************************************************/
 140      =2  
 141      =2  extern void OSTaskSuspend(uint8 TaskID)    small;
 142      =2  /*********************************************************************************************************
 143      =2  ** º¯ÊýÃû³Æ: OSTaskSuspend
 144      =2  ** ¹¦ÄÜÃèÊö: Ê¹Ö¸¶¨ÈÎÎñÐÝÃß
 145      =2  ** Êä¡¡Èë: TaskID : ÈÎÎñID
 146      =2  ** Êä¡¡³ö: ÎÞ
 147      =2  ** È«¾Ö±äÁ¿: Îå
 148      =2  ** µ÷ÓÃÄ£¿é: OS_TaskSuspend
 149      =2  **
 150      =2  ** ×÷¡¡Õß: ³ÂÃ÷¼Æ
 151      =2  ** ÈÕ¡¡ÆÚ: 2002Äê6ÔÂ20ÈÕ
 152      =2  **-------------------------------------------------------------------------------------------------------
 153      =2  ** ÐÞ¸ÄÈË:
 154      =2  ** ÈÕ¡¡ÆÚ:
 155      =2  **-------------------------------------------------------------------------------------------------------
 156      =2  ********************************************************************************************************/
 157      =2  
 158      =2  extern void OSTimeDly(uint8 ticks)     small;
 159      =2  /*********************************************************************************************************
 160      =2  ** º¯ÊýÃû³Æ: OSTimeDly
 161      =2  ** ¹¦ÄÜÃèÊö: ÏµÍ³µÈ´ýº¯Êý,ÈÎÎñµ÷ÓÃ´Ëº¯Êý¿ÉÒÔµÈ´ýÒ»¶¨Ê±¼ä
 162      =2  ** Êä¡¡Èë:  ticks : µÈ´ý³¬Ê±Ê±µÄÏµÍ³àÖàªÊý
 163      =2  ** Êä¡¡³ö : ÎÞ
 164      =2  **
 165      =2  ** È«¾Ö±äÁ¿: OSWaitTick
 166      =2  ** µ÷ÓÃÄ£¿é: OSIntTaskResume,OSSched
 167      =2  ********************************************************************************************************/
 168      =2  
 169      =2  extern void OSTimeDlyResume(uint8 TaskID)    small;
 170      =2  /*********************************************************************************************************
 171      =2  ** º¯ÊýÃû³Æ: OSTimeDlyResume
 172      =2  ** ¹¦ÄÜÃèÊö: ÈÃ´¦ÔÚÑÓÊ±ÆÚµÄÈÎÎñ½áÊøÑÓÊ±
 173      =2  ** Êä¡¡Èë:  TaskID : ÈÎÎñID
 174      =2  ** Êä¡¡³ö : ÎÞ
 175      =2  ** È«¾Ö±äÁ¿: OSWaitTick
 176      =2  ** µ÷ÓÃÄ£¿é: OSTaskResume
 177      =2  ********************************************************************************************************/
 178      =2  
 179      =2  extern void  OSTimeTick (void)  small;
 180      =2  /*********************************************************************************************************
 181      =2  ** º¯ÊýÃû³Æ: OSTimeTick
 182      =2  ** ¹¦ÄÜÃèÊö: ÏµÍ³Ê±ÖÓ´¦Àíº¯Êý,´¦Àí¸÷¸öÈÎÎñµÄÑÓÊ±
 183      =2  ** Êä¡¡Èë: ÎÞ
 184      =2  ** Êä¡¡³ö: ÎÞ
 185      =2  ** È«¾Ö±äÁ¿: OSWaitTick
 186      =2  ** µ÷ÓÃÄ£¿é: OSIntSendSignal
 187      =2  ********************************************************************************************************/
 188      =2  
 189      =2  extern uint8 OSWait (uint8 typ, uint8 ticks)    small;
 190      =2  /*********************************************************************************************************
 191      =2  ** º¯ÊýÃû³Æ: OSWait
 192      =2  ** ¹¦ÄÜÃèÊö: ÏµÍ³µÈ´ýº¯Êý,ÈÎÎñµ÷ÓÃ´Ëº¯Êý¿ÉÒÔµÈ´ýÒ»¶¨Ê±¼ä»òÐÅºÅ
 193      =2  ** Êä¡¡Èë: typ: µÈ´ýÊÂ¼þÀàÐÍ,Ä¿Ç°¿ÉÒÔÈ¡ÒÔÏÂÖµ,»òÊÇÆäÖÐÈÎÒâ¸öÖµµÄ°´Î»»ò
 194      =2  **             K_SIG: µÈ´ýÐÅºÅ
 195      =2  **             K_TMO: µÈ´ý³¬Ê±
 196      =2  **        ticks : µÈ´ý³¬Ê±Ê±µÄÏµÍ³àÖàªÊý
 197      =2  ** Êä¡¡³ö : NOT_OK : ²ÎÊý´íÎó
 198      =2  **         TMO_EVENT : ³¬Ê±µ½
 199      =2  **         SIG_EVENT : ÓÐÐÅºÅ
 200      =2  ** È«¾Ö±äÁ¿: OSWaitTick
C51 COMPILER V8.08   UART                                                                  01/26/2011 09:34:32 PAGE 28  

 201      =2  ** µ÷ÓÃÄ£¿é: OSTaskSuspend,OSTimeDly,OS_ENTER_CRITICAL,OS_EXIT_CRITICAL
 202      =2  ********************************************************************************************************/
 203      =2  
 204      =2  extern uint8 OSIntExit (void)    small;
 205      =2  /*********************************************************************************************************
 206      =2  ** º¯ÊýÃû³Æ: OSIntExit
 207      =2  ** ¹¦ÄÜÃèÊö: ÖÐ¶ÏÍË³ö´¦Àíº¯Êý,ÔÚ´Ë½øÐÐÖÐ¶ÏºóµÄÈÎÎñÇÐ»»
 208      =2  ** Êä¡¡Èë: ÎÞ
 209      =2  ** Êä¡¡³ö: 0:ÎÞÐèÈÎÎñÇÐ»»
 210      =2  **         1:ÐèÒªÈÎÎñÇÐ»»
 211      =2  ** È«¾Ö±äÁ¿: OSIntNesting,OSNextTaskID
 212      =2  ** µ÷ÓÃÄ£¿é: OSIntCtxSw
 213      =2  ********************************************************************************************************/
 214      =2  
 215      =2  extern void OSSched (void)  small;
 216      =2  /*********************************************************************************************************
 217      =2  ** º¯ÊýÃû³Æ: OSSched
 218      =2  ** ¹¦ÄÜÃèÊö: ·ÇÖÐ¶ÏµÄÈÎÎñÇÐ»»º¯Êý
 219      =2  ** Êä¡¡Èë: ÎÞ
 220      =2  ** Êä¡¡³ö: ÎÞ
 221      =2  ** È«¾Ö±äÁ¿: OSIntNesting,OSNextTaskID
 222      =2  ** µ÷ÓÃÄ£¿é: OS_TASK_SW
 223      =2  ********************************************************************************************************/
 224      =2  
 225      =2  extern void OSFindNextRunningTask(void) small;
 226      =2  /*********************************************************************************************************
 227      =2  ** º¯ÊýÃû³Æ: OSFindNextRunningTask
 228      =2  ** ¹¦ÄÜÃèÊö: ²éÕÒÏÂÒ»¸öÓÅÏÈ¼¶×î¸ßµÄ¾ÍÐ÷ÈÎÎñ
 229      =2  ** Êä¡¡Èë: ÎÞ
 230      =2  ** Êä¡¡³ö: OSNextTaskID:´æ´¢²éÕÒ½á¹û
 231      =2  ** È«¾Ö±äÁ¿: OSTaskRuning,OSTaskCreated
 232      =2  ** µ÷ÓÃÄ£¿é: ÎÞ
 233      =2  **
 234      =2  ** ×÷¡¡Õß: ³ÂÃ÷¼Æ
 235      =2  ** ÈÕ¡¡ÆÚ: 2002Äê6ÔÂ20ÈÕ
 236      =2  **-------------------------------------------------------------------------------------------------------
 237      =2  ** ÐÞ¸ÄÈË:
 238      =2  ** ÈÕ¡¡ÆÚ:
 239      =2  **-------------------------------------------------------------------------------------------------------
 240      =2  ********************************************************************************************************/
 241      =2  #endif
 242      =2  
 243      =2  /*********************************************************************************************************
 244      =2  **                            End Of File
 245      =2  ********************************************************************************************************/
 140      =1  #include "..\os\OS_Q.h"
   1      =2  /*********************************************************************************************************
   2      =2  **                                                             Small RTOS(51)
   3      =2  **                                   The Real-Time Kernel(For Keil c51)
   4      =2  **
   5      =2  **                                  (c) Copyright 2002-2003, chenmingji
   6      =2  **                                           All Rights Reserved
   7      =2  **
   8      =2  **                                                  V1.20.0
   9      =2  **
  10      =2  **
  11      =2  **--------------ÎÄ¼þÐÅÏ¢--------------------------------------------------------------------------------
  12      =2  **ÎÄ   ¼þ   Ãû: OS_Q.h
  13      =2  **´´   ½¨   ÈË: ³ÂÃ÷¼Æ
  14      =2  **×îºóÐÞ¸ÄÈÕÆÚ:  2003Äê8ÔÂ3ÈÕ
  15      =2  ** Ãè¡¡Êö: Small RTOS(51)ÏûÏ¢¶ÓÁÐÍ·ÎÄ¼þ£¬¶¨ÒåÒ»Ð©ºêºÍÉùÃ÷Ò»Ð©º¯Êý
  16      =2  **
C51 COMPILER V8.08   UART                                                                  01/26/2011 09:34:32 PAGE 29  

  17      =2  **--------------ÀúÊ·°æ±¾ÐÅÏ¢----------------------------------------------------------------------------
  18      =2  ** ´´½¨ÈË: ³ÂÃ÷¼Æ
  19      =2  ** °æ  ±¾: V1.10~V1.12.0
  20      =2  ** ÈÕ¡¡ÆÚ: 2002Äê6ÔÂ20ÈÕ~2002Äê12ÔÂ30ÈÕ
  21      =2  ** Ãè¡¡Êö: ÍêÉÆÏûÏ¢¶ÓÁÐ´úÂë
  22      =2  **
  23      =2  **------------------------------------------------------------------------------------------------------
  24      =2  ** ÐÞ¸ÄÈË: ³ÂÃ÷¼Æ
  25      =2  ** °æ  ±¾: V1.20.0
  26      =2  ** ÈÕ¡¡ÆÚ: 2003Äê8ÔÂ3ÈÕ
  27      =2  ** Ãè¡¡Êö: É¾³ýOSInt*º¯Êý£¬¸ù¾ÝÐÂ°æ±¾ÒªÇó¸Ä±äÒ»Ð©´úÂë
  28      =2  **
  29      =2  **--------------µ±Ç°°æ±¾ÐÞ¶©-----------------------------------------------------------------------------
  30      =2  ** ÐÞ¸ÄÈË:
  31      =2  ** ÈÕ¡¡ÆÚ:
  32      =2  ** Ãè¡¡Êö:
  33      =2  **
  34      =2  **------------------------------------------------------------------------------------------------------
  35      =2  ********************************************************************************************************/
  36      =2  
  37      =2  
  38      =2  #ifndef NOT_OK
           =2 #define NOT_OK      255                                 /* ²ÎÊý´íÎó                                     */
           =2 #endif
  41      =2  
  42      =2  #define OS_Q_FULL   8                                   /* ¶ÓÁÐÂú                                       */
  43      =2  #define OS_Q_NOT_OK 4                                   /* ÎÞÏûÏ¢                                       */
  44      =2  #define OS_Q_TMO    2                                   /* ³¬Ê±µ½                                       */
  45      =2  #define OS_Q_OK     1                                   /* ²Ù×÷³É¹¦                                     */
  46      =2  
  47      =2  #ifndef IN_OS_Q
  48      =2  extern uint8 OSQCreate(uint8 OS_Q_MEM_SEL *Buf, uint8 SizeOfBuf);
  49      =2  /*********************************************************************************************************
  50      =2  ** º¯ÊýÃû³Æ: OSQCreate
  51      =2  ** ¹¦ÄÜÃèÊö: ³õÊ¼»¯ÏûÏ¢¶ÓÁÐ
  52      =2  ** Êä¡¡Èë: Buf:Îª¶ÓÁÐ·ÖÅäµÄ´æ´¢¿Õ¼äµØÖ·
  53      =2  **         SizeOfBuf:Îª¶ÓÁÐ·ÖÅäµÄ´æ´¢¿Õ¼ä´óÐ¡
  54      =2  ** Êä¡¡³ö: NOT_OK:²ÎÊý´íÎó
  55      =2  **         OS_Q_OK:³É¹¦
  56      =2  ** È«¾Ö±äÁ¿: ÎÞ
  57      =2  ** µ÷ÓÃÄ£¿é: ÎÞ
  58      =2  ********************************************************************************************************/
  59      =2  extern uint8 OSQPend(uint8 data *Ret, uint8 OS_Q_MEM_SEL *Buf, uint8 Tick);
  60      =2  /*********************************************************************************************************
  61      =2  ** º¯ÊýÃû³Æ: OSQPend
  62      =2  ** ¹¦ÄÜÃèÊö: µÈ´ýÏûÏ¢¶ÓÁÐÖÐµÄÏûÏ¢
  63      =2  ** Êä¡¡Èë: Ret:·µ»ØµÄÏûÏ¢
  64      =2  **         Buf:Ö¸Ïò¶ÓÁÐµÄÖ¸Õë
  65      =2  **         Tick:µÈ´ýÊ±¼ä
  66      =2  ** Êä¡¡³ö: NOT_OK:²ÎÊý´íÎó
  67      =2  **         OS_Q_OK:ÊÕµ½ÏûÏ¢
  68      =2  **         OS_Q_TMO:³¬Ê±µ½
  69      =2  **         OS_Q_NOT_OK:ÎÞÏûÏ¢
  70      =2  ** È«¾Ö±äÁ¿: ÎÞ
  71      =2  ** µ÷ÓÃÄ£¿é: OSRunningTaskID,OSClearSignal,OSSched,OS_ENTER_CRITICAL,OS_EXIT_CRITICAL
  72      =2  ********************************************************************************************************/
  73      =2  extern uint8 OSQAccept(uint8 data *Ret, uint8 OS_Q_MEM_SEL *Buf);
  74      =2  /*********************************************************************************************************
  75      =2  ** º¯ÊýÃû³Æ: OSQAccept
  76      =2  ** ¹¦ÄÜÃèÊö: ÎÞµÈ´ý´ÓÏûÏ¢¶ÓÁÐÖÐÈ¡µÃÏûÏ¢
  77      =2  ** Êä¡¡Èë: Ret:·µ»ØµÄÏûÏ¢
  78      =2  **         Buf:Ö¸Ïò¶ÓÁÐµÄÖ¸Õë
C51 COMPILER V8.08   UART                                                                  01/26/2011 09:34:32 PAGE 30  

  79      =2  ** Êä¡¡³ö: NOT_OK:²ÎÊý´íÎó
  80      =2  **         OS_Q_OK:ÊÕµ½ÏûÏ¢
  81      =2  **         OS_Q_TMO:³¬Ê±µ½
  82      =2  **         OS_Q_NOT_OK:ÎÞÏûÏ¢
  83      =2  ** È«¾Ö±äÁ¿: ÎÞ
  84      =2  ** µ÷ÓÃÄ£¿é: OSClearSignal,OSSched,OS_ENTER_CRITICAL,OS_EXIT_CRITICAL
  85      =2  ********************************************************************************************************/
  86      =2  extern uint8 OSQPost(uint8 OS_Q_MEM_SEL *Buf, uint8 Data);
  87      =2  /*********************************************************************************************************
  88      =2  ** º¯ÊýÃû³Æ: OSQPost
  89      =2  ** ¹¦ÄÜÃèÊö: FIFO·½Ê½·¢ËÍÏûÏ¢
  90      =2  ** Êä¡¡Èë: Buf:Ö¸Ïò¶ÓÁÐµÄÖ¸Õë
  91      =2  **         Data:ÏûÏ¢Êý¾Ý
  92      =2  ** Êä¡¡³ö: OS_Q_FULL:¶ÓÁÐÂú
  93      =2  **         OS_Q_OK:·¢ËÍ³É¹¦
  94      =2  ** È«¾Ö±äÁ¿: ÎÞ
  95      =2  ** µ÷ÓÃÄ£¿é: OSQIntPost,OSSched
  96      =2  ********************************************************************************************************/
  97      =2  extern uint8 OSQPostFront(uint8 OS_Q_MEM_SEL *Buf, uint8 Data);
  98      =2  /*********************************************************************************************************
  99      =2  ** º¯ÊýÃû³Æ: OSQPostFront
 100      =2  ** ¹¦ÄÜÃèÊö: LIFO·½Ê½·¢ËÍÏûÏ¢
 101      =2  ** Êä¡¡Èë: Buf:Ö¸Ïò¶ÓÁÐµÄÖ¸Õë
 102      =2  **         Data:ÏûÏ¢Êý¾Ý
 103      =2  ** Êä¡¡³ö: OS_Q_FULL:¶ÓÁÐÂú
 104      =2  **         OS_Q_OK:·¢ËÍ³É¹¦
 105      =2  ** È«¾Ö±äÁ¿: ÎÞ
 106      =2  ** µ÷ÓÃÄ£¿é: OSQIntPostFront,OSSched
 107      =2  ********************************************************************************************************/
 108      =2  /* ¼æÈÝV1.12.1µÄºê */
 109      =2  #define OSQIntPost(Buf, Data) OSQPost(Buf, Data)
 110      =2  #define OSQIntPostFront(Buf, Data) OSQPostFront(Buf, Data)
 111      =2  
 112      =2  extern uint8 OSQNMsgs(uint8 OS_Q_MEM_SEL *Buf);
 113      =2  /*********************************************************************************************************
 114      =2  ** º¯ÊýÃû³Æ: OSQNMsgs
 115      =2  ** ¹¦ÄÜÃèÊö: È¡µÃÏûÏ¢¶ÓÁÐÖÐÏûÏ¢Êý
 116      =2  ** Êä¡¡Èë: Buf:Ö¸Ïò¶ÓÁÐµÄÖ¸Õë
 117      =2  ** Êä¡¡³ö: ÏûÏ¢Êý
 118      =2  ** È«¾Ö±äÁ¿: ÎÞ
 119      =2  ** µ÷ÓÃÄ£¿é: OS_ENTER_CRITICAL,OS_EXIT_CRITICAL
 120      =2  ********************************************************************************************************/
 121      =2  extern uint8 OSQSize(uint8 OS_Q_MEM_SEL *Buf);
 122      =2  /*********************************************************************************************************
 123      =2  ** º¯ÊýÃû³Æ: OSQSize
 124      =2  ** ¹¦ÄÜÃèÊö: È¡µÃÏûÏ¢¶ÓÁÐ×ÜÈÝÁ¿
 125      =2  ** Êä¡¡Èë: Buf:Ö¸Ïò¶ÓÁÐµÄÖ¸Õë
 126      =2  ** Êä¡¡³ö: ÏûÏ¢¶ÓÁÐ×ÜÈÝÁ¿
 127      =2  ** È«¾Ö±äÁ¿: ÎÞ
 128      =2  ** µ÷ÓÃÄ£¿é: OS_ENTER_CRITICAL,OS_EXIT_CRITICAL
 129      =2  ********************************************************************************************************/
 130      =2  extern void OSQFlush (uint8 OS_Q_MEM_SEL *Buf);
 131      =2  /*********************************************************************************************************
 132      =2  ** º¯ÊýÃû³Æ: OSQFlush
 133      =2  ** ¹¦ÄÜÃèÊö: Çå¿Õ¶ÓÁÐ
 134      =2  ** Êä¡¡Èë: Buf:Ö¸Ïò¶ÓÁÐµÄÖ¸Õë
 135      =2  ** Êä¡¡³ö: ÎÞ
 136      =2  ** È«¾Ö±äÁ¿: ÎÞ
 137      =2  ** µ÷ÓÃÄ£¿é: OS_ENTER_CRITICAL,OS_EXIT_CRITICAL
 138      =2  **
 139      =2  ** ×÷¡¡Õß: ³ÂÃ÷¼Æ
 140      =2  ** ÈÕ¡¡ÆÚ: 2002Äê9ÔÂ1ÈÕ
C51 COMPILER V8.08   UART                                                                  01/26/2011 09:34:32 PAGE 31  

 141      =2  **-------------------------------------------------------------------------------------------------------
 142      =2  ** ÐÞ¸ÄÈË: ³ÂÃ÷¼Æ
 143      =2  ** ÈÕ¡¡ÆÚ: 2002Äê10ÔÂ26ÈÕ
 144      =2  **-------------------------------------------------------------------------------------------------------
 145      =2  ** ÐÞ¸ÄÈË:
 146      =2  ** ÈÕ¡¡ÆÚ:
 147      =2  **-------------------------------------------------------------------------------------------------------
 148      =2  ********************************************************************************************************/
 149      =2  #endif
 150      =2  /*********************************************************************************************************
 151      =2  **                            End Of File
 152      =2  ********************************************************************************************************/
 141      =1  #include "..\os\OS_SEM.h"       
   1      =2  /*********************************************************************************************************
   2      =2  **                                                             Small RTOS(51)
   3      =2  **                                   The Real-Time Kernel(For Keil c51)
   4      =2  **
   5      =2  **                                  (c) Copyright 2002-2003, chenmingji
   6      =2  **                                           All Rights Reserved
   7      =2  **
   8      =2  **                                                  V1.20.0
   9      =2  **
  10      =2  **
  11      =2  **--------------ÎÄ¼þÐÅÏ¢--------------------------------------------------------------------------------
  12      =2  **ÎÄ   ¼þ   Ãû: OS_sem.h
  13      =2  **´´   ½¨   ÈË: ³ÂÃ÷¼Æ
  14      =2  **×îºóÐÞ¸ÄÈÕÆÚ:  2002Äê12ÔÂ2ÈÕ
  15      =2  ** Ãè¡¡Êö: Small RTOS(51)ÐÅºÅÁ¿Í·ÎÄ¼þ£¬¶¨ÒåÒ»Ð©ºêºÍÉùÃ÷Ò»Ð©º¯Êý
  16      =2  **
  17      =2  **--------------ÀúÊ·°æ±¾ÐÅÏ¢----------------------------------------------------------------------------
  18      =2  ** ´´½¨ÈË: ³ÂÃ÷¼Æ
  19      =2  ** °æ  ±¾: V1.10~V1.12.0
  20      =2  ** ÈÕ¡¡ÆÚ: 2002Äê9ÔÂ1ÈÕ~2002Äê12ÔÂ30ÈÕ
  21      =2  ** Ãè¡¡Êö: ÍêÉÆÐÅºÅÁ¿´úÂë
  22      =2  **
  23      =2  **------------------------------------------------------------------------------------------------------
  24      =2  ** ÐÞ¸ÄÈË: ³ÂÃ÷¼Æ
  25      =2  ** °æ  ±¾: V1.20.0
  26      =2  ** ÈÕ¡¡ÆÚ: 2003Äê8ÔÂ3ÈÕ
  27      =2  ** Ãè¡¡Êö: É¾³ýOSInt*º¯Êý£¬¸ù¾ÝÐÂ°æ±¾ÒªÇó¸Ä±äÒ»Ð©´úÂë
  28      =2  **
  29      =2  **--------------µ±Ç°°æ±¾ÐÞ¶©-----------------------------------------------------------------------------
  30      =2  ** ÐÞ¸ÄÈË:
  31      =2  ** ÈÕ¡¡ÆÚ:
  32      =2  ** Ãè¡¡Êö:
  33      =2  **
  34      =2  **------------------------------------------------------------------------------------------------------
  35      =2  ********************************************************************************************************/
  36      =2  
  37      =2  
  38      =2  #ifndef NOT_OK
           =2 #define NOT_OK      255                                 /* ²ÎÊý´íÎó                                     */
           =2 #endif
  41      =2  
  42      =2  #define OS_SEM_NOT_OK 4                                 /* ÎÞÐÅºÅ                                       */
  43      =2  #define OS_SEM_TMO    2                                 /* ³¬Ê±µ½                                       */
  44      =2  #define OS_SEM_OK     1                                 /* ²Ù×÷³É¹¦                                     */
  45      =2  
  46      =2  #ifndef IN_OS_SEM
  47      =2  extern uint8 OSSemCreate(uint8 Index,uint8 Data);
  48      =2  /*********************************************************************************************************
  49      =2  ** º¯ÊýÃû³Æ: OSSemCreate
C51 COMPILER V8.08   UART                                                                  01/26/2011 09:34:32 PAGE 32  

  50      =2  ** ¹¦ÄÜÃèÊö: ³õÊ¼»¯ÏûÏ¢¶ÓÁÐ
  51      =2  ** Êä¡¡Èë: Index:ÐÅºÅÁ¿Ë÷Òý
  52      =2  **         data:ÐÅºÅÁ¿³õÊ¼Öµ
  53      =2  ** Êä¡¡³ö: NOT_OK:Ã»ÓÐÕâ¸öÐÅºÅÁ¿
  54      =2  **         OS_SEM_OK:³É¹¦
  55      =2  ** È«¾Ö±äÁ¿: ÎÞ
  56      =2  ** µ÷ÓÃÄ£¿é: ÎÞ
  57      =2  ********************************************************************************************************/
  58      =2  extern uint8 OSSemPend(uint8 Index, uint8 Tick);
  59      =2  /*********************************************************************************************************
  60      =2  ** º¯ÊýÃû³Æ: OSSemPend
  61      =2  ** ¹¦ÄÜÃèÊö: µÈ´ýÒ»¸öÐÅºÅÁ¿
  62      =2  ** Êä¡¡Èë: Index:ÐÅºÅÁ¿Ë÷Òý
  63      =2  **         Tick:µÈ´ýÊ±¼ä
  64      =2  ** Êä¡¡³ö: NOT_OK:²ÎÊý´íÎó
  65      =2  **         OS_SEM_OK:µÃµ½ÐÅºÅÁ¿
  66      =2  **         OS_SEM_TMO:³¬Ê±µ½
  67      =2  **         OS_SEM_NOT_OK:Ã»ÓÐµÃµ½ÐÅºÅÁ¿
  68      =2  ** È«¾Ö±äÁ¿: ÎÞ
  69      =2  ** µ÷ÓÃÄ£¿é: OSRunningTaskID,OSClearSignal,OSSched,OS_ENTER_CRITICAL,OS_EXIT_CRITICAL
  70      =2  ********************************************************************************************************/
  71      =2  extern uint8 OSSemAccept(uint8 Index);
  72      =2  /*********************************************************************************************************
  73      =2  ** º¯ÊýÃû³Æ: OSSemAccept
  74      =2  ** ¹¦ÄÜÃèÊö: ÎÞµÈ´ýÇëÇóÐÅºÅÁ¿
  75      =2  ** Êä¡¡Èë: Index:ÐÅºÅÁ¿Ë÷Òý
  76      =2  ** Êä¡¡³ö: NOT_OK:²ÎÊý´íÎó
  77      =2  **         OS_SEM_OK:µÃµ½ÐÅºÅÁ¿
  78      =2  **         OS_SEM_TMO:³¬Ê±µ½
  79      =2  **         OS_SEM_NOT_OK:Ã»ÓÐµÃµ½ÐÅºÅÁ¿
  80      =2  ** È«¾Ö±äÁ¿: ÎÞ
  81      =2  ** µ÷ÓÃÄ£¿é: OSClearSignal,OSSched,OS_ENTER_CRITICAL,OS_EXIT_CRITICAL
  82      =2  ********************************************************************************************************/
  83      =2  
  84      =2  #define OSSemIntPost(Index) OSSemPost(Index)
  85      =2  
  86      =2  extern uint8 OSSemPost(uint8 Index);
  87      =2  /*********************************************************************************************************
  88      =2  ** º¯ÊýÃû³Æ: OSSemPost
  89      =2  ** ¹¦ÄÜÃèÊö: ·¢ËÍÒ»¸öÐÅºÅÁ¿
  90      =2  ** Êä¡¡Èë: Index:ÐÅºÅÁ¿Ë÷Òý
  91      =2  ** Êä¡¡³ö: NOT_OK:²ÎÊý´íÎó
  92      =2  **         OS_SEM_OK:·¢ËÍ³É¹¦
  93      =2  ** È«¾Ö±äÁ¿: ÎÞ
  94      =2  ** µ÷ÓÃÄ£¿é: OSSemIntPost,OSSched
  95      =2  ********************************************************************************************************/
  96      =2  extern uint8 OSSemQuery(uint8 Index);
  97      =2  /*********************************************************************************************************
  98      =2  ** º¯ÊýÃû³Æ: OSSemQuery
  99      =2  ** ¹¦ÄÜÃèÊö: ²éÑ¯ÐÅºÅÁ¿
 100      =2  ** Êä¡¡Èë: Index:ÐÅºÅÁ¿Ë÷Òý
 101      =2  ** Êä¡¡³ö: ÐÅºÅÁ¿µÄÖµ
 102      =2  ** È«¾Ö±äÁ¿: ÎÞ
 103      =2  ** µ÷ÓÃÄ£¿é: OS_ENTER_CRITICAL,OS_EXIT_CRITICAL
 104      =2  ********************************************************************************************************/
 105      =2  #endif
 106      =2  /*********************************************************************************************************
 107      =2  **                            End Of File
 108      =2  ********************************************************************************************************/
 142      =1  #include "SingleBus.h"  
   1      =2  /*
   2      =2  ************************Copyright(c)************************
C51 COMPILER V8.08   UART                                                                  01/26/2011 09:34:32 PAGE 33  

   3      =2  *                                  ºþÄÏÒ»ÌØµç×Ó¹É·ÝÓÐÏÞ¹«Ë¾
   4      =2  *                               All Rights Reserved
   5      =2  *                                        
   6      =2  *
   7      =2  *-----------------------ÎÄ¼þÐÅÏ¢---------------------------
   8      =2  *ÎÄ¼þÃû³Æ               :SingleBus.h
   9      =2  *ÎÄ¼þÃèÊö               :µ¥×ÜÏß³ÌÐòÍ·ÎÄ¼þ
  10      =2  *´´½¨ÈË                 :ÒüÔËÍ¬
  11      =2  *´´½¨ÈÕÆÚ               :2008-9-22
  12      =2  *°æ±¾ºÅ                 :V1.0
  13      =2  *×¢ÊÍ                   :                                       
  14      =2  *----------------------------------------------------------
  15      =2  *ÐÞ¸ÄÈË                         :
  16      =2  *ÐÞ¸ÄÈÕÆÚ                       :
  17      =2  *°æ±¾ºÅ                 :
  18      =2  *×¢ÊÍ                   :
  19      =2  ***********************************************************
  20      =2  */
  21      =2  //×ÜÏß0ºê¶¨Òå
  22      =2  #define         BUS0_FREQ_SIZE          7                                                       //µ¥×ÜÏß0Êý¾ÝÖ¡³¤¶È
  23      =2  #define         BUS0_FREQ_SIZE_HI       (BUS0_FREQ_SIZE << 4)           
  24      =2  #define         BUS0_TX_Q_ZISE          (BUS0_FREQ_SIZE*10 + 1)         //µ¥×ÜÏß0Êý¾Ý¶ÓÁÐ³¤¶È
  25      =2  #define         DisableBus0RecInt()     {EX0 = 0;PW=0;}                         //µ¥×ÜÏß0½ûÖ¹×ÜÏßÖÐ¶Ïºê¶¨Òå
  26      =2  #define         EnableBus0RecInt()      {IE0 = 0;EX0 = 1;}                      //µ¥×ÜÏß0»Ö¸´×ÜÏßÖÐ¶Ïºê¶¨Òå
  27      =2  #define         BUS0_SEND_CON           0x3c
  28      =2  #define         BUS0_CAN_SEND           0x0c 
  29      =2  #define         BUS0_ON_REC                     0x03
  30      =2  #define         BUS0_REQ_SEND           0x28
  31      =2  #define         BUS0_SEND_FINISH        0x0c
  32      =2  #define         BUS0_ON_WORK            0x23 
  33      =2  
  34      =2  
  35      =2  //×ÜÏß1ºê¶¨Òå
  36      =2  #define         BUS1_FREQ_SIZE          7                                                       //µ¥×ÜÏß1Êý¾ÝÖ¡³¤¶È
  37      =2  #define         BUS1_FREQ_SIZE_HI       (BUS1_FREQ_SIZE << 4)
  38      =2  #define         BUS1_TX_Q_ZISE          (BUS1_FREQ_SIZE*12 + 1)         //µ¥×ÜÏß1Êý¾Ý¶ÓÁÐ³¤¶È
  39      =2  #define         DisableBus1RecInt()     {EX1 = 0;}                                      //µ¥×ÜÏß1½ûÖ¹×ÜÏßÖÐ¶Ïºê¶¨Òå
  40      =2  #define         EnableBus1RecInt()      {IE1 = 0;EX1 = 1;}                      //µ¥×ÜÏß1»Ö¸´×ÜÏßÖÐ¶Ïºê¶¨Òå
  41      =2  #define         BUS1_SEND_CON           0x3c
  42      =2  #define         BUS1_CAN_SEND           0x0c 
  43      =2  #define         BUS1_ON_REC                     0x03
  44      =2  #define         BUS1_REQ_SEND           0x28
  45      =2  #define         BUS1_SEND_FINISH        0x0c
  46      =2  #define         BUS1_ON_WORK            0x23
  47      =2  
  48      =2  //µ¥×ÜÏß×Ô¶¯ÖØÔØÊ±¼ä
  49      =2  //#define               TIMER0_COUNT            ((256-(Fbus*9375/12/1000000)))
  50      =2  //#define               TIMER0_COUNT            ((256-(Fbus*15000/12/1000000)))         //150us
  51      =2  #define TIMER0_H  0xfe
  52      =2  #define TIMER0_L  0x34
  53      =2  
  54      =2   
  55      =2  /*Êý¾ÝÖ¡¸ñÊ½
  56      =2  ×Ö½Ú1£º·¢ËÍ·½ÇøµØÖ·£¨Ò»¸ö×Ö½Ú£©
  57      =2  ×Ö½Ú2£º·¢ËÍ·½·¿µØÖ·£¨Ò»¸ö×Ö½Ú£©
  58      =2  ×Ö½Ú3£º·¢ËÍ·½´²µØÖ·£¨Ò»¸ö×Ö½Ú£©
  59      =2  ×Ö½Ú4£ºÃüÁî´úÂë£¨Ò»¸ö×Ö½Ú£©
  60      =2  ×Ö½Ú5£º½ÓÊÕ·½ÇøµØÖ·£¨Ò»¸ö×Ö½Ú£©
  61      =2  ×Ö½Ú6£º½ÓÊÕ·½·¿µØÖ·£¨Ò»¸ö×Ö½Ú£©
  62      =2  ×Ö½Ú7£º½ÓÊÕ·½´²µØÖ·£¨Ò»¸ö×Ö½Ú£©
  63      =2  ×¢:Êý¾ÝèåÔÚ²»Í¬µÄÃüÁîÖÐ¿ÉÄÜÓÐ²»Í¬º¬Òå
  64      =2  */
C51 COMPILER V8.08   UART                                                                  01/26/2011 09:34:32 PAGE 34  

  65      =2  /*µ¥×ÜÏßÐ­Òé
  66      =2    ÃüÁî´úÂë:Ò»×Ö½Ú
  67      =2    Êý¾Ý´úÂë:6×Ö½Ú(¸ù¾ÝÃüÁîµÄ²»Í¬Êý¾Ý¸ñÊ½)
  68      =2  */
  69      =2  typedef struct
  70      =2  {
  71      =2          uint8 bySndSecAddr;                     /*Ö÷¶¯·¢ËÍ·½ÇøµØÖ·*/
  72      =2          uint8 bySndRoomAddr;            /*Ö÷¶¯·¢ËÍ·½·¿µØÖ·*/
  73      =2          uint8 bySndBedAddr;                     /*Ö÷¶¯·¢ËÍ·½´²µØÖ·*/
  74      =2          uint8 byCmd;                            /*ÃüÁî*/
  75      =2          uint8 byRecSecAddr;                     /*½ÓÊÕ·½ÇøµØÖ·*/
  76      =2          uint8 byRecRoomAddr;            /*½ÓÊÕ·½·¿µØÖ·*/
  77      =2          uint8 byRecBedAddr;                     /*½ÓÊÕ·½´²µØÖ·*/        
  78      =2  } STBusFreq, *pSTBusFreq;       
  79      =2  /*************************ÃüÁî¶¨Òå**********************/
  80      =2  #define CMD_ENTER_PC                    0x01    /*¶Ô¼¯³ÉÖ÷»ú(PC»ú)µÄÈ·ÈÏÃüÁî*/
  81      =2  #define CMD_BUS_ANSWER                  0x02    /*µ¥×ÜÏßÉÏµÄÍ¨ÓÃÓ¦´ðÃüÁî*/
  82      =2  #define CMD_RESULT_PC                   0x02    /*¶Ô¼¯³ÉÖ÷»ú(PC»ú)µÄ½á¹ûÃüÁî*/
  83      =2  #define CMD_LANDING                             0x03    /*µÇ¼ÇÃüÁî*/                    /*ºóÃæÁ½¸ö×Ö½ÚÎªÓÅÏÈ¼¶ºÍ0x00*/
  84      =2  #define CMD_ENTER                               0x04    /*È·ÈÏÃüÁî*/                    /*Ö»ÄÜÎªÖ÷»ú¶Ô´Ó»ú·¢ËÍ*/
  85      =2  /*****************************************************************/
  86      =2  #define CMD_COMM_CALL                   0x05    /*ÆÕÍ¨ºô½ÐÃüÁî*/                /*ºóÃæÁ½¸ö×Ö½ÚÎªÓÅÏÈ¼¶ºÍÖ÷·½×´Ì¬*/
  87      =2  #define CMD_INFUSION_CALL               0x06    /*ÊäÒººô½ÐÃüÁî*/
  88      =2  #define CMD_SERVICE_CALL                0x07    /*·þÎñºô½ÐÃüÁî*/
  89      =2  #define CMD_EMERGENCY_CALL              0x08    /*½ô¼±ºô½ÐÃüÁî*/
  90      =2  #define CMD_HELP_CALL                   0x09    /*ÇóÔ®ºô½ÐÃüÁî*/                /* ±ØÐëµÃµ½Ö÷»úµÄÈ·ÈÏÃüÁî*/
  91      =2  #define CMD_INSPECTOR_CALL              0x0a    /*²é·¿ºô½ÐÃüÁî*/                /* ±ØÐëµÃµ½Ö÷»úµÄÈ·ÈÏÃüÁî*/
  92      =2  /*****************************************************************/
  93      =2  #define CMD_COMM_ANSWER                 0x0b    /*ÆÕÍ¨Ó¦´ðÃüÁî*/                
  94      =2  #define CMD_INFUSION_ANSWER             0x0c    /*´¦ÀíÊäÒºÃüÁî*/
  95      =2  #define CMD_SERVICE_ANSWER              0x0d    /*´¦Àí·þÎñÃüÁî*/
  96      =2  #define CMD_EMERGENCY_ANSWER    0x0e    /*´¦Àí½ô¼±ÃüÁî*/
  97      =2  #define CMD_HELP_ANSWER                 0x0f    /*´¦ÀíÇóÔ®ÃüÁî*/
  98      =2  /*****************************************************************/
  99      =2  #define CMD_INFUSION_CLEAR              0x10    /*Çå³ýÊäÒºÃüÁî*/                /* ¶ÔÓ¦µÄÇå³ýÃüÁî*/
 100      =2  #define CMD_SERVICE_CLEAR               0x11    /*Çå³ý·þÎñÃüÁî*/
 101      =2  #define CMD_EMERGENCY_CLEAR             0x12    /*Çå³ý½ô¼±ÃüÁî*/
 102      =2  #define CMD_HELP_CLEAR                  0x13    /*Çå³ýÇóÔ®ÃüÁî*/
 103      =2  /*****************************************************************/
 104      =2  #define CMD_BROADCAST1                  0x14    /*²¡Çø¹ã²¥ºô½ÐÃüÁî*/
 105      =2  #define CMD_BROADCAST2                  0x15    //°ì¹«Çø¹ã²¥ºô½ÐÃüÁî*/
 106      =2  #define CMD_CALL_LISTEN                 0x16    /*½ÓÌýºô½ÐÃüÁî*/
 107      =2  #define CMD_PRIORITY_SET                0x17    /*ÓÅÏÈ¼¶Ö¸¶¨ÃüÁî*/              /*ÏµÍ³ÃüÁî£ºµÚÒ»¸ö×Ö½Ú¸ß3Î»ÎªÓÅÏÈ¼¶£¬½ÓÊÕ·½µØÖ·*/
 108      =2  #define CMD_SYSTERM_RESET               0x18    /*ÏµÍ³¸´Î»ÃüÁî*/
 109      =2  /*****************************************************************/
 110      =2  #define CMD_DATE_SEND                   0x19    /*ÈÕÆÚ·¢ËÍÃüÁî*/                /*Ç°Á½¸ö×Ö½Ú£¬Äê£º4Î»BCDÂë£¬ºóÃæÁ½¸ö×Ö½Ú£ºÔÂºÍÈÕÆÚ£º4Î»BCDÂ
             -ë*/
 111      =2  #define CMD_LCD_SEND                    0x1a    /*ÆÁÊý¾Ý·¢ËÍÃüÁî*/
 112      =2  #define CMD_SCHEDULE_SEND               0x1b    /*Ò»ÀÀ±í·¢ËÍÃüÁî*/
 113      =2  #define CMD_NUMBER_SET                  0x1c    /*ÐÞ¸Ä±àºÅÃüÁî*/                /*ÐÂµÄµØÖ·ÔÚÇ°2¸ö×Ö½Ú£¬±»ÐÞ¸ÄµØÖ·ÔÚºóÁ½¸ö×Ö½Ú*/
 114      =2  #define CMD_HANDLER_SEND                0x1d    /*·¢ËÍÊÖ±úÒº¾§ÃüÁî*/
 115      =2  /*****************************************************************/
 116      =2  #define CMD_CONTROL_SEND                0x1e    /*¿ØÖÆ×Ö´«µÝÃüÁî*/
 117      =2  #define CMD_FLOOR_SET                   0x1f    /*ÐÞ¸ÄÂ¥²ãºÅÃüÁî*/
 118      =2  #define CMD_BROADCAST3                  0x20    /*È«Çø¹ã²¥ºô½ÐÃüÁî*/
 119      =2  #define CMD_INFUSION_ENTER              0x21    /*È·ÈÏÊäÒºÃüÁî*/
 120      =2  #define CMD_SERVICE_ENTER               0x22    /*È·ÈÏ·þÎñÃüÁî*/
 121      =2  #define CMD_HELP_ENTER                  0x23    /*È·ÈÏÇóÔ®ÃüÁî*/
 122      =2  #define CMD_EMERGENCY_ENTER             0x24    /*È·ÈÏ½ô¼±ÃüÁî*/
 123      =2  /*****************************************************************/
 124      =2  #define CMD_CLEAR_INSPERCTOR    0x25    /*Çå³ý²é·¿ÃüÁî*/
 125      =2  #define CMD_START_VOICE                 0x26    /*Æô¶¯²¥ÒôÃüÁî*/
C51 COMPILER V8.08   UART                                                                  01/26/2011 09:34:32 PAGE 35  

 126      =2  #define CMD_STOP_VOICE                  0x27    /*Í£Ö¹²¥ÒôÃüÁî*/
 127      =2  #define CMD_MUSIC_PLAY                  0x28    /*±³¾°ÒôÀÖÃüÁî*/
 128      =2  #define CMD_REQUEST_INFO                0x29    /*ÇëÇó·¢ËÍÐÅÏ¢ÃüÁî*/
 129      =2  /*****************************************************************/
 130      =2  #define CMD_CHANNEL_CHANGE              0x2a    /*ÇÐ»»Í¨»°Í¨µÀ*/
 131      =2  #define CMD_CHANNEL_CLOSE               0x2b    /*¹Ø±ÕÍ¨»°Í¨µÀ*/
 132      =2  #define CMD_POWER_ON                    0x2c    /*ÉÏµç¸´Î»ÃüÁî*/
 133      =2  #define CMD_INSPERCTOR_ENTER    0x2d    /*È·ÈÏ²é·¿ÃüÁî*/
 134      =2  #define CMD_STOP_INDICATION             0x2e    /*ÖÕÖ¹ºô½ÐÐÅÏ¢ÃüÁî*/
 135      =2  #define CMD_INFO_INDICATION             0x2f    /*ÐÅÏ¢Ö¸Ê¾ÃüÁî*/
 136      =2  /*Ö÷¶¯ºô½Ð·½µØÖ·ÔÚÇ°Á½¸ö×Ö½Ú£¬ºóÃæÁ½¸ö×Ö½ÚÎªºô½ÐÀàÐÍ£º¸ß3Î»ÓÅÏÈ¼¶£¬µÍ5Î»ÎªÀà±ð*/
 137      =2  /*****************************************************************/
 138      =2  #define CMD_MUSIC                               0x30    /*ÒôÀÖÃüÁî*/
 139      =2  #define CMD_INCREACE_VOL                0x31    /*ÒôÁ¿Ôö¼ÓÃüÁî*/
 140      =2  #define CMD_DECREACE_VOL                0x32    /*ÒôÁ¿¼õÐ¡ÃüÁî*/
 141      =2  #define CMD_OPEN_485BUS_IN_ACK  0x34    //´Ó»ú´ò¿ª485ÊäÈëÃüÁî
 142      =2  #define CMD_OPEN_485BUS_OUT_ACK 0x35    //´Ó»ú´ò¿ª485Êä³öÃüÁî
 143      =2  #define CMD_OPEN_LCD                    0x3e    /*´ò¿ªÏÔÊ¾ÃüÁî*/
 144      =2  #define CMD_CLOSE_LCD                   0x3f    /*¹Ø±ÕÏÔÊ¾ÃüÁî*/
 145      =2  /*****************************************************************/
 146      =2  #define CMD_OPEN_485BUS_OUT             0x40    /*´ò¿ª485Êä³ö*/
 147      =2  #define CMD_OPEN_485BUS_IN              0x41    /*´ò¿ª485ÊäÈëÃüÁî*/
 148      =2  #define CMD_CLOSE_485BUS                0x42    /*¹Ø±Õ485ÃüÁî*/
 149      =2  /*****************************************************************/
 150      =2  #define CMD_CLEAR_HANDLE_LCD    0x43    /*Çå³ýÊÖ±úÒº¾§ÆÁ*/
 151      =2  #define CMD_KEY_AVALID                  0x44    /*°´¼üÓÐÐ§ÃüÁî*/
 152      =2  #define CMD_KEY_INVALID                 0x45    /*°´¼üÊ§Ð§ÃüÁî*/
 153      =2  #define CMD_KEY_DOWN                    0x46    /*°´¼üÑ¹ÏÂÃüÁî*/
 154      =2  #define CMD_KEY_UP                              0x47    /*°´¼üÊÍ·ÅÃüÁî*/
 155      =2  #define CMD_ERROR_REPORT                0x48    /*¹ÊÕÏ±¨¸æÃüÁî*/
 156      =2  #define CMD_CLEAR_LCD                   0x49    /*Çå³ýÒº¾§ÐÅÏ¢ÃüÁî*/
 157      =2  #define CMD_RECEIVE_OK                  0x4a    /*ÊÕµ½ÐÅÏ¢ÃüÁî*/
 158      =2  #define CMD_RECEIVE_ERROR               0x4b    /*Ñ¡ÔñÐÅÏ¢ÃüÁî*/
 159      =2  #define CMD_NO_BUG                              0x4c    /*ÇëÎð´òÈÅÃüÁî*/
 160      =2  #define CMD_NO_BUG_AVALID               0x4d    /*ÇëÎð´òÈÅÓÐÐ§ÃüÁî*/
 161      =2  #define CMD_BUG_END                             0x4e    /*½áÊø´òÈÅÃüÁî*/
 162      =2  
 163      =2  #define CMD_WRITE_SERIAL                0x55    /*Ð´ÈëÐòÁÐºÅ*/
 164      =2  #define CMD_READ_SERIAL                 0x56    /*¶ÁÐòÁÐºÅ*/
 165      =2  #define CMD_OUT_SERIAL                  0x57    /*ÐòÁÐºÅÊä³ö*/
 166      =2  #define CMD_SET_BY_SERIAL               0x5a    /*¸ù¾ÝÐòÁÐºÅÐ´Éè±¸µØÖ·*/
 167      =2  #define CMD_READ_BY_SERIAL              0x5b    /*¸ù¾ÝÐòÁÐºÅ¶ÁÉè±¸µØÖ·*/
 168      =2  #define CMD_OUT_BY_SERIAL               0x5c    /*¸ù¾ÝÐòÁÐºÅ¶ÁÉè±¸µØÖ·Êä³ö*/
 169      =2  
 170      =2  #define CMD_LED_INDICATE                0x70    /*µÆÖ¸Ê¾ÃüÁî,·¢ËÍ·½µØÖ·ÎÞÐ§£¬ÇøµØÖ·ÎªµÆ×´Ì¬*/
 171      =2  #define CMD_GET_BUS                             0x71    /*Õ¼ÓÃ×ÜÏßÃüÁî*/
 172      =2  #define CMD_QUEST                               0x73    /*²éÑ¯ÃüÁî*/
 173      =2  #define CMD_QUEST_ANSWER                0x74    /*²éÑ¯Ó¦´ðÃüÁî*/
 174      =2  #define CMD_TALK_CLEAR                  0X75    /*½áÊøÍ¨»°ÃüÁî*/
 175      =2  
 176      =2  
 177      =2  /*****************************************************************/
 178      =2  #define CMD_DISPLAY_DATA                0x80    /*·¢ËÍÒ»Ö¡Òº¾§ÆÁÊý¾Ý*/
 179      =2  #define CMD_DATA_ERROR                  0x81    /*Ò»Ö¡Êý¾Ý³ö´íÃüÁî*/
 180      =2  #define CMD_SB_DISPLAY_DATA             0x82    /*·¢ËÍÒ»Ö¡Òº¾§ÆÁÊý¾Ý*/
 181      =2  
 182      =2  #define CMD_NURSE_IN                    0X83    //»¤Ê¿µ½Î»ÃüÁî
 183      =2  #define CMD_NURSE_OUT                   0X84    //»¤Ê¿Àë¿ªÃüÁî
 184      =2  
 185      =2  
 186      =2  /*****************************************************************/
 187      =2  
C51 COMPILER V8.08   UART                                                                  01/26/2011 09:34:32 PAGE 36  

 188      =2  #define CMD_ONLINE_WRITE                0xf3    /*ÔÚÏßÐ´ÈëÃüÁî*/
 189      =2  #define CMD_ONLIEN_READ                 0xf4    /*ÔÚÏß¶Á³öÃüÁî*/
 190      =2  #define CMD_ONLINE_OUTPUT               0xf5    /*ÔÚÏßÊä³öÃüÁî*/
 191      =2  /*****************************************************************/
 192      =2  #define CMD_LED_OFFLINE_WRITE   0xf0    /*ledeepromÀëÏßÐ´ÈëÃüÁî*/
 193      =2  #define CMD_LED_OFFLINE_READ    0xf1    /*ledeepromÀëÏß¶Á³öÃüÁî*/
 194      =2  #define CMD_LED_OFFLINE_OUTPUT  0xf2    /*ledeepromÀëÏßÊä³öÃüÁî*/
 195      =2  /*****************************************************************/
 196      =2  #define CMD_EEPROM_OFFLINE_WR   0xfe    /*eepromÀëÏßÐ´ÈëÃüÁî*/
 197      =2  #define CMD_EEPROM_OFFLINE_RD   0xf1    /*eepromÀëÏß¶Á³öÃüÁî*/
 198      =2  #define CMD_EEPROM_OFFLINE_OUTT 0xf2    /*eepromÀëÏßÊä³öÃüÁî*/ 
 199      =2  
 200      =2  extern unsigned char bdata ledflag;
 201      =2  extern bit fled0;
 202      =2  extern bit fled1;
 203      =2  extern bit fled2;
 204      =2  extern bit fled3;
 205      =2  extern bit fled4;
 206      =2  
 207      =2  extern void led0flash(void);
 208      =2  
 209      =2  extern uint8 Bus0OutputData(uint8* pbyData);  
 210      =2  extern uint8 Bus1OutputData(uint8* pbyData);
 211      =2  
 212      =2  
 213      =2  extern bit Bus0SendPin;
 214      =2  
 215      =2  #ifdef _IN_SINGLE_BUS_
           =2 //Éè±¸×´Ì¬¶¨Òå
           =2 uint8   bdata   byDevState1;
           =2 sbit    bBusy                           =       byDevState1^7;                          //ÏµÍ³Ã¦±êÖ¾
           =2 sbit    bSetKeyDown                     =       byDevState1^6;                          //ÉèÖÃ¼ü°´ÏÂ×´Ì¬
           =2 sbit    bDealKeyDown            =       byDevState1^5;                          //´¦Àí¼ü°´ÏÂ×´Ì¬
           =2 sbit    bNurseIn                        =       byDevState1^4;                          //»¤Ê¿µ½Î»±êÖ¾
           =2 sbit    bChannel1Talked         =       byDevState1^3;                          //Í¨µÀ1±»¶¯Í¨»°±êÖ¾
           =2 sbit    bChannel1Talk           =       byDevState1^2;                          //Í¨µÀ1Ö÷¶¯Í¨»°±êÖ¾
           =2 sbit    bIndicatingOther        =       byDevState1^1;                          //Ö¸Ê¾ÆäËü·Ö»úºô½Ð±êÖ¾
           =2 sbit    bLanding                        =       byDevState1^0;                          //ÉÏµçµÇ¼Ç×´Ì¬
           =2 uint8   bdata   byDevState2;
           =2 sbit    bWaitAck                        =       byDevState2^7;                          //µÈ´ýÓ¦´ð±êÖ¾
           =2 sbit    bWaitListen                     =       byDevState2^6;                          //µÈ´ý½ÓÌý±êÖ¾
           =2 sbit    bChannel0Talked         =       byDevState2^5;                          //Í¨µÀ0±»¶¯Í¨»°±êÖ¾
           =2 sbit    bChannel0Talk           =       byDevState2^4;                          //Í¨µÀ0Ö÷¶¯Í¨»°±êÖ¾
           =2 sbit    bSickRoomBroad          =       byDevState2^3;                          //²¡Çø¹ã²¥±êÖ¾
           =2 sbit    bOfficeBroad            =       byDevState2^2;                          //°ì¹«Çø¹ã²¥±êÖ¾
           =2 sbit    bAllBroad                       =       byDevState2^1;                          //È«Çø¹ã²¥±êÖ¾
           =2 sbit    bSelfBroad                      =       byDevState2^0;                          //Ö÷¶¯¹ã²¥±êÖ¾
           =2 uint8   bdata   byDevState3;
           =2 sbit    bCalledRing                     =       byDevState3^7;                          //±»½ÐÕñÁå±êÖ¾
           =2 sbit    bVoiceNoting            =       byDevState3^6;                          //ÓïÒôÌáÊ¾±êÖ¾
           =2 sbit    bMusicPlaying           =       byDevState3^5;                          //±³¾°ÒôÀÖ²¥·Å±êÖ¾
           =2 sbit    bConfusionNoting        =       byDevState3^4;                          //ÊäÒººô½ÐÌáÊ¾±êÖ¾
           =2 sbit    bServiceNoting          =       byDevState3^3;                          //·þÎñºô½ÐÌáÊ¾±êÖ¾
           =2 sbit    bHelpNoting                     =       byDevState3^2;                          //ÇóÔ®ºô½ÐÌáÊ¾±êÖ¾
           =2 sbit    bEmergencyNoting        =       byDevState3^1;                          //½ô¼±ºô½ÐÌáÊ¾±êÖ¾ 
           =2 sbit    bPWState                        =       byDevState3^0;                          //PW¿ØÖÆ½Å×´Ì¬
           =2 //Ðí¿É±êÖ¾¶¨Òå
           =2 uint8   bdata byEnable1;
           =2 sbit    bEnSickRoomBroad        =       byEnable1^0;                            //Ðí¿É²¡Çø¹ã²¥
           =2 sbit    bEnOfficeBroad          =       byEnable1^1;                            //Ðí¿É°ì¹«Çø¹ã²¥
           =2 sbit    bEnAllBroad                     =       byEnable1^2;                            //Ðí¿ÉÈ«Çø¹ã²¥
           =2 sbit    bEnSoundNote            =       byEnable1^3;                            //Ðí¿ÉÓïÒôÌáÊ¾
C51 COMPILER V8.08   UART                                                                  01/26/2011 09:34:32 PAGE 37  

           =2 sbit    bEnOutRing                      =       byEnable1^4;                            //Ðí¿ÉÍâ²¿ÕñÁå
           =2 sbit    bEnAutoListen           =       byEnable1^5;                            //Ðí¿É×Ô¶¯½ÓÌý
           =2 sbit    bEnVoiceNote            =       byEnable1^6;                            //Ðí¿ÉÉùÒôÌáÊ¾
           =2 sbit    bEnHandleDeal           =       byEnable1^7;                            //Ðí¿ÉÊÖ±ú´¦Àí
           =2 uint8   bdata byEnable2;
           =2 sbit    bEnInfusionDeal         =       byEnable2^0;                            //Ðí¿ÉÊäÒººô½Ð´¦Àí
           =2 sbit    bEnServiceDeal          =       byEnable2^1;                            //Ðí¿É·þÎñºô½Ð´¦Àí
           =2 sbit    bEnHelpDeal                     =       byEnable2^2;                            //Ðí¿ÉÇóÔ®ºô½Ð´¦Àí
           =2 sbit    bEnEmergencyDeal        =       byEnable2^3;                            //Ðí¿ÉÇóÔ®ºô½Ð´¦Àí
           =2 sbit    bEnCallDeal                     =       byEnable2^4;                            //Ðí¿Éºô½Ð´¦Àí
           =2 sbit    bEnMusicplay            =       byEnable2^5;                            //Ðí¿É±³¾°ÒôÀÖ²¥·Å
           =2 sbit    bEnHandDown                     =       byEnable2^6;                            //Ðí¿ÉÊÖ±ú¹Ò¶Ïºô½Ð
           =2 #else
 263      =2  extern  uint8   byDevState1;
 264      =2  extern  uint8   byDevState2;
 265      =2  extern  uint8   byDevState3;
 266      =2  extern  uint8   byEnable1;
 267      =2  extern  uint8   byEnable2;
 268      =2  extern  bit     bBusy;
 269      =2  extern  bit             bSetKeyDown;
 270      =2  extern  bit             bDealKeyDown;
 271      =2  extern  bit             bNurseIn;
 272      =2  extern  bit             bChannel1Talked;
 273      =2  extern  bit             bChannel1Talk;
 274      =2  extern  bit             bIndicatingOther;
 275      =2  extern  bit             bLanding;
 276      =2  extern  bit     bWaitAck;
 277      =2  extern  bit     bWaitListen;
 278      =2  extern  bit             bChannel0Talked;
 279      =2  extern  bit             bChannel0Talk;
 280      =2  extern  bit             bSickRoomBroad;
 281      =2  extern  bit             bOfficeBroad;
 282      =2  extern  bit             bAllBroad;
 283      =2  extern  bit             bSelfBroad;     
 284      =2  extern  bit             bCalledRing;
 285      =2  extern  bit             bVoiceNoting;
 286      =2  extern  bit             bMusicPlaying;
 287      =2  extern  bit             bConfusionNoting;
 288      =2  extern  bit             bServiceNoting;
 289      =2  extern  bit             bHelpNoting;
 290      =2  extern  bit             bEmergencyNoting;
 291      =2  extern  bit             bPWState;
 292      =2  /********************************************/
 293      =2  extern  bit             bEnSickRoomBroad;
 294      =2  extern  bit             bEnOfficeBroad;
 295      =2  extern  bit             bEnAllBroad;
 296      =2  extern  bit             bEnSoundNote;
 297      =2  extern  bit             bEnOutRing;
 298      =2  extern  bit             bEnAutoListen;
 299      =2  extern  bit             bEnVoiceNote;
 300      =2  extern  bit             bEnHandleDeal;
 301      =2  extern  bit             bEnInfusionDeal;
 302      =2  extern  bit             bEnServiceDeal;
 303      =2  extern  bit             bEnHelpDeal;
 304      =2  extern  bit             bEnEmergencyDeal;
 305      =2  extern  bit             bEnCallDeal;
 306      =2  extern  bit             bEnMusicplay;
 307      =2  extern  bit             bEnHandDown;
 308      =2  void SingleBusInit(void);        
 309      =2  void ReadParameter(void);
 310      =2  void InitParameter(void);
 311      =2  void VoiceChannelCtx(void);
C51 COMPILER V8.08   UART                                                                  01/26/2011 09:34:32 PAGE 38  

 312      =2  void LedControl(void);
 313      =2  void MakeCH0TimerOut(uint8 byTimerOut, uint8 byTimerOutCount);  
 314      =2  void MakeCH1TimerOut(uint8 byTimerOut, uint8 byTimerOutCount);          
 315      =2  void Bus0RecDeal(void);
 316      =2  void Bus0SendDeal(void);
 317      =2  void Bus0Manage(void);
 318      =2  void Bus1RecDeal(void);
 319      =2  void Bus1SendDeal(void);
 320      =2  void Bus1Manage(void);
 321      =2  
 322      =2  void TimerOutDeal(void);
 323      =2  void TimerOutManager(void);
 324      =2  #endif
 143      =1  #include "IAP.h"
   1      =2  /*
   2      =2  ************************Copyright(c)************************
   3      =2  *                                  ºþÄÏÒ»ÌØµç×Ó¹É·ÝÓÐÏÞ¹«Ë¾
   4      =2  *                               All Rights Reserved
   5      =2  *                                        
   6      =2  *
   7      =2  *-----------------------ÎÄ¼þÐÅÏ¢---------------------------
   8      =2  *ÎÄ¼þÃû³Æ               :IAP.h
   9      =2  *ÎÄ¼þÃèÊö               :Ð´FlashÇý¶¯Í·ÎÄ¼þ
  10      =2  *´´½¨ÈË                 :ÒüÔËÍ¬
  11      =2  *´´½¨ÈÕÆÚ               :2008-9-22
  12      =2  *°æ±¾ºÅ                 :V1.0
  13      =2  *×¢ÊÍ                   :²ÉÓÃSTCÏµÁÐCPU,¸ÃÀàÐÍCPU½«ÄÚ²¿Flash×÷
  14      =2                                       EEPromÊ¹ÓÃ,²Á³ýÐèÒÔÉÈÇøÎªµ¥Î»,ÔÚ½øÐÐ
  15      =2                                       IAP²Ù×÷¹ý³ÌÖÐ,CPU°´ÕÕÉè¶¨µÄÊ±¼ä¹ÒÆð,
  16      =2                                       ´ËÊ±CPU²»ÄÜ¹»½øÐÐÈÎºÎ¹¤×÷
  17      =2  *----------------------------------------------------------
  18      =2  *ÐÞ¸ÄÈË                         :
  19      =2  *ÐÞ¸ÄÈÕÆÚ                       :
  20      =2  *°æ±¾ºÅ                 :
  21      =2  *×¢ÊÍ                   :
  22      =2  ***********************************************************
  23      =2  */
  24      =2  #define         IAP_READ                        0x01                                            //IAP¶ÁÃüÁî
  25      =2  #define         IAP_WRITE                       0x02                                            //IAPÐ´ÃüÁî
  26      =2  #define         IAP_ERASE                       0x03                                            //IAP²Á³ýÃüÁî
  27      =2  #define         IAP_WAIT_TIME           0x02                                            //IAPµÈ´ýÊ±¼ä 20MÒÔÏÂ
  28      =2  //#define               IAP_WAIT_TIME           0x03                                            //IAPµÈ´ýÊ±¼ä   12MÒÔÏÂ
  29      =2  
  30      =2  //#define       ISP_DATA        IAP_DATA        
  31      =2  //#define       ISP_CONTR       IAP_CONTR       
  32      =2  //#define       ISP_CMD         IAP_CMD         
  33      =2  //#define       ISP_ADDRH       IAP_ADDRH       
  34      =2  //#define       ISP_ADDRL       IAP_ADDRL       
  35      =2  //#define       ISP_TRIG        IAP_TRIG        
  36      =2  
  37      =2  
  38      =2  #ifndef _IN_IAP_
  39      =2  #define _IN_IAP_
  40      =2  void EnableIAP(uint8 byCmd);
  41      =2  void DisableIAP(void);
  42      =2  uint8 IapReadByte(uint16 uiAddr);
  43      =2  void IapWriteByte(uint16 uiAddr, uint8 byData);
  44      =2  void IapErase(uint16 uiAddr);
  45      =2  #endif
 144      =1  #include "uart.h"
   1      =2  /*
   2      =2  ************************Copyright(c)************************
C51 COMPILER V8.08   UART                                                                  01/26/2011 09:34:32 PAGE 39  

   3      =2  *                                  ºþÄÏÒ»ÌØµç×Ó¹É·ÝÓÐÏÞ¹«Ë¾
   4      =2  *                               All Rights Reserved
   5      =2  *                                        
   6      =2  *
   7      =2  *-----------------------ÎÄ¼þÐÅÏ¢---------------------------
   8      =2  *ÎÄ¼þÃû³Æ               :Uart.c
   9      =2  *ÎÄ¼þÃèÊö               :´®¿ÚÇý¶¯³ÌÐò
  10      =2  *´´½¨ÈË                 :ÒüÔËÍ¬
  11      =2  *´´½¨ÈÕÆÚ               :2009-4-6
  12      =2  *°æ±¾ºÅ                 :V1.0
  13      =2  *×¢ÊÍ                   :                                       
  14      =2  *----------------------------------------------------------
  15      =2  *ÐÞ¸ÄÈË                         :
  16      =2  *ÐÞ¸ÄÈÕÆÚ                       :
  17      =2  *°æ±¾ºÅ                 :
  18      =2  *×¢ÊÍ                   :
  19      =2  ***********************************************************
  20      =2  */
  21      =2  //¶¨Òå´®¿ÚÊýÄ¿
  22      =2  #define MAX_COM         1
  23      =2  
  24      =2  #define UART0_RX_BUF_SIZE       (128+EXT_SIZE)
  25      =2  #define UART0_TX_BUF_SIZE       50
  26      =2  
  27      =2  #define UART1_TX_BUF_SIZE       (128+EXT_SIZE)
  28      =2  #define UART1_RX_BUF_SIZE   50
  29      =2  //´®¿Ú½á¹¹Ìå¶¨Òå
  30      =2  //typedef struct
  31      =2  //{
  32      =2  //      uint8  xdata *pbyRecBuf;                /*½ÓÊÕ»º³åÇø*/
  33      =2  //      uint8  xdata *pbySndBuf;                /*·¢ËÍ»º³åÇø*/
  34      =2  //      uint16 uiRecHead;               /*½ÓÊÕÍ·*/
  35      =2  //      uint16 uiRecTail;               /*½ÓÊÕÎ²*/
  36      =2  //      uint16 uiSndHead;               /*·¢ËÍÍ·*/
  37      =2  //      uint16 uiSndTail;               /*·¢ËÍÎ²*/      
  38      =2  //      uint16 uiRecBufSize;    /*½ÓÊÕ»º³åÇø´óÐ¡*/
  39      =2  //      uint16 uiSndBufSize;    /*·¢ËÍ»º³åÇø´óÐ¡*/      
  40      =2  //      uint8  byBusy;                  /*´®¿Ú·¢ËÍ×´Ì¬£¬0£º¿ÕÏÐ*/
  41      =2  //} STUsartCfg, pSTUsartCfg;
  42      =2  typedef struct
  43      =2  {
  44      =2          uint8  xdata *pbyRecBuf;                /*½ÓÊÕ»º³åÇø*/
  45      =2          uint8  xdata *pbySndBuf;                /*·¢ËÍ»º³åÇø*/
  46      =2          uint8  byRecState;              /*½ÓÊÕ¹ý³ÌÖÐËù´¦µÄ½×¶Î*/
  47      =2          uint16 uiRecPosition;   /*Êý¾Ý´æ·ÅÎ»ÖÃ*/
  48      =2          uint16 uiRecLen;                /*Êý¾ÝÓòµÄÊý¾Ý¸öÊý*/
  49      =2          uint8  byRecCount;              /*´¦Ëù½×¶ÎÓ¦½ÓÊÕ¸Ã½×¶ÎÊý¾ÝµÄ¸öÊý*/
  50      =2          uint8  byRecTimeout;    /*½ÓÊÕ¹ý³ÌÖÐµÄ³¬Ê±¼ÆÊý*/
  51      =2  
  52      =2          uint16 uiSndLen;                /*·¢ËÍÊý¾Ý³¤¶È*/
  53      =2          uint16 uiSndPos;                /*·¢ËÍÊý¾ÝÎ»ÖÃ*/        
  54      =2  } STUsartCfg, pSTUsartCfg;
  55      =2  
  56      =2  
  57      =2  //Êý¾ÝÖ¡½á¹¹Ìå¶¨Òå
  58      =2  //typedef struct
  59      =2  //{
  60      =2  //      uint8   byStartByte1;                                   //Êý¾ÝÖ¡ÆðÊ¼×Ö·û1
  61      =2  //      uint8   byRecSecAddr;                                   //ÊÕ·½ÇøµØÖ·
  62      =2  //      uint8   byRecRoomAddr;                                  //½ÓÊÕ·½·¿µØÖ·
  63      =2  //      uint8   byRecBedAddr;                                   //½ÓÊÕ·½´²µØÖ·  
  64      =2  //      uint8   bySndSecAddr;                                   //Ö÷¶¯·¢ËÍ·½ÇøµØÖ·
C51 COMPILER V8.08   UART                                                                  01/26/2011 09:34:32 PAGE 40  

  65      =2  //      uint8   bySndRoomAddr;                                  //Ö÷¶¯·¢ËÍ·½·¿µØÖ·
  66      =2  //      uint8   bySndBedAddr;                                   //Ö÷¶¯·¢ËÍ·½´²µØÖ·
  67      =2  //      uint8   byStartByte2;                                   //(Êý¾ÝÖ¡ÆðÊ¼×Ö·û2)Ö¸¶¨¶Ë¿Ú
  68      =2  //      uint8   byCmd;                                                  //ÃüÁî
  69      =2  //      uint16  uiLen;                                                  //Êý¾Ý³¤¶È£¬2¸ö×Ö½Ú
  70      =2  //      uint8   byData[1];                                              //Á´Â·Êý¾Ý      
  71      =2  //} STUartFreq, *pSTUartFreq;
  72      =2  typedef struct
  73      =2  {
  74      =2          uint8   byStartByte1;                                   //Êý¾ÝÖ¡ÆðÊ¼×Ö·û1
  75      =2          uint8   bySndSecAddr;                                   //ÊÕ·½ÇøµØÖ·
  76      =2          uint8   bySndRoomAddr;                                  //½ÓÊÕ·½·¿µØÖ·
  77      =2          uint8   bySndBedAddr;                                   //½ÓÊÕ·½´²µØÖ·  
  78      =2          uint8   byRecSecAddr;                                   //Ö÷¶¯·¢ËÍ·½ÇøµØÖ·
  79      =2          uint8   byRecRoomAddr;                                  //Ö÷¶¯·¢ËÍ·½·¿µØÖ·
  80      =2          uint8   byRecBedAddr;                                   //Ö÷¶¯·¢ËÍ·½´²µØÖ·
  81      =2          uint8   byCmd;                                                  //ÃüÁî
  82      =2          uint16  uiLen;                                                  //Êý¾Ý³¤¶È£¬2¸ö×Ö½Ú
  83      =2          uint8   byData[1];                                              //Á´Â·Êý¾Ý      
  84      =2  } STUartFreq, *pSTUartFreq;
  85      =2  //±êÊ¾·û¶¨Òå
  86      =2  #define         START_BYTE1                     0x5a
  87      =2  #define         END_BYTE                        0x16
  88      =2  
  89      =2  #define         DOWN_START_BYTE1        0x46
  90      =2  #define         DOWN_START_BYTE2        0XB9
  91      =2  #define         DOWN_ID1                        0X6A
  92      =2  #define         DOWN_ID2                        0X68
  93      =2  #define         DOWN_END_BYTE           0X16
  94      =2  
  95      =2  #define         CMD_POSITION            0X07
  96      =2  
  97      =2  //´®¿Ú1¿ØÖÆÒý½Å
  98      =2  #define         RE_485                          0
  99      =2  #define         DE_485                          1
 100      =2  //³¤¶È±êÊ¾·û¶¨Òå
 101      =2  //#define               HEAD_SIZE                       10
 102      =2  //#define               EXT_SIZE                        13
 103      =2  //#define               MAX_UART0_DATA_LEN      (UART0_RX_BUF_SIZE-14)
 104      =2  #define         HEAD_SIZE                       9
 105      =2  #define         EXT_SIZE                        12
 106      =2  #define         MAX_UART0_DATA_LEN      (UART0_RX_BUF_SIZE-EXT_SIZE)
 107      =2  
 108      =2  
 109      =2  #ifndef _IN_UART_
 110      =2  #define _IN_UART_
 111      =2  
 112      =2  #if MAX_COM > 0
 113      =2  extern STUsartCfg  xdata stUsartCfg[];
 114      =2  #endif
 115      =2  
 116      =2  
 117      =2  #if MAX_COM >= 1
 118      =2  extern uint8    xdata byUsart0RecBuf[];
 119      =2  extern uint8    xdata byUsart0SndBuf[];
 120      =2  #endif
 121      =2  
 122      =2  
 123      =2  #if MAX_COM >= 2
           =2 extern uint8    xdata byUsart1RecBuf[];
           =2 extern uint8    xdata byUsart1SndBuf[];
           =2 #endif
C51 COMPILER V8.08   UART                                                                  01/26/2011 09:34:32 PAGE 41  

 127      =2  
 128      =2  
 129      =2  void UsartInit(void);
 130      =2  void Usart0RecDeal(void);
 131      =2  void Usart1RecDeal(void);
 132      =2  void UsartManager(void);
 133      =2  void UsartSndEnter(uint8 byPort,uint8 byOriginalCmd,uint8 byData);
 134      =2  void UsartSndResult(uint8 byPort,uint8 byOriginalCmd,uint8 byData);
 135      =2  void Usart0SndData(pSTBusFreq pstBusFreq);
 136      =2  uint8 GetPskCrc(pSTUartFreq pstDataFreq);
 137      =2  uint8 CheckPsk(pSTUartFreq pstDataFreq);
 138      =2  #endif
 145      =1  #include "key.h"
   1      =2  /*
   2      =2  ************************Copyright(c)************************
   3      =2  *                                  ºþÄÏÒ»ÌØµç×Ó¹É·ÝÓÐÏÞ¹«Ë¾
   4      =2  *                               All Rights Reserved
   5      =2  *                                        
   6      =2  *
   7      =2  *-----------------------ÎÄ¼þÐÅÏ¢---------------------------
   8      =2  *ÎÄ¼þÃû³Æ               :Key.h
   9      =2  *ÎÄ¼þÃèÊö               :°´¼üÇý¶¯³ÌÐòÍ·ÎÄ¼þ
  10      =2  *´´½¨ÈË                 :ÒüÔËÍ¬
  11      =2  *´´½¨ÈÕÆÚ               :2008-9-22
  12      =2  *°æ±¾ºÅ                 :V1.0
  13      =2  *×¢ÊÍ                   :²ÉÓÃ°´¼üÓëµÆÏÔÊ¾¿ØÖÆ¹²ÓÃÒ»¸öI/O¿ÚµÄ·½Ê½                                        
  14      =2  *----------------------------------------------------------
  15      =2  *ÐÞ¸ÄÈË                         :
  16      =2  *ÐÞ¸ÄÈÕÆÚ                       :
  17      =2  *°æ±¾ºÅ                 :
  18      =2  *×¢ÊÍ                   :
  19      =2  ***********************************************************
  20      =2  */
  21      =2  #define         KEY_DELAY                       100                                                     //ÉèÖÃ³¤°´¼üÊ±¼ä
  22      =2  
  23      =2  #ifndef _IN_KEY_
  24      =2  #define _IN_KEY_
  25      =2  extern  bit     bLedDealState;                                  
  26      =2  extern  bit     bLedSetState;                                   
  27      =2  void SetLedDealState(uint8 byState);
  28      =2  void KeyDownDeal(uint8 byKey);
  29      =2  void KeyUpDeal(uint8 byKey);
  30      =2  void KeyAlwaysDeal(uint8 byKey);
  31      =2  void KeyManager(void);
  32      =2  #endif
 146      =1  //Éè±¸ÅäÖÃ×Ö¶¨Òå
 147      =1  typedef struct
 148      =1  {
 149      =1          uint8   byInitFlag;                                                                             //³õÊ¼»¯²ÎÊý±êÖ¾
 150      =1          uint8   bySelfSecAddr;                                                                  //±¾»úÇøµØÖ·
 151      =1          uint8   bySelfRoomAddr;                                                                 //±¾»ú·¿µØÖ·
 152      =1          uint8   bySelfBedAddr;                                                                  //±¾»ú´²µØÖ·
 153      =1          uint8   byEnable1;                                                                              //ÔÊÐí±êÖ¾1
 154      =1          uint8   byEnable2;                                                                              //ÔÊÐí±êÖ¾2     
 155      =1          uint8   byPrio;                                                                                 //ÓÅÏÈ¼¶
 156      =1          uint8   byRingTime;                                                                             //ÕñÁåÊ±¼ä
 157      =1          uint8   byTalkTime;                                                                             //Í¨»°Ê±¼ä
 158      =1          uint8   byBroadTime;                                                                    //¹ã²¥Ê±¼ä
 159      =1          uint8   byListenDelay;                                                                  //½ÓÌýÑÓÊ±Ê±¼ä
 160      =1          uint8   byVolumStep;                                                                    //ÒôÁ¿µ÷½Ú²½³¤
 161      =1          uint8   byRingVol;                                                                              //ÕñÁåÌáÊ¾ÒôÁ¿
 162      =1          uint8   byCH0TalkedVol;                                                                 //Í¨µÀ0±»ºôÍ¨»°ÒôÁ¿
C51 COMPILER V8.08   UART                                                                  01/26/2011 09:34:32 PAGE 42  

 163      =1          uint8   byCH1TalkedVol;                                                                 //Í¨µÀ1±»ºôÍ¨»°ÒôÁ¿
 164      =1          uint8   byBroadVol;                                                                             //¹ã²¥ÒôÁ¿
 165      =1          uint8   byNoteVol;                                                                              //ÌáÊ¾ÒôÁ¿
 166      =1          uint8   byMusicVol;                                                                             //±³¾°ÒôÀÖÒôÁ¿
 167      =1          uint8   byCH0TalkVol;                                                                   //Í¨µÀ0Ö÷¶¯Í¨»°ÒôÁ¿
 168      =1          uint8   byCH1TalkVol;                                                                   //Í¨µÀ1Ö÷¶¯Í¨»°ÒôÁ¿
 169      =1          uint8   bySelfRingVol;                                                                  //±¾»úÕñÁåÌáÊ¾ÒôÁ¿
 170      =1          uint8   byMaxVol;                                                                               //×î´óÒôÁ¿Öµ
 171      =1          uint8   byMinVol;                                                                               //×îÐ¡ÒôÁ¿Öµ
 172      =1          uint8   byReserve1;                                                                             //±£Áô×Ö½Ú1
 173      =1          uint8   byReserve2;                                                                             //±£Áô×Ö½Ú2
 174      =1          uint8   byReserve3;                                                                             //±£Áô×Ö½Ú3
 175      =1          uint8   bySerialNum1;                                                                   //ÐòÁÐºÅ×Ö½Ú1(ÐòÁÐºÅ×î¸ßÎ»µÄÒ»¸ö×Ö½Ú)
 176      =1          uint8   bySerialNum2;                                                                   //ÐòÁÐºÅ×Ö½Ú2
 177      =1          uint8   bySerialNum3;                                                                   //ÐòÁÐºÅ×Ö½Ú3(ÐòÁÐºÅ×îµÍÎ»µÄÒ»¸ö×Ö½Ú)
 178      =1          uint8   byVersionHi;                                                                    //°æ±¾ºÅ¸ß×Ö½Ú
 179      =1          uint8   byVersionLo;                                                                    //°æ±¾ºÅµÍ×Ö½Ú 
 180      =1  } STEepromCfgData, *pSTEepromCfgData;
 181      =1  //µØÖ·½á¹¹Ìå
 182      =1  typedef struct
 183      =1  {
 184      =1          uint8   bySecAddr;                                                                              //ÇøµØÖ·
 185      =1      uint8       byRoomAddr;                                                                             //·¿µØÖ·  
 186      =1      uint8       byBedAddr;                                                                              //´²µØÖ·
 187      =1  } STAddr, *pSTAddr;
 188      =1  //ÐÅÏ¢Ö¸Ê¾·½µØÖ·½á¹¹Ìå
 189      =1  typedef struct 
 190      =1  {           
 191      =1          STAddr  stAddr;                                                                                 //Ö¸Ê¾·½µØÖ· 
 192      =1      uint8       byCallCmd;                                                                              //Ö¸Ê¾µÄÃüÁî
 193      =1  } STIndicationData, *pSTIndicationData; 
 194      =1  //³¬Ê±¿ØÖÆ½á¹¹Ìå
 195      =1  typedef struct
 196      =1  {
 197      =1          uint8                           byTimerOutSet;                                          //Ò»´Î³¬Ê±Ê±¼äÉèÖÃ(20msµ¥Î»)
 198      =1          uint8                           byTimerOut;                                                     //Ò»´Î³¬Ê±Ê±¼ä(20msµ¥Î»)
 199      =1          uint8                           byTimerOutCount;                                        //ÔÊÐí³¬Ê±´ÎÊý 
 200      =1  } STTimerOut, *pSTTimerOut;     
 201      =1  //È«¾Ö¿ØÖÆ½á¹¹Ìå
 202      =1  typedef struct
 203      =1  {
 204      =1          uint8                           byLedState;                                                     //¸ß4Î»ÎªºìµÆ×´Ì¬,µÍ4Î»ÎªÂÌµÆ×´Ì¬
 205      =1          uint8                           byLedFlashTime;                                         //µÆÉÁË¸Ê±¼ä¿ØÖÆ
 206      =1          uint8                           byLedTimeSet;                                           //ÉÁË¸Ê±¼äÉèÖÃÖµ
 207      =1          uint16                          uiNurseInTime;                                          //¼ì²â»¤Ê¿µ½Î»¶¨Ê±Ê±¼ä
 208      =1          uint16                          uiShortType;                                            //¶ÌÕûÐÍÊý¾Ý
 209      =1          uint8                           byChar1;                                                        //×Ö·ûÐÍÊý¾Ý
 210      =1          uint8   xdata           *pbyData;                                                       //×Ö·ûÊý¾ÝÖ¸Õë
 211      =1          STBusFreq                       stBusDealFreq;                                          //×ÜÏßÊý¾Ý´¦Àí´æ´¢Æ÷
 212      =1          STTimerOut                      stCH0TimerOut;                                          //Éè±¸µ±Ç°×´Ì¬³¬Ê±¿ØÖÆ½á¹¹Ìå 
 213      =1          STTimerOut                      stCH1Timerout;                                          //Í¨µÀ1Í¨»°³¬Ê±¹ÜÀí½á¹¹Ìå       
 214      =1          STIndicationData        stIndicationData;                                       //ÐÅÏ¢Ö¸Ê¾Êý¾Ý½á¹¹Ìå
 215      =1          STAddr                          stCallAddr;                                                     //Ö÷¶¯ºô½Ð·½µØÖ·        
 216      =1          STEepromCfgData         stEepromCfgData;                                        //ÏµÍ³ÅäÖÃ×Ö                    
 217      =1  } STLocalControl, *pSTLocalControl;
 218      =1  //5msPCAÖÐ¶Ï¼ÆÊ±´ÎÊý£¬Fosc=18.432MHz,·ÖÆµÏµÊýÎª2 
 219      =1  #define Fosc                            18432000
 220      =1  #define Fbus                            184320
 221      =1          
 222      =1                          
 223      =1  #define ISR_INC_COUNT           (Fosc/2/OS_TICKS_PER_SEC)
 224      =1  #define IAP_ADDR                        0x0000          //STC12C5624ÄÚµÄE2Ö»ÄÜÊÇÊý¾ÝE2
C51 COMPILER V8.08   UART                                                                  01/26/2011 09:34:32 PAGE 43  

 225      =1  #define INIT_FLAG           0x5a
 226      =1  
 227      =1  extern void UserTickTimer(void);
  23          
  24          //´®¿Ú±äÁ¿¶¨Òå
  25          #if MAX_COM > 0
  26          STUsartCfg  xdata stUsartCfg[MAX_COM];
  27          #define IncRxPtr(byPort,addr)           (addr=(addr+1)%stUsartCfg[byPort].uiRecBufSize)
  28          #define IncTxPtr(byPort,addr)           (addr=(addr+1)%stUsartCfg[byPort].uiSndBufSize)
  29          #endif
  30          //´®¿Ú0ÅäÖÃ
  31          #if MAX_COM >= 1
  32          uint8   xdata byUsart0RecBuf[UART0_RX_BUF_SIZE];
  33          uint8   xdata byUsart0SndBuf[UART0_TX_BUF_SIZE];
  34          
  35          
  36          #endif
  37          //´®¿Ú1ÅäÖÃ
  38          #if MAX_COM >= 2
              uint8   xdata byUsart1RecBuf[UART1_RX_BUF_SIZE];
              uint8   xdata byUsart1SndBuf[UART1_TX_BUF_SIZE];
              
              #endif
  43          
  44          uint8 bdata byUsartState;
  45          sbit bUsart0RecFinish   = byUsartState^0;
  46          sbit bUsart1RecFinish   = byUsartState^1;
  47          
  48          extern STLocalControl xdata stLocalControl;
  49          extern uint8    OS_Q_MEM_SEL    byMainCmdQ[];
  50          /**********************************************************
  51          *º¯ÊýÃû³Æ                       :UsartInit      
  52          *º¯ÊýÃèÊö               :´®¿Ú³õÊ¼»¯º¯Êý
  53          *ÊäÈë²ÎÊý               :
  54          *·µ»ØÖµ                         :
  55          *È«¾Ö±äÁ¿                       :
  56          *µ÷ÓÃÄ£¿é                       :
  57          ***********************************************************
  58          *´´½¨ÈË                 :ÒüÔËÍ¬
  59          *´´½¨ÈÕÆÚ                       :2009-4-6
  60          ***********************************************************
  61          *ÐÞ¸ÄÈË                         :
  62          *ÐÞ¸ÄÈÕÆÚ               :
  63          *×¢ÊÍ                   :
  64          **********************************************************/
  65          void UsartInit(void)
  66          {
  67   1      #if MAX_COM >= 1
  68   1      //STC12C56ÏµÁÐ::M0=0,M1=0:×¼Ë«Ïò£¬M0=0,M1=1:ÍÆÍì£¬M0=1,M1=0:¸ß×è£¬M0=1,M1=1:¿ªÂ©
  69   1              //P3.0 RXD×¼Ë«Ïò  P3.1 TXD×¼Ë«Ïò
  70   1              P3M0 &= (~Bin(0,0,0,0,0,0,1,1));
  71   1              P3M1 &= (~Bin(0,0,0,0,0,0,1,1));
  72   1              RXD=1;
  73   1              TXD=1;
  74   1              //´®¿Ú0³õÊ¼»¯
  75   1              stUsartCfg[0].pbyRecBuf = byUsart0RecBuf;
  76   1              stUsartCfg[0].pbySndBuf = byUsart0SndBuf;
  77   1              stUsartCfg[0].byRecState=0;
  78   1              stUsartCfg[0].uiRecPosition=0;
  79   1              stUsartCfg[0].uiRecLen=0;
  80   1              stUsartCfg[0].byRecCount=0;     
  81   1              stUsartCfg[0].uiSndLen  = stUsartCfg[0].uiSndPos  = 0;
C51 COMPILER V8.08   UART                                                                  01/26/2011 09:34:32 PAGE 44  

  82   1              
  83   1              SCON = 0X50;            //¹¤×÷·½Ê½1
  84   1      
  85   1       //   TMOD= 0x21;   //  ;t1×÷²¨ÌØÂÊ·¢ÉúÆ÷£¬t0×÷·½Ê½1£¨16Î»)¶¨Ê±Æ÷
  86   1              TMOD &= 0X0F;           //TO·½Ê½²»±ä
  87   1              TMOD |= 0X20;           //T1 8Î»×Ô¶¯ÖØÔØ
  88   1      
  89   1              TL1     =       0XF6;           //²¨ÌØÂÊ4800  ÔÚ18.432M¾§ÕñµÄÇé¿öÏÂ
  90   1              TH1     =       0XF6;
  91   1      
  92   1          PCON &=     (~SMOD);   //  ;²¨ÌØÂÊ±¶ÔöÑ¡Ôñ          smod=0
  93   1              AUXR |= T1x12;          //1TÄ£Ê½,×îºó²¨ÌØÂÊÎª:4800*12=57.6K
  94   1          TF1=0;
  95   1          TR1=1;
  96   1              
  97   1              RI=0;
  98   1              TI=0;
  99   1              REN=1;
 100   1              ES=1;   
 101   1      #endif
 102   1      
 103   1      #if MAX_COM >= 2
                      //´®¿Ú1³õÊ¼»¯
                      AUXR1 |= S2_P4;         //´®¿Ú2ÇÐ»»µ½P4¿Ú
                      stUsartCfg[1].pbyRecBuf = byUsart1RecBuf;
                      stUsartCfg[1].pbySndBuf = byUsart1SndBuf;
                      stUsartCfg[1].byRecState=0;
                      stUsartCfg[1].uiRecPosition=0;
                      stUsartCfg[1].uiRecLen=0;
                      stUsartCfg[1].byRecCount=3;     
                      stUsartCfg[1].uiSndLen  = stUsartCfg[1].uiSndPos  = 0;
              
                      S2CON   =       0X50;           //0101 0000 8Î»¿É±ä²¨ÌØÂÊ,ÎÞÆæÅ¼Ð£ÑéÎ»
              //      AUXR    &=      ~(S2SMOD|BRTx12);       //S2MOD=0;BRTX12=0;
              //      BRT             =       0XFD;
              
                      AUXR    &=      ~S2SMOD;        //S2MOD=0;
                  AUXR        |=  BRTx12;             //BRTX12=1; 1TÄ£Ê½,×îºó²¨ÌØÂÊÎª:4800*12=57.6K
                      AUXR    |=      BRTR;           //Æô¶¯¶ÀÁ¢²¨ÌØÂÊ·¢ÉúÆ÷
                      IE2     |= ES2;
              #endif
 123   1      }
 124          #if MAX_COM >= 1
 125          /**********************************************************
 126          *º¯ÊýÃû³Æ                       :UART0(void)    
 127          *º¯ÊýÃèÊö               :´®¿Ú0ÖÐ¶Ïº¯Êý
 128          *ÊäÈë²ÎÊý               :
 129          *·µ»ØÖµ                         :
 130          *È«¾Ö±äÁ¿                       :stUsartCfg
 131          *µ÷ÓÃÄ£¿é                       :
 132          ***********************************************************
 133          *´´½¨ÈË                 :ÒüÔËÍ¬
 134          *´´½¨ÈÕÆÚ                       :2009-4-6
 135          ***********************************************************
 136          *ÐÞ¸ÄÈË                         :
 137          *ÐÞ¸ÄÈÕÆÚ               :
 138          *×¢ÊÍ                   :
 139          **********************************************************/
 140          #pragma disable
 141          void UART0(void) interrupt UART_INTNO
 142          {
 143   1              uint8 byTemp;
C51 COMPILER V8.08   UART                                                                  01/26/2011 09:34:32 PAGE 45  

 144   1              if(RI==1)
 145   1              {  
 146   2                      RI=0;
 147   2                      byTemp=SBUF;
 148   2                      if(stUsartCfg[0].uiRecPosition!=0)      //²»ÊÇÆðÊ¼×Ö½Ú
 149   2                      {
 150   3                              if(stUsartCfg[0].byRecTimeout==0)
 151   3                              {//³¬Ê±µ½ÁË
 152   4                                      stUsartCfg[0].byRecState=0;
 153   4                                      stUsartCfg[0].uiRecPosition=0;
 154   4                                      return;
 155   4                              }
 156   3                      }
 157   2                      stUsartCfg[0].byRecTimeout=5;   //ÓÖ¿ªÊ¼¶¨Ê±
 158   2                      byUsart0RecBuf[stUsartCfg[0].uiRecPosition++] = byTemp;         
 159   2                      switch(stUsartCfg[0].byRecState)
 160   2                      {
 161   3                              case 0:                                                         
 162   3                                      if(byTemp == START_BYTE1)
 163   3                                      {
 164   4                                              stUsartCfg[0].byRecState = 1;
 165   4      //                                      byCount = 7;
 166   4                                              stUsartCfg[0].byRecCount = 6;
 167   4                                      }
 168   3                                      else
 169   3                                      {
 170   4                                              stUsartCfg[0].uiRecPosition = 0;
 171   4                                      }
 172   3                                      break;
 173   3                              case 1:                                                         
 174   3                                      if(--stUsartCfg[0].byRecCount == 0)
 175   3                                      {       //ÊÕÍêµØÖ·Êý¾Ý                                                                                                                                          
 176   4                                              stUsartCfg[0].byRecState = 2;
 177   4                                              stUsartCfg[0].byRecCount = 3;                                           
 178   4                                      }
 179   3                                      break;                          
 180   3                              case 2:                         
 181   3                                      stUsartCfg[0].byRecCount--;
 182   3                                      if(stUsartCfg[0].byRecCount == 1)
 183   3                                      {       
 184   4                                              stUsartCfg[0].uiRecLen = byTemp<<8; 
 185   4                                      }
 186   3                                      else if(stUsartCfg[0].byRecCount == 0)
 187   3                                      {       //½ÓÊÕÍêÊý¾Ý³¤¶È
 188   4                                              //stUsartCfg[0].uiRecLen += (byTemp << 8);                      //»ñÈ¡Êý¾ÝÓò³¤¶ÈÖµ
 189   4                                              stUsartCfg[0].uiRecLen += byTemp;
 190   4                                              if(stUsartCfg[0].uiRecLen <= MAX_UART0_DATA_LEN)                                        
 191   4                                              {       //Êý¾Ý³¤¶È·ûºÏÒªÇó
 192   5                                                      stUsartCfg[0].byRecState = 3;
 193   5                                                      stUsartCfg[0].uiRecLen += 2;                                                                                                            
 194   5                                              }
 195   4                                              else
 196   4                                              {
 197   5                                                      stUsartCfg[0].byRecState = 0;
 198   5                                                      stUsartCfg[0].uiRecPosition = 0;
 199   5                                              }                                                                               
 200   4                                      }
 201   3                                      break;                  
 202   3                              case 3:                         
 203   3                                      if(--stUsartCfg[0].uiRecLen == 0)
 204   3                                      {       //½ÓÊÕÍêËùÓÐÊý¾Ý
 205   4                                              if(END_BYTE == byTemp)
C51 COMPILER V8.08   UART                                                                  01/26/2011 09:34:32 PAGE 46  

 206   4                                              {       //½áÊøÎ»ÕýÈ·
 207   5                                                      bUsart0RecFinish=1;
 208   5                                              }
 209   4                                              stUsartCfg[0].byRecState = 0;
 210   4                                              stUsartCfg[0].uiRecPosition = 0;                        
 211   4                                      }
 212   3                                      break;                  
 213   3                              default:
 214   3                                      stUsartCfg[0].byRecState = 0;
 215   3                                      stUsartCfg[0].uiRecPosition = 0;
 216   3                                      break;          
 217   3                      }
 218   2              }
 219   1              else if(TI==1)
 220   1              {
 221   2                      TI=0;
 222   2                      stUsartCfg[0].uiSndLen--;
 223   2                      stUsartCfg[0].uiSndPos++;
 224   2                      if(stUsartCfg[0].uiSndLen!=0)
 225   2                      {
 226   3                              SBUF = stUsartCfg[0].pbySndBuf[stUsartCfg[0].uiSndPos]; 
 227   3                              
 228   3                      }
 229   2              }
 230   1      } 
 231          
 232          #endif
 233          #if MAX_COM >= 2
              /**********************************************************
              *º¯ÊýÃû³Æ                       :UART1(void)    
              *º¯ÊýÃèÊö               :´®¿Ú2ÖÐ¶Ïº¯Êý
              *ÊäÈë²ÎÊý               :
              *·µ»ØÖµ                         :
              *È«¾Ö±äÁ¿                       :stUsartCfg
              *µ÷ÓÃÄ£¿é                       :
              ***********************************************************
              *´´½¨ÈË                 :ÒüÔËÍ¬
              *´´½¨ÈÕÆÚ                       :2009-4-6
              ***********************************************************
              *ÐÞ¸ÄÈË                         :
              *ÐÞ¸ÄÈÕÆÚ               :
              *×¢ÊÍ                   :
              **********************************************************/
              #pragma disable
              void UART1(void) interrupt UART2_INTNO
              {
                      if(S2CON&S2RI)
                      {
                              S2CON &= ~S2RI;
                      }
                      else if(S2CON&S2TI)
                      {
                              S2CON &= ~S2TI;
                      }
              }
              
              #endif
 263          /**********************************************************
 264          *º¯ÊýÃû³Æ                       :GetPskCrc      
 265          *º¯ÊýÃèÊö               :¼ÆËãÊý¾ÝèåÀÛ¼ÓÐ£ÑéºÍ
 266          *ÊäÈë²ÎÊý               :pstDataFreq:´ý¼ÆËãµÄÊý¾ÝèåÖ¸Õë
 267          *·µ»ØÖµ                         :ÀÛ¼ÓÐ£ÑéºÍ
C51 COMPILER V8.08   UART                                                                  01/26/2011 09:34:32 PAGE 47  

 268          *È«¾Ö±äÁ¿                       :stUsartCfg
 269          *µ÷ÓÃÄ£¿é                       :
 270          ***********************************************************
 271          *´´½¨ÈË                 :ÒüÔËÍ¬
 272          *´´½¨ÈÕÆÚ                       :2009-4-6
 273          ***********************************************************
 274          *ÐÞ¸ÄÈË                         :
 275          *ÐÞ¸ÄÈÕÆÚ               :
 276          *×¢ÊÍ                   :
 277          **********************************************************/
 278          uint8 GetPskCrc(pSTUartFreq pstDataFreq)
 279          {
 280   1              uint8  *pbyData;
 281   1              uint16 uiLen;
 282   1              uint8  byCrc = 0;
 283   1              
 284   1      //      pbyData = &(pstDataFreq->byRecSecAddr);
 285   1              pbyData = &(pstDataFreq->bySndSecAddr);
 286   1              uiLen = pstDataFreq->uiLen + HEAD_SIZE;
 287   1              while(uiLen--)
 288   1              {
 289   2                      byCrc += *pbyData++;
 290   2              }       
 291   1              return(byCrc);
 292   1      }
 293          /**********************************************************
 294          *º¯ÊýÃû³Æ                       :CheckPsk       
 295          *º¯ÊýÃèÊö               :¼ìÑéÊý¾Ý°üµÄÕýÈ·ÐÍ
 296          *ÊäÈë²ÎÊý               :pstDataFreq:´ýÐ£ÑéµÄÊý¾ÝèåÖ¸Õë
 297          *·µ»ØÖµ                         :true:Êý¾Ý°üÕýÈ·,false:Êý¾Ý°üÓÐÎó
 298          *È«¾Ö±äÁ¿                       :
 299          *µ÷ÓÃÄ£¿é                       :
 300          ***********************************************************
 301          *´´½¨ÈË                 :ÒüÔËÍ¬
 302          *´´½¨ÈÕÆÚ                       :2009-4-6
 303          ***********************************************************
 304          *ÐÞ¸ÄÈË                         :
 305          *ÐÞ¸ÄÈÕÆÚ               :
 306          *×¢ÊÍ                   :
 307          **********************************************************/
 308          uint8 CheckPsk(pSTUartFreq pstDataFreq)
 309          {
 310   1              uint8* pbyData;
 311   1              uint16 uiLen;
 312   1              uint8  byCrc = 0;
 313   1              
 314   1      //      pbyData = &(pstDataFreq->byRecSecAddr);
 315   1              pbyData = &(pstDataFreq->bySndSecAddr);
 316   1              uiLen = pstDataFreq->uiLen + HEAD_SIZE;
 317   1              while(uiLen--)
 318   1              {
 319   2                      byCrc += *pbyData++;
 320   2              }
 321   1              if(byCrc != *pbyData)
 322   1              {
 323   2                      return(false);
 324   2              }
 325   1              return(true);   
 326   1      }
 327          /**********************************************************
 328          *º¯ÊýÃû³Æ                       :UsartSndEnter  
 329          *º¯ÊýÃèÊö               :´®¿Ú·¢ËÍÈ·ÈÏÃüÁî
C51 COMPILER V8.08   UART                                                                  01/26/2011 09:34:32 PAGE 48  

 330          *ÊäÈë²ÎÊý               :byPort :´®¿ÚºÅ
 331                                              byOriginalCmd:Ô­ÃüÁî
 332                                              byData:Êý¾Ý
 333          *·µ»ØÖµ                         :
 334          *È«¾Ö±äÁ¿                       :
 335          *µ÷ÓÃÄ£¿é                       :
 336          ***********************************************************
 337          *´´½¨ÈË                 :ÒüÔËÍ¬
 338          *´´½¨ÈÕÆÚ                       :2009-4-6
 339          ***********************************************************
 340          *ÐÞ¸ÄÈË                         :
 341          *ÐÞ¸ÄÈÕÆÚ               :
 342          *×¢ÊÍ                   :
 343          **********************************************************/
 344          void UsartSndEnter(uint8 byPort,uint8 byOriginalCmd,uint8 byData)
 345          {
 346   1              pSTUartFreq pstDataFreq;
 347   1              while(stUsartCfg[byPort].uiSndLen!=0)   
 348   1              {//ÓÐÊý¾ÝÕýÔÚ·¢ËÍÖÐ
 349   2                      OSTimeDly(20);          //ÑÓÊ±100us
 350   2              }
 351   1      #if MAX_COM>=1
 352   1              if(byPort==0)           pstDataFreq = (pSTUartFreq)byUsart0SndBuf;
 353   1      #endif
 354   1      
 355   1      #if MAX_COM>=2
                      else if(byPort==1)              pstDataFreq = (pSTUartFreq)byUsart1SndBuf;
              #endif
 358   1              pstDataFreq->byStartByte1   =START_BYTE1;       
 359   1              pstDataFreq->byCmd                      =CMD_ENTER_PC;          //È·ÈÏÃüÁî
 360   1              pstDataFreq->uiLen                      =0X02;
 361   1              pstDataFreq->byData[0]          =byOriginalCmd; //Ô­ÃüÁî        
 362   1              pstDataFreq->byData[1]          =byData;                //³É¹¦»òÊ§°Ü
 363   1              pstDataFreq->byData[pstDataFreq->uiLen] = GetPskCrc(pstDataFreq);
 364   1              pstDataFreq->byData[pstDataFreq->uiLen+1] = END_BYTE;
 365   1              
 366   1              stUsartCfg[byPort].uiSndLen     = pstDataFreq->uiLen+EXT_SIZE;
 367   1              stUsartCfg[byPort].uiSndPos = 0;        //´ÓÊý¾ÝÖ¡Í·²¿¿ªÊ¼·¢ËÍÊý¾Ý
 368   1      #if MAX_COM>=1
 369   1              if(byPort==0)
 370   1              {
 371   2                      TI=0;
 372   2                      SBUF=pstDataFreq->byStartByte1;
 373   2              }
 374   1      #endif
 375   1      
 376   1      #if MAX_COM>=2
                      else if(byPort==1)
                      {
                              S2CON &= ~S2TI;
                              S2BUF=pstDataFreq->byStartByte1;                
                      }
              #endif
 383   1      
 384   1      }
 385          
 386          
 387          
 388          /**********************************************************
 389          *º¯ÊýÃû³Æ                       :UsartSndResult 
 390          *º¯ÊýÃèÊö               :´®¿Ú·¢ËÍ½á¹ûÃüÁî
 391          *ÊäÈë²ÎÊý               :byPort :´®¿ÚºÅ
C51 COMPILER V8.08   UART                                                                  01/26/2011 09:34:32 PAGE 49  

 392                                              byOriginalCmd:Ô­ÃüÁî
 393                                              byData:Êý¾Ý
 394          *·µ»ØÖµ                         :
 395          *È«¾Ö±äÁ¿                       :
 396          *µ÷ÓÃÄ£¿é                       :
 397          ***********************************************************
 398          *´´½¨ÈË                 :ÒüÔËÍ¬
 399          *´´½¨ÈÕÆÚ                       :2009-4-6
 400          ***********************************************************
 401          *ÐÞ¸ÄÈË                         :
 402          *ÐÞ¸ÄÈÕÆÚ               :
 403          *×¢ÊÍ                   :
 404          **********************************************************/
 405          void UsartSndResult(uint8 byPort,uint8 byOriginalCmd,uint8 byData)
 406          {
 407   1              pSTUartFreq pstDataFreq;
 408   1              while(stUsartCfg[byPort].uiSndLen!=0)   
 409   1              {//ÓÐÊý¾ÝÕýÔÚ·¢ËÍÖÐ
 410   2                      OSTimeDly(20);          //ÑÓÊ±100us
 411   2              }
 412   1      #if MAX_COM>=1
 413   1              if(byPort==0)           pstDataFreq = (pSTUartFreq)byUsart0SndBuf;
 414   1      #endif
 415   1      
 416   1      #if MAX_COM>=2
                      else if(byPort==1)              pstDataFreq = (pSTUartFreq)byUsart1SndBuf;
              #endif
 419   1              pstDataFreq->byStartByte1   =START_BYTE1;       
 420   1              pstDataFreq->byCmd                      =CMD_RESULT_PC;         //È·ÈÏÃüÁî
 421   1              pstDataFreq->uiLen                      =0X02;
 422   1              pstDataFreq->byData[0]          =byOriginalCmd; //Ô­ÃüÁî        
 423   1              pstDataFreq->byData[1]          =byData;                //³É¹¦»òÊ§°Ü
 424   1              pstDataFreq->byData[pstDataFreq->uiLen] = GetPskCrc(pstDataFreq);
 425   1              pstDataFreq->byData[pstDataFreq->uiLen+1] = END_BYTE;
 426   1              
 427   1              stUsartCfg[byPort].uiSndLen     = pstDataFreq->uiLen+EXT_SIZE;
 428   1              stUsartCfg[byPort].uiSndPos = 0;        //´ÓÊý¾ÝÖ¡Í·²¿¿ªÊ¼·¢ËÍÊý¾Ý
 429   1      
 430   1      #if MAX_COM>=1
 431   1              if(byPort==0)
 432   1              {
 433   2                      TI=0;
 434   2                      SBUF=pstDataFreq->byStartByte1;
 435   2              }
 436   1      #endif
 437   1      
 438   1      #if MAX_COM>=2
                      else if(byPort==1)
                      {
                              S2CON &= ~S2TI;
                              S2BUF=pstDataFreq->byStartByte1;                
                      }
              #endif
 445   1      
 446   1      }
 447          /**********************************************************
 448          *º¯ÊýÃû³Æ                       :Usart0Manager  
 449          *º¯ÊýÃèÊö               :´®¿Ú0¹ÜÀíº¯Êý
 450          *ÊäÈë²ÎÊý               :
 451          *·µ»ØÖµ                         :
 452          *È«¾Ö±äÁ¿                       :stUsartCfg,stLocalControl
 453          *µ÷ÓÃÄ£¿é                       :
C51 COMPILER V8.08   UART                                                                  01/26/2011 09:34:32 PAGE 50  

 454          ***********************************************************
 455          *´´½¨ÈË                 :ÒüÔËÍ¬
 456          *´´½¨ÈÕÆÚ                       :2009-4-6
 457          ***********************************************************
 458          *ÐÞ¸ÄÈË                         :
 459          *ÐÞ¸ÄÈÕÆÚ               :
 460          *×¢ÊÍ                   :
 461          **********************************************************/
 462          void Usart0RecDeal(void)
 463          {               
 464   1              pSTUartFreq pstDataFreq;
 465   1              bUsart0RecFinish=0;
 466   1              stLocalControl.stBusDealFreq.bySndSecAddr = stLocalControl.stEepromCfgData.bySelfSecAddr;
 467   1              stLocalControl.stBusDealFreq.bySndRoomAddr = stLocalControl.stEepromCfgData.bySelfRoomAddr;
 468   1              stLocalControl.stBusDealFreq.bySndBedAddr = stLocalControl.stEepromCfgData.bySelfBedAddr;
 469   1              pstDataFreq = (pSTUartFreq)byUsart0RecBuf;
 470   1              if((pstDataFreq->byRecSecAddr == stLocalControl.stEepromCfgData.bySelfSecAddr)&&
 471   1                      (pstDataFreq->byRecRoomAddr == stLocalControl.stEepromCfgData.bySelfRoomAddr)&&
 472   1                      (pstDataFreq->byRecBedAddr == stLocalControl.stEepromCfgData.bySelfBedAddr))
 473   1              {//ÊÇ±¾»úµØÖ·
 474   2                      if(!CheckPsk(pstDataFreq))      
 475   2                      {//Êý¾ÝÖ¡³ö´í
 476   3                              stLocalControl.stBusDealFreq.byCmd = CMD_DATA_ERROR;                    
 477   3                              Bus0OutputData(&(stLocalControl.stBusDealFreq.bySndSecAddr));   
 478   3                      }
 479   2                      else
 480   2                      {
 481   3                              stLocalControl.stBusDealFreq.byCmd = CMD_BUS_ANSWER; 
 482   3                              stLocalControl.stBusDealFreq.byRecSecAddr = pstDataFreq->byCmd;
 483   3                              Bus0OutputData(&(stLocalControl.stBusDealFreq.bySndSecAddr));                   
 484   3                              switch(pstDataFreq->byCmd)
 485   3                              {
 486   4                                      case CMD_DISPLAY_DATA:
 487   4      
 488   4                                              break;
 489   4                                      default:
 490   4                                              break;
 491   4                              }
 492   3                      }
 493   2              }
 494   1              
 495   1      }
 496          
 497          
 498          /**********************************************************
 499          *º¯ÊýÃû³Æ                       :Usart1RecDeal  
 500          *º¯ÊýÃèÊö               :´®¿Ú1Ð­Òé´¦Àí
 501          *ÊäÈë²ÎÊý               :
 502          *·µ»ØÖµ                         :
 503          *È«¾Ö±äÁ¿                       :
 504          *µ÷ÓÃÄ£¿é                       :
 505          ***********************************************************
 506          *´´½¨ÈË                 :ÒüÔËÍ¬
 507          *´´½¨ÈÕÆÚ                       :2009-4-6
 508          ***********************************************************
 509          *ÐÞ¸ÄÈË                         :
 510          *ÐÞ¸ÄÈÕÆÚ               :
 511          *×¢ÊÍ                   :
 512          **********************************************************/
 513          void Usart1RecDeal(void)
 514          {
 515   1              bUsart1RecFinish=0;
C51 COMPILER V8.08   UART                                                                  01/26/2011 09:34:32 PAGE 51  

 516   1      }
 517          
 518          
 519          /**********************************************************
 520          *º¯ÊýÃû³Æ                       :UsartManager
 521          *º¯ÊýÃèÊö               :µ¥×ÜÏß0¹ÜÀíÏß³Ì
 522          *ÊäÈë²ÎÊý               :
 523          *·µ»ØÖµ                         :
 524          *È«¾Ö±äÁ¿                       :stLocalControl
 525          *µ÷ÓÃÄ£¿é                       :
 526          ***********************************************************
 527          *´´½¨ÈË                 :ÒüÔËÍ¬
 528          *´´½¨ÈÕÆÚ                       :2009-4-7
 529          ***********************************************************
 530          *ÐÞ¸ÄÈË                         :
 531          *ÐÞ¸ÄÈÕÆÚ               :
 532          *×¢ÊÍ                   :
 533          **********************************************************/
 534          void UsartManager(void)  
 535          {       
 536   1              while(true)
 537   1              {
 538   2                      if(bUsart0RecFinish)                                                                    //´®¿Ú0ÊÕµ½Ò»Ö¡Êý¾Ý
 539   2                      {       
 540   3                              OSQPost(byMainCmdQ,UART0_CMD);  
 541   3                      }
 542   2                      if(bUsart1RecFinish)                                                                    //´®¿Ú1ÊÕµ½Ò»Ö¡Êý¾Ý
 543   2                      {
 544   3                              OSQPost(byMainCmdQ, UART1_CMD);                 
 545   3                      } 
 546   2                      OSWait(K_TMO, 1);
 547   2                                              
 548   2              }
 549   1      
 550   1      }
 551          
 552          /**********************************************************
 553          *º¯ÊýÃû³Æ                       :Usart0SndData
 554          *º¯ÊýÃèÊö               :´®¿Ú·¢ËÍÊý¾Ý
 555          *ÊäÈë²ÎÊý                
 556          *·µ»ØÖµ                         :
 557          *È«¾Ö±äÁ¿                       :
 558          *µ÷ÓÃÄ£¿é                       :
 559          ***********************************************************
 560          *´´½¨ÈË                 :ÒüÔËÍ¬
 561          *´´½¨ÈÕÆÚ                       :2009-4-6
 562          ***********************************************************
 563          *ÐÞ¸ÄÈË                         :
 564          *ÐÞ¸ÄÈÕÆÚ               :
 565          *×¢ÊÍ                   :
 566          **********************************************************/
 567          void Usart0SndData(pSTBusFreq pstBusFreq)
 568          {
 569   1              pSTUartFreq pstDataFreq;
 570   1              while(stUsartCfg[0].uiSndLen!=0)        
 571   1              {//ÓÐÊý¾ÝÕýÔÚ·¢ËÍÖÐ
 572   2                      OSTimeDly(20);          //ÑÓÊ±100us
 573   2              }
 574   1              pstDataFreq = (pSTUartFreq)byUsart0SndBuf;
 575   1      
 576   1              pstDataFreq->byStartByte1   =START_BYTE1;
 577   1          memcpy(&(pstDataFreq->bySndSecAddr),&(pstBusFreq->bySndSecAddr),3);
C51 COMPILER V8.08   UART                                                                  01/26/2011 09:34:32 PAGE 52  

 578   1              memcpy(&(pstDataFreq->byRecSecAddr),&(pstBusFreq->byRecSecAddr),3);
 579   1              pstDataFreq->byCmd                      =pstBusFreq->byCmd;             
 580   1              pstDataFreq->uiLen                      =0X00;
 581   1              pstDataFreq->byData[pstDataFreq->uiLen] = GetPskCrc(pstDataFreq);
 582   1              pstDataFreq->byData[pstDataFreq->uiLen+1] = END_BYTE;
 583   1              
 584   1              stUsartCfg[0].uiSndLen  = pstDataFreq->uiLen+EXT_SIZE;
 585   1              stUsartCfg[0].uiSndPos = 0;     //´ÓÊý¾ÝÖ¡Í·²¿¿ªÊ¼·¢ËÍÊý¾Ý
 586   1              TI=0;
 587   1              SBUF=pstDataFreq->byStartByte1;
 588   1      }
C51 COMPILER V8.08   UART                                                                  01/26/2011 09:34:32 PAGE 53  

ASSEMBLY LISTING OF GENERATED OBJECT CODE


             ; FUNCTION UsartInit (BEGIN)
                                           ; SOURCE LINE # 65
                                           ; SOURCE LINE # 66
                                           ; SOURCE LINE # 70
0000 53B1FC            ANL     P3M0,#0FCH
                                           ; SOURCE LINE # 71
0003 53B2FC            ANL     P3M1,#0FCH
                                           ; SOURCE LINE # 72
0006 D2B0              SETB    RXD
                                           ; SOURCE LINE # 73
0008 D2B1              SETB    TXD
                                           ; SOURCE LINE # 75
000A 900000      R     MOV     DPTR,#stUsartCfg
000D 7400        R     MOV     A,#HIGH byUsart0RecBuf
000F F0                MOVX    @DPTR,A
0010 A3                INC     DPTR
0011 7400        R     MOV     A,#LOW byUsart0RecBuf
0013 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 76
0014 A3                INC     DPTR
0015 7400        R     MOV     A,#HIGH byUsart0SndBuf
0017 F0                MOVX    @DPTR,A
0018 A3                INC     DPTR
0019 7400        R     MOV     A,#LOW byUsart0SndBuf
001B F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 77
001C E4                CLR     A
001D A3                INC     DPTR
001E F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 78
001F A3                INC     DPTR
0020 F0                MOVX    @DPTR,A
0021 A3                INC     DPTR
0022 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 79
0023 A3                INC     DPTR
0024 F0                MOVX    @DPTR,A
0025 A3                INC     DPTR
0026 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 80
0027 A3                INC     DPTR
0028 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 81
0029 900000      R     MOV     DPTR,#stUsartCfg+0DH
002C F0                MOVX    @DPTR,A
002D A3                INC     DPTR
002E F0                MOVX    @DPTR,A
002F 900000      R     MOV     DPTR,#stUsartCfg+0BH
0032 F0                MOVX    @DPTR,A
0033 A3                INC     DPTR
0034 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 83
0035 759850            MOV     SCON,#050H
                                           ; SOURCE LINE # 86
0038 53890F            ANL     TMOD,#0FH
                                           ; SOURCE LINE # 87
003B 438920            ORL     TMOD,#020H
                                           ; SOURCE LINE # 89
003E 758BF6            MOV     TL1,#0F6H
C51 COMPILER V8.08   UART                                                                  01/26/2011 09:34:32 PAGE 54  

                                           ; SOURCE LINE # 90
0041 758DF6            MOV     TH1,#0F6H
                                           ; SOURCE LINE # 92
0044 53877F            ANL     PCON,#07FH
                                           ; SOURCE LINE # 93
0047 438E40            ORL     AUXR,#040H
                                           ; SOURCE LINE # 94
004A C28F              CLR     TF1
                                           ; SOURCE LINE # 95
004C D28E              SETB    TR1
                                           ; SOURCE LINE # 97
004E C298              CLR     RI
                                           ; SOURCE LINE # 98
0050 C299              CLR     TI
                                           ; SOURCE LINE # 99
0052 D29C              SETB    REN
                                           ; SOURCE LINE # 100
0054 D2AC              SETB    ES
                                           ; SOURCE LINE # 123
0056 22                RET     
             ; FUNCTION UsartInit (END)

             ; FUNCTION UART0 (BEGIN)
0000 C2AF              CLR     EA
0002 C0E0              PUSH    ACC
0004 C0F0              PUSH    B
0006 C083              PUSH    DPH
0008 C082              PUSH    DPL
000A C0D0              PUSH    PSW
000C 75D000            MOV     PSW,#00H
000F C000              PUSH    AR0
0011 C004              PUSH    AR4
0013 C005              PUSH    AR5
0015 C006              PUSH    AR6
0017 C007              PUSH    AR7
                                           ; SOURCE LINE # 141
                                           ; SOURCE LINE # 144
0019 209803            JB      RI,$ + 6H
001C 020000      R     LJMP    ?C0002
                                           ; SOURCE LINE # 145
                                           ; SOURCE LINE # 146
001F C298              CLR     RI
                                           ; SOURCE LINE # 147
;---- Variable 'byTemp' assigned to Register 'R7' ----
0021 AF99              MOV     R7,SBUF
                                           ; SOURCE LINE # 148
0023 900000      R     MOV     DPTR,#stUsartCfg+05H
0026 E0                MOVX    A,@DPTR
0027 7002              JNZ     ?C0058
0029 A3                INC     DPTR
002A E0                MOVX    A,@DPTR
002B         ?C0058:
002B 600C              JZ      ?C0003
                                           ; SOURCE LINE # 149
                                           ; SOURCE LINE # 150
002D 900000      R     MOV     DPTR,#stUsartCfg+0AH
0030 E0                MOVX    A,@DPTR
0031 7006              JNZ     ?C0003
                                           ; SOURCE LINE # 151
                                           ; SOURCE LINE # 152
0033 900000      R     MOV     DPTR,#stUsartCfg+04H
                                           ; SOURCE LINE # 153
C51 COMPILER V8.08   UART                                                                  01/26/2011 09:34:32 PAGE 55  

0036 020000      R     LJMP    ?C0066
                                           ; SOURCE LINE # 155
                                           ; SOURCE LINE # 156
0039         ?C0003:
                                           ; SOURCE LINE # 157
0039 900000      R     MOV     DPTR,#stUsartCfg+0AH
003C 7405              MOV     A,#05H
003E F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 158
003F 900000      R     MOV     DPTR,#stUsartCfg+05H
0042 E4                CLR     A
0043 75F001            MOV     B,#01H
0046 120000      E     LCALL   ?C?ILDIX
0049 FC                MOV     R4,A
004A 7400        R     MOV     A,#LOW byUsart0RecBuf
004C 25F0              ADD     A,B
004E F582              MOV     DPL,A
0050 7400        R     MOV     A,#HIGH byUsart0RecBuf
0052 3C                ADDC    A,R4
0053 F583              MOV     DPH,A
0055 EF                MOV     A,R7
0056 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 159
0057 900000      R     MOV     DPTR,#stUsartCfg+04H
005A E0                MOVX    A,@DPTR
005B 14                DEC     A
005C 6029              JZ      ?C0010
005E 14                DEC     A
005F 603F              JZ      ?C0012
0061 14                DEC     A
0062 7003              JNZ     $ + 5H
0064 020000      R     LJMP    ?C0018
0067 2403              ADD     A,#03H
0069 6003              JZ      $ + 5H
006B 020000      R     LJMP    ?C0021
                                           ; SOURCE LINE # 160
                                           ; SOURCE LINE # 161
006E         ?C0007:
                                           ; SOURCE LINE # 162
006E BF5A0F            CJNE    R7,#05AH,?C0008
                                           ; SOURCE LINE # 163
                                           ; SOURCE LINE # 164
0071 900000      R     MOV     DPTR,#stUsartCfg+04H
0074 7401              MOV     A,#01H
0076 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 166
0077 900000      R     MOV     DPTR,#stUsartCfg+09H
007A 7406              MOV     A,#06H
007C F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 167
007D 020000      R     LJMP    ?C0005
0080         ?C0008:
                                           ; SOURCE LINE # 169
                                           ; SOURCE LINE # 170
0080 900000      R     MOV     DPTR,#stUsartCfg+05H
0083 E4                CLR     A
                                           ; SOURCE LINE # 171
                                           ; SOURCE LINE # 172
0084 020000      R     LJMP    ?C0069
                                           ; SOURCE LINE # 173
0087         ?C0010:
                                           ; SOURCE LINE # 174
C51 COMPILER V8.08   UART                                                                  01/26/2011 09:34:32 PAGE 56  

0087 900000      R     MOV     DPTR,#stUsartCfg+09H
008A E0                MOVX    A,@DPTR
008B 14                DEC     A
008C F0                MOVX    @DPTR,A
008D 6003              JZ      $ + 5H
008F 020000      R     LJMP    ?C0005
                                           ; SOURCE LINE # 175
                                           ; SOURCE LINE # 176
0092 900000      R     MOV     DPTR,#stUsartCfg+04H
0095 7402              MOV     A,#02H
0097 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 177
0098 900000      R     MOV     DPTR,#stUsartCfg+09H
009B 04                INC     A
009C F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 178
                                           ; SOURCE LINE # 179
009D 020000      R     LJMP    ?C0005
                                           ; SOURCE LINE # 180
00A0         ?C0012:
                                           ; SOURCE LINE # 181
00A0 900000      R     MOV     DPTR,#stUsartCfg+09H
00A3 E0                MOVX    A,@DPTR
00A4 14                DEC     A
00A5 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 182
00A6 E0                MOVX    A,@DPTR
00A7 FD                MOV     R5,A
00A8 B4010B            CJNE    A,#01H,?C0013
                                           ; SOURCE LINE # 183
                                           ; SOURCE LINE # 184
00AB EF                MOV     A,R7
00AC 900000      R     MOV     DPTR,#stUsartCfg+07H
00AF F0                MOVX    @DPTR,A
00B0 A3                INC     DPTR
00B1 E4                CLR     A
00B2 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 185
00B3 020000      R     LJMP    ?C0005
00B6         ?C0013:
                                           ; SOURCE LINE # 186
00B6 ED                MOV     A,R5
00B7 6003              JZ      $ + 5H
00B9 020000      R     LJMP    ?C0005
                                           ; SOURCE LINE # 187
                                           ; SOURCE LINE # 189
00BC EF                MOV     A,R7
00BD FD                MOV     R5,A
00BE 900000      R     MOV     DPTR,#stUsartCfg+08H
00C1 E0                MOVX    A,@DPTR
00C2 2D                ADD     A,R5
00C3 F0                MOVX    @DPTR,A
00C4 900000      R     MOV     DPTR,#stUsartCfg+07H
00C7 E0                MOVX    A,@DPTR
00C8 3400              ADDC    A,#00H
00CA F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 190
00CB D3                SETB    C
00CC A3                INC     DPTR
00CD E0                MOVX    A,@DPTR
00CE 9480              SUBB    A,#080H
00D0 900000      R     MOV     DPTR,#stUsartCfg+07H
C51 COMPILER V8.08   UART                                                                  01/26/2011 09:34:32 PAGE 57  

00D3 E0                MOVX    A,@DPTR
00D4 9400              SUBB    A,#00H
00D6 900000      R     MOV     DPTR,#stUsartCfg+04H
00D9 5013              JNC     ?C0016
                                           ; SOURCE LINE # 191
                                           ; SOURCE LINE # 192
00DB 7403              MOV     A,#03H
00DD F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 193
00DE 900000      R     MOV     DPTR,#stUsartCfg+08H
00E1 E0                MOVX    A,@DPTR
00E2 2402              ADD     A,#02H
00E4 F0                MOVX    @DPTR,A
00E5 900000      R     MOV     DPTR,#stUsartCfg+07H
00E8 E0                MOVX    A,@DPTR
00E9 3400              ADDC    A,#00H
00EB F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 194
00EC 806F              SJMP    ?C0005
00EE         ?C0016:
                                           ; SOURCE LINE # 196
                                           ; SOURCE LINE # 197
00EE E4                CLR     A
00EF         ?C0066:
00EF F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 198
00F0 A3                INC     DPTR
00F1         ?C0067:
                                           ; SOURCE LINE # 199
                                           ; SOURCE LINE # 200
                                           ; SOURCE LINE # 201
00F1 8021              SJMP    ?C0069
                                           ; SOURCE LINE # 202
00F3         ?C0018:
                                           ; SOURCE LINE # 203
00F3 900000      R     MOV     DPTR,#stUsartCfg+07H
00F6 74FF              MOV     A,#0FFH
00F8 F5F0              MOV     B,A
00FA 120000      E     LCALL   ?C?IILDX
00FD 45F0              ORL     A,B
00FF 705C              JNZ     ?C0005
                                           ; SOURCE LINE # 204
                                           ; SOURCE LINE # 205
0101 BF1602            CJNE    R7,#016H,?C0020
                                           ; SOURCE LINE # 206
                                           ; SOURCE LINE # 207
0104 D200        R     SETB    bUsart0RecFinish
                                           ; SOURCE LINE # 208
0106         ?C0020:
                                           ; SOURCE LINE # 209
0106 900000      R     MOV     DPTR,#stUsartCfg+04H
0109 E4                CLR     A
010A F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 210
010B A3                INC     DPTR
010C         ?C0068:
                                           ; SOURCE LINE # 211
                                           ; SOURCE LINE # 212
010C 8006              SJMP    ?C0069
                                           ; SOURCE LINE # 213
010E         ?C0021:
                                           ; SOURCE LINE # 214
C51 COMPILER V8.08   UART                                                                  01/26/2011 09:34:32 PAGE 58  

010E 900000      R     MOV     DPTR,#stUsartCfg+04H
0111 E4                CLR     A
0112 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 215
0113 A3                INC     DPTR
0114         ?C0069:
0114 F0                MOVX    @DPTR,A
0115 A3                INC     DPTR
0116 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 216
0117 8044              SJMP    ?C0005
                                           ; SOURCE LINE # 217
                                           ; SOURCE LINE # 218
0119         ?C0002:
                                           ; SOURCE LINE # 219
0119 309941            JNB     TI,?C0005
                                           ; SOURCE LINE # 220
                                           ; SOURCE LINE # 221
011C C299              CLR     TI
                                           ; SOURCE LINE # 222
011E 900000      R     MOV     DPTR,#stUsartCfg+0CH
0121 E0                MOVX    A,@DPTR
0122 24FF              ADD     A,#0FFH
0124 F0                MOVX    @DPTR,A
0125 900000      R     MOV     DPTR,#stUsartCfg+0BH
0128 E0                MOVX    A,@DPTR
0129 34FF              ADDC    A,#0FFH
012B F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 223
012C 900000      R     MOV     DPTR,#stUsartCfg+0EH
012F E0                MOVX    A,@DPTR
0130 04                INC     A
0131 F0                MOVX    @DPTR,A
0132 7006              JNZ     ?C0059
0134 900000      R     MOV     DPTR,#stUsartCfg+0DH
0137 E0                MOVX    A,@DPTR
0138 04                INC     A
0139 F0                MOVX    @DPTR,A
013A         ?C0059:
                                           ; SOURCE LINE # 224
013A 900000      R     MOV     DPTR,#stUsartCfg+0BH
013D E0                MOVX    A,@DPTR
013E 7002              JNZ     ?C0060
0140 A3                INC     DPTR
0141 E0                MOVX    A,@DPTR
0142         ?C0060:
0142 6019              JZ      ?C0005
                                           ; SOURCE LINE # 225
                                           ; SOURCE LINE # 226
0144 900000      R     MOV     DPTR,#stUsartCfg+0DH
0147 E0                MOVX    A,@DPTR
0148 FE                MOV     R6,A
0149 A3                INC     DPTR
014A E0                MOVX    A,@DPTR
014B FF                MOV     R7,A
014C 900000      R     MOV     DPTR,#stUsartCfg+02H
014F E0                MOVX    A,@DPTR
0150 FC                MOV     R4,A
0151 A3                INC     DPTR
0152 E0                MOVX    A,@DPTR
0153 2F                ADD     A,R7
0154 F582              MOV     DPL,A
C51 COMPILER V8.08   UART                                                                  01/26/2011 09:34:32 PAGE 59  

0156 EC                MOV     A,R4
0157 3E                ADDC    A,R6
0158 F583              MOV     DPH,A
015A E0                MOVX    A,@DPTR
015B F599              MOV     SBUF,A
                                           ; SOURCE LINE # 228
                                           ; SOURCE LINE # 229
                                           ; SOURCE LINE # 230
015D         ?C0005:
015D D007              POP     AR7
015F D006              POP     AR6
0161 D005              POP     AR5
0163 D004              POP     AR4
0165 D000              POP     AR0
0167 D0D0              POP     PSW
0169 D082              POP     DPL
016B D083              POP     DPH
016D D0F0              POP     B
016F D0E0              POP     ACC
0171 D2AF              SETB    EA
0173 32                RETI    
             ; FUNCTION UART0 (END)

             ; FUNCTION L?0070 (BEGIN)
0000 90000B            MOV     DPTR,#0BH
0003 120000      E     LCALL   ?C?CSTOPTR
             ; FUNCTION _GetPskCrc (BEGIN)
                                           ; SOURCE LINE # 278
0006 8B00        R     MOV     pstDataFreq,R3
0008 8A00        R     MOV     pstDataFreq+01H,R2
000A 8900        R     MOV     pstDataFreq+02H,R1
                                           ; SOURCE LINE # 279
                                           ; SOURCE LINE # 282
;---- Variable 'byCrc' assigned to Register 'R7' ----
000C E4                CLR     A
000D FF                MOV     R7,A
                                           ; SOURCE LINE # 285
000E E9                MOV     A,R1
000F 2401              ADD     A,#01H
0011 F9                MOV     R1,A
0012 E4                CLR     A
0013 3A                ADDC    A,R2
0014 8B00        R     MOV     pbyData,R3
0016 F500        R     MOV     pbyData+01H,A
0018 8900        R     MOV     pbyData+02H,R1
                                           ; SOURCE LINE # 286
001A A900        R     MOV     R1,pstDataFreq+02H
001C 900008            MOV     DPTR,#08H
001F 120000      E     LCALL   ?C?ILDOPTR
0022 ACF0              MOV     R4,B
0024 2409              ADD     A,#09H
0026 F500        R     MOV     uiLen+01H,A
0028 E4                CLR     A
0029 3C                ADDC    A,R4
002A F500        R     MOV     uiLen,A
002C         ?C0025:
                                           ; SOURCE LINE # 287
002C E500        R     MOV     A,uiLen+01H
002E 1500        R     DEC     uiLen+01H
0030 AC00        R     MOV     R4,uiLen
0032 7002              JNZ     ?C0061
0034 1500        R     DEC     uiLen
C51 COMPILER V8.08   UART                                                                  01/26/2011 09:34:32 PAGE 60  

0036         ?C0061:
0036 4C                ORL     A,R4
0037 6015              JZ      ?C0026
                                           ; SOURCE LINE # 288
                                           ; SOURCE LINE # 289
0039 AB00        R     MOV     R3,pbyData
003B 0500        R     INC     pbyData+02H
003D E500        R     MOV     A,pbyData+02H
003F AA00        R     MOV     R2,pbyData+01H
0041 7002              JNZ     ?C0062
0043 0500        R     INC     pbyData+01H
0045         ?C0062:
0045 14                DEC     A
0046 F9                MOV     R1,A
0047 120000      E     LCALL   ?C?CLDPTR
004A 2F                ADD     A,R7
004B FF                MOV     R7,A
                                           ; SOURCE LINE # 290
004C 80DE              SJMP    ?C0025
004E         ?C0026:
                                           ; SOURCE LINE # 291
                                           ; SOURCE LINE # 292
004E         ?C0027:
004E 22                RET     
             ; FUNCTION _GetPskCrc (END)

             ; FUNCTION _CheckPsk (BEGIN)
                                           ; SOURCE LINE # 308
0000 8B00        R     MOV     pstDataFreq,R3
0002 8A00        R     MOV     pstDataFreq+01H,R2
0004 8900        R     MOV     pstDataFreq+02H,R1
                                           ; SOURCE LINE # 309
                                           ; SOURCE LINE # 312
;---- Variable 'byCrc' assigned to Register 'R7' ----
0006 E4                CLR     A
0007 FF                MOV     R7,A
                                           ; SOURCE LINE # 315
0008 E9                MOV     A,R1
0009 2401              ADD     A,#01H
000B F9                MOV     R1,A
000C E4                CLR     A
000D 3A                ADDC    A,R2
000E 8B00        R     MOV     pbyData,R3
0010 F500        R     MOV     pbyData+01H,A
0012 8900        R     MOV     pbyData+02H,R1
                                           ; SOURCE LINE # 316
0014 A900        R     MOV     R1,pstDataFreq+02H
0016 900008            MOV     DPTR,#08H
0019 120000      E     LCALL   ?C?ILDOPTR
001C ACF0              MOV     R4,B
001E 2409              ADD     A,#09H
0020 F500        R     MOV     uiLen+01H,A
0022 E4                CLR     A
0023 3C                ADDC    A,R4
0024 F500        R     MOV     uiLen,A
0026         ?C0028:
                                           ; SOURCE LINE # 317
0026 E500        R     MOV     A,uiLen+01H
0028 1500        R     DEC     uiLen+01H
002A AC00        R     MOV     R4,uiLen
002C 7002              JNZ     ?C0063
002E 1500        R     DEC     uiLen
C51 COMPILER V8.08   UART                                                                  01/26/2011 09:34:32 PAGE 61  

0030         ?C0063:
0030 4C                ORL     A,R4
0031 6015              JZ      ?C0029
                                           ; SOURCE LINE # 318
                                           ; SOURCE LINE # 319
0033 AB00        R     MOV     R3,pbyData
0035 0500        R     INC     pbyData+02H
0037 E500        R     MOV     A,pbyData+02H
0039 AA00        R     MOV     R2,pbyData+01H
003B 7002              JNZ     ?C0064
003D 0500        R     INC     pbyData+01H
003F         ?C0064:
003F 14                DEC     A
0040 F9                MOV     R1,A
0041 120000      E     LCALL   ?C?CLDPTR
0044 2F                ADD     A,R7
0045 FF                MOV     R7,A
                                           ; SOURCE LINE # 320
0046 80DE              SJMP    ?C0028
0048         ?C0029:
                                           ; SOURCE LINE # 321
0048 AB00        R     MOV     R3,pbyData
004A AA00        R     MOV     R2,pbyData+01H
004C A900        R     MOV     R1,pbyData+02H
004E 120000      E     LCALL   ?C?CLDPTR
0051 6F                XRL     A,R7
0052 6003              JZ      ?C0030
                                           ; SOURCE LINE # 322
                                           ; SOURCE LINE # 323
0054 7F00              MOV     R7,#00H
0056 22                RET     
                                           ; SOURCE LINE # 324
0057         ?C0030:
                                           ; SOURCE LINE # 325
0057 7F01              MOV     R7,#01H
                                           ; SOURCE LINE # 326
0059         ?C0031:
0059 22                RET     
             ; FUNCTION _CheckPsk (END)

             ; FUNCTION _UsartSndEnter (BEGIN)
                                           ; SOURCE LINE # 344
0000 8F00        R     MOV     byPort,R7
0002 8D00        R     MOV     byOriginalCmd,R5
0004 8B00        R     MOV     byData,R3
                                           ; SOURCE LINE # 345
0006         ?C0032:
                                           ; SOURCE LINE # 347
0006 E500        R     MOV     A,byPort
0008 75F00F            MOV     B,#0FH
000B A4                MUL     AB
000C 2400        R     ADD     A,#LOW stUsartCfg+0BH
000E F582              MOV     DPL,A
0010 E4                CLR     A
0011 3400        R     ADDC    A,#HIGH stUsartCfg+0BH
0013 F583              MOV     DPH,A
0015 E0                MOVX    A,@DPTR
0016 FE                MOV     R6,A
0017 A3                INC     DPTR
0018 E0                MOVX    A,@DPTR
0019 4E                ORL     A,R6
001A 6007              JZ      ?C0033
C51 COMPILER V8.08   UART                                                                  01/26/2011 09:34:32 PAGE 62  

                                           ; SOURCE LINE # 348
                                           ; SOURCE LINE # 349
001C 7F14              MOV     R7,#014H
001E 120000      E     LCALL   _OSTimeDly
                                           ; SOURCE LINE # 350
0021 80E3              SJMP    ?C0032
0023         ?C0033:
                                           ; SOURCE LINE # 352
0023 E500        R     MOV     A,byPort
0025 7009              JNZ     ?C0034
0027 750001      R     MOV     pstDataFreq,#01H
002A 750000      R     MOV     pstDataFreq+01H,#HIGH byUsart0SndBuf
002D 750000      R     MOV     pstDataFreq+02H,#LOW byUsart0SndBuf
0030         ?C0034:
                                           ; SOURCE LINE # 358
0030 AB00        R     MOV     R3,pstDataFreq
0032 AA00        R     MOV     R2,pstDataFreq+01H
0034 A900        R     MOV     R1,pstDataFreq+02H
0036 745A              MOV     A,#05AH
0038 120000      E     LCALL   ?C?CSTPTR
                                           ; SOURCE LINE # 359
003B AB00        R     MOV     R3,pstDataFreq
003D AA00        R     MOV     R2,pstDataFreq+01H
003F A900        R     MOV     R1,pstDataFreq+02H
0041 900007            MOV     DPTR,#07H
0044 7401              MOV     A,#01H
0046 120000      E     LCALL   ?C?CSTOPTR
                                           ; SOURCE LINE # 360
0049 900008            MOV     DPTR,#08H
004C E4                CLR     A
004D 75F002            MOV     B,#02H
0050 120000      E     LCALL   ?C?ISTOPTR
                                           ; SOURCE LINE # 361
0053 90000A            MOV     DPTR,#0AH
0056 E500        R     MOV     A,byOriginalCmd
0058 120000      E     LCALL   ?C?CSTOPTR
                                           ; SOURCE LINE # 362
005B E500        R     MOV     A,byData
                                           ; SOURCE LINE # 363
005D 120000      R     LCALL   L?0070
0060 AB00        R     MOV     R3,pstDataFreq
0062 AA00        R     MOV     R2,pstDataFreq+01H
0064 A900        R     MOV     R1,pstDataFreq+02H
0066 900008            MOV     DPTR,#08H
0069 120000      E     LCALL   ?C?ILDOPTR
006C FD                MOV     R5,A
006D E9                MOV     A,R1
006E 240A              ADD     A,#0AH
0070 F9                MOV     R1,A
0071 E4                CLR     A
0072 3A                ADDC    A,R2
0073 FA                MOV     R2,A
0074 E9                MOV     A,R1
0075 2D                ADD     A,R5
0076 F9                MOV     R1,A
0077 EA                MOV     A,R2
0078 35F0              ADDC    A,B
007A FA                MOV     R2,A
007B EF                MOV     A,R7
007C 120000      E     LCALL   ?C?CSTPTR
                                           ; SOURCE LINE # 364
007F AB00        R     MOV     R3,pstDataFreq
C51 COMPILER V8.08   UART                                                                  01/26/2011 09:34:32 PAGE 63  

0081 AA00        R     MOV     R2,pstDataFreq+01H
0083 A900        R     MOV     R1,pstDataFreq+02H
0085 900008            MOV     DPTR,#08H
0088 120000      E     LCALL   ?C?ILDOPTR
008B 240B              ADD     A,#0BH
008D F582              MOV     DPL,A
008F E4                CLR     A
0090 35F0              ADDC    A,B
0092 F583              MOV     DPH,A
0094 7416              MOV     A,#016H
0096 120000      E     LCALL   ?C?CSTOPTR
                                           ; SOURCE LINE # 366
0099 900008            MOV     DPTR,#08H
009C 120000      E     LCALL   ?C?ILDOPTR
009F 240C              ADD     A,#0CH
00A1 FF                MOV     R7,A
00A2 E4                CLR     A
00A3 35F0              ADDC    A,B
00A5 FE                MOV     R6,A
00A6 E500        R     MOV     A,byPort
00A8 75F00F            MOV     B,#0FH
00AB A4                MUL     AB
00AC 2400        R     ADD     A,#LOW stUsartCfg+0BH
00AE F582              MOV     DPL,A
00B0 E4                CLR     A
00B1 3400        R     ADDC    A,#HIGH stUsartCfg+0BH
00B3 F583              MOV     DPH,A
00B5 EE                MOV     A,R6
00B6 F0                MOVX    @DPTR,A
00B7 A3                INC     DPTR
00B8 EF                MOV     A,R7
00B9 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 367
00BA E500        R     MOV     A,byPort
00BC 75F00F            MOV     B,#0FH
00BF A4                MUL     AB
00C0 2400        R     ADD     A,#LOW stUsartCfg+0DH
00C2 F582              MOV     DPL,A
00C4 E4                CLR     A
00C5 3400        R     ADDC    A,#HIGH stUsartCfg+0DH
00C7 F583              MOV     DPH,A
00C9 E4                CLR     A
00CA F0                MOVX    @DPTR,A
00CB A3                INC     DPTR
00CC F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 369
00CD E500        R     MOV     A,byPort
00CF 700D              JNZ     ?C0036
                                           ; SOURCE LINE # 370
                                           ; SOURCE LINE # 371
00D1 C299              CLR     TI
                                           ; SOURCE LINE # 372
00D3 AB00        R     MOV     R3,pstDataFreq
00D5 AA00        R     MOV     R2,pstDataFreq+01H
00D7 A900        R     MOV     R1,pstDataFreq+02H
00D9 120000      E     LCALL   ?C?CLDPTR
00DC F599              MOV     SBUF,A
                                           ; SOURCE LINE # 373
                                           ; SOURCE LINE # 384
00DE         ?C0036:
00DE 22                RET     
             ; FUNCTION _UsartSndEnter (END)
C51 COMPILER V8.08   UART                                                                  01/26/2011 09:34:32 PAGE 64  


             ; FUNCTION _UsartSndResult (BEGIN)
                                           ; SOURCE LINE # 405
0000 8F00        R     MOV     byPort,R7
0002 8D00        R     MOV     byOriginalCmd,R5
0004 8B00        R     MOV     byData,R3
                                           ; SOURCE LINE # 406
0006         ?C0037:
                                           ; SOURCE LINE # 408
0006 E500        R     MOV     A,byPort
0008 75F00F            MOV     B,#0FH
000B A4                MUL     AB
000C 2400        R     ADD     A,#LOW stUsartCfg+0BH
000E F582              MOV     DPL,A
0010 E4                CLR     A
0011 3400        R     ADDC    A,#HIGH stUsartCfg+0BH
0013 F583              MOV     DPH,A
0015 E0                MOVX    A,@DPTR
0016 FE                MOV     R6,A
0017 A3                INC     DPTR
0018 E0                MOVX    A,@DPTR
0019 4E                ORL     A,R6
001A 6007              JZ      ?C0038
                                           ; SOURCE LINE # 409
                                           ; SOURCE LINE # 410
001C 7F14              MOV     R7,#014H
001E 120000      E     LCALL   _OSTimeDly
                                           ; SOURCE LINE # 411
0021 80E3              SJMP    ?C0037
0023         ?C0038:
                                           ; SOURCE LINE # 413
0023 E500        R     MOV     A,byPort
0025 7009              JNZ     ?C0039
0027 750001      R     MOV     pstDataFreq,#01H
002A 750000      R     MOV     pstDataFreq+01H,#HIGH byUsart0SndBuf
002D 750000      R     MOV     pstDataFreq+02H,#LOW byUsart0SndBuf
0030         ?C0039:
                                           ; SOURCE LINE # 419
0030 AB00        R     MOV     R3,pstDataFreq
0032 AA00        R     MOV     R2,pstDataFreq+01H
0034 A900        R     MOV     R1,pstDataFreq+02H
0036 745A              MOV     A,#05AH
0038 120000      E     LCALL   ?C?CSTPTR
                                           ; SOURCE LINE # 420
003B AB00        R     MOV     R3,pstDataFreq
003D AA00        R     MOV     R2,pstDataFreq+01H
003F A900        R     MOV     R1,pstDataFreq+02H
0041 900007            MOV     DPTR,#07H
0044 7402              MOV     A,#02H
0046 120000      E     LCALL   ?C?CSTOPTR
                                           ; SOURCE LINE # 421
0049 900008            MOV     DPTR,#08H
004C E4                CLR     A
004D 75F002            MOV     B,#02H
0050 120000      E     LCALL   ?C?ISTOPTR
                                           ; SOURCE LINE # 422
0053 90000A            MOV     DPTR,#0AH
0056 E500        R     MOV     A,byOriginalCmd
0058 120000      E     LCALL   ?C?CSTOPTR
                                           ; SOURCE LINE # 423
005B E500        R     MOV     A,byData
                                           ; SOURCE LINE # 424
C51 COMPILER V8.08   UART                                                                  01/26/2011 09:34:32 PAGE 65  

005D 120000      R     LCALL   L?0070
0060 AB00        R     MOV     R3,pstDataFreq
0062 AA00        R     MOV     R2,pstDataFreq+01H
0064 A900        R     MOV     R1,pstDataFreq+02H
0066 900008            MOV     DPTR,#08H
0069 120000      E     LCALL   ?C?ILDOPTR
006C FD                MOV     R5,A
006D E9                MOV     A,R1
006E 240A              ADD     A,#0AH
0070 F9                MOV     R1,A
0071 E4                CLR     A
0072 3A                ADDC    A,R2
0073 FA                MOV     R2,A
0074 E9                MOV     A,R1
0075 2D                ADD     A,R5
0076 F9                MOV     R1,A
0077 EA                MOV     A,R2
0078 35F0              ADDC    A,B
007A FA                MOV     R2,A
007B EF                MOV     A,R7
007C 120000      E     LCALL   ?C?CSTPTR
                                           ; SOURCE LINE # 425
007F AB00        R     MOV     R3,pstDataFreq
0081 AA00        R     MOV     R2,pstDataFreq+01H
0083 A900        R     MOV     R1,pstDataFreq+02H
0085 900008            MOV     DPTR,#08H
0088 120000      E     LCALL   ?C?ILDOPTR
008B 240B              ADD     A,#0BH
008D F582              MOV     DPL,A
008F E4                CLR     A
0090 35F0              ADDC    A,B
0092 F583              MOV     DPH,A
0094 7416              MOV     A,#016H
0096 120000      E     LCALL   ?C?CSTOPTR
                                           ; SOURCE LINE # 427
0099 900008            MOV     DPTR,#08H
009C 120000      E     LCALL   ?C?ILDOPTR
009F 240C              ADD     A,#0CH
00A1 FF                MOV     R7,A
00A2 E4                CLR     A
00A3 35F0              ADDC    A,B
00A5 FE                MOV     R6,A
00A6 E500        R     MOV     A,byPort
00A8 75F00F            MOV     B,#0FH
00AB A4                MUL     AB
00AC 2400        R     ADD     A,#LOW stUsartCfg+0BH
00AE F582              MOV     DPL,A
00B0 E4                CLR     A
00B1 3400        R     ADDC    A,#HIGH stUsartCfg+0BH
00B3 F583              MOV     DPH,A
00B5 EE                MOV     A,R6
00B6 F0                MOVX    @DPTR,A
00B7 A3                INC     DPTR
00B8 EF                MOV     A,R7
00B9 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 428
00BA E500        R     MOV     A,byPort
00BC 75F00F            MOV     B,#0FH
00BF A4                MUL     AB
00C0 2400        R     ADD     A,#LOW stUsartCfg+0DH
00C2 F582              MOV     DPL,A
00C4 E4                CLR     A
C51 COMPILER V8.08   UART                                                                  01/26/2011 09:34:32 PAGE 66  

00C5 3400        R     ADDC    A,#HIGH stUsartCfg+0DH
00C7 F583              MOV     DPH,A
00C9 E4                CLR     A
00CA F0                MOVX    @DPTR,A
00CB A3                INC     DPTR
00CC F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 431
00CD E500        R     MOV     A,byPort
00CF 700D              JNZ     ?C0041
                                           ; SOURCE LINE # 432
                                           ; SOURCE LINE # 433
00D1 C299              CLR     TI
                                           ; SOURCE LINE # 434
00D3 AB00        R     MOV     R3,pstDataFreq
00D5 AA00        R     MOV     R2,pstDataFreq+01H
00D7 A900        R     MOV     R1,pstDataFreq+02H
00D9 120000      E     LCALL   ?C?CLDPTR
00DC F599              MOV     SBUF,A
                                           ; SOURCE LINE # 435
                                           ; SOURCE LINE # 446
00DE         ?C0041:
00DE 22                RET     
             ; FUNCTION _UsartSndResult (END)

             ; FUNCTION Usart0RecDeal (BEGIN)
                                           ; SOURCE LINE # 462
                                           ; SOURCE LINE # 463
                                           ; SOURCE LINE # 465
0000 C200        R     CLR     bUsart0RecFinish
                                           ; SOURCE LINE # 466
0002 900000      E     MOV     DPTR,#stLocalControl+01FH
0005 E0                MOVX    A,@DPTR
0006 900000      E     MOV     DPTR,#stLocalControl+0AH
0009 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 467
000A 900000      E     MOV     DPTR,#stLocalControl+020H
000D E0                MOVX    A,@DPTR
000E 900000      E     MOV     DPTR,#stLocalControl+0BH
0011 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 468
0012 900000      E     MOV     DPTR,#stLocalControl+021H
0015 E0                MOVX    A,@DPTR
0016 900000      E     MOV     DPTR,#stLocalControl+0CH
0019 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 469
001A 7B01              MOV     R3,#01H
001C 7A00        R     MOV     R2,#HIGH byUsart0RecBuf
001E 7900        R     MOV     R1,#LOW byUsart0RecBuf
0020 8B00        R     MOV     pstDataFreq,R3
0022 8A00        R     MOV     pstDataFreq+01H,R2
0024 8900        R     MOV     pstDataFreq+02H,R1
                                           ; SOURCE LINE # 470
0026 900004            MOV     DPTR,#04H
0029 120000      E     LCALL   ?C?CLDOPTR
002C FF                MOV     R7,A
002D 900000      E     MOV     DPTR,#stLocalControl+01FH
0030 E0                MOVX    A,@DPTR
0031 6F                XRL     A,R7
0032 705F              JNZ     ?C0048
0034 AB00        R     MOV     R3,pstDataFreq
0036 AA00        R     MOV     R2,pstDataFreq+01H
0038 A900        R     MOV     R1,pstDataFreq+02H
C51 COMPILER V8.08   UART                                                                  01/26/2011 09:34:32 PAGE 67  

003A 900005            MOV     DPTR,#05H
003D 120000      E     LCALL   ?C?CLDOPTR
0040 FF                MOV     R7,A
0041 900000      E     MOV     DPTR,#stLocalControl+020H
0044 E0                MOVX    A,@DPTR
0045 6F                XRL     A,R7
0046 704B              JNZ     ?C0048
0048 900006            MOV     DPTR,#06H
004B 120000      E     LCALL   ?C?CLDOPTR
004E FF                MOV     R7,A
004F 900000      E     MOV     DPTR,#stLocalControl+021H
0052 E0                MOVX    A,@DPTR
0053 6F                XRL     A,R7
0054 703D              JNZ     ?C0048
                                           ; SOURCE LINE # 473
                                           ; SOURCE LINE # 474
0056 120000      R     LCALL   _CheckPsk
0059 EF                MOV     A,R7
005A 900000      E     MOV     DPTR,#stLocalControl+0DH
005D 700C              JNZ     ?C0043
                                           ; SOURCE LINE # 475
                                           ; SOURCE LINE # 476
005F 7481              MOV     A,#081H
0061 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 477
0062 7B01              MOV     R3,#01H
0064 7A00        E     MOV     R2,#HIGH stLocalControl+0AH
0066 7900        E     MOV     R1,#LOW stLocalControl+0AH
0068 020000      E     LJMP    _Bus0OutputData
                                           ; SOURCE LINE # 478
006B         ?C0043:
                                           ; SOURCE LINE # 480
                                           ; SOURCE LINE # 481
006B 7402              MOV     A,#02H
006D F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 482
006E AB00        R     MOV     R3,pstDataFreq
0070 AA00        R     MOV     R2,pstDataFreq+01H
0072 A900        R     MOV     R1,pstDataFreq+02H
0074 900007            MOV     DPTR,#07H
0077 120000      E     LCALL   ?C?CLDOPTR
007A 900000      E     MOV     DPTR,#stLocalControl+0EH
007D F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 483
007E 7B01              MOV     R3,#01H
0080 7A00        E     MOV     R2,#HIGH stLocalControl+0AH
0082 7900        E     MOV     R1,#LOW stLocalControl+0AH
0084 120000      E     LCALL   _Bus0OutputData
                                           ; SOURCE LINE # 484
0087 AB00        R     MOV     R3,pstDataFreq
0089 AA00        R     MOV     R2,pstDataFreq+01H
008B A900        R     MOV     R1,pstDataFreq+02H
008D 900007            MOV     DPTR,#07H
0090 120000      E     LCALL   ?C?CLDOPTR
                                           ; SOURCE LINE # 485
                                           ; SOURCE LINE # 486
                                           ; SOURCE LINE # 488
                                           ; SOURCE LINE # 489
                                           ; SOURCE LINE # 490
                                           ; SOURCE LINE # 491
                                           ; SOURCE LINE # 492
                                           ; SOURCE LINE # 493
C51 COMPILER V8.08   UART                                                                  01/26/2011 09:34:32 PAGE 68  

                                           ; SOURCE LINE # 495
0093         ?C0048:
0093 22                RET     
             ; FUNCTION Usart0RecDeal (END)

             ; FUNCTION Usart1RecDeal (BEGIN)
                                           ; SOURCE LINE # 513
                                           ; SOURCE LINE # 514
                                           ; SOURCE LINE # 515
0000 C200        R     CLR     bUsart1RecFinish
                                           ; SOURCE LINE # 516
0002 22                RET     
             ; FUNCTION Usart1RecDeal (END)

             ; FUNCTION UsartManager (BEGIN)
                                           ; SOURCE LINE # 534
                                           ; SOURCE LINE # 535
0000         ?C0050:
                                           ; SOURCE LINE # 536
                                           ; SOURCE LINE # 537
                                           ; SOURCE LINE # 538
0000 300007      R     JNB     bUsart0RecFinish,?C0052
                                           ; SOURCE LINE # 539
                                           ; SOURCE LINE # 540
0003 7F00        E     MOV     R7,#LOW byMainCmdQ
0005 7D90              MOV     R5,#090H
0007 120000      E     LCALL   _OSQPost
                                           ; SOURCE LINE # 541
000A         ?C0052:
                                           ; SOURCE LINE # 542
000A 300007      R     JNB     bUsart1RecFinish,?C0053
                                           ; SOURCE LINE # 543
                                           ; SOURCE LINE # 544
000D 7F00        E     MOV     R7,#LOW byMainCmdQ
000F 7DA0              MOV     R5,#0A0H
0011 120000      E     LCALL   _OSQPost
                                           ; SOURCE LINE # 545
0014         ?C0053:
                                           ; SOURCE LINE # 546
0014 7D01              MOV     R5,#01H
0016 7F02              MOV     R7,#02H
0018 120000      E     LCALL   _OSWait
                                           ; SOURCE LINE # 548
001B 80E3              SJMP    ?C0050
             ; FUNCTION UsartManager (END)

             ; FUNCTION _Usart0SndData (BEGIN)
                                           ; SOURCE LINE # 567
0000 8B00        R     MOV     pstBusFreq,R3
0002 8A00        R     MOV     pstBusFreq+01H,R2
0004 8900        R     MOV     pstBusFreq+02H,R1
                                           ; SOURCE LINE # 568
0006         ?C0055:
                                           ; SOURCE LINE # 570
0006 900000      R     MOV     DPTR,#stUsartCfg+0BH
0009 E0                MOVX    A,@DPTR
000A 7002              JNZ     ?C0065
000C A3                INC     DPTR
000D E0                MOVX    A,@DPTR
000E         ?C0065:
000E 6007              JZ      ?C0056
                                           ; SOURCE LINE # 571
C51 COMPILER V8.08   UART                                                                  01/26/2011 09:34:32 PAGE 69  

                                           ; SOURCE LINE # 572
0010 7F14              MOV     R7,#014H
0012 120000      E     LCALL   _OSTimeDly
                                           ; SOURCE LINE # 573
0015 80EF              SJMP    ?C0055
0017         ?C0056:
                                           ; SOURCE LINE # 574
0017 750001      R     MOV     pstDataFreq,#01H
001A 750000      R     MOV     pstDataFreq+01H,#HIGH byUsart0SndBuf
001D 750000      R     MOV     pstDataFreq+02H,#LOW byUsart0SndBuf
                                           ; SOURCE LINE # 576
0020 AB00        R     MOV     R3,pstDataFreq
0022 AA00        R     MOV     R2,pstDataFreq+01H
0024 A900        R     MOV     R1,pstDataFreq+02H
0026 745A              MOV     A,#05AH
0028 120000      E     LCALL   ?C?CSTPTR
                                           ; SOURCE LINE # 577
002B E500        R     MOV     A,pstDataFreq+02H
002D 2401              ADD     A,#01H
002F F9                MOV     R1,A
0030 E4                CLR     A
0031 3500        R     ADDC    A,pstDataFreq+01H
0033 A801              MOV     R0,AR1
0035 FC                MOV     R4,A
0036 AD00        R     MOV     R5,pstDataFreq
0038 AB00        R     MOV     R3,pstBusFreq
003A AA00        R     MOV     R2,pstBusFreq+01H
003C A900        R     MOV     R1,pstBusFreq+02H
003E 7E00              MOV     R6,#00H
0040 7F03              MOV     R7,#03H
0042 120000      E     LCALL   ?C?COPY
                                           ; SOURCE LINE # 578
0045 AB00        R     MOV     R3,pstBusFreq
0047 E500        R     MOV     A,pstBusFreq+02H
0049 2404              ADD     A,#04H
004B F9                MOV     R1,A
004C E4                CLR     A
004D 3500        R     ADDC    A,pstBusFreq+01H
004F FA                MOV     R2,A
0050 C002              PUSH    AR2
0052 C001              PUSH    AR1
0054 E500        R     MOV     A,pstDataFreq+02H
0056 2404              ADD     A,#04H
0058 F9                MOV     R1,A
0059 E4                CLR     A
005A 3500        R     ADDC    A,pstDataFreq+01H
005C A801              MOV     R0,AR1
005E FC                MOV     R4,A
005F AD00        R     MOV     R5,pstDataFreq
0061 D001              POP     AR1
0063 D002              POP     AR2
0065 7E00              MOV     R6,#00H
0067 7F03              MOV     R7,#03H
0069 120000      E     LCALL   ?C?COPY
                                           ; SOURCE LINE # 579
006C AB00        R     MOV     R3,pstBusFreq
006E AA00        R     MOV     R2,pstBusFreq+01H
0070 A900        R     MOV     R1,pstBusFreq+02H
0072 900003            MOV     DPTR,#03H
0075 120000      E     LCALL   ?C?CLDOPTR
0078 AB00        R     MOV     R3,pstDataFreq
007A AA00        R     MOV     R2,pstDataFreq+01H
C51 COMPILER V8.08   UART                                                                  01/26/2011 09:34:32 PAGE 70  

007C A900        R     MOV     R1,pstDataFreq+02H
007E 900007            MOV     DPTR,#07H
0081 120000      E     LCALL   ?C?CSTOPTR
                                           ; SOURCE LINE # 580
0084 900008            MOV     DPTR,#08H
0087 E4                CLR     A
0088 F5F0              MOV     B,A
008A 120000      E     LCALL   ?C?ISTOPTR
                                           ; SOURCE LINE # 581
008D 120000      R     LCALL   _GetPskCrc
0090 AB00        R     MOV     R3,pstDataFreq
0092 AA00        R     MOV     R2,pstDataFreq+01H
0094 A900        R     MOV     R1,pstDataFreq+02H
0096 900008            MOV     DPTR,#08H
0099 120000      E     LCALL   ?C?ILDOPTR
009C FD                MOV     R5,A
009D E9                MOV     A,R1
009E 240A              ADD     A,#0AH
00A0 F9                MOV     R1,A
00A1 E4                CLR     A
00A2 3A                ADDC    A,R2
00A3 FA                MOV     R2,A
00A4 E9                MOV     A,R1
00A5 2D                ADD     A,R5
00A6 F9                MOV     R1,A
00A7 EA                MOV     A,R2
00A8 35F0              ADDC    A,B
00AA FA                MOV     R2,A
00AB EF                MOV     A,R7
00AC 120000      E     LCALL   ?C?CSTPTR
                                           ; SOURCE LINE # 582
00AF AB00        R     MOV     R3,pstDataFreq
00B1 AA00        R     MOV     R2,pstDataFreq+01H
00B3 A900        R     MOV     R1,pstDataFreq+02H
00B5 900008            MOV     DPTR,#08H
00B8 120000      E     LCALL   ?C?ILDOPTR
00BB 240B              ADD     A,#0BH
00BD F582              MOV     DPL,A
00BF E4                CLR     A
00C0 35F0              ADDC    A,B
00C2 F583              MOV     DPH,A
00C4 7416              MOV     A,#016H
00C6 120000      E     LCALL   ?C?CSTOPTR
                                           ; SOURCE LINE # 584
00C9 900008            MOV     DPTR,#08H
00CC 120000      E     LCALL   ?C?ILDOPTR
00CF 240C              ADD     A,#0CH
00D1 FE                MOV     R6,A
00D2 E4                CLR     A
00D3 35F0              ADDC    A,B
00D5 900000      R     MOV     DPTR,#stUsartCfg+0BH
00D8 F0                MOVX    @DPTR,A
00D9 A3                INC     DPTR
00DA CE                XCH     A,R6
00DB F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 585
00DC E4                CLR     A
00DD A3                INC     DPTR
00DE F0                MOVX    @DPTR,A
00DF A3                INC     DPTR
00E0 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 586
C51 COMPILER V8.08   UART                                                                  01/26/2011 09:34:32 PAGE 71  

00E1 C299              CLR     TI
                                           ; SOURCE LINE # 587
00E3 120000      E     LCALL   ?C?CLDPTR
00E6 F599              MOV     SBUF,A
                                           ; SOURCE LINE # 588
00E8 22                RET     
             ; FUNCTION _Usart0SndData (END)

C51 COMPILER V8.08   UART                                                                  01/26/2011 09:34:32 PAGE 72  

NAME                                    CLASS   MSPACE  TYPE    OFFSET  SIZE
====                                    =====   ======  ====    ======  ====


P0 . . . . . . . . . . . . . . . . . .  SFR      DATA   U_CHAR   0080H  1
P3M0 . . . . . . . . . . . . . . . . .  SFR      DATA   U_CHAR   00B1H  1
P1 . . . . . . . . . . . . . . . . . .  SFR      DATA   U_CHAR   0090H  1
P3M1 . . . . . . . . . . . . . . . . .  SFR      DATA   U_CHAR   00B2H  1
P2 . . . . . . . . . . . . . . . . . .  SFR      DATA   U_CHAR   00A0H  1
P3 . . . . . . . . . . . . . . . . . .  SFR      DATA   U_CHAR   00B0H  1
int8 . . . . . . . . . . . . . . . . .  TYPEDEF  -----  CHAR     -----  1
stUsartCfg . . . . . . . . . . . . . .  PUBLIC   XDATA  ARRAY    0000H  15
IE . . . . . . . . . . . . . . . . . .  SFR      DATA   U_CHAR   00A8H  1
_CheckPsk. . . . . . . . . . . . . . .  PUBLIC   CODE   PROC     0000H  -----
  pstDataFreq. . . . . . . . . . . . .  AUTO     DATA   PTR      0000H  3
  pbyData. . . . . . . . . . . . . . .  AUTO     DATA   PTR      0003H  3
  uiLen. . . . . . . . . . . . . . . .  AUTO     DATA   U_INT    0006H  2
  byCrc. . . . . . . . . . . . . . . .  * REG *  DATA   U_CHAR   0007H  1
size_t . . . . . . . . . . . . . . . .  TYPEDEF  -----  U_INT    -----  2
pSTEepromCfgData . . . . . . . . . . .  TYPEDEF  -----  PTR      -----  3
pSTAddr. . . . . . . . . . . . . . . .  TYPEDEF  -----  PTR      -----  3
ES . . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      00ACH  1
IP . . . . . . . . . . . . . . . . . .  SFR      DATA   U_CHAR   00B8H  1
RI . . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      0098H  1
_OSQPost . . . . . . . . . . . . . . .  EXTERN   CODE   PROC     -----  -----
TI . . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      0099H  1
pSTIndicationData. . . . . . . . . . .  TYPEDEF  -----  PTR      -----  3
STEepromCfgData. . . . . . . . . . . .  TYPEDEF  -----  STRUCT   -----  31
  byInitFlag . . . . . . . . . . . . .  MEMBER   -----  U_CHAR   0000H  1
  bySelfSecAddr. . . . . . . . . . . .  MEMBER   -----  U_CHAR   0001H  1
  bySelfRoomAddr . . . . . . . . . . .  MEMBER   -----  U_CHAR   0002H  1
  bySelfBedAddr. . . . . . . . . . . .  MEMBER   -----  U_CHAR   0003H  1
  byEnable1. . . . . . . . . . . . . .  MEMBER   -----  U_CHAR   0004H  1
  byEnable2. . . . . . . . . . . . . .  MEMBER   -----  U_CHAR   0005H  1
  byPrio . . . . . . . . . . . . . . .  MEMBER   -----  U_CHAR   0006H  1
  byRingTime . . . . . . . . . . . . .  MEMBER   -----  U_CHAR   0007H  1
  byTalkTime . . . . . . . . . . . . .  MEMBER   -----  U_CHAR   0008H  1
  byBroadTime. . . . . . . . . . . . .  MEMBER   -----  U_CHAR   0009H  1
  byListenDelay. . . . . . . . . . . .  MEMBER   -----  U_CHAR   000AH  1
  byVolumStep. . . . . . . . . . . . .  MEMBER   -----  U_CHAR   000BH  1
  byRingVol. . . . . . . . . . . . . .  MEMBER   -----  U_CHAR   000CH  1
  byCH0TalkedVol . . . . . . . . . . .  MEMBER   -----  U_CHAR   000DH  1
  byCH1TalkedVol . . . . . . . . . . .  MEMBER   -----  U_CHAR   000EH  1
  byBroadVol . . . . . . . . . . . . .  MEMBER   -----  U_CHAR   000FH  1
  byNoteVol. . . . . . . . . . . . . .  MEMBER   -----  U_CHAR   0010H  1
  byMusicVol . . . . . . . . . . . . .  MEMBER   -----  U_CHAR   0011H  1
  byCH0TalkVol . . . . . . . . . . . .  MEMBER   -----  U_CHAR   0012H  1
  byCH1TalkVol . . . . . . . . . . . .  MEMBER   -----  U_CHAR   0013H  1
  bySelfRingVol. . . . . . . . . . . .  MEMBER   -----  U_CHAR   0014H  1
  byMaxVol . . . . . . . . . . . . . .  MEMBER   -----  U_CHAR   0015H  1
  byMinVol . . . . . . . . . . . . . .  MEMBER   -----  U_CHAR   0016H  1
  byReserve1 . . . . . . . . . . . . .  MEMBER   -----  U_CHAR   0017H  1
  byReserve2 . . . . . . . . . . . . .  MEMBER   -----  U_CHAR   0018H  1
  byReserve3 . . . . . . . . . . . . .  MEMBER   -----  U_CHAR   0019H  1
  bySerialNum1 . . . . . . . . . . . .  MEMBER   -----  U_CHAR   001AH  1
  bySerialNum2 . . . . . . . . . . . .  MEMBER   -----  U_CHAR   001BH  1
  bySerialNum3 . . . . . . . . . . . .  MEMBER   -----  U_CHAR   001CH  1
  byVersionHi. . . . . . . . . . . . .  MEMBER   -----  U_CHAR   001DH  1
  byVersionLo. . . . . . . . . . . . .  MEMBER   -----  U_CHAR   001EH  1
CCON . . . . . . . . . . . . . . . . .  SFR      DATA   U_CHAR   00D8H  1
STAddr . . . . . . . . . . . . . . . .  TYPEDEF  -----  STRUCT   -----  3
C51 COMPILER V8.08   UART                                                                  01/26/2011 09:34:32 PAGE 73  

NAME                                    CLASS   MSPACE  TYPE    OFFSET  SIZE
====                                    =====   ======  ====    ======  ====


  bySecAddr. . . . . . . . . . . . . .  MEMBER   -----  U_CHAR   0000H  1
  byRoomAddr . . . . . . . . . . . . .  MEMBER   -----  U_CHAR   0001H  1
  byBedAddr. . . . . . . . . . . . . .  MEMBER   -----  U_CHAR   0002H  1
bUsart0RecFinish . . . . . . . . . . .  ABSBIT   -----  BIT      0000H  1
bUsart1RecFinish . . . . . . . . . . .  ABSBIT   -----  BIT      0001H  1
uint32 . . . . . . . . . . . . . . . .  TYPEDEF  -----  U_LONG   -----  4
UsartInit. . . . . . . . . . . . . . .  PUBLIC   CODE   PROC     0000H  -----
uint16 . . . . . . . . . . . . . . . .  TYPEDEF  -----  U_INT    -----  2
STIndicationData . . . . . . . . . . .  TYPEDEF  -----  STRUCT   -----  4
  stAddr . . . . . . . . . . . . . . .  MEMBER   -----  STRUCT   0000H  3
  byCallCmd. . . . . . . . . . . . . .  MEMBER   -----  U_CHAR   0003H  1
SBUF . . . . . . . . . . . . . . . . .  SFR      DATA   U_CHAR   0099H  1
PCON . . . . . . . . . . . . . . . . .  SFR      DATA   U_CHAR   0087H  1
int32. . . . . . . . . . . . . . . . .  TYPEDEF  -----  LONG     -----  4
int16. . . . . . . . . . . . . . . . .  TYPEDEF  -----  INT      -----  2
SCON . . . . . . . . . . . . . . . . .  SFR      DATA   U_CHAR   0098H  1
TMOD . . . . . . . . . . . . . . . . .  SFR      DATA   U_CHAR   0089H  1
TCON . . . . . . . . . . . . . . . . .  SFR      DATA   U_CHAR   0088H  1
_OSWait. . . . . . . . . . . . . . . .  EXTERN   CODE   PROC     -----  -----
_UsartSndEnter . . . . . . . . . . . .  PUBLIC   CODE   PROC     0000H  -----
  byPort . . . . . . . . . . . . . . .  AUTO     DATA   U_CHAR   0000H  1
  byOriginalCmd. . . . . . . . . . . .  AUTO     DATA   U_CHAR   0001H  1
  byData . . . . . . . . . . . . . . .  AUTO     DATA   U_CHAR   0002H  1
  pstDataFreq. . . . . . . . . . . . .  AUTO     DATA   PTR      0003H  3
stLocalControl . . . . . . . . . . . .  EXTERN   XDATA  STRUCT   -----  61
_UsartSndResult. . . . . . . . . . . .  PUBLIC   CODE   PROC     0000H  -----
  byPort . . . . . . . . . . . . . . .  AUTO     DATA   U_CHAR   0000H  1
  byOriginalCmd. . . . . . . . . . . .  AUTO     DATA   U_CHAR   0001H  1
  byData . . . . . . . . . . . . . . .  AUTO     DATA   U_CHAR   0002H  1
  pstDataFreq. . . . . . . . . . . . .  AUTO     DATA   PTR      0003H  3
pSTUsartCfg. . . . . . . . . . . . . .  TYPEDEF  -----  STRUCT   -----  15
  pbyRecBuf. . . . . . . . . . . . . .  MEMBER   -----  PTR      0000H  2
  pbySndBuf. . . . . . . . . . . . . .  MEMBER   -----  PTR      0002H  2
  byRecState . . . . . . . . . . . . .  MEMBER   -----  U_CHAR   0004H  1
  uiRecPosition. . . . . . . . . . . .  MEMBER   -----  U_INT    0005H  2
  uiRecLen . . . . . . . . . . . . . .  MEMBER   -----  U_INT    0007H  2
  byRecCount . . . . . . . . . . . . .  MEMBER   -----  U_CHAR   0009H  1
  byRecTimeout . . . . . . . . . . . .  MEMBER   -----  U_CHAR   000AH  1
  uiSndLen . . . . . . . . . . . . . .  MEMBER   -----  U_INT    000BH  2
  uiSndPos . . . . . . . . . . . . . .  MEMBER   -----  U_INT    000DH  2
AUXR . . . . . . . . . . . . . . . . .  SFR      DATA   U_CHAR   008EH  1
ACC. . . . . . . . . . . . . . . . . .  SFR      DATA   U_CHAR   00E0H  1
pSTUartFreq. . . . . . . . . . . . . .  TYPEDEF  -----  PTR      -----  3
byMainCmdQ . . . . . . . . . . . . . .  EXTERN   IDATA  ARRAY    -----  -----
TF1. . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      008FH  1
STUsartCfg . . . . . . . . . . . . . .  TYPEDEF  -----  STRUCT   -----  15
  pbyRecBuf. . . . . . . . . . . . . .  MEMBER   -----  PTR      0000H  2
  pbySndBuf. . . . . . . . . . . . . .  MEMBER   -----  PTR      0002H  2
  byRecState . . . . . . . . . . . . .  MEMBER   -----  U_CHAR   0004H  1
  uiRecPosition. . . . . . . . . . . .  MEMBER   -----  U_INT    0005H  2
  uiRecLen . . . . . . . . . . . . . .  MEMBER   -----  U_INT    0007H  2
  byRecCount . . . . . . . . . . . . .  MEMBER   -----  U_CHAR   0009H  1
  byRecTimeout . . . . . . . . . . . .  MEMBER   -----  U_CHAR   000AH  1
  uiSndLen . . . . . . . . . . . . . .  MEMBER   -----  U_INT    000BH  2
  uiSndPos . . . . . . . . . . . . . .  MEMBER   -----  U_INT    000DH  2
TH1. . . . . . . . . . . . . . . . . .  SFR      DATA   U_CHAR   008DH  1
TL1. . . . . . . . . . . . . . . . . .  SFR      DATA   U_CHAR   008BH  1
C51 COMPILER V8.08   UART                                                                  01/26/2011 09:34:32 PAGE 74  

NAME                                    CLASS   MSPACE  TYPE    OFFSET  SIZE
====                                    =====   ======  ====    ======  ====


UsartManager . . . . . . . . . . . . .  PUBLIC   CODE   PROC     0000H  -----
pSTBusFreq . . . . . . . . . . . . . .  TYPEDEF  -----  PTR      -----  3
pSTTimerOut. . . . . . . . . . . . . .  TYPEDEF  -----  PTR      -----  3
Usart0RecDeal. . . . . . . . . . . . .  PUBLIC   CODE   PROC     0000H  -----
  pstDataFreq. . . . . . . . . . . . .  AUTO     DATA   PTR      0000H  3
STUartFreq . . . . . . . . . . . . . .  TYPEDEF  -----  STRUCT   -----  11
  byStartByte1 . . . . . . . . . . . .  MEMBER   -----  U_CHAR   0000H  1
  bySndSecAddr . . . . . . . . . . . .  MEMBER   -----  U_CHAR   0001H  1
  bySndRoomAddr. . . . . . . . . . . .  MEMBER   -----  U_CHAR   0002H  1
  bySndBedAddr . . . . . . . . . . . .  MEMBER   -----  U_CHAR   0003H  1
  byRecSecAddr . . . . . . . . . . . .  MEMBER   -----  U_CHAR   0004H  1
  byRecRoomAddr. . . . . . . . . . . .  MEMBER   -----  U_CHAR   0005H  1
  byRecBedAddr . . . . . . . . . . . .  MEMBER   -----  U_CHAR   0006H  1
  byCmd. . . . . . . . . . . . . . . .  MEMBER   -----  U_CHAR   0007H  1
  uiLen. . . . . . . . . . . . . . . .  MEMBER   -----  U_INT    0008H  2
  byData . . . . . . . . . . . . . . .  MEMBER   -----  ARRAY    000AH  1
TR1. . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      008EH  1
Usart1RecDeal. . . . . . . . . . . . .  PUBLIC   CODE   PROC     0000H  -----
byUsart0RecBuf . . . . . . . . . . . .  PUBLIC   XDATA  ARRAY    000FH  140
_OSTimeDly . . . . . . . . . . . . . .  EXTERN   CODE   PROC     -----  -----
STBusFreq. . . . . . . . . . . . . . .  TYPEDEF  -----  STRUCT   -----  7
  bySndSecAddr . . . . . . . . . . . .  MEMBER   -----  U_CHAR   0000H  1
  bySndRoomAddr. . . . . . . . . . . .  MEMBER   -----  U_CHAR   0001H  1
  bySndBedAddr . . . . . . . . . . . .  MEMBER   -----  U_CHAR   0002H  1
  byCmd. . . . . . . . . . . . . . . .  MEMBER   -----  U_CHAR   0003H  1
  byRecSecAddr . . . . . . . . . . . .  MEMBER   -----  U_CHAR   0004H  1
  byRecRoomAddr. . . . . . . . . . . .  MEMBER   -----  U_CHAR   0005H  1
  byRecBedAddr . . . . . . . . . . . .  MEMBER   -----  U_CHAR   0006H  1
byUsart0SndBuf . . . . . . . . . . . .  PUBLIC   XDATA  ARRAY    009BH  50
REN. . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      009CH  1
STTimerOut . . . . . . . . . . . . . .  TYPEDEF  -----  STRUCT   -----  3
  byTimerOutSet. . . . . . . . . . . .  MEMBER   -----  U_CHAR   0000H  1
  byTimerOut . . . . . . . . . . . . .  MEMBER   -----  U_CHAR   0001H  1
  byTimerOutCount. . . . . . . . . . .  MEMBER   -----  U_CHAR   0002H  1
_Usart0SndData . . . . . . . . . . . .  PUBLIC   CODE   PROC     0000H  -----
  pstBusFreq . . . . . . . . . . . . .  AUTO     DATA   PTR      0000H  3
  pstDataFreq. . . . . . . . . . . . .  AUTO     DATA   PTR      0003H  3
_GetPskCrc . . . . . . . . . . . . . .  PUBLIC   CODE   PROC     0006H  -----
  pstDataFreq. . . . . . . . . . . . .  AUTO     DATA   PTR      0000H  3
  pbyData. . . . . . . . . . . . . . .  AUTO     DATA   PTR      0003H  3
  uiLen. . . . . . . . . . . . . . . .  AUTO     DATA   U_INT    0006H  2
  byCrc. . . . . . . . . . . . . . . .  * REG *  DATA   U_CHAR   0007H  1
UART0. . . . . . . . . . . . . . . . .  PUBLIC   CODE   PROC     0000H  -----
  byTemp . . . . . . . . . . . . . . .  * REG *  DATA   U_CHAR   0007H  1
pSTLocalControl. . . . . . . . . . . .  TYPEDEF  -----  PTR      -----  3
_Bus0OutputData. . . . . . . . . . . .  EXTERN   CODE   PROC     -----  -----
RXD. . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      00B0H  1
TXD. . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      00B1H  1
byUsartState . . . . . . . . . . . . .  PUBLIC   DATA   U_CHAR   0000H  1
uint8. . . . . . . . . . . . . . . . .  TYPEDEF  -----  U_CHAR   -----  1
PSW. . . . . . . . . . . . . . . . . .  SFR      DATA   U_CHAR   00D0H  1
STLocalControl . . . . . . . . . . . .  TYPEDEF  -----  STRUCT   -----  61
  byLedState . . . . . . . . . . . . .  MEMBER   -----  U_CHAR   0000H  1
  byLedFlashTime . . . . . . . . . . .  MEMBER   -----  U_CHAR   0001H  1
  byLedTimeSet . . . . . . . . . . . .  MEMBER   -----  U_CHAR   0002H  1
  uiNurseInTime. . . . . . . . . . . .  MEMBER   -----  U_INT    0003H  2
  uiShortType. . . . . . . . . . . . .  MEMBER   -----  U_INT    0005H  2
C51 COMPILER V8.08   UART                                                                  01/26/2011 09:34:32 PAGE 75  

NAME                                    CLASS   MSPACE  TYPE    OFFSET  SIZE
====                                    =====   ======  ====    ======  ====


  byChar1. . . . . . . . . . . . . . .  MEMBER   -----  U_CHAR   0007H  1
  pbyData. . . . . . . . . . . . . . .  MEMBER   -----  PTR      0008H  2
  stBusDealFreq. . . . . . . . . . . .  MEMBER   -----  STRUCT   000AH  7
  stCH0TimerOut. . . . . . . . . . . .  MEMBER   -----  STRUCT   0011H  3
  stCH1Timerout. . . . . . . . . . . .  MEMBER   -----  STRUCT   0014H  3
  stIndicationData . . . . . . . . . .  MEMBER   -----  STRUCT   0017H  4
  stCallAddr . . . . . . . . . . . . .  MEMBER   -----  STRUCT   001BH  3
  stEepromCfgData. . . . . . . . . . .  MEMBER   -----  STRUCT   001EH  31


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   1487    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =    205    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      1      37
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
