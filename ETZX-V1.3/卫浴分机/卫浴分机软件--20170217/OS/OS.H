/*********************************************************************************************************
**				                               Small RTOS(51)
**                                   The Real-Time Kernel(For Keil c51)
**
**                                  (c) Copyright 2002-2003, chenmingji
**                                           All Rights Reserved
**
**                                                  V1.20.0
**
**
**--------------文件信息--------------------------------------------------------------------------------
**文   件   名: OS.h
**创   建   人: 陈明计
**最后修改日期:  2003年8月17日
**描　     述: Small RTOS(51) C语言头文件,定义一些宏和声明一些函数和变量
**
**--------------历史版本信息----------------------------------------------------------------------------
** 创建人: 陈明计
** 版  本: V0.50~V1.00
** 日　期: 2002年2月22日~2002年6月20日
** 描　述: 基本完成Small RTOS核
**
**------------------------------------------------------------------------------------------------------
** 修改人: 陈明计
** 版  本: V1.10~V1.21
** 日　期: 2002年9月1日~2003年1月23日
** 描　述: 完善Small RTOS
**
**------------------------------------------------------------------------------------------------------
** 修改人: 陈明计
** 版  本: V1.20.0
** 日　期: 2003年8月17日
** 描　述: 增加支持任务动态建立和删除，函数功能向一般的RTOS靠齐
**--------------当前版本修订------------------------------------------------------------------------------
** 修改人: 
** 日　期:
** 描　述:
**
**------------------------------------------------------------------------------------------------------
********************************************************************************************************/

#define  OS_VERSION    120                              /* 系统版本号                                   */

#define  OSVersion()     OS_VERSION                     /* 返回系统版本                                 */
#define  OSRunningTaskID() OSTaskID                     /* 返回当前任务ID                               */ 

#define K_SIG      1                                    /* 等待信号                                     */
#define K_TMO      2                                    /* 等待超时                                     */

#define NOT_OK     255                                  /* 参数错误                                     */
#define TMO_EVENT  8                                    /* 超时到                                       */
#define SIG_EVENT  4                                    /* 有信号                                       */

 
#ifndef IN_OS_CORE

/* 兼容V1.21.1版本的宏 */
#define OSSendSignal(a)     OSTaskResume((a))
#define OSIntSendSignal(a)  OSTaskResume((a))
#define OSClearSignal(a)    OS_TaskSuspend((a))
#define OSTaskCreate(a, b, c) _OSTaskCreate((c),(a),(b))


extern uint8 data OSWaitTick[];
extern uint8 code OSMapTbl[];
extern uint8 data Os_Enter_Sum;
extern uint8 data OSTaskID;
extern uint8 data OSNextTaskID;
extern uint8 data OSIntNesting;


extern void OSInit(void) small;
/*********************************************************************************************************
** 函数名称: OSInit
** 功能描述: 系统变量初始化
** 输　入: 无
** 输　出: 无
** 全局变量: 
** 调用模块: OSCPUInit
********************************************************************************************************/

extern void OSStart(void);
/*********************************************************************************************************
** 函数名称: OSStart
** 功能描述: 启动多任务环境
** 输　入: 无
** 输　出 : 无
** 全局变量: 无
** 调用模块: OSFindNextRunningTask,OSStartHighRdy
********************************************************************************************************/

extern uint8 _OSTaskCreate(uint8 TaskID, void (code * task)(void), void xdata *ptos) small;
/*********************************************************************************************************
** 函数名称: _OSTaskCreate
** 功能描述: 创建任务
** 输　入: TaskID:任务ID
**         task  :任务地址
**         ptos  :任务堆栈，在51中为重入栈
** 输　出: 无
** 全局变量: 
** 调用模块: 无
********************************************************************************************************/

extern uint8 OSTaskDel(uint8 TaskID) small;
/*********************************************************************************************************
** 函数名称: OSTaskDel
** 功能描述: 创建任务
** 输　入: TaskID:任务ID
** 输　出: 无
** 全局变量: 
** 调用模块: 无
********************************************************************************************************/
       
extern void OSTaskResume(uint8 TaskID) small;
/*********************************************************************************************************
** 函数名称: OSTaskResume
** 功能描述: 中恢复任务
** 输　入: TaskID : 任务ID
** 输　出: 无
** 全局变量: 无
** 调用模块: OSSched
********************************************************************************************************/

extern void OS_TaskSuspend(uint8 TaskID)    small;
/*********************************************************************************************************
** 函数名称: OS_TaskSuspend
** 功能描述: 使指定任务休眠，但不进行任务切换
** 输　入: TaskID : 任务ID
** 输　出: 无
** 全局变量: OSWaitTick
** 调用模块: 无
**
** 作　者: 陈明计
** 日　期: 2002年6月20日
**-------------------------------------------------------------------------------------------------------
** 修改人:
** 日　期:
**-------------------------------------------------------------------------------------------------------
********************************************************************************************************/

extern void OSTaskSuspend(uint8 TaskID)    small;
/*********************************************************************************************************
** 函数名称: OSTaskSuspend
** 功能描述: 使指定任务休眠
** 输　入: TaskID : 任务ID
** 输　出: 无
** 全局变量: 五
** 调用模块: OS_TaskSuspend
**
** 作　者: 陈明计
** 日　期: 2002年6月20日
**-------------------------------------------------------------------------------------------------------
** 修改人:
** 日　期:
**-------------------------------------------------------------------------------------------------------
********************************************************************************************************/

extern void OSTimeDly(uint8 ticks)     small;
/*********************************************************************************************************
** 函数名称: OSTimeDly
** 功能描述: 系统等待函数,任务调用此函数可以等待一定时间
** 输　入:  ticks : 等待超时时的系统嘀嗒数
** 输　出 : 无
**
** 全局变量: OSWaitTick
** 调用模块: OSIntTaskResume,OSSched
********************************************************************************************************/

extern void OSTimeDlyResume(uint8 TaskID)    small;
/*********************************************************************************************************
** 函数名称: OSTimeDlyResume
** 功能描述: 让处在延时期的任务结束延时
** 输　入:  TaskID : 任务ID
** 输　出 : 无
** 全局变量: OSWaitTick
** 调用模块: OSTaskResume
********************************************************************************************************/

extern void  OSTimeTick (void)  small;
/*********************************************************************************************************
** 函数名称: OSTimeTick
** 功能描述: 系统时钟处理函数,处理各个任务的延时
** 输　入: 无
** 输　出: 无
** 全局变量: OSWaitTick
** 调用模块: OSIntSendSignal
********************************************************************************************************/

extern uint8 OSWait (uint8 typ, uint8 ticks)    small;
/*********************************************************************************************************
** 函数名称: OSWait
** 功能描述: 系统等待函数,任务调用此函数可以等待一定时间或信号
** 输　入: typ: 等待事件类型,目前可以取以下值,或是其中任意个值的按位或
**             K_SIG: 等待信号
**             K_TMO: 等待超时
**        ticks : 等待超时时的系统嘀嗒数
** 输　出 : NOT_OK : 参数错误
**         TMO_EVENT : 超时到
**         SIG_EVENT : 有信号
** 全局变量: OSWaitTick
** 调用模块: OSTaskSuspend,OSTimeDly,OS_ENTER_CRITICAL,OS_EXIT_CRITICAL
********************************************************************************************************/

extern uint8 OSIntExit (void)    small;
/*********************************************************************************************************
** 函数名称: OSIntExit
** 功能描述: 中断退出处理函数,在此进行中断后的任务切换
** 输　入: 无
** 输　出: 0:无需任务切换
**         1:需要任务切换
** 全局变量: OSIntNesting,OSNextTaskID
** 调用模块: OSIntCtxSw
********************************************************************************************************/

extern void OSSched (void)  small;
/*********************************************************************************************************
** 函数名称: OSSched
** 功能描述: 非中断的任务切换函数
** 输　入: 无
** 输　出: 无
** 全局变量: OSIntNesting,OSNextTaskID
** 调用模块: OS_TASK_SW
********************************************************************************************************/

extern void OSFindNextRunningTask(void) small;
/*********************************************************************************************************
** 函数名称: OSFindNextRunningTask
** 功能描述: 查找下一个优先级最高的就绪任务
** 输　入: 无
** 输　出: OSNextTaskID:存储查找结果
** 全局变量: OSTaskRuning,OSTaskCreated
** 调用模块: 无
**
** 作　者: 陈明计
** 日　期: 2002年6月20日
**-------------------------------------------------------------------------------------------------------
** 修改人:
** 日　期:
**-------------------------------------------------------------------------------------------------------
********************************************************************************************************/
#endif

/*********************************************************************************************************
**                            End Of File
********************************************************************************************************/
