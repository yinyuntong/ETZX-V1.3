C51 COMPILER V8.08   SINGLEBUS                                                             02/22/2013 13:09:18 PAGE 1   


C51 COMPILER V8.08, COMPILATION OF MODULE SINGLEBUS
OBJECT MODULE PLACED IN SingleBus.OBJ
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE SingleBus.c LARGE BROWSE DEBUG OBJECTEXTEND CODE LISTINCLUDE SYMBOLS

line level    source

   1          /*
   2          ************************Copyright(c)************************
   3          *                                  ºþÄÏÎõÍú´ï¿Æ¼¼ÓÐÏÞ¹«Ë¾
   4          *                               All Rights Reserved
   5          *                                        
   6          *
   7          *-----------------------ÎÄ¼þÐÅÏ¢---------------------------
   8          *ÎÄ¼þÃû³Æ               :SingleBus.c
   9          *ÎÄ¼þÃèÊö               :µ¥×ÜÏß³ÌÐò
  10          *´´½¨ÈË                 :³ÂÎÀ¹ú
  11          *´´½¨ÈÕÆÚ               :2008-9-22
  12          *°æ±¾ºÅ                 :V1.0
  13          *×¢ÊÍ                   :                                       
  14          *----------------------------------------------------------
  15          *ÐÞ¸ÄÈË                         :
  16          *ÐÞ¸ÄÈÕÆÚ                       :
  17          *°æ±¾ºÅ                 :
  18          *×¢ÊÍ                   :
  19          ***********************************************************
  20          */
  21          #define _IN_SINGLE_BUS_
  22          #include "config.h"
   1      =1  /*
   2      =1  ************************Copyright(c)************************
   3      =1  *                                  ºþÄÏÎõÍú´ï¿Æ¼¼ÓÐÏÞ¹«Ë¾
   4      =1  *                               All Rights Reserved
   5      =1  *                                        
   6      =1  *
   7      =1  *-----------------------ÎÄ¼þÐÅÏ¢---------------------------
   8      =1  *ÎÄ¼þÃû³Æ               :config.h
   9      =1  *ÎÄ¼þÃèÊö               :ÅäÖÃÍ·ÎÄ¼þ
  10      =1  *´´½¨ÈË                 :³ÂÎÀ¹ú
  11      =1  *´´½¨ÈÕÆÚ               :2008-9-22
  12      =1  *°æ±¾ºÅ                 :V1.0
  13      =1  *×¢ÊÍ                   :                                       
  14      =1  *----------------------------------------------------------
  15      =1  *ÐÞ¸ÄÈË                         :
  16      =1  *ÐÞ¸ÄÈÕÆÚ                       :
  17      =1  *°æ±¾ºÅ                 :
  18      =1  *×¢ÊÍ                   :
  19      =1  ***********************************************************
  20      =1  */
  21      =1  //ÏµÍ³Í·ÎÄ¼þ
  22      =1  #pragma REGPARMS          
  23      =1  #include <intrins.h>
   1      =2  /*--------------------------------------------------------------------------
   2      =2  INTRINS.H
   3      =2  
   4      =2  Intrinsic functions for C51.
   5      =2  Copyright (c) 1988-2004 Keil Elektronik GmbH and Keil Software, Inc.
   6      =2  All rights reserved.
   7      =2  --------------------------------------------------------------------------*/
   8      =2  
   9      =2  #ifndef __INTRINS_H__
  10      =2  #define __INTRINS_H__
C51 COMPILER V8.08   SINGLEBUS                                                             02/22/2013 13:09:18 PAGE 2   

  11      =2  
  12      =2  extern void          _nop_     (void);
  13      =2  extern bit           _testbit_ (bit);
  14      =2  extern unsigned char _cror_    (unsigned char, unsigned char);
  15      =2  extern unsigned int  _iror_    (unsigned int,  unsigned char);
  16      =2  extern unsigned long _lror_    (unsigned long, unsigned char);
  17      =2  extern unsigned char _crol_    (unsigned char, unsigned char);
  18      =2  extern unsigned int  _irol_    (unsigned int,  unsigned char);
  19      =2  extern unsigned long _lrol_    (unsigned long, unsigned char);
  20      =2  extern unsigned char _chkfloat_(float);
  21      =2  extern void          _push_    (unsigned char _sfr);
  22      =2  extern void          _pop_     (unsigned char _sfr);
  23      =2  
  24      =2  #endif
  25      =2  
  24      =1  #include <absacc.h>
   1      =2  /*--------------------------------------------------------------------------
   2      =2  ABSACC.H
   3      =2  
   4      =2  Direct access to 8051, extended 8051 and Philips 80C51MX memory areas.
   5      =2  Copyright (c) 1988-2002 Keil Elektronik GmbH and Keil Software, Inc.
   6      =2  All rights reserved.
   7      =2  --------------------------------------------------------------------------*/
   8      =2  
   9      =2  #ifndef __ABSACC_H__
  10      =2  #define __ABSACC_H__
  11      =2  
  12      =2  #define CBYTE ((unsigned char volatile code  *) 0)
  13      =2  #define DBYTE ((unsigned char volatile data  *) 0)
  14      =2  #define PBYTE ((unsigned char volatile pdata *) 0)
  15      =2  #define XBYTE ((unsigned char volatile xdata *) 0)
  16      =2  
  17      =2  #define CWORD ((unsigned int volatile code  *) 0)
  18      =2  #define DWORD ((unsigned int volatile data  *) 0)
  19      =2  #define PWORD ((unsigned int volatile pdata *) 0)
  20      =2  #define XWORD ((unsigned int volatile xdata *) 0)
  21      =2  
  22      =2  
  23      =2  #ifdef __CX51__
           =2 #define FVAR(object, addr)   (*((object volatile far *) (addr)))
           =2 #define FARRAY(object, base) ((object volatile far *) (base))
           =2 #define FCVAR(object, addr)   (*((object const far *) (addr)))
           =2 #define FCARRAY(object, base) ((object const far *) (base))
           =2 #else
  29      =2  #define FVAR(object, addr)    (*((object volatile far *) ((addr)+0x10000L)))
  30      =2  #define FCVAR(object, addr)   (*((object const far *) ((addr)+0x810000L)))
  31      =2  #define FARRAY(object, base)  ((object volatile far *) ((base)+0x10000L))
  32      =2  #define FCARRAY(object, base) ((object const far *) ((base)+0x810000L))
  33      =2  #endif
  34      =2  
  35      =2  #endif
  25      =1  #include <stdio.h>
   1      =2  /*--------------------------------------------------------------------------
   2      =2  STDIO.H
   3      =2  
   4      =2  Prototypes for standard I/O functions.
   5      =2  Copyright (c) 1988-2002 Keil Elektronik GmbH and Keil Software, Inc.
   6      =2  All rights reserved.
   7      =2  --------------------------------------------------------------------------*/
   8      =2  
   9      =2  #ifndef __STDIO_H__
  10      =2  #define __STDIO_H__
C51 COMPILER V8.08   SINGLEBUS                                                             02/22/2013 13:09:18 PAGE 3   

  11      =2  
  12      =2  #ifndef EOF
  13      =2   #define EOF -1
  14      =2  #endif
  15      =2  
  16      =2  #ifndef NULL
  17      =2   #define NULL ((void *) 0)
  18      =2  #endif
  19      =2  
  20      =2  #ifndef _SIZE_T
  21      =2   #define _SIZE_T
  22      =2   typedef unsigned int size_t;
  23      =2  #endif
  24      =2  
  25      =2  #pragma SAVE
  26      =2  #pragma REGPARMS
  27      =2  extern char _getkey (void);
  28      =2  extern char getchar (void);
  29      =2  extern char ungetchar (char);
  30      =2  extern char putchar (char);
  31      =2  extern int printf   (const char *, ...);
  32      =2  extern int sprintf  (char *, const char *, ...);
  33      =2  extern int vprintf  (const char *, char *);
  34      =2  extern int vsprintf (char *, const char *, char *);
  35      =2  extern char *gets (char *, int n);
  36      =2  extern int scanf (const char *, ...);
  37      =2  extern int sscanf (char *, const char *, ...);
  38      =2  extern int puts (const char *);
  39      =2  
  40      =2  #pragma RESTORE
  41      =2  
  42      =2  #endif
  43      =2  
  26      =1  #include <string.h>
   1      =2  /*--------------------------------------------------------------------------
   2      =2  STRING.H
   3      =2  
   4      =2  String functions.
   5      =2  Copyright (c) 1988-2002 Keil Elektronik GmbH and Keil Software, Inc.
   6      =2  All rights reserved.
   7      =2  --------------------------------------------------------------------------*/
   8      =2  
   9      =2  #ifndef __STRING_H__
  10      =2  #define __STRING_H__
  11      =2  
  12      =2  #ifndef _SIZE_T
           =2  #define _SIZE_T
           =2  typedef unsigned int size_t;
           =2 #endif
  16      =2  
  17      =2  #ifndef NULL
           =2  #define NULL ((void *) 0L)
           =2 #endif
  20      =2  
  21      =2  #pragma SAVE
  22      =2  #pragma REGPARMS
  23      =2  extern char *strcat (char *s1, char *s2);
  24      =2  extern char *strncat (char *s1, char *s2, int n);
  25      =2  
  26      =2  extern char strcmp (char *s1, char *s2);
  27      =2  extern char strncmp (char *s1, char *s2, int n);
  28      =2  
C51 COMPILER V8.08   SINGLEBUS                                                             02/22/2013 13:09:18 PAGE 4   

  29      =2  extern char *strcpy (char *s1, char *s2);
  30      =2  extern char *strncpy (char *s1, char *s2, int n);
  31      =2  
  32      =2  extern int strlen (char *);
  33      =2  
  34      =2  extern char *strchr (const char *s, char c);
  35      =2  extern int strpos (const char *s, char c);
  36      =2  extern char *strrchr (const char *s, char c);
  37      =2  extern int strrpos (const char *s, char c);
  38      =2  
  39      =2  extern int strspn (char *s, char *set);
  40      =2  extern int strcspn (char *s, char *set);
  41      =2  extern char *strpbrk (char *s, char *set);
  42      =2  extern char *strrpbrk (char *s, char *set);
  43      =2  extern char *strstr  (char *s, char *sub);
  44      =2  extern char *strtok  (char *str, const char *set);
  45      =2  
  46      =2  extern char memcmp (void *s1, void *s2, int n);
  47      =2  extern void *memcpy (void *s1, void *s2, int n);
  48      =2  extern void *memchr (void *s, char val, int n);
  49      =2  extern void *memccpy (void *s1, void *s2, char val, int n);
  50      =2  extern void *memmove (void *s1, void *s2, int n);
  51      =2  extern void *memset  (void *s, char val, int n);
  52      =2  #pragma RESTORE
  53      =2  
  54      =2  #endif
  27      =1  #include <math.h> 
   1      =2  /*--------------------------------------------------------------------------
   2      =2  MATH.H
   3      =2  
   4      =2  Prototypes for mathematic functions.
   5      =2  Copyright (c) 1988-2002 Keil Elektronik GmbH and Keil Software, Inc.
   6      =2  All rights reserved.
   7      =2  --------------------------------------------------------------------------*/
   8      =2  
   9      =2  #ifndef __MATH_H__
  10      =2  #define __MATH_H__
  11      =2  
  12      =2  #pragma SAVE
  13      =2  #pragma REGPARMS
  14      =2  extern char  cabs  (char  val);
  15      =2  extern int    abs  (int   val);
  16      =2  extern long  labs  (long  val);
  17      =2  extern float fabs  (float val);
  18      =2  extern float sqrt  (float val);
  19      =2  extern float exp   (float val);
  20      =2  extern float log   (float val);
  21      =2  extern float log10 (float val);
  22      =2  extern float sin   (float val);
  23      =2  extern float cos   (float val);
  24      =2  extern float tan   (float val);
  25      =2  extern float asin  (float val);
  26      =2  extern float acos  (float val);
  27      =2  extern float atan  (float val);
  28      =2  extern float sinh  (float val);
  29      =2  extern float cosh  (float val);
  30      =2  extern float tanh  (float val);
  31      =2  extern float atan2 (float y, float x);
  32      =2  
  33      =2  extern float ceil  (float val);
  34      =2  extern float floor (float val);
  35      =2  extern float modf  (float val, float *n);
C51 COMPILER V8.08   SINGLEBUS                                                             02/22/2013 13:09:18 PAGE 5   

  36      =2  extern float fmod  (float x, float y);
  37      =2  extern float pow   (float x, float y);
  38      =2  
  39      =2  #pragma RESTORE
  40      =2  
  41      =2  #endif
  28      =1  #include "STC12C56.H"
   1      =2  /*------------------------------------------------*/
   2      =2  /* --- ºê¾§¿Æ¼¼ STCMCU ---------------------------*/
   3      =2  /* --- Mobile: (86)13922805190 -------------------*/
   4      =2  /* --- Fax: 86-755-82944243 ----------------------*/
   5      =2  /* --- Tel: 86-755-82948412 ----------------------*/
   6      =2  /* --- Web: www.STCMCU.com -----------------------*/
   7      =2  /* ÊÊÓÃÓÚ: STC12C56xx    STC12LE56xx  ------------*/
   8      =2  /* ------- STC12C56xxAD  STC12LE56xxAD  ----------*/
   9      =2  /*------------------------------------------------*/
  10      =2  
  11      =2  #ifndef __STC12C56_H__
  12      =2  #define __STC12C56_H__
  13      =2  
  14      =2  //////////////////////////////////////////////////////////////////////////////////////////////////////////
             -//////
  15      =2  
  16      =2  sfr  PSW        =   0xd0;       //³ÌÐò×´Ì¬×Ö            Bit7    Bit6    Bit5    Bit4    Bit3    Bit2    Bi
             -t1    Bit0
  17      =2                                  //Î»ÃèÊö                CY      AC      F0      RS1     RS0     OV      F1
             -      P
  18      =2                                  //³õÊ¼Öµ=0000,0000      0       0       0       0       0       0       0 
             -      0
  19      =2  
  20      =2  sbit CY         =   PSW^7;      //½øÎ»±êÖ¾
  21      =2  sbit AC         =   PSW^6;      //¸¨Öú½øÎ»±êÖ¾
  22      =2  sbit F0         =   PSW^5;      //ÓÃ»§±êÖ¾
  23      =2  sbit RS1        =   PSW^4;      //¼Ä´æÆ÷×éÑ¡ÔñÎ»1
  24      =2  sbit RS0        =   PSW^3;      //¼Ä´æÆ÷×éÑ¡ÔñÎ»0
  25      =2  sbit OV         =   PSW^2;      //Òç³ö±êÖ¾
  26      =2  sbit P          =   PSW^0;      //ACCµÄÅ¼Ð£ÑéÎ»
  27      =2  
  28      =2  /////////////////////////////////
  29      =2  
  30      =2  sfr  ACC        =   0xe0;       //ÀÛ¼ÓÆ÷                Bit7    Bit6    Bit5    Bit4    Bit3    Bit2    Bi
             -t1    Bit0
  31      =2                                  //³õÊ¼Öµ=0000,0000      0       0       0       0       0       0       0 
             -      0
  32      =2  
  33      =2  sbit ACC7       =   ACC^7;      //ÀÛ¼ÓÆ÷µÚ7Î»
  34      =2  sbit ACC6       =   ACC^6;      //ÀÛ¼ÓÆ÷µÚ6Î»
  35      =2  sbit ACC5       =   ACC^5;      //ÀÛ¼ÓÆ÷µÚ5Î»
  36      =2  sbit ACC4       =   ACC^4;      //ÀÛ¼ÓÆ÷µÚ4Î»
  37      =2  sbit ACC3       =   ACC^3;      //ÀÛ¼ÓÆ÷µÚ3Î»
  38      =2  sbit ACC2       =   ACC^2;      //ÀÛ¼ÓÆ÷µÚ2Î»
  39      =2  sbit ACC1       =   ACC^1;      //ÀÛ¼ÓÆ÷µÚ1Î»
  40      =2  sbit ACC0       =   ACC^0;      //ÀÛ¼ÓÆ÷µÚ0Î»
  41      =2  
  42      =2  /////////////////////////////////
  43      =2  
  44      =2  sfr  B          =   0xf0;       //B¼Ä´æÆ÷               Bit7    Bit6    Bit5    Bit4    Bit3    Bit2    Bi
             -t1    Bit0
  45      =2                                  //³õÊ¼Öµ=0000,0000      0       0       0       0       0       0       0 
             -      0
  46      =2  
  47      =2  /////////////////////////////////
C51 COMPILER V8.08   SINGLEBUS                                                             02/22/2013 13:09:18 PAGE 6   

  48      =2  
  49      =2  sfr  SP         =   0x81;       //¶ÑÕ»Ö¸Õë              Bit7    Bit6    Bit5    Bit4    Bit3    Bit2    Bi
             -t1    Bit0
  50      =2                                  //³õÊ¼Öµ=0000,0111      0       0       0       0       0       1       1 
             -      1
  51      =2  
  52      =2  /////////////////////////////////
  53      =2  
  54      =2  sfr  DPL        =   0x82;       //Êý¾ÝÖ¸ÕëµÍ×Ö½Ú        Bit7    Bit6    Bit5    Bit4    Bit3    Bit2    Bi
             -t1    Bit0
  55      =2                                  //³õÊ¼Öµ=0000,0000      0       0       0       0       0       0       0 
             -      0
  56      =2  
  57      =2  /////////////////////////////////
  58      =2  
  59      =2  sfr  DPH        =   0x83;       //Êý¾ÝÖ¸Õë¸ß×Ö½Ú        Bit7    Bit6    Bit5    Bit4    Bit3    Bit2    Bi
             -t1    Bit0
  60      =2                                  //³õÊ¼Öµ=0000,0000      0       0       0       0       0       0       0 
             -      0
  61      =2  
  62      =2  //////////////////////////////////////////////////////////////////////////////////////////////////////////
             -//////
  63      =2  
  64      =2  sfr  PCON       =   0x87;       //µçÔ´¿ØÖÆ¼Ä´æÆ÷        Bit7    Bit6    Bit5    Bit4    Bit3    Bit2    Bi
             -t1    Bit0
  65      =2                                  //Î»ÃèÊö                SMOD    SMOD0   LVDF    POF     GF1     GF0     PD
             -      IDL
  66      =2                                  //³õÊ¼Öµ=0011,0000      0       0       1       1       0       0       0 
             -      0
  67      =2  
  68      =2  #define SMOD        0x80        //´®¿Ú²¨ÌØÂÊ±¶ËÙÎ»,ÖÃ1¿ÉÊ¹²¨ÌØÂÊ¿ì1±¶
  69      =2  #define SMOD0       0x40        //FE/SM0Ñ¡ÔñÎ»,0:SCON.7ÎªSM0 1:SCON.7ÎªFE
  70      =2  #define LVDF        0x20        //µÍÑ¹¼ì²âÖÐ¶ÏÇëÇóÎ»,ÓÉÓ²¼þÖÃ1,ÐèÓÉÈí¼þÇå0
  71      =2  #define POF         0x10        //ÉÏµç¸´Î»±êÖ¾Î»,ÉÏµçÊ±ÓÉÓ²¼þÖÃ1,ÐèÓÉÈí¼þÇå0
  72      =2  #define GF1         0x08        //Í¨ÓÃ±êÖ¾Î»1
  73      =2  #define GF0         0x04        //Í¨ÓÃ±êÖ¾Î»0
  74      =2  #define PD          0x02        //µôµç¿ØÖÆÎ»,Ð´1¿ÉÒÔÊ¹MCU½øÈëPowerDownÄ£Ê½
  75      =2  #define IDL         0x01        //¿ÕÏÐ¿ØÖÆÎ»,Ð´1¿ÉÒÔÊ¹MCU½øÈëIdleÄ£Ê½
  76      =2  
  77      =2  /////////////////////////////////
  78      =2  
  79      =2  sfr  WAKE_CLKO  =   0x8f;       //µôµç»½ÐÑ/Ê±ÖÓÊä³ö¿ØÖÆ Bit7    Bit6    Bit5    Bit4    Bit3    Bit2    Bi
             -t1    Bit0
  80      =2                                  //Î»ÃèÊö          PCAWAKEUP RXDPINIE T1PINIE T0PINIE    -       -      T1V
             -LKO  T0CLKO
  81      =2                                  //³õÊ¼Öµ=0000,xx00      0       0       0       0       x       x       0 
             -      0
  82      =2  
  83      =2  #define PCAWAKEUP   0x80        //ÔÊÐíPCAµÄÉÏÉýÑØ/ÏÂ½µÑØÖÐ¶Ï»½ÐÑµôµçMCU
  84      =2  #define RXD_PIN_IE  0x40        //ÔÊÐíRXD(P3.0)ÏÂ½µÑØÖÃÎ»RIÖÐ¶ÏÊ±»½ÐÑµôµçMCU(±ØÐë´ò¿ªÏàÓ¦ÖÐ¶Ï)
  85      =2  #define T1_PIN_IE   0x20        //ÔÊÐíT1(P3.5)ÏÂ½µÑØÖÃÎ»T1ÖÐ¶ÏÊ±»½ÐÑµôµçMCU(±ØÐë´ò¿ªÏàÓ¦ÖÐ¶Ï)
  86      =2  #define T0_PIN_IE   0x10        //ÔÊÐíT0(P3.4)ÏÂ½µÑØÖÃÎ»T0ÖÐ¶ÏÊ±»½ÐÑµôµçMCU(±ØÐë´ò¿ªÏàÓ¦ÖÐ¶Ï)
  87      =2  #define T1CLKOEN    0x02        //´ò¿ªP3.5½ÅµÄ¶¨Ê±Æ÷1Ê±ÖÓÒç³öÂö³å,Êä³öµÄÊ±ÖÓÆµÂÊÎª1/2±¶µÄT1Òç³öÂÊ
  88      =2  #define T0CLKOEN    0x01        //´ò¿ªP3.4½ÅµÄ¶¨Ê±Æ÷0Ê±ÖÓÒç³öÂö³å,Êä³öµÄÊ±ÖÓÆµÂÊÎª1/2±¶µÄT0Òç³öÂÊ
  89      =2  
  90      =2  /////////////////////////////////
  91      =2  
  92      =2  sfr  CLK_DIV    =   0xc7;       //Ê±ÖÓ·ÖÆµ¼Ä´æÆ÷        Bit7    Bit6    Bit5    Bit4    Bit3    Bit2    Bi
             -t1    Bit0
  93      =2                                  //Î»ÃèÊö                -       -       -       -       -       CLKS2   CL
             -KS1   CLKS0
  94      =2                                  //³õÊ¼Öµ=xxxx,x000      x       x       x       x       x       0       0 
C51 COMPILER V8.08   SINGLEBUS                                                             02/22/2013 13:09:18 PAGE 7   

             -      0
  95      =2  
  96      =2  #define FOSCD1      0x00        //ÏµÍ³Ê±ÖÓÎªFosc
  97      =2  #define FOSCD2      0x01        //ÏµÍ³Ê±ÖÓÎªFosc/2
  98      =2  #define FOSCD4      0x02        //ÏµÍ³Ê±ÖÓÎªFosc/4
  99      =2  #define FOSCD8      0x03        //ÏµÍ³Ê±ÖÓÎªFosc/8
 100      =2  #define FOSCD16     0x04        //ÏµÍ³Ê±ÖÓÎªFosc/16
 101      =2  #define FOSCD32     0x05        //ÏµÍ³Ê±ÖÓÎªFosc/32
 102      =2  #define FOSCD64     0x06        //ÏµÍ³Ê±ÖÓÎªFosc/64
 103      =2  #define FOSCD128    0x07        //ÏµÍ³Ê±ÖÓÎªFosc/128
 104      =2  
 105      =2  /////////////////////////////////
 106      =2  
 107      =2  sfr  WDT_CONTR  =   0xe1;       //¿´ÃÅ¹·¶¨Ê±Æ÷¿ØÖÆÆ÷    Bit7    Bit6    Bit5    Bit4    Bit3    Bit2    Bi
             -t1    Bit0
 108      =2                                  //Î»ÃèÊö             WDT_FLAG   -       EN_WDT  CLR_WDT IDL_WDT PS2     PS
             -1     PS0
 109      =2                                  //³õÊ¼Öµ=0x00,0000      0       x       0       0       0       0       0 
             -      0
 110      =2  
 111      =2  #define WDT_FLAG    0x80        //¿´ÃÅ¹·¸´Î»±êÖ¾,µ±¿´ÃÅ¹·Òç³ö²úÉú¸´Î»ºó,Ó²¼þ×Ô¶¯ÖÃ1,ÐèÒªÓÉÈí¼þÇå0
 112      =2  #define EN_WDT      0x20        //Èí¼þÊ¹ÄÜ¿´ÃÅ¹·,´ò¿ªºó²»ÄÜÓÃÈí¼þµÄ·½Ê½¹Ø±Õ
 113      =2  #define CLR_WDT     0x10        //Çå¿´ÃÅ¹·¶¨Ê±Æ÷
 114      =2  #define IDLE_WDT    0x08        //IDLEÄ£Ê½ÏÂ,¿´ÃÅ¹·¶¨Ê±Æ÷ÊÇ·ñ¼ÌÐø¼ÆÊ±
 115      =2  
 116      =2  //////////////////////////////////////////////////////////////////////////////////////////////////////////
             -//////
 117      =2  
 118      =2  sfr  AUXR       =   0x8e;       //¸¨Öú¼Ä´æÆ÷            Bit7    Bit6    Bit5    Bit4    Bit3    Bit2    Bi
             -t1    Bit0
 119      =2                                  //Î»ÃèÊö                T0x12   T1x12   UM0x6   EADCI   ESPI    ELVDI   - 
             -      -
 120      =2                                  //³õÊ¼Öµ=0000,00xx      0       0       0       0       0       0       x 
             -      x
 121      =2  
 122      =2  #define T0x12       0x80        //¶¨Ê±Æ÷0Ê±ÖÓ¿ØÖÆ,0:Fosc/12(´«Í³µÄ12·ÖÆµ) 1:Fosc/1(1TÄ£Ê½,²»·ÖÆµ,¼´12±¶ÓÚ´
             -«Í³ËÙ¶È)
 123      =2  #define T1x12       0x40        //¶¨Ê±Æ÷1Ê±ÖÓ¿ØÖÆ,0:Fosc/12(´«Í³µÄ12·ÖÆµ) 1:Fosc/1(1TÄ£Ê½,²»·ÖÆµ,¼´12±¶ÓÚ´
             -«Í³ËÙ¶È)
 124      =2  #define UR0x6       0x20        //´®¿ÚÄ£Ê½0µÄÊ±ÖÓ¿ØÖÆ,0:Fosc/12(´«Í³µÄ12·ÖÆµ) 1:Fosc/2(2·ÖÆµ,,¼´6±¶ÓÚ´«Í³Ë
             -Ù¶È)
 125      =2  #define EADCI       0x10        //Ê¹ÄÜADCÖÐ¶ÏÎ»
 126      =2  #define ESPI        0x08        //Ê¹ÄÜSPIÖÐ¶ÏÎ»
 127      =2  #define ELVDI       0x04        //Ê¹ÄÜLVDÖÐ¶ÏÎ»
 128      =2  
 129      =2  //////////////////////////////////////////////////////////////////////////////////////////////////////////
             -//////
 130      =2  
 131      =2  sfr  P0         =   0x80;       //I/O¶Ë¿Ú0              Bit7    Bit6    Bit5    Bit4    Bit3    Bit2    Bi
             -t1    Bit0
 132      =2                                  //Î»ÃèÊö                -       -       -       -       P0.3    P0.2    P0
             -.1    P0.0
 133      =2                                  //³õÊ¼Öµ=xxxx,1111      x       x       x       x       1       1       1 
             -      1
 134      =2  
 135      =2  sbit P03        =   P0^3;       //I/O¿ÚP0.3
 136      =2  sbit P02        =   P0^2;       //I/O¿ÚP0.2
 137      =2  sbit P01        =   P0^1;       //I/O¿ÚP0.1
 138      =2  sbit P00        =   P0^0;       //I/O¿ÚP0.0
 139      =2  
 140      =2  /////////////////////////////////
 141      =2  
C51 COMPILER V8.08   SINGLEBUS                                                             02/22/2013 13:09:18 PAGE 8   

 142      =2  sfr  P1         =   0x90;       //I/O¶Ë¿Ú0              Bit7    Bit6    Bit5    Bit4    Bit3    Bit2    Bi
             -t1    Bit0
 143      =2                                  //Î»ÃèÊö                P1.7    P1.6    P1.5    P1.4    P1.3    P1.2    P1
             -.1    P1.0
 144      =2                                  //³õÊ¼Öµ=1111,1111      1       1       1       1       1       1       1 
             -      1
 145      =2  
 146      =2  sbit P17        =   P1^7;       //I/O¿ÚP1.7
 147      =2  sbit P16        =   P1^6;       //I/O¿ÚP1.6
 148      =2  sbit P15        =   P1^5;       //I/O¿ÚP1.5
 149      =2  sbit P14        =   P1^4;       //I/O¿ÚP1.4
 150      =2  sbit P13        =   P1^3;       //I/O¿ÚP1.3
 151      =2  sbit P12        =   P1^2;       //I/O¿ÚP1.2
 152      =2  sbit P11        =   P1^1;       //I/O¿ÚP1.1
 153      =2  sbit P10        =   P1^0;       //I/O¿ÚP1.0
 154      =2  
 155      =2  sbit ADCIN7     =   P1^7;       //ADCÍ¨µÀ7µÄÄ£ÄâÐÅºÅÊäÈë½Å
 156      =2  sbit ADCIN6     =   P1^6;       //ADCÍ¨µÀ6µÄÄ£ÄâÐÅºÅÊäÈë½Å
 157      =2  sbit ADCIN5     =   P1^5;       //ADCÍ¨µÀ5µÄÄ£ÄâÐÅºÅÊäÈë½Å
 158      =2  sbit ADCIN4     =   P1^4;       //ADCÍ¨µÀ4µÄÄ£ÄâÐÅºÅÊäÈë½Å
 159      =2  sbit ADCIN3     =   P1^3;       //ADCÍ¨µÀ3µÄÄ£ÄâÐÅºÅÊäÈë½Å
 160      =2  sbit ADCIN2     =   P1^2;       //ADCÍ¨µÀ2µÄÄ£ÄâÐÅºÅÊäÈë½Å
 161      =2  sbit ADCIN1     =   P1^1;       //ADCÍ¨µÀ1µÄÄ£ÄâÐÅºÅÊäÈë½Å
 162      =2  sbit ADCIN0     =   P1^0;       //ADCÍ¨µÀ0µÄÄ£ÄâÐÅºÅÊäÈë½Å
 163      =2  
 164      =2  sbit SPISCLK    =   P1^7;       //SPI×ÜÏßµÄÊ±ÖÓ½Å
 165      =2  sbit SPIMISO    =   P1^6;       //SPI×ÜÏßµÄÖ÷³ö´ÓÈë½Å
 166      =2  sbit SPIMOSI    =   P1^5;       //SPI×ÜÏßµÄÖ÷Èë´Ó³ö½Å
 167      =2  sbit SPISS      =   P1^4;       //SPI×ÜÏßµÄ´Ó»úÑ¡Ôñ½Å
 168      =2  
 169      =2  sbit T1CLKO     =   P1^1;       //¶¨Ê±Æ÷1Ê±ÖÓÒç³öÂö³åÊä³ö½Å
 170      =2  sbit T0CLKO     =   P1^0;       //¶¨Ê±Æ÷0Ê±ÖÓÒç³öÂö³åÊä³ö½Å
 171      =2  
 172      =2  /////////////////////////////////
 173      =2  
 174      =2  sfr  P2         =   0xa0;       //I/O¶Ë¿Ú2              Bit7    Bit6    Bit5    Bit4    Bit3    Bit2    Bi
             -t1    Bit0
 175      =2                                  //Î»ÃèÊö                P2.7    P2.6    P2.5    P2.4    P2.3    P2.2    P2
             -.1    P2.0
 176      =2                                  //³õÊ¼Öµ=1111,1111      1       1       1       1       1       1       1 
             -      1
 177      =2  
 178      =2  sbit P27        =   P2^7;       //I/O¿ÚP2.7
 179      =2  sbit P26        =   P2^6;       //I/O¿ÚP2.6
 180      =2  sbit P25        =   P2^5;       //I/O¿ÚP2.5
 181      =2  sbit P24        =   P2^4;       //I/O¿ÚP2.4
 182      =2  sbit P23        =   P2^3;       //I/O¿ÚP2.3
 183      =2  sbit P22        =   P2^2;       //I/O¿ÚP2.2
 184      =2  sbit P21        =   P2^1;       //I/O¿ÚP2.1
 185      =2  sbit P20        =   P2^0;       //I/O¿ÚP2.0
 186      =2  
 187      =2  sbit CEX3       =   P2^4;       //±È½Ï/²¶»ñ/PWM3Íâ²¿Òý½Å
 188      =2  sbit CEX2       =   P2^0;       //±È½Ï/²¶»ñ/PWM2Íâ²¿Òý½Å
 189      =2  
 190      =2  /////////////////////////////////
 191      =2  
 192      =2  sfr  P3         =   0xb0;       //I/O¶Ë¿Ú3              Bit7    Bit6    Bit5    Bit4    Bit3    Bit2    Bi
             -t1    Bit0
 193      =2                                  //Î»ÃèÊö                P3.7    -       P3.5    P3.4    P3.3    P3.2    P3
             -.1    P3.0
 194      =2                                  //³õÊ¼Öµ=1x11,1111      1       x       1       1       1       1       1 
             -      1
C51 COMPILER V8.08   SINGLEBUS                                                             02/22/2013 13:09:18 PAGE 9   

 195      =2  
 196      =2  sbit P37        =   P3^7;       //I/O¿ÚP3.7
 197      =2  sbit P35        =   P3^5;       //I/O¿ÚP3.5
 198      =2  sbit P34        =   P3^4;       //I/O¿ÚP3.4
 199      =2  sbit P33        =   P3^3;       //I/O¿ÚP3.3
 200      =2  sbit P32        =   P3^2;       //I/O¿ÚP3.2
 201      =2  sbit P31        =   P3^1;       //I/O¿ÚP3.1
 202      =2  sbit P30        =   P3^0;       //I/O¿ÚP3.0
 203      =2  
 204      =2  sbit RXD        =   P3^0;       //´®¿Ú1µÄÊý¾Ý½ÓÊÕ¿Ú
 205      =2  sbit TXD        =   P3^1;       //´®¿Ú1µÄÊý¾Ý·¢ËÍ¿Ú
 206      =2  sbit INT0       =   P3^2;       //Íâ²¿ÖÐ¶Ï0µÄÐÅºÅÊäÈë¿Ú
 207      =2  sbit INT1       =   P3^3;       //Íâ²¿ÖÐ¶Ï1µÄÐÅºÅÊä³ö¿Ú
 208      =2  sbit T0         =   P3^4;       //¶¨Ê±Æ÷0µÄÍâ²¿ÐÅºÅÊäÈë¿Ú
 209      =2  sbit T1         =   P3^5;       //¶¨Ê±Æ÷1µÄÍâ²¿ÐÅºÅÊäÈë¿Ú
 210      =2  
 211      =2  sbit CEX0       =   P3^7;       //±È½Ï/²¶»ñ/PWM0Íâ²¿Òý½Å
 212      =2  sbit CEX1       =   P3^5;       //±È½Ï/²¶»ñ/PWM1Íâ²¿Òý½Å
 213      =2  sbit ECI        =   P3^4;       //±È½Ï/²¶»ñ/PWMÄ£¿éµÄÍâ²¿Ê±ÖÓÊäÈë½Å(×î´óÖµÎªFosc/2)
 214      =2  
 215      =2  /////////////////////////////////
 216      =2  
 217      =2  sfr  P1M0       =   0x91;       //I/O¿Ú1Ä£Ê½¿ØÖÆÆ÷1     Bit7    Bit6    Bit5    Bit4    Bit3    Bit2    Bi
             -t1    Bit0
 218      =2                                  //³õ/Ê¼Öµ=0000,0000     0       0       0       0       0       0       0 
             -      0
 219      =2  
 220      =2  /////////////////////////////////
 221      =2  
 222      =2  sfr  P1M1       =   0x92;       //I/O¿Ú1Ä£Ê½¿ØÖÆÆ÷0     Bit7    Bit6    Bit5    Bit4    Bit3    Bit2    Bi
             -t1    Bit0
 223      =2                                  //³õÊ¼Öµ=0000,0000      0       0       0       0       0       0       0 
             -      0
 224      =2  
 225      =2  /////////////////////////////////
 226      =2  
 227      =2  sfr  P0M0       =   0x93;       //I/O¿Ú0Ä£Ê½¿ØÖÆÆ÷1     Bit7    Bit6    Bit5    Bit4    Bit3    Bit2    Bi
             -t1    Bit0
 228      =2                                  //³õÊ¼Öµ=0000,0000      0       0       0       0       0       0       0 
             -      0
 229      =2  
 230      =2  /////////////////////////////////
 231      =2  
 232      =2  sfr  P0M1       =   0x94;       //I/O¿Ú0Ä£Ê½¿ØÖÆÆ÷0     Bit7    Bit6    Bit5    Bit4    Bit3    Bit2    Bi
             -t1    Bit0
 233      =2                                  //³õÊ¼Öµ=0000,0000      0       0       0       0       0       0       0 
             -      0
 234      =2  
 235      =2  /////////////////////////////////
 236      =2  
 237      =2  sfr  P2M0       =   0x95;       //I/O¿Ú2Ä£Ê½¿ØÖÆÆ÷1     Bit7    Bit6    Bit5    Bit4    Bit3    Bit2    Bi
             -t1    Bit0
 238      =2                                  //³õÊ¼Öµ=0000,0000      0       0       0       0       0       0       0 
             -      0
 239      =2  
 240      =2  /////////////////////////////////
 241      =2  
 242      =2  sfr  P2M1       =   0x96;       //I/O¿Ú2Ä£Ê½¿ØÖÆÆ÷0     Bit7    Bit6    Bit5    Bit4    Bit3    Bit2    Bi
             -t1    Bit0
 243      =2                                  //³õÊ¼Öµ=0000,0000      0       0       0       0       0       0       0 
             -      0
 244      =2  
C51 COMPILER V8.08   SINGLEBUS                                                             02/22/2013 13:09:18 PAGE 10  

 245      =2  /////////////////////////////////
 246      =2  
 247      =2  sfr  P3M0       =   0xb1;       //I/O¿Ú3Ä£Ê½¿ØÖÆÆ÷1     Bit7    Bit6    Bit5    Bit4    Bit3    Bit2    Bi
             -t1    Bit0
 248      =2                                  //³õ/Ê¼Öµ=0000,0000     0       0       0       0       0       0       0 
             -      0
 249      =2  
 250      =2  /////////////////////////////////
 251      =2  
 252      =2  sfr  P3M1       =   0xb2;       //I/O¿Ú3Ä£Ê½¿ØÖÆÆ÷0     Bit7    Bit6    Bit5    Bit4    Bit3    Bit2    Bi
             -t1    Bit0
 253      =2                                  //³õÊ¼Öµ=0000,0000      0       0       0       0       0       0       0 
             -      0
 254      =2  
 255      =2  /////////////////////////////////
 256      =2  
 257      =2  // PxM0 PxM1
 258      =2  //  0    0     ×¼Ë«Ïò¿Ú
 259      =2  //  0    1     Ç¿ÍÆÍìÊä³ö
 260      =2  //  1    0     ¸ß×èÊäÈëÌ¬
 261      =2  //  1    1     ¿ªÂ©Êä³ö
 262      =2  
 263      =2  //////////////////////////////////////////////////////////////////////////////////////////////////////////
             -//////
 264      =2  
 265      =2  sfr  IE         =   0xa8;       //ÖÐ¶ÏÊ¹ÄÜ¼Ä´æÆ÷        Bit7    Bit6    Bit5    Bit4    Bit3    Bit2    Bi
             -t1    Bit0
 266      =2                                  //Î»ÃèÊö                EA   EPCA_LVD EADC_SPI  ES      ET1     EX1     ET
             -0     EX0
 267      =2                                  //³õÊ¼Öµ=0000,0000      0       0       0       0       0       0       0 
             -      0
 268      =2  
 269      =2  sbit EA         =   IE^7;       //×ÜÖÐ¶Ï¿ª¹Ø
 270      =2  sbit EPCA_LVD   =   IE^6;       //PCAºÍLVD×ÜÖÐ¶ÏÊ¹ÄÜÎ»,Òª´ò¿ªPCA/LVDÖÐ¶Ï,»¹ÐèÒªÊ¹ÄÜCCAPMn.ECCFn/AUXR.ELVDI
 271      =2  sbit EADC_SPI   =   IE^5;       //ADCºÍSPI×ÜÖÐ¶ÏÊ¹ÄÜÎ»,Òª´ò¿ªADC/SPIÖÐ¶Ï,»¹ÐèÒªÊ¹ÄÜAUXR.EADCI/AUXR.ESPII
 272      =2  sbit ES         =   IE^4;       //´®¿ÚÖÐ¶ÏÊ¹ÄÜÎ»
 273      =2  sbit ET1        =   IE^3;       //¶¨Ê±Æ÷1ÖÐ¶ÏÊ¹ÄÜÎ»
 274      =2  sbit EX1        =   IE^2;       //Íâ²¿ÖÐ¶Ï1ÖÐ¶ÏÊ¹ÄÜÎ»
 275      =2  sbit ET0        =   IE^1;       //¶¨Ê±Æ÷0ÖÐ¶ÏÊ¹ÄÜÎ»
 276      =2  sbit EX0        =   IE^0;       //Íâ²¿ÖÐ¶Ï0ÖÐ¶ÏÊ¹ÄÜÎ»
 277      =2  
 278      =2  /////////////////////////////////
 279      =2  
 280      =2  #define X0_INTNO    0           //Íâ²¿ÖÐ¶Ï0ÖÐ¶ÏºÅ,Èë¿ÚµØÖ·Îª0003H
 281      =2  #define T0_INTNO    1           //¶¨Ê±Æ÷0ÖÐ¶ÏºÅ,Èë¿ÚµØÖ·Îª000BH
 282      =2  #define X1_INTNO    2           //Íâ²¿ÖÐ¶Ï1ÖÐ¶ÏºÅ,Èë¿ÚµØÖ·Îª0013H
 283      =2  #define T1_INTNO    3           //¶¨Ê±Æ÷1ÖÐ¶ÏºÅ,Èë¿ÚµØÖ·Îª001BH
 284      =2  #define UART_INTNO  4           //´®¿ÚÖÐ¶ÏºÅ,Èë¿ÚµØÖ·Îª0023H
 285      =2  #define ADC_SPI_INTNO   5       //SPI/ADCÖÐ¶ÏºÅ,Èë¿ÚµØÖ·Îª002BH
 286      =2  #define PCA_LVD_INTNO   6       //PCA/LVDÖÐ¶ÏºÅ,Èë¿ÚµØÖ·Îª0033H
 287      =2  
 288      =2  /////////////////////////////////
 289      =2  
 290      =2  sfr  IPH        =   0xb7;       //ÖÐ¶ÏÓÅÏÈ¼¶¼Ä´æÆ÷¸ßÎ»  Bit7    Bit6    Bit5    Bit4    Bit3    Bit2    Bi
             -t1    Bit0
 291      =2                                  //Î»ÃèÊö                -    PCA_LVDH PADC_SPIH PSH     PT1H    PX1H    PT
             -0H    PX0H
 292      =2                                  //³õÊ¼Öµ=x000,0000      x       0       0       0       0       0       0 
             -      0
 293      =2  
 294      =2  #define PPCA_LVDH   0x40        //PCA/LVDÖÐ¶ÏÓÅÏÈ¼¶¿ØÖÆ¸ßÎ»
 295      =2  #define PADC_SPIH   0x20        //ADC/SPIÖÐ¶ÏÓÅÏÈ¼¶¿ØÖÆ¸ßÎ»
C51 COMPILER V8.08   SINGLEBUS                                                             02/22/2013 13:09:18 PAGE 11  

 296      =2  #define PSH         0x10        //´®¿ÚÖÐ¶ÏÓÅÏÈ¼¶¿ØÖÆ¸ßÎ»
 297      =2  #define PT1H        0x08        //¶¨Ê±Æ÷1ÖÐ¶ÏÓÅÏÈ¼¶¿ØÖÆ¸ßÎ»
 298      =2  #define PX1H        0x04        //Íâ²¿ÖÐ¶Ï1ÖÐ¶ÏÓÅÏÈ¼¶¿ØÖÆ¸ßÎ»
 299      =2  #define PT0H        0x02        //¶¨Ê±Æ÷0ÖÐ¶ÏÓÅÏÈ¼¶¿ØÖÆ¸ßÎ»
 300      =2  #define PX0H        0x01        //Íâ²¿ÖÐ¶Ï0ÖÐ¶ÏÓÅÏÈ¼¶¿ØÖÆ¸ßÎ»
 301      =2  
 302      =2  /////////////////////////////////
 303      =2  
 304      =2  sfr  IP         =   0xb8;       //ÖÐ¶ÏÓÅÏÈ¼¶¼Ä´æÆ÷      Bit7    Bit6    Bit5    Bit4    Bit3    Bit2    Bi
             -t1    Bit0
 305      =2                                  //Î»ÃèÊö                -    PPCA_LVD PADC_SPI  PS      PT1     PX1     PT
             -0     PX0
 306      =2                                  //³õÊ¼Öµ=x000,0000      x       0       0       0       0       0       0 
             -      0
 307      =2  
 308      =2  sbit PPCA_LVD   =   IP^6;       //PCA/LVDÖÐ¶ÏÓÅÏÈ¼¶¿ØÖÆµÍÎ»
 309      =2  sbit PADC_SPI   =   IP^5;       //ADC/SPIÖÐ¶ÏÓÅÏÈ¼¶¿ØÖÆµÍÎ»
 310      =2  sbit PS         =   IP^4;       //´®¿ÚÖÐ¶ÏÓÅÏÈ¼¶¿ØÖÆµÍÎ»
 311      =2  sbit PT1        =   IP^3;       //¶¨Ê±Æ÷1ÖÐ¶ÏÓÅÏÈ¼¶¿ØÖÆµÍÎ»
 312      =2  sbit PX1        =   IP^2;       //Íâ²¿ÖÐ¶Ï1ÖÐ¶ÏÓÅÏÈ¼¶¿ØÖÆµÍÎ»
 313      =2  sbit PT0        =   IP^1;       //¶¨Ê±Æ÷0ÖÐ¶ÏÓÅÏÈ¼¶¿ØÖÆµÍÎ»
 314      =2  sbit PX0        =   IP^0;       //Íâ²¿ÖÐ¶Ï0ÖÐ¶ÏÓÅÏÈ¼¶¿ØÖÆµÍÎ»
 315      =2  
 316      =2  //////////////////////////////////////////////////////////////////////////////////////////////////////////
             -//////
 317      =2  
 318      =2  sfr  TCON       =   0x88;       //¶¨Ê±Æ÷0/1¿ØÖÆ¼Ä´æÆ÷   Bit7    Bit6    Bit5    Bit4    Bit3    Bit2    Bi
             -t1    Bit0
 319      =2                                  //Î»ÃèÊö                TF1     TR1     TF0     TR0     IE1     IT1     IE
             -0     IT0
 320      =2                                  //³õÊ¼Öµ=0000,0000      0       0       0       0       0       0       0 
             -      0
 321      =2  
 322      =2  sbit TF1        = TCON^7;       //¶¨Ê±Æ÷1Òç³ö±êÖ¾,ÓÉÓ²¼þÖÃ1,¿ÉÓÉÈí¼þÇå0»òÕßÔÚÖÐ¶Ï´¦Àí³ÌÐòÍê³ÉºóÓÉÓ²¼þ×Ô¶¯Ç
             -å0
 323      =2  sbit TR1        = TCON^6;       //¶¨Ê±Æ÷1µÄÆô¶¯¿ØÖÆÎ»,1:Æô¶¯¶¨Ê±Æ÷ 0:Í£Ö¹¶¨Ê±Æ÷
 324      =2  sbit TF0        = TCON^5;       //¶¨Ê±Æ÷0Òç³ö±êÖ¾,ÓÉÓ²¼þÖÃ1,¿ÉÓÉÈí¼þÇå0»òÕßÔÚÖÐ¶Ï´¦Àí³ÌÐòÍê³ÉºóÓÉÓ²¼þ×Ô¶¯Ç
             -å0
 325      =2  sbit TR0        = TCON^4;       //¶¨Ê±Æ÷0µÄÆô¶¯¿ØÖÆÎ»,1:Æô¶¯¶¨Ê±Æ÷ 0:Í£Ö¹¶¨Ê±Æ÷
 326      =2  sbit IE1        = TCON^3;       //Íâ²¿ÖÐ¶Ï1µÄÖÐ¶ÏÇëÇóÎ»,ÓÉÓ²¼þÖÃ1,¿ÉÓÉÈí¼þÇå0»òÕßÔÚÖÐ¶Ï´¦Àí³ÌÐòÍê³ÉºóÓÉÓ²¼
             -þ×Ô¶¯Çå0
 327      =2  sbit IT1        = TCON^2;       //Íâ²¿ÖÐ¶Ï1µÄ´¥·¢ÀàÐÍ,0:µÍµçÆ½´¥·¢Íâ²¿ÖÐ¶Ï 1:ÏÂ½µÑØ´¥·¢Íâ²¿ÖÐ¶Ï
 328      =2  sbit IE0        = TCON^1;       //Íâ²¿ÖÐ¶Ï0µÄÖÐ¶ÏÇëÇóÎ»,ÓÉÓ²¼þÖÃ1,¿ÉÓÉÈí¼þÇå0»òÕßÔÚÖÐ¶Ï´¦Àí³ÌÐòÍê³ÉºóÓÉÓ²¼
             -þ×Ô¶¯Çå0
 329      =2  sbit IT0        = TCON^0;       //Íâ²¿ÖÐ¶Ï0µÄ´¥·¢ÀàÐÍ,0:µÍµçÆ½´¥·¢Íâ²¿ÖÐ¶Ï 1:ÏÂ½µÑØ´¥·¢Íâ²¿ÖÐ¶Ï
 330      =2  
 331      =2  /////////////////////////////////
 332      =2  
 333      =2  sfr  TMOD       =   0x89;       //¶¨Ê±Æ÷0/1Ä£Ê½¼Ä´æÆ÷   Bit7    Bit6    Bit5    Bit4    Bit3    Bit2    Bi
             -t1    Bit0
 334      =2                                  //Î»ÃèÊö                GATE    C/T#    M1      M0      GATE    C/T#    M1
             -      M0
 335      =2                                  //³õÊ¼Öµ=0000,0000      0       0       0       0       0       0       0 
             -      0
 336      =2  
 337      =2  #define GATE1       0x80        //¶¨Ê±Æ÷1Æô¶¯¿ØÖÆÎ»,0:TR1Îª1Ê±Æô¶¯¶¨Ê±Æ÷1 1:TR1Îª1ÇÒINT1Îª¸ßµçÆ½Ê±²ÅÆô¶¯¶¨
             -Ê±Æ÷1
 338      =2  #define C_T1        0x40        //¶¨Ê±Æ÷/¼ÆÊýÆ÷Ñ¡ÔñÎ»,0:¶¨Ê±Æ÷(Ê±ÖÓÔ´ÎªÄÚ²¿Ê±ÖÓ) 1:¼ÆÊýÆ÷(Ê±ÖÓÔ´ÎªT1Òý½ÅµÄ
             -Íâ²¿Ê±ÖÓ)
 339      =2  #define T1_M0       0x00        //¶¨Ê±Æ÷1²Ù×÷Ä£Ê½0:13Î»¶¨Ê±Æ÷
 340      =2  #define T1_M1       0x10        //¶¨Ê±Æ÷1²Ù×÷Ä£Ê½1:16Î»¶¨Ê±Æ÷
 341      =2  #define T1_M2       0x20        //¶¨Ê±Æ÷1²Ù×÷Ä£Ê½2:8Î»×Ô¶¯ÖØÔØ¶¨Ê±Æ÷
C51 COMPILER V8.08   SINGLEBUS                                                             02/22/2013 13:09:18 PAGE 12  

 342      =2  #define T1_M3       0x30        //¶¨Ê±Æ÷1²Ù×÷Ä£Ê½3:¶¨Ê±Æ÷1Í£Ö¹
 343      =2  #define GATE0       0x08        //¶¨Ê±Æ÷1Æô¶¯¿ØÖÆÎ»,0:TR0Îª1Ê±Æô¶¯¶¨Ê±Æ÷1 1:TR0Îª1ÇÒINT0Îª¸ßµçÆ½Ê±²ÅÆô¶¯¶¨
             -Ê±Æ÷0
 344      =2  #define C_T0        0x04        //¶¨Ê±Æ÷/¼ÆÊýÆ÷Ñ¡ÔñÎ»,0:¶¨Ê±Æ÷(Ê±ÖÓÔ´ÎªÄÚ²¿Ê±ÖÓ) 1:¼ÆÊýÆ÷(Ê±ÖÓÔ´ÎªT0Òý½ÅµÄ
             -Íâ²¿Ê±ÖÓ)
 345      =2  #define T0_M0       0x00        //¶¨Ê±Æ÷0²Ù×÷Ä£Ê½0:13Î»¶¨Ê±Æ÷
 346      =2  #define T0_M1       0x01        //¶¨Ê±Æ÷0²Ù×÷Ä£Ê½1:16Î»¶¨Ê±Æ÷
 347      =2  #define T0_M2       0x02        //¶¨Ê±Æ÷0²Ù×÷Ä£Ê½2:8Î»×Ô¶¯ÖØÔØ¶¨Ê±Æ÷
 348      =2  #define T0_M3       0x03        //¶¨Ê±Æ÷0²Ù×÷Ä£Ê½3:TL0ºÍTH0ÎªÁ½×é¶ÀÁ¢8Î»¶¨Ê±Æ÷
 349      =2  
 350      =2  /////////////////////////////////
 351      =2  
 352      =2  sfr  TL0        = 0x8a;         //¶¨Ê±Æ÷0µÄµÍ8Î»¼ÆÊýÖµ  Bit7    Bit6    Bit5    Bit4    Bit3    Bit2    Bi
             -t1    Bit0
 353      =2                                  //³õÊ¼Öµ=0000,0000      0       0       0       0       0       0       0 
             -      0
 354      =2  
 355      =2  /////////////////////////////////
 356      =2  
 357      =2  sfr  TL1        = 0x8b;         //¶¨Ê±Æ÷1µÄµÍ8Î»¼ÆÊýÖµ  Bit7    Bit6    Bit5    Bit4    Bit3    Bit2    Bi
             -t1    Bit0
 358      =2                                  //³õÊ¼Öµ=0000,0000      0       0       0       0       0       0       0 
             -      0
 359      =2  
 360      =2  /////////////////////////////////
 361      =2  
 362      =2  sfr  TH0        = 0x8c;         //¶¨Ê±Æ÷0µÄ¸ß8Î»¼ÆÊýÖµ  Bit7    Bit6    Bit5    Bit4    Bit3    Bit2    Bi
             -t1    Bit0
 363      =2                                  //³õÊ¼Öµ=0000,0000      0       0       0       0       0       0       0 
             -      0
 364      =2  
 365      =2  /////////////////////////////////
 366      =2  
 367      =2  sfr  TH1        = 0x8d;         //¶¨Ê±Æ÷1µÄ¸ß8Î»¼ÆÊýÖµ  Bit7    Bit6    Bit5    Bit4    Bit3    Bit2    Bi
             -t1    Bit0
 368      =2                                  //³õÊ¼Öµ=0000,0000      0       0       0       0       0       0       0 
             -      0
 369      =2  
 370      =2  //////////////////////////////////////////////////////////////////////////////////////////////////////////
             -//////
 371      =2  
 372      =2  sfr  SCON       =   0x98;       //´®¿Ú¿ØÖÆ¼Ä´æÆ÷        Bit7    Bit6    Bit5    Bit4    Bit3    Bit2    Bi
             -t1    Bit0
 373      =2                                  //Î»ÃèÊö                SM0/FE  SM1     SM2     REN     TB8     RB8     TI
             -      Ri
 374      =2                                  //³õÊ¼Öµ=0000,0000      0       0       0       0       0       0       0 
             -      0
 375      =2  
 376      =2  sbit FE         =   SCON^7;     //Ö¡´íÎó¼ì²âÎ»,µ±´®¿ÚÄ£¿éÔÚ½ÓÊÕÊý¾ÝÊ±Ã»ÓÐ¼ì²âµ½ÕýÈ·µÄÍ£Ö¹Î»Ê±,FE±»Ó²¼þÖÃ1,
             -ÐèÒªÓÉÈí¼þÀ´Çå0(µ±SMOD0Îª1Ê±,FEÓÐÐ§)
 377      =2  sbit SM0        =   SCON^7;     //´®¿ÚÄ£Ê½ÉèÖÃÎ»
 378      =2  sbit SM1        =   SCON^6;     //SM0/SM1=0/0:ÒÆÎ»¼Ä´æÆ÷ 0/1:8Î»¿É±ä²¨ÌØÂÊ 1/0:9Î»¹Ì¶¨²¨ÌØÂÊ 1/1:9Î»¿É±ä²¨
             -ÌØÂÊ
 379      =2  sbit SM2        =   SCON^5;     //×Ô¶¯µØÖ·Ê¶±ðÊ¹ÄÜÎ»
 380      =2  sbit REN        =   SCON^4;     //Ê¹ÄÜ´®¿Ú½ÓÊÕÄ£¿é
 381      =2  sbit TB8        =   SCON^3;     //·¢ËÍµÄµÚ9Î»Êý¾Ý
 382      =2  sbit RB8        =   SCON^2;     //½ÓÊÕµÄµÚ9Î»Êý¾Ý
 383      =2  sbit TI         =   SCON^1;     //·¢ËÍÍê³ÉÖÐ¶Ï±êÖ¾
 384      =2  sbit RI         =   SCON^0;     //½ÓÊÕÍê³ÉÖÐ¶Ï±êÖ¾
 385      =2  
 386      =2  /////////////////////////////////
 387      =2  
C51 COMPILER V8.08   SINGLEBUS                                                             02/22/2013 13:09:18 PAGE 13  

 388      =2  sfr  SBUF       =   0x99;       //´®¿Ú½ÓÊÕ/·¢ËÍÊý¾Ý     Bit7    Bit6    Bit5    Bit4    Bit3    Bit2    Bi
             -t1    Bit0
 389      =2                                  //³õÊ¼Öµ=xxxx,xxxx      x       x       x       x       x       x       x 
             -      x
 390      =2  
 391      =2  /////////////////////////////////
 392      =2  
 393      =2  sfr  SADDR      =   0xa9;       //´®¿ÚÉè±¸´ÓµØÖ·¼Ä´æÆ÷  Bit7    Bit6    Bit5    Bit4    Bit3    Bit2    Bi
             -t1    Bit0
 394      =2                                  //³õÊ¼Öµ=0000,0000      0       0       0       0       0       0       0 
             -      0
 395      =2  
 396      =2  /////////////////////////////////
 397      =2  
 398      =2  sfr  SADEN      =   0xb9;       //´®¿ÚÉè±¸´ÓµØÖ·ÆÁ±ÎÎ»  Bit7    Bit6    Bit5    Bit4    Bit3    Bit2    Bi
             -t1    Bit0
 399      =2                                  //³õÊ¼Öµ=0000,0000      0       0       0       0       0       0       0 
             -      0
 400      =2  
 401      =2  //////////////////////////////////////////////////////////////////////////////////////////////////////////
             -//////
 402      =2  
 403      =2  sfr  ADC_CONTR  =   0xc5;       //ADC¿ØÖÆ¼Ä´æÆ÷         Bit7    Bit6    Bit5    Bit4    Bit3    Bit2    Bi
             -t1    Bit0
 404      =2                                  //Î»ÃèÊö            ADC_POWER  SPEED1 SPEED0 ADC_FLAG ADC_START CHS2    CH
             -S1    CHS0
 405      =2                                  //³õÊ¼Öµ=0000,0000      0       0       0       0       0       0       0 
             -      0
 406      =2  
 407      =2  #define ADC_POWER   0x80        //ADCÄ£¿éµçÔ´¿ØÖÆÎ»
 408      =2  #define ADC_SPEEDLL 0x00        //Ã¿´Î×ª»»ÐèÒª1080¸öÊ±ÖÓÖÜÆÚ
 409      =2  #define ADC_SPEEDL  0x20        //Ã¿´Î×ª»»ÐèÒª810¸öÊ±ÖÓÖÜÆÚ
 410      =2  #define ADC_SPEEDH  0x40        //Ã¿´Î×ª»»ÐèÒª540¸öÊ±ÖÓÖÜÆÚ
 411      =2  #define ADC_SPEEDHH 0x60        //Ã¿´Î×ª»»ÐèÒª270¸öÊ±ÖÓÖÜÆÚ
 412      =2  #define ADC_FLAG    0x10        //ADC×ª»»Íê³É±êÖ¾
 413      =2  #define ADC_START   0x08        //ADC¿ªÊ¼×ª»»¿ØÖÆÎ»
 414      =2  #define ADC_CHS2    0x04        //ADCÍ¨µÀÑ¡ÔñÎ»2
 415      =2  #define ADC_CHS1    0x02        //ADCÍ¨µÀÑ¡ÔñÎ»1
 416      =2  #define ADC_CHS0    0x01        //ADCÍ¨µÀÑ¡ÔñÎ»0
 417      =2  
 418      =2  /////////////////////////////////
 419      =2  
 420      =2  sfr  ADC_DATA   =   0xc6;       //ADC½á¹û¸ß×Ö½Ú         Bit7    Bit6    Bit5    Bit4    Bit3    Bit2    Bi
             -t1    Bit0
 421      =2                                  //³õÊ¼Öµ=0000,0000      0       0       0       0       0       0       0 
             -      0
 422      =2  
 423      =2  /////////////////////////////////
 424      =2  
 425      =2  sfr  ADC_LOW2   =   0xbe;       //ADC½á¹ûµÍ×Ö½Ú         Bit7    Bit6    Bit5    Bit4    Bit3    Bit2    Bi
             -t1    Bit0
 426      =2                                  //³õÊ¼Öµ=0000,0000      0       0       0       0       0       0       0 
             -      0
 427      =2  
 428      =2  //////////////////////////////////////////////////////////////////////////////////////////////////////////
             -//////
 429      =2  
 430      =2  sfr  ISP_DATA   =   0xe2;       //ISPÊý¾Ý¼Ä´æÆ÷         Bit7    Bit6    Bit5    Bit4    Bit3    Bit2    Bi
             -t1    Bit0
 431      =2                                  //³õÊ¼Öµ=1111,1111      1       1       1       1       1       1       1 
             -      1
 432      =2  
C51 COMPILER V8.08   SINGLEBUS                                                             02/22/2013 13:09:18 PAGE 14  

 433      =2  /////////////////////////////////
 434      =2  
 435      =2  sfr  ISP_ADDRH  =   0xe3;       //ISPµØÖ·¸ßÎ»¼Ä´æÆ÷     Bit7    Bit6    Bit5    Bit4    Bit3    Bit2    Bi
             -t1    Bit0
 436      =2                                  //³õÊ¼Öµ=0000,0000      0       0       0       0       0       0       0 
             -      0
 437      =2  
 438      =2  /////////////////////////////////
 439      =2  
 440      =2  sfr  ISP_ADDRL  =   0xe4;       //ISPµØÖ·µÍÎ»¼Ä´æÆ÷     Bit7    Bit6    Bit5    Bit4    Bit3    Bit2    Bi
             -t1    Bit0
 441      =2                                  //³õÊ¼Öµ=0000,0000      0       0       0       0       0       0       0 
             -      0
 442      =2  
 443      =2  /////////////////////////////////
 444      =2  
 445      =2  sfr  ISP_CMD    =   0xe5;       //ISPÃüÁî¼Ä´æÆ÷         Bit7    Bit6    Bit5    Bit4    Bit3    Bit2    Bi
             -t1    Bit0
 446      =2                                  //³õÊ¼Öµ=xxxx,xx00      x       x       x       x       x       x       0 
             -      0
 447      =2  
 448      =2  #define ISP_IDLE    0x00        //ISP´ý»úÃüÁî
 449      =2  #define ISP_READ    0x01        //ISP¶Á×Ö½ÚÊý¾ÝÃüÁî
 450      =2  #define ISP_PROGRAM 0x02        //ISP×Ö½Ú±à³ÌÃüÁî
 451      =2  #define ISP_ERASE   0x03        //ISPÉÈÇø²Á³ýÃüÁî(Ã¿ÉÈÇø512×Ö½Ú))
 452      =2  
 453      =2  /////////////////////////////////
 454      =2  
 455      =2  sfr  ISP_TRIG   =   0xe6;       //ISPÃüÁî´¥·¢¼Ä´æÆ÷     Bit7    Bit6    Bit5    Bit4    Bit3    Bit2    Bi
             -t1    Bit0
 456      =2                                  //³õÊ¼Öµ=xxxx,xxxx      x       x       x       x       x       x       x 
             -      x
 457      =2  
 458      =2  #define ISP_TRIG0   0x46        //ISP¹¦ÄÜ´¥·¢ÃüÁî1
 459      =2  #define ISP_TRIG1   0xb9        //ISP¹¦ÄÜ´¥·¢ÃüÁî2
 460      =2  
 461      =2  /////////////////////////////////
 462      =2  
 463      =2  sfr  ISP_CONTR  =   0xe7;       //ISP¿ØÖÆ¼Ä´æÆ÷         Bit7    Bit6    Bit5    Bit4    Bit3    Bit2    Bi
             -t1    Bit0
 464      =2                                  //Î»ÃèÊö                ISPEN   SWBS    SWRST   CMD_FAIL -      WT2     WT
             -1     WT0
 465      =2                                  //³õÊ¼Öµ=0000,0000      0       0       0       0       0       0       0 
             -      0
 466      =2  
 467      =2  #define ISPEN       0x80        //ISPÊ¹ÄÜ¿ª¹Ø
 468      =2  #define SWBS        0x40        //ÈíÆô¶¯Ñ¡Ôñ,0:´ÓÓÃ»§APÆô¶¯ 1:´ÓISPÆô¶¯
 469      =2  #define SWRST       0x20        //´¥·¢Èí¼þ¸´Î»
 470      =2  #define CMD_FAIL    0x10        //ISPÃüÁîÊ§°Ü±êÖ¾
 471      =2  
 472      =2  //////////////////////////////////////////////////////////////////////////////////////////////////////////
             -//////
 473      =2  
 474      =2  sfr  SPSTAT     =   0x84;       //SPI×´Ì¬¼Ä´æÆ÷         Bit7    Bit6    Bit5    Bit4    Bit3    Bit2    Bi
             -t1    Bit0
 475      =2                                  //Î»ÃèÊö                SPIF    WCOL    -       -       -       -       - 
             -      -
 476      =2                                  //³õÊ¼Öµ=11xx,xxxx      1       1       x       x       x       x       x 
             -      x
 477      =2  
 478      =2  #define SPIF        0x80        //SPI´«ÊäÍê³É±êÖ¾,µ±SPIÖÐ¶ÏÊ¹ÄÜÊ±»á´¥·¢SPIÖÐ¶ÏÇëÇó,ÐèÒªÓÃÈí¼þÏò´ËÎ»Ð´"1"À´
             -Çå0
C51 COMPILER V8.08   SINGLEBUS                                                             02/22/2013 13:09:18 PAGE 15  

 479      =2  #define WCOL        0x40        //SPIÐ´³åÍ»±êÖ¾,ÐèÒªÓÃÈí¼þÏò´ËÎ»Ð´"1"À´Çå0
 480      =2  
 481      =2  /////////////////////////////////
 482      =2  
 483      =2  sfr  SPCTL      =   0x85;       //SPI¿ØÖÆ¼Ä´æÆ÷         Bit7    Bit6    Bit5    Bit4    Bit3    Bit2    Bi
             -t1    Bit0
 484      =2                                  //Î»ÃèÊö                SSIG    SPEN    DORD    MSTR    CPOL    CPHA    SP
             -R1    SPR0
 485      =2                                  //³õÊ¼Öµ=0000,0100      0       0       0       0       0       1       0 
             -      0
 486      =2  
 487      =2  #define SSIG        0x80        //SSºöÂÔÎ»,1:ÓÉMSTRÈ·¶¨Ö÷/´Ó 0:ÓÉSS½ÅÈ·¶¨Ö÷/´Ó
 488      =2  #define SPEN        0x40        //SPIÄ£¿éÊ¹ÄÜÎ»
 489      =2  #define DORD        0x20        //SPIÊý¾ÝË³Ðò,1:LSB(ÏÈÊÕ/·¢×îµÍÎ») 0:MSB(ÏÈÊÕ/·¢×î¸ßÎ»)
 490      =2  #define MSTR        0x10        //Ö÷/´ÓÄ£Ê½Ñ¡ÔñÎ»
 491      =2  #define CPOL        0x08        //SPIÊ±ÖÓ¼«ÐÔ
 492      =2  #define CPHA        0x04        //SPIÏàÎ»Ñ¡Ôñ
 493      =2  #define SPSPEEDHH   0x00        //×î¿ìµÄËÙ¶È,CPU_CLK/4
 494      =2  #define SPSPEEDH    0x01        //×î¿ìµÄËÙ¶È,CPU_CLK/16
 495      =2  #define SPSPEEDL    0x02        //×î¿ìµÄËÙ¶È,CPU_CLK/64
 496      =2  #define SPSPEEDLL   0x03        //×î¿ìµÄËÙ¶È,CPU_CLK/128
 497      =2  
 498      =2  /////////////////////////////////
 499      =2  
 500      =2  sfr  SPDAT      =   0x86;       //SPIÊý¾Ý¼Ä´æÆ÷         Bit7    Bit6    Bit5    Bit4    Bit3    Bit2    Bi
             -t1    Bit0
 501      =2                                  //³õÊ¼Öµ=0000,0000      0       0       0       0       0       0       0 
             -      0
 502      =2  
 503      =2  //////////////////////////////////////////////////////////////////////////////////////////////////////////
             -//////
 504      =2  
 505      =2  sfr  CCON       =   0xd8;       //PCA¿ØÖÆ¼Ä´æÆ÷         Bit7    Bit6    Bit5    Bit4    Bit3    Bit2    Bi
             -t1    Bit0
 506      =2                                  //Î»ÃèÊö                CF      CR      -       -       CCF3    CCF2    CC
             -F1    CCF0
 507      =2                                  //³õÊ¼Öµ=00xx,0000      0       0       x       x       0       0       0 
             -      0
 508      =2  
 509      =2  sbit CF         =   CCON^7;     //PCA¼ÆÊýÆ÷Òç³ö±êÖ¾,µ±PCAÖÐ¶ÏÊ¹ÄÜÊ±»á´¥·¢PCAÖÐ¶ÏÇëÇó,ÐèÒªÓÃÈí¼þÇå0
 510      =2  sbit CR         =   CCON^6;     //PCA¼ÆÊýÆ÷Æô¶¯¿ØÖÆÎ»,Ð´"1"Æô¶¯¶«¼ÆÊýÆ÷
 511      =2  sbit CCF3       =   CCON^3;     //PCAÄ£¿é3ÖÐ¶Ï±êÖ¾,ÐèÒªÓÃÈí¼þÇå0
 512      =2  sbit CCF2       =   CCON^2;     //PCAÄ£¿é2ÖÐ¶Ï±êÖ¾,ÐèÒªÓÃÈí¼þÇå0
 513      =2  sbit CCF1       =   CCON^1;     //PCAÄ£¿é1ÖÐ¶Ï±êÖ¾,ÐèÒªÓÃÈí¼þÇå0
 514      =2  sbit CCF0       =   CCON^0;     //PCAÄ£¿é0ÖÐ¶Ï±êÖ¾,ÐèÒªÓÃÈí¼þÇå0
 515      =2  
 516      =2  /////////////////////////////////
 517      =2  
 518      =2  sfr  CMOD       =   0xd9;       //PCAÄ£Ê½¼Ä´æÆ÷         Bit7    Bit6    Bit5    Bit4    Bit3    Bit2    Bi
             -t1    Bit0
 519      =2                                  //Î»ÃèÊö                CIDL    -       -       -       CPS2    CPS1    CP
             -S0    ECF
 520      =2                                  //³õÊ¼Öµ=0xxx,0000      0       x       x       x       0       0       0 
             -      0
 521      =2  
 522      =2  #define CIDL        0x80        //¼ÆÊ±Æ÷ÕóÁÐ¿ÕÏÐ¿ØÖÆ,0:¿ÕÏÐÄ£Ê½ÏÂPCA¼ÌÐø¹¤×÷ 1:¿ÕÏÐÄ£Ê½ÏÂPCAÍ£Ö¹¹¤×÷
 523      =2  #define PCACLK0     0x00        //Fosc/12
 524      =2  #define PCACLK1     0x02        //Fosc/2
 525      =2  #define PCACLK2     0x04        //¶¨Ê±Æ÷0µÄÒç³öÂÊ
 526      =2  #define PCACLK3     0x06        //ECIÍâ²¿Ê±ÖÓ
 527      =2  #define PCACLK4     0x08        //Fosc/1
 528      =2  #define PCACLK5     0x0a        //Fosc/4
C51 COMPILER V8.08   SINGLEBUS                                                             02/22/2013 13:09:18 PAGE 16  

 529      =2  #define PCACLK6     0x0c        //Fosc/6
 530      =2  #define PCACLK7     0x0e        //Fosc/8
 531      =2  #define ECF         0x01        //PCA¼ÆÊýÆ÷Òç³öÖÐ¶ÏÔÊÐíÎ»
 532      =2  
 533      =2  /////////////////////////////////
 534      =2  
 535      =2  sfr  CCAPM0     =   0xda;       //PCAÄ£¿é0Ä£Ê½¼Ä´æÆ÷    Bit7    Bit6    Bit5    Bit4    Bit3    Bit2    Bi
             -t1    Bit0
 536      =2                                  //Î»ÃèÊö                -       ECOM0   CAPP0   CAPN0   MAT0    TOG0    PW
             -M0    ECCF0
 537      =2                                  //³õÊ¼Öµ=x000,0000      x       0       0       0       0       0       0 
             -      0
 538      =2  
 539      =2  #define PCA0_ECOM   0x40        //Ê¹ÄÜ±È½ÏÆ÷0
 540      =2  #define PCA0_CAPP   0x20        //Ê¹ÄÜPCAÄ£¿é0µÄÉÏÉýÑØ²¶»ñ
 541      =2  #define PCA0_CAPN   0x10        //Ê¹ÄÜPCAÄ£¿é0µÄÏÂ½µÑØ²¶»ñ
 542      =2  #define PCA0_MAT    0x08        //Æ¥ÅäÊ¹ÄÜ,µ±PCAµÄ¼ÆÊýÖµÓëÄ£¿é0Éè¶¨µÄÖµÏàÆ¥ÅäÊ±,ÖÃCCON.CCF0
 543      =2  #define PCA0_TOG    0x04        //·­×ª¿ØÖÆÎ»,µ±PCAµÄ¼ÆÊýÖµÓëÄ£¿é0Éè¶¨µÄÖµÏàÆ¥ÅäÊ±,·­×ªCEX0µÄµçÆ½
 544      =2  #define PCA0_PWM    0x02        //Âö¿íµ÷ÖÆÄ£Ê½,Ê¹ÄÜCEX0ÎªÂö¿íµ÷ÖÆÊä³ö¿Ú
 545      =2  #define PCA0_ECCF   0x01        //Ê¹ÄÜCCF0ÖÐ¶Ï
 546      =2  
 547      =2  /////////////////////////////////
 548      =2  
 549      =2  sfr  CCAPM1     =   0xdb;       //PCAÄ£¿é1Ä£Ê½¼Ä´æÆ÷    Bit7    Bit6    Bit5    Bit4    Bit3    Bit2    Bi
             -t1    Bit0
 550      =2                                  //Î»ÃèÊö                -       ECOM1   CAPP1   CAPN1   MAT1    TOG1    PW
             -M1    ECCF1
 551      =2                                  //³õÊ¼Öµ=x000,0000      x       0       0       0       0       0       0 
             -      0
 552      =2  
 553      =2  #define PCA1_ECOM   0x40        //Ê¹ÄÜ±È½ÏÆ÷1
 554      =2  #define PCA1_CAPP   0x20        //Ê¹ÄÜPCAÄ£¿é1µÄÉÏÉýÑØ²¶»ñ
 555      =2  #define PCA1_CAPN   0x10        //Ê¹ÄÜPCAÄ£¿é1µÄÏÂ½µÑØ²¶»ñ
 556      =2  #define PCA1_MAT    0x08        //Æ¥ÅäÊ¹ÄÜ,µ±PCAµÄ¼ÆÊýÖµÓëÄ£¿é1Éè¶¨µÄÖµÏàÆ¥ÅäÊ±,ÖÃCCON.CCF1
 557      =2  #define PCA1_TOG    0x04        //·­×ª¿ØÖÆÎ»,µ±PCAµÄ¼ÆÊýÖµÓëÄ£¿é1Éè¶¨µÄÖµÏàÆ¥ÅäÊ±,·­×ªCEX1µÄµçÆ½
 558      =2  #define PCA1_PWM    0x02        //Âö¿íµ÷ÖÆÄ£Ê½,Ê¹ÄÜCEX1ÎªÂö¿íµ÷ÖÆÊä³ö¿Ú
 559      =2  #define PCA1_ECCF   0x01        //Ê¹ÄÜCCF1ÖÐ¶Ï
 560      =2  
 561      =2  /////////////////////////////////
 562      =2  
 563      =2  sfr  CCAPM2     =   0xdc;       //PCAÄ£¿é2Ä£Ê½¼Ä´æÆ÷    Bit7    Bit6    Bit5    Bit4    Bit3    Bit2    Bi
             -t1    Bit0
 564      =2                                  //Î»ÃèÊö                -       ECOM2   CAPP2   CAPN2   MAT2    TOG2    PW
             -M2    ECCF2
 565      =2                                  //³õÊ¼Öµ=x000,0000      x       0       0       0       0       0       0 
             -      0
 566      =2  
 567      =2  #define PCA2_ECOM   0x40        //Ê¹ÄÜ±È½ÏÆ÷2
 568      =2  #define PCA2_CAPP   0x20        //Ê¹ÄÜPCAÄ£¿é2µÄÉÏÉýÑØ²¶»ñ
 569      =2  #define PCA2_CAPN   0x10        //Ê¹ÄÜPCAÄ£¿é2µÄÏÂ½µÑØ²¶»ñ
 570      =2  #define PCA2_MAT    0x08        //Æ¥ÅäÊ¹ÄÜ,µ±PCAµÄ¼ÆÊýÖµÓëÄ£¿é2Éè¶¨µÄÖµÏàÆ¥ÅäÊ±,ÖÃCCON.CCF2
 571      =2  #define PCA2_TOG    0x04        //·­×ª¿ØÖÆÎ»,µ±PCAµÄ¼ÆÊýÖµÓëÄ£¿é2Éè¶¨µÄÖµÏàÆ¥ÅäÊ±,·­×ªCEX2µÄµçÆ½
 572      =2  #define PCA2_PWM    0x02        //Âö¿íµ÷ÖÆÄ£Ê½,Ê¹ÄÜCEX2ÎªÂö¿íµ÷ÖÆÊä³ö¿Ú
 573      =2  #define PCA2_ECCF   0x01        //Ê¹ÄÜCCF2ÖÐ¶Ï
 574      =2  
 575      =2  /////////////////////////////////
 576      =2  
 577      =2  sfr  CCAPM3     =   0xdd;       //PCAÄ£¿é3Ä£Ê½¼Ä´æÆ÷    Bit7    Bit6    Bit5    Bit4    Bit3    Bit2    Bi
             -t1    Bit0
 578      =2                                  //Î»ÃèÊö                -       ECOM3   CAPP3   CAPN3   MAT3    TOG3    PW
             -M3    ECCF3
 579      =2                                  //³õÊ¼Öµ=x000,0000      x       0       0       0       0       0       0 
C51 COMPILER V8.08   SINGLEBUS                                                             02/22/2013 13:09:18 PAGE 17  

             -      0
 580      =2  
 581      =2  #define PCA3_ECOM   0x40        //Ê¹ÄÜ±È½ÏÆ÷3
 582      =2  #define PCA3_CAPP   0x20        //Ê¹ÄÜPCAÄ£¿é3µÄÉÏÉýÑØ²¶»ñ
 583      =2  #define PCA3_CAPN   0x10        //Ê¹ÄÜPCAÄ£¿é3µÄÏÂ½µÑØ²¶»ñ
 584      =2  #define PCA3_MAT    0x08        //Æ¥ÅäÊ¹ÄÜ,µ±PCAµÄ¼ÆÊýÖµÓëÄ£¿é3Éè¶¨µÄÖµÏàÆ¥ÅäÊ±,ÖÃCCON.CCF3
 585      =2  #define PCA3_TOG    0x04        //·­×ª¿ØÖÆÎ»,µ±PCAµÄ¼ÆÊýÖµÓëÄ£¿é3Éè¶¨µÄÖµÏàÆ¥ÅäÊ±,·­×ªCEX3µÄµçÆ½
 586      =2  #define PCA3_PWM    0x02        //Âö¿íµ÷ÖÆÄ£Ê½,Ê¹ÄÜCEX3ÎªÂö¿íµ÷ÖÆÊä³ö¿Ú
 587      =2  #define PCA3_ECCF   0x01        //Ê¹ÄÜCCF3ÖÐ¶Ï
 588      =2  
 589      =2  /////////////////////////////////
 590      =2  
 591      =2  //CCAPM0   -   ECOM CAPP CAPN MAT  TOG  PWM  CCF
 592      =2  // 00H     0    0    0    0    0    0    0    0     ÎÞ²Ù×÷,´ý»ú×´Ì¬
 593      =2  // 42H     0    1    0    0    0    0    1    0     8Î»PWMÊä³ö,ÎÞÖÐ¶Ï
 594      =2  // 63H     0    1    1    0    0    0    1    1     8Î»PWMÊä³ö,²úÉúCEX0ÉÏÉýÑØÖÐ¶Ï
 595      =2  // 53H     0    1    0    1    0    0    1    1     8Î»PWMÊä³ö,²úÉúCEX0ÏÂ½µÑØÖÐ¶Ï
 596      =2  // 73H     0    1    1    1    0    0    1    1     8Î»PWMÊä³ö,²úÉúCEX0Ìø±äÖÐ¶Ï
 597      =2  // 20H     0    x    1    0    0    0    0    0     16Î»²¶»ñÄ£Ê½,CEX0ÉÏÉýÑØ´¥·¢²¶»ñ
 598      =2  // 10H     0    x    0    1    0    0    0    0     16Î»²¶»ñÄ£Ê½,CEX0ÏÂ½µÑØ´¥·¢²¶»ñ
 599      =2  // 30H     0    x    1    1    0    0    0    0     16Î»²¶»ñÄ£Ê½,CEX0Ìø±ä´¥·¢²¶»ñ
 600      =2  // 48H     0    1    0    0    1    0    0    0     16Î»Èí¼þ¶¨Ê±Æ÷
 601      =2  // 4CH     0    1    0    0    1    1    0    0     16Î»¸ßËÙÂö³åÊä³ö
 602      =2  
 603      =2  /////////////////////////////////
 604      =2  
 605      =2  sfr  CL         =   0xe9;       //PCA¼ÆÊýÆ÷µÍ8Î»        Bit7    Bit6    Bit5    Bit4    Bit3    Bit2    Bi
             -t1    Bit0
 606      =2                                  //³õÊ¼Öµ=0000,0000      0       0       0       0       0       0       0 
             -      0
 607      =2  
 608      =2  /////////////////////////////////
 609      =2  
 610      =2  sfr  CH         =   0xf9;       //PCA¼ÆÊýÆ÷¸ß8Î»        Bit7    Bit6    Bit5    Bit4    Bit3    Bit2    Bi
             -t1    Bit0
 611      =2                                  //³õÊ¼Öµ=0000,0000      0       0       0       0       0       0       0 
             -      0
 612      =2  
 613      =2  /////////////////////////////////
 614      =2  
 615      =2  sfr  CCAP0L     =   0xea;       //PCAÄ£¿é0¼Ä´æÆ÷µÍ8Î»   Bit7    Bit6    Bit5    Bit4    Bit3    Bit2    Bi
             -t1    Bit0
 616      =2                                  //³õÊ¼Öµ=0000,0000      0       0       0       0       0       0       0 
             -      0
 617      =2  
 618      =2  /////////////////////////////////
 619      =2  
 620      =2  sfr  CCAP1L     =   0xeb;       //PCAÄ£¿é1¼Ä´æÆ÷µÍ8Î»   Bit7    Bit6    Bit5    Bit4    Bit3    Bit2    Bi
             -t1    Bit0
 621      =2                                  //³õÊ¼Öµ=0000,0000      0       0       0       0       0       0       0 
             -      0
 622      =2  
 623      =2  /////////////////////////////////
 624      =2  
 625      =2  sfr  CCAP2L     =   0xec;       //PCAÄ£¿é2¼Ä´æÆ÷µÍ8Î»   Bit7    Bit6    Bit5    Bit4    Bit3    Bit2    Bi
             -t1    Bit0
 626      =2                                  //³õÊ¼Öµ=0000,0000      0       0       0       0       0       0       0 
             -      0
 627      =2  
 628      =2  /////////////////////////////////
 629      =2  
 630      =2  sfr  CCAP3L     =   0xed;       //PCAÄ£¿é3¼Ä´æÆ÷µÍ8Î»   Bit7    Bit6    Bit5    Bit4    Bit3    Bit2    Bi
C51 COMPILER V8.08   SINGLEBUS                                                             02/22/2013 13:09:18 PAGE 18  

             -t1    Bit0
 631      =2                                  //³õÊ¼Öµ=0000,0000      0       0       0       0       0       0       0 
             -      0
 632      =2  
 633      =2  /////////////////////////////////
 634      =2  
 635      =2  sfr  CCAP0H     =   0xfa;       //PCAÄ£¿é0¼Ä´æÆ÷¸ß8Î»   Bit7    Bit6    Bit5    Bit4    Bit3    Bit2    Bi
             -t1    Bit0
 636      =2                                  //³õÊ¼Öµ=0000,0000      0       0       0       0       0       0       0 
             -      0
 637      =2  
 638      =2  /////////////////////////////////
 639      =2  
 640      =2  sfr  CCAP1H     =   0xfb;       //PCAÄ£¿é1¼Ä´æÆ÷¸ß8Î»   Bit7    Bit6    Bit5    Bit4    Bit3    Bit2    Bi
             -t1    Bit0
 641      =2                                  //³õÊ¼Öµ=0000,0000      0       0       0       0       0       0       0 
             -      0
 642      =2  
 643      =2  /////////////////////////////////
 644      =2  
 645      =2  sfr  CCAP2H     =   0xfc;       //PCAÄ£¿é2¼Ä´æÆ÷¸ß8Î»   Bit7    Bit6    Bit5    Bit4    Bit3    Bit2    Bi
             -t1    Bit0
 646      =2                                  //³õÊ¼Öµ=0000,0000      0       0       0       0       0       0       0 
             -      0
 647      =2  
 648      =2  /////////////////////////////////
 649      =2  
 650      =2  sfr  CCAP3H     =   0xfd;       //PCAÄ£¿é3¼Ä´æÆ÷¸ß8Î»   Bit7    Bit6    Bit5    Bit4    Bit3    Bit2    Bi
             -t1    Bit0
 651      =2                                  //³õÊ¼Öµ=0000,0000      0       0       0       0       0       0       0 
             -      0
 652      =2  
 653      =2  /////////////////////////////////
 654      =2  
 655      =2  sfr  PCA_PWM0   =   0xf2;       //PCA0Ä£Ê½PWM¸¨Öú¼Ä´æÆ÷ Bit7    Bit6    Bit5    Bit4    Bit3    Bit2    Bi
             -t1    Bit0
 656      =2                                  //Î»ÃèÊö                -       -       -       -       -       -       EP
             -C0H   EPC0L
 657      =2                                  //³õÊ¼Öµ=xxxx,xx00      x       x       x       x       x       x       0 
             -      0
 658      =2  
 659      =2  /////////////////////////////////
 660      =2  
 661      =2  sfr  PCA_PWM1   =   0xf3;       //PCA1Ä£Ê½PWM¸¨Öú¼Ä´æÆ÷ Bit7    Bit6    Bit5    Bit4    Bit3    Bit2    Bi
             -t1    Bit0
 662      =2                                  //Î»ÃèÊö                -       -       -       -       -       -       EP
             -C1H   EPC1L
 663      =2                                  //³õÊ¼Öµ=xxxx,xx00      x       x       x       x       x       x       0 
             -      0
 664      =2  
 665      =2  /////////////////////////////////
 666      =2  
 667      =2  sfr  PCA_PWM2   =   0xf4;       //PCA2Ä£Ê½PWM¸¨Öú¼Ä´æÆ÷ Bit7    Bit6    Bit5    Bit4    Bit3    Bit2    Bi
             -t1    Bit0
 668      =2                                  //Î»ÃèÊö                -       -       -       -       -       -       EP
             -C2H   EPC2L
 669      =2                                  //³õÊ¼Öµ=xxxx,xx00      x       x       x       x       x       x       0 
             -      0
 670      =2  
 671      =2  /////////////////////////////////
 672      =2  
 673      =2  sfr  PCA_PWM3   =   0xf5;       //PCA3Ä£Ê½PWM¸¨Öú¼Ä´æÆ÷ Bit7    Bit6    Bit5    Bit4    Bit3    Bit2    Bi
C51 COMPILER V8.08   SINGLEBUS                                                             02/22/2013 13:09:18 PAGE 19  

             -t1    Bit0
 674      =2                                  //Î»ÃèÊö                -       -       -       -       -       -       EP
             -C3H   EPC3L
 675      =2                                  //³õÊ¼Öµ=xxxx,xx00      x       x       x       x       x       x       0 
             -      0
 676      =2  
 677      =2  //////////////////////////////////////////////////////////////////////////////////////////////////////////
             -//////
 678      =2  
 679      =2  #endif
  29      =1  
  30      =1  #define const code 
  31      =1  #ifndef TRUE
  32      =1  #define TRUE  1
  33      =1  #endif 
  34      =1  #ifndef FALSE
  35      =1  #define FALSE 0
  36      =1  #endif
  37      =1  
  38      =1  #define true 1
  39      =1  
  40      =1  #define SPK_ROOM 0
  41      =1  
  42      =1  #define ADD_FJ_ADDR 250
  43      =1  #define MOVE_FJ_ADDR 251
  44      =1  
  45      =1  
  46      =1  #define Bin(b7,b6,b5,b4,b3,b2,b1,b0)    ((b7<<7)|(b6<<6)|(b5<<5)|(b4<<4)|(b3<<3)|(b2<<2)|(b1<<1)|(b0<<0))
  47      =1  
  48      =1  //Ö÷Ïß³ÌÃüÁî
  49      =1  #define BUS0_REC                0x20                                                            //×ÜÏß0½ÓÊÕÍê³É
  50      =1  #define BUS0_SND                0x40                                                            //×ÜÏß0·¢ËÍÍê³É  
  51      =1  #define KEY_DOWN                0x60                                                            //°´¼ü°´ÏÂ
  52      =1  #define KEY_ALWAYS              0x70
  53      =1  #define KEY_UP                  0x80                                                            //°´¼üµ¯Æð
  54      =1  #define TIMER_OUT               0xa0                                                            //³¬Ê±ÃüÁî      
  55      =1  //°´¼ü¶¨Òå      
  56      =1  #define NO_KEY                  0xff                                                            //ÎÞ¼ü°´ÏÂ      
  57      =1  
  58      =1  sbit    MP3_DREQ        =       P3^2;
  59      =1  sbit    KEY_COPY        =       P3^5;
  60      =1  sbit    MP3_XDCS        =       P3^7;
  61      =1  
  62      =1  sbit    PRG_STATE       =       P1^0;
  63      =1  sbit    MP3_XRESET      =       P1^1;
  64      =1  sbit    MP3_XCS         =       P1^2;
  65      =1  sbit    TER_CS          =       P1^3;
  66      =1  sbit    SST25VF_CS              =       P1^4;
  67      =1  sbit    MOSI            =       P1^5;
  68      =1  sbit    MISO            =       P1^6;
  69      =1  sbit    SCLK            =       P1^7;
  70      =1  
  71      =1  
  72      =1  //°üº¬Í·ÎÄ¼þ
  73      =1  #include "OS_CFG.H"
   1      =2  /*********************************************************************************************************
   2      =2  **                                                             Small RTOS(51)
   3      =2  **                                   The Real-Time Kernel(For Keil c51)
   4      =2  **
   5      =2  **                                  (c) Copyright 2002-2002, chenmingji
   6      =2  **                                           All Rights Reserved
   7      =2  **
C51 COMPILER V8.08   SINGLEBUS                                                             02/22/2013 13:09:18 PAGE 20  

   8      =2  **                                                  V1.20.0
   9      =2  **
  10      =2  **
  11      =2  **--------------ÎÄ¼þÐÅÏ¢--------------------------------------------------------------------------------
  12      =2  **ÎÄ   ¼þ   Ãû: OS_CFG.H
  13      =2  **´´   ½¨   ÈË: ³ÂÃ÷¼Æ
  14      =2  **×îºóÐÞ¸ÄÈÕÆÚ: 2002Äê12ÔÂ30ÈÕ
  15      =2  **Ãè¡¡      Êö: ex1µÄÏµÍ³ÅäÖÃÎÄ¼þ
  16      =2  **
  17      =2  **--------------ÀúÊ·°æ±¾ÐÅÏ¢----------------------------------------------------------------------------
  18      =2  ** ´´½¨ÈË: ³ÂÃ÷¼Æ
  19      =2  ** °æ  ±¾: V0.50
  20      =2  ** ÈÕ¡¡ÆÚ: 2002Äê2ÔÂ22ÈÕ
  21      =2  ** Ãè¡¡Êö: Ô­Ê¼°æ±¾
  22      =2  **
  23      =2  **------------------------------------------------------------------------------------------------------
  24      =2  ** ÐÞ¸ÄÈË: ³ÂÃ÷¼Æ
  25      =2  ** °æ  ±¾: V1.00
  26      =2  ** ÈÕ¡¡ÆÚ: 2002Äê6ÔÂ20ÈÕ
  27      =2  ** Ãè¡¡Êö: Ê¹ÓÃ»§¿ÉÒÔ½øÐÐ¸ü¶àµÄÅäÖÃ
  28      =2  **
  29      =2  **------------------------------------------------------------------------------------------------------
  30      =2  ** ÐÞ¸ÄÈË: ³ÂÃ÷¼Æ
  31      =2  ** °æ  ±¾: V1.10~1.12.1
  32      =2  ** ÈÕ¡¡ÆÚ: 2002Äê9ÔÂ1ÈÕ~2002Äê12ÔÂ2ÈÕ
  33      =2  ** Ãè¡¡Êö: ¸ù¾ÝÐÂ°æ±¾ÐèÒª¸ü¸ÄÒ»Ð©¶¨Òå
  34      =2  **
  35      =2  **------------------------------------------------------------------------------------------------------
  36      =2  ** ÐÞ¸ÄÈË: ³ÂÃ÷¼Æ
  37      =2  ** °æ  ±¾: V1.20.0
  38      =2  ** ÈÕ¡¡ÆÚ: 2003Äê8ÔÂ3ÈÕ
  39      =2  ** Ãè¡¡Êö: ¸ù¾ÝÐÂ°æ±¾ÐèÒªÔö¼ÓÅäÖÃOSWait_EN£»
  40      =2  **         ¼õÉÙÒ»Ð©¹ØÓÚÖÐ¶ÏÇ¶Ì×µÄÅäÖÃ
  41      =2  **
  42      =2  **--------------µ±Ç°°æ±¾ÐÞ¶©------------------------------------------------------------------------------
  43      =2  ** ÐÞ¸ÄÈË: 
  44      =2  ** ÈÕ¡¡ÆÚ:
  45      =2  ** Ãè¡¡Êö:
  46      =2  **
  47      =2  **------------------------------------------------------------------------------------------------------
  48      =2  ********************************************************************************************************/
  49      =2  
  50      =2  #define OS_MAX_TASKS            5           /* ×î´óÈÎÎñÊý1~16                                           */
  51      =2  #define OS_TICKS_PER_SEC        200         /* ÉùÃ÷1ÃëÏµÍ³ÏµÍ³½ÚÅÄÊý                                    */
  52      =2  #define EN_USER_TICK_TIMER      1           /* ½ûÖ¹(0)»òÔÊÐí(1)ÏµÍ³¶¨Ê±ÖÐ¶Ïµ÷ÓÃÓÃ»§º¯ÊýUserTickTimer()  */
  53      =2  #define EN_TIMER_SHARING        1           /* ½ûÖ¹(0)»òÔÊÐí(1)¶¨Ê±Æ÷ÖÐ¶Ïµ÷ÓÃOSTimeTick()               */
  54      =2  #define TICK_TIMER_SHARING      0           /* ¶¨Òå½øÈë¶àÉÙ´ÎÓ²¼þÖÐ¶ÏÎªÒ»´ÎÏµÍ³¶¨Ê±Æ÷ÈíÖÐ¶Ï             */
  55      =2  #define OSWait_EN               1           /* ½ûÖ¹(0)»òÔÊÐí(1)µ÷ÓÃ¼æÈÝº¯ÊýOSWait  */
  56      =2  
  57      =2  
  58      =2  #define EN_OS_Q                 1           /* ½ûÖ¹(0)»òÔÊÐí(1)ÏûÏ¢¶ÓÁÐ                                 */
  59      =2  #define EN_OS_Q_CHK             0           /* ½ûÖ¹(0)»òÔÊÐí(1)Ð£ÑéÏûÏ¢¶ÓÁÐÖ¸Õë                         */
  60      =2  #define OS_Q_MEM_SEL            idata       /* ÏûÏ¢¶ÓÁÐ´æ´¢¿Õ¼äÑ¡Ôñ£¬keil c51ÓÐÓÃ£¬±ØÐëÎªidata¡¢xdata   */
  61      =2                                              /* ²»ÊÇkeil c51Ê±Ëü±ØÐëÎª¿Õ¸ñ                               */
  62      =2  #define EN_OS_Q_PENT            1           /* ½ûÖ¹(0)»òÔÊÐí(1)µÈ´ý¶ÓÁÐÖÐµÄÏûÏ¢                         */
  63      =2  #define EN_OS_Q_ACCEPT          0           /* ½ûÖ¹(0)»òÔÊÐí(1)ÎÞµÈ´ýµÄ´Ó¶ÓÁÐÖÐÈ¡µÃÏûÏ¢                 */
  64      =2  #define EN_OS_Q_POST            1           /* ½ûÖ¹(0)»òÔÊÐí(1)FIFO·½Ê½Ïò¶ÔÁÐ·¢ËÍÏûÏ¢                   */
  65      =2  #define EN_OS_Q_POST_FRONT      0           /* ½ûÖ¹(0)»òÔÊÐí(1)LIFO·½Ê½Ïò¶ÔÁÐ·¢ËÍÏûÏ¢                   */
  66      =2  #define EN_OS_Q_NMsgs           0           /* ½ûÖ¹(0)»òÔÊÐí(1)È¡µÃ¶ÓÁÐÖÐÏûÏ¢Êý                         */
  67      =2  #define EN_OS_Q_SIZE            0           /* ½ûÖ¹(0)»òÔÊÐí(1)È¡µÃ¶ÓÁÐ×ÜÈÝÁ¿                           */
  68      =2  #define EN_OS_Q_FLUSH           0           /* ½ûÖ¹(0)»òÔÊÐí(1)Çå¿Õ¶ÓÁÐ                                 */
  69      =2  
C51 COMPILER V8.08   SINGLEBUS                                                             02/22/2013 13:09:18 PAGE 21  

  70      =2  #define EN_OS_SEM               0           /* ½ûÖ¹(0)»òÔÊÐí(1)ÐÅºÅÁ¿                                   */
  71      =2  #define EN_OS_SEM_CHK           0           /* ½ûÖ¹(0)»òÔÊÐí(1)Ð£ÑéÐÅºÅÁ¿Ë÷Òý                           */
  72      =2  #define OS_SEM_MEM_SEL          idata       /* ÐÅºÅÁ¿´¢¿Õ¼äÑ¡Ôñ£¬keil c51ÓÐÓÃ£¬±ØÐëÎªidata¡¢xdata       */
  73      =2                                              /* ²»ÊÇkeil c51Ê±Ëü±ØÐëÎª¿Õ¸ñ                               */
  74      =2  #define OS_MAX_SEMS             0           /* ×î´óÐÅºÅÁ¿ÊýÄ¿                                           */
  75      =2  #define EN_OS_SEM_PENT          1           /* ½ûÖ¹(0)»òÔÊÐí(1)µÈ´ýÐÅºÅÁ¿                               */
  76      =2  #define EN_OS_SEM_ACCEPT        1           /* ½ûÖ¹(0)»òÔÊÐí(1)ÎÞµÈ´ýÇëÇóÐÅºÅÁ¿                         */
  77      =2  #define EN_OS_SEM_POST          1           /* ½ûÖ¹(0)»òÔÊÐí(1)ÖÐ·¢ËÍÐÅºÅÁ¿                             */
  78      =2  #define EN_OS_SEM_QUERY         1           /* ½ûÖ¹(0)»òÔÊÐí(1)²éÑ¯ÐÅºÅÁ¿                               */
  79      =2  
  80      =2  #define EN_OS_MEM               0           /* ½ûÖ¹(0)»òÔÊÐí(1)¶¯Ì¬ÄÚ´æ·ÖÅä                             */
  81      =2  #define EN_OS_MEM_FREE          0           /* ½ûÖ¹(0)»òÔÊÐí(1)ÊÍ·Å¶¯Ì¬·ÖÅäµÄÄÚ´æ                        *
             -/
  82      =2  #define EN_OS_MEM_CHK           1           /* ½ûÖ¹(0)»òÔÊÐí(1)ÄÚ´æ»ØÊÕÊ±ÑéÖ¤ÄÚ´æ¿éÊÇ·ñÓÐÐ§               
             -*/
  83      =2  #define EN_UserMemChkErr        0           /* ½ûÖ¹(0)»òÔÊÐí(1)ÄÚ´æ»ØÊÕÑéÖ¤³ö´íµ÷ÓÃÓÃ»§º¯ÊýUserMemChkErr  
             - */
  84      =2  
  85      =2  #if EN_TIMER_SHARING == 0
           =2 #define TIME_ISR_TASK_ID     COMM_TASK_ID   /* ¶¨ÒåÏµÍ³¶¨Ê±Æ÷ÈíÖÐ¶Ï´¥·¢µÄÈÎÎñID                         */
           =2 #endif
  88      =2  
  89      =2  #ifdef IN_OS_CPU_C 
           =2 #if EN_USER_TICK_TIMER > 0      
           =2 //extern void UserTickTimer(void);            /* ÏµÍ³¶¨Ê±ÖÐ¶ÏÖÐµ÷ÓÃµÄÓÃ»§º¯Êý                             
             -   
           =2 //#define UserTickTimer()       {uiIsrTimerCount+=ISR_INC_COUNT;CCAP0L = (uint8)uiIsrTimerCount;CCAP0H = (uint8
             -)(uiIsrTimerCount>>8);CCF0=0;WDT_CONTR = 0x3a;}   /* ÏµÍ³¶¨Ê±ÖÐ¶ÏÖÐµ÷ÓÃµÄÓÃ»§º¯                                                                */
           =2 
           =2 #endif
           =2 #endif
  96      =2  /*********************************************************************************************************
  97      =2  **                            End Of File
  98      =2  ********************************************************************************************************/
  74      =1  #include "OS_CPU.H"
   1      =2  /*********************************************************************************************************
   2      =2  **                                                             Small RTOS 51
   3      =2  **                                   The Real-Time Kernel For Keil c51
   4      =2  **
   5      =2  **                                  (c) Copyright 2002-2003, chenmingji
   6      =2  **                                           All Rights Reserved
   7      =2  **
   8      =2  **                                                  V1.20.0
   9      =2  **
  10      =2  **
  11      =2  **--------------ÎÄ¼þÐÅÏ¢--------------------------------------------------------------------------------
  12      =2  **ÎÄ   ¼þ   Ãû: OS_CPU.h
  13      =2  **´´   ½¨   ÈË: ³ÂÃ÷¼Æ
  14      =2  **×îºóÐÞ¸ÄÈÕÆÚ:  2003Äê8ÔÂ17ÈÕ
  15      =2  **Ãè¡¡      Êö: Small RTOS 51ÓëCPU(¼È8051ÏµÁÐ)Ïà¹ØµÄCÓïÑÔÍ·ÎÄ¼þ,¶¨ÒåÒ»Ð©ÓëCPUÏà¹ØµÄºê¡£
  16      =2  **
  17      =2  **--------------ÀúÊ·°æ±¾ÐÅÏ¢----------------------------------------------------------------------------
  18      =2  ** ´´½¨ÈË: ³ÂÃ÷¼Æ
  19      =2  ** °æ  ±¾: V0.50
  20      =2  ** ÈÕ¡¡ÆÚ: 2002Äê2ÔÂ22ÈÕ
  21      =2  ** Ãè¡¡Êö: Ô­Ê¼°æ±¾
  22      =2  **
  23      =2  **------------------------------------------------------------------------------------------------------
  24      =2  ** ÐÞ¸ÄÈË: ³ÂÃ÷¼Æ
  25      =2  ** °æ  ±¾: V1.00
  26      =2  ** ÈÕ¡¡ÆÚ: 2002Äê6ÔÂ20ÈÕ
  27      =2  ** Ãè¡¡Êö: ÎÞ±ä»¯
C51 COMPILER V8.08   SINGLEBUS                                                             02/22/2013 13:09:18 PAGE 22  

  28      =2  **
  29      =2  **------------------------------------------------------------------------------------------------------
  30      =2  ** ÐÞ¸ÄÈË: ³ÂÃ÷¼Æ
  31      =2  ** °æ  ±¾: V1.10~1.12.1
  32      =2  ** ÈÕ¡¡ÆÚ: 2002Äê9ÔÂ1ÈÕ~2002Äê12ÔÂ2ÈÕ
  33      =2  ** Ãè¡¡Êö: ¸ù¾ÝÐÂ°æ±¾ÐèÒªÔö¼ÓÒ»Ð©ºê¶¨Òå
  34      =2  **
  35      =2  **------------------------------------------------------------------------------------------------------
  36      =2  ** ÐÞ¸ÄÈË: ³ÂÃ÷¼Æ
  37      =2  ** °æ  ±¾: V1.20.0
  38      =2  ** ÈÕ¡¡ÆÚ: 2003Äê8ÔÂ17ÈÕ
  39      =2  ** Ãè¡¡Êö: ¸ù¾ÝÐÂ°æ±¾ÐèÒªÔö¼ÓEN_REENTRANT
  40      =2  **
  41      =2  **--------------µ±Ç°°æ±¾ÐÞ¶©------------------------------------------------------------------------------
  42      =2  ** ÐÞ¸ÄÈË: 
  43      =2  ** ÈÕ¡¡ÆÚ:
  44      =2  ** Ãè¡¡Êö:
  45      =2  **
  46      =2  **------------------------------------------------------------------------------------------------------
  47      =2  ********************************************************************************************************/
  48      =2  #define EN_SP2        0                                         /* ½ûÖ¹(0)»òÔÊÐí(1)Èí·ÇÆÁ±ÎÖÐ¶Ï           
             -    */
  49      =2  #define EN_REENTRANT  0                                         /* ½ûÖ¹(0)»òÔÊÐí(1)¹ÜÀíÖØÈëÕ»             
             -    */
  50      =2  
  51      =2  #ifdef __C51__
  52      =2  
  53      =2  //#define idata                                   /* ·Çkeil c51Ê±±ØÐë¼ÓÖ¹ÕâÒ»¾ä                           
             -    */
  54      =2  //#define data                                    /* ·Çkeil c51Ê±±ØÐë¼ÓÖ¹ÕâÒ»¾ä                           
             -    */
  55      =2  //#define xdata                                   /* ·Çkeil c51Ê±±ØÐë¼ÓÖ¹ÕâÒ»¾ä                           
             -    */
  56      =2  //#define reentrant                               /* ·Çkeil c51Ê±±ØÐë¼ÓÖ¹ÕâÒ»¾ä                           
             -    */
  57      =2  //#define small                                   /* ·Çkeil c51Ê±±ØÐë¼ÓÖ¹ÕâÒ»¾ä                           
             -    */
  58      =2  //#define code                                    /* ·Çkeil c51Ê±±ØÐë¼ÓÖ¹ÕâÒ»¾ä                           
             -    */
  59      =2  
  60      =2  typedef unsigned char  uint8;                                   /* ¶¨Òå¿ÉÒÆÖ²µÄÎÞ·ûºÅ8Î»ÕûÊý¹Ø¼ü×Ö        
             -    */
  61      =2  typedef signed   char  int8;                                    /* ¶¨Òå¿ÉÒÆÖ²µÄÓÐ·ûºÅ8Î»ÕûÊý¹Ø¼ü×Ö        
             -    */
  62      =2  typedef unsigned int   uint16;                                  /* ¶¨Òå¿ÉÒÆÖ²µÄÎÞ·ûºÅ16Î»ÕûÊý¹Ø¼ü×Ö       
             -    */
  63      =2  typedef signed   int   int16;                                   /* ¶¨Òå¿ÉÒÆÖ²µÄÓÐ·ûºÅ16Î»ÕûÊý¹Ø¼ü×Ö       
             -    */
  64      =2  typedef unsigned long  uint32;                                  /* ¶¨Òå¿ÉÒÆÖ²µÄÎÞ·ûºÅ32Î»ÕûÊý¹Ø¼ü×Ö       
             -    */
  65      =2  typedef signed   long  int32;                                   /* ¶¨Òå¿ÉÒÆÖ²µÄÓÐ·ûºÅ32Î»ÕûÊý¹Ø¼ü×Ö       
             -    */
  66      =2  
  67      =2  extern void OSCPUInit(void) small;
  68      =2  extern void OSTaskStkInit(void (code * task)(void), void xdata *ptos, uint8 TaskID);
  69      =2  extern void OSTaskStkDel(uint8 TaskID) small;
  70      =2  
  71      =2  #ifndef NULL
           =2 #define NULL 0
           =2 #endif
  74      =2  
  75      =2  #define  OS_INT_ENTER() OSIntNesting++, EA = 1
C51 COMPILER V8.08   SINGLEBUS                                                             02/22/2013 13:09:18 PAGE 23  

  76      =2  
  77      =2  #define  OS_ENTER_CRITICAL()  EA = 0,Os_Enter_Sum++             /* ½ûÖ¹ÖÐ¶Ï                                     */      
  78      =2  #define  OS_EXIT_CRITICAL()   if (--Os_Enter_Sum==0) EA = 1  /* ÔÊÐíÖÐ¶Ï                                        
             -*/         
  79      =2  
  80      =2  #define  HIGH_BYTE  0                                           /* uint16µÄ¸ßÎ»×Ö½Ú                       
             -       */
  81      =2  #define  LOW_BYTE   1                                           /* uint16µÄµÍÎ»×Ö½Ú                       
             -       */
  82      =2  
  83      =2  #define  OS_TASK_SW()         OSCtxSw()                         /* ÈÎÎñÇÐ»»º¯Êý                           
             -       */
  84      =2  
  85      =2  
  86      =2  #define  IDATA_RAM_SIZE  0x100                                  /* idata´óÐ¡                              
             -      */
  87      =2  
  88      =2  extern void OSCtxSw(void);
  89      =2  extern void OSIntCtxSw(void);
  90      =2  #ifndef IN_OS_CPU_C
  91      =2  extern void OSStartHighRdy(void)  small;
  92      =2  #endif
  93      =2  
  94      =2  #define  Sp2Space       8                                       /* ¸ß¼¶ÖÐ¶Ï£¨Èí·ÇÆÁ±ÎÖÐ¶Ï£©¶ÑÕ»´óÐ¡ EN_SP2
             -Îª0Ê±ÎÞÐ§*/
  95      =2  
  96      =2  #define OS_TIME_ISR     6                                       /* ÏµÍ³¶¨Ê±Æ÷Ê¹ÓÃµÄÖÐ¶Ï                   
             -      */
  97      =2  
  98      =2  #endif
  99      =2  
 100      =2  
 101      =2  
 102      =2  #ifndef __C51__   
           =2 SET_EA   MACRO
           =2              SETB     EA
           =2          ENDM
           =2          
           =2 #endif
 108      =2  
 109      =2  /*********************************************************************************************************
 110      =2  **                            End Of File
 111      =2  ********************************************************************************************************/
  75      =1  #include "..\os\OS.H"
   1      =2  /*********************************************************************************************************
   2      =2  **                                                             Small RTOS(51)
   3      =2  **                                   The Real-Time Kernel(For Keil c51)
   4      =2  **
   5      =2  **                                  (c) Copyright 2002-2003, chenmingji
   6      =2  **                                           All Rights Reserved
   7      =2  **
   8      =2  **                                                  V1.20.0
   9      =2  **
  10      =2  **
  11      =2  **--------------ÎÄ¼þÐÅÏ¢--------------------------------------------------------------------------------
  12      =2  **ÎÄ   ¼þ   Ãû: OS.h
  13      =2  **´´   ½¨   ÈË: ³ÂÃ÷¼Æ
  14      =2  **×îºóÐÞ¸ÄÈÕÆÚ:  2003Äê8ÔÂ17ÈÕ
  15      =2  **Ãè¡¡     Êö: Small RTOS(51) CÓïÑÔÍ·ÎÄ¼þ,¶¨ÒåÒ»Ð©ºêºÍÉùÃ÷Ò»Ð©º¯ÊýºÍ±äÁ¿
  16      =2  **
  17      =2  **--------------ÀúÊ·°æ±¾ÐÅÏ¢----------------------------------------------------------------------------
  18      =2  ** ´´½¨ÈË: ³ÂÃ÷¼Æ
C51 COMPILER V8.08   SINGLEBUS                                                             02/22/2013 13:09:18 PAGE 24  

  19      =2  ** °æ  ±¾: V0.50~V1.00
  20      =2  ** ÈÕ¡¡ÆÚ: 2002Äê2ÔÂ22ÈÕ~2002Äê6ÔÂ20ÈÕ
  21      =2  ** Ãè¡¡Êö: »ù±¾Íê³ÉSmall RTOSºË
  22      =2  **
  23      =2  **------------------------------------------------------------------------------------------------------
  24      =2  ** ÐÞ¸ÄÈË: ³ÂÃ÷¼Æ
  25      =2  ** °æ  ±¾: V1.10~V1.21
  26      =2  ** ÈÕ¡¡ÆÚ: 2002Äê9ÔÂ1ÈÕ~2003Äê1ÔÂ23ÈÕ
  27      =2  ** Ãè¡¡Êö: ÍêÉÆSmall RTOS
  28      =2  **
  29      =2  **------------------------------------------------------------------------------------------------------
  30      =2  ** ÐÞ¸ÄÈË: ³ÂÃ÷¼Æ
  31      =2  ** °æ  ±¾: V1.20.0
  32      =2  ** ÈÕ¡¡ÆÚ: 2003Äê8ÔÂ17ÈÕ
  33      =2  ** Ãè¡¡Êö: Ôö¼ÓÖ§³ÖÈÎÎñ¶¯Ì¬½¨Á¢ºÍÉ¾³ý£¬º¯Êý¹¦ÄÜÏòÒ»°ãµÄRTOS¿¿Æë
  34      =2  **--------------µ±Ç°°æ±¾ÐÞ¶©------------------------------------------------------------------------------
  35      =2  ** ÐÞ¸ÄÈË: 
  36      =2  ** ÈÕ¡¡ÆÚ:
  37      =2  ** Ãè¡¡Êö:
  38      =2  **
  39      =2  **------------------------------------------------------------------------------------------------------
  40      =2  ********************************************************************************************************/
  41      =2  
  42      =2  #define  OS_VERSION    120                              /* ÏµÍ³°æ±¾ºÅ                                   */
  43      =2  
  44      =2  #define  OSVersion()     OS_VERSION                     /* ·µ»ØÏµÍ³°æ±¾                                 */
  45      =2  #define  OSRunningTaskID() OSTaskID                     /* ·µ»Øµ±Ç°ÈÎÎñID                               */
             - 
  46      =2  
  47      =2  #define K_SIG      1                                    /* µÈ´ýÐÅºÅ                                     */
  48      =2  #define K_TMO      2                                    /* µÈ´ý³¬Ê±                                     */
  49      =2  
  50      =2  #define NOT_OK     255                                  /* ²ÎÊý´íÎó                                     */
  51      =2  #define TMO_EVENT  8                                    /* ³¬Ê±µ½                                       */
  52      =2  #define SIG_EVENT  4                                    /* ÓÐÐÅºÅ                                       */
  53      =2  
  54      =2   
  55      =2  #ifndef IN_OS_CORE
  56      =2  
  57      =2  /* ¼æÈÝV1.21.1°æ±¾µÄºê */
  58      =2  #define OSSendSignal(a)     OSTaskResume((a))
  59      =2  #define OSIntSendSignal(a)  OSTaskResume((a))
  60      =2  #define OSClearSignal(a)    OS_TaskSuspend((a))
  61      =2  #define OSTaskCreate(a, b, c) _OSTaskCreate((c),(a),(b))
  62      =2  
  63      =2  
  64      =2  extern uint8 data OSWaitTick[];
  65      =2  extern uint8 code OSMapTbl[];
  66      =2  extern uint8 data Os_Enter_Sum;
  67      =2  extern uint8 data OSTaskID;
  68      =2  extern uint8 data OSNextTaskID;
  69      =2  extern uint8 data OSIntNesting;
  70      =2  
  71      =2  
  72      =2  extern void OSInit(void) small;
  73      =2  /*********************************************************************************************************
  74      =2  ** º¯ÊýÃû³Æ: OSInit
  75      =2  ** ¹¦ÄÜÃèÊö: ÏµÍ³±äÁ¿³õÊ¼»¯
  76      =2  ** Êä¡¡Èë: ÎÞ
  77      =2  ** Êä¡¡³ö: ÎÞ
  78      =2  ** È«¾Ö±äÁ¿: 
  79      =2  ** µ÷ÓÃÄ£¿é: OSCPUInit
C51 COMPILER V8.08   SINGLEBUS                                                             02/22/2013 13:09:18 PAGE 25  

  80      =2  ********************************************************************************************************/
  81      =2  
  82      =2  extern void OSStart(void);
  83      =2  /*********************************************************************************************************
  84      =2  ** º¯ÊýÃû³Æ: OSStart
  85      =2  ** ¹¦ÄÜÃèÊö: Æô¶¯¶àÈÎÎñ»·¾³
  86      =2  ** Êä¡¡Èë: ÎÞ
  87      =2  ** Êä¡¡³ö : ÎÞ
  88      =2  ** È«¾Ö±äÁ¿: ÎÞ
  89      =2  ** µ÷ÓÃÄ£¿é: OSFindNextRunningTask,OSStartHighRdy
  90      =2  ********************************************************************************************************/
  91      =2  
  92      =2  extern uint8 _OSTaskCreate(uint8 TaskID, void (code * task)(void), void xdata *ptos) small;
  93      =2  /*********************************************************************************************************
  94      =2  ** º¯ÊýÃû³Æ: _OSTaskCreate
  95      =2  ** ¹¦ÄÜÃèÊö: ´´½¨ÈÎÎñ
  96      =2  ** Êä¡¡Èë: TaskID:ÈÎÎñID
  97      =2  **         task  :ÈÎÎñµØÖ·
  98      =2  **         ptos  :ÈÎÎñ¶ÑÕ»£¬ÔÚ51ÖÐÎªÖØÈëÕ»
  99      =2  ** Êä¡¡³ö: ÎÞ
 100      =2  ** È«¾Ö±äÁ¿: 
 101      =2  ** µ÷ÓÃÄ£¿é: ÎÞ
 102      =2  ********************************************************************************************************/
 103      =2  
 104      =2  extern uint8 OSTaskDel(uint8 TaskID) small;
 105      =2  /*********************************************************************************************************
 106      =2  ** º¯ÊýÃû³Æ: OSTaskDel
 107      =2  ** ¹¦ÄÜÃèÊö: ´´½¨ÈÎÎñ
 108      =2  ** Êä¡¡Èë: TaskID:ÈÎÎñID
 109      =2  ** Êä¡¡³ö: ÎÞ
 110      =2  ** È«¾Ö±äÁ¿: 
 111      =2  ** µ÷ÓÃÄ£¿é: ÎÞ
 112      =2  ********************************************************************************************************/
 113      =2         
 114      =2  extern void OSTaskResume(uint8 TaskID) small;
 115      =2  /*********************************************************************************************************
 116      =2  ** º¯ÊýÃû³Æ: OSTaskResume
 117      =2  ** ¹¦ÄÜÃèÊö: ÖÐ»Ö¸´ÈÎÎñ
 118      =2  ** Êä¡¡Èë: TaskID : ÈÎÎñID
 119      =2  ** Êä¡¡³ö: ÎÞ
 120      =2  ** È«¾Ö±äÁ¿: ÎÞ
 121      =2  ** µ÷ÓÃÄ£¿é: OSSched
 122      =2  ********************************************************************************************************/
 123      =2  
 124      =2  extern void OS_TaskSuspend(uint8 TaskID)    small;
 125      =2  /*********************************************************************************************************
 126      =2  ** º¯ÊýÃû³Æ: OS_TaskSuspend
 127      =2  ** ¹¦ÄÜÃèÊö: Ê¹Ö¸¶¨ÈÎÎñÐÝÃß£¬µ«²»½øÐÐÈÎÎñÇÐ»»
 128      =2  ** Êä¡¡Èë: TaskID : ÈÎÎñID
 129      =2  ** Êä¡¡³ö: ÎÞ
 130      =2  ** È«¾Ö±äÁ¿: OSWaitTick
 131      =2  ** µ÷ÓÃÄ£¿é: ÎÞ
 132      =2  **
 133      =2  ** ×÷¡¡Õß: ³ÂÃ÷¼Æ
 134      =2  ** ÈÕ¡¡ÆÚ: 2002Äê6ÔÂ20ÈÕ
 135      =2  **-------------------------------------------------------------------------------------------------------
 136      =2  ** ÐÞ¸ÄÈË:
 137      =2  ** ÈÕ¡¡ÆÚ:
 138      =2  **-------------------------------------------------------------------------------------------------------
 139      =2  ********************************************************************************************************/
 140      =2  
 141      =2  extern void OSTaskSuspend(uint8 TaskID)    small;
C51 COMPILER V8.08   SINGLEBUS                                                             02/22/2013 13:09:18 PAGE 26  

 142      =2  /*********************************************************************************************************
 143      =2  ** º¯ÊýÃû³Æ: OSTaskSuspend
 144      =2  ** ¹¦ÄÜÃèÊö: Ê¹Ö¸¶¨ÈÎÎñÐÝÃß
 145      =2  ** Êä¡¡Èë: TaskID : ÈÎÎñID
 146      =2  ** Êä¡¡³ö: ÎÞ
 147      =2  ** È«¾Ö±äÁ¿: Îå
 148      =2  ** µ÷ÓÃÄ£¿é: OS_TaskSuspend
 149      =2  **
 150      =2  ** ×÷¡¡Õß: ³ÂÃ÷¼Æ
 151      =2  ** ÈÕ¡¡ÆÚ: 2002Äê6ÔÂ20ÈÕ
 152      =2  **-------------------------------------------------------------------------------------------------------
 153      =2  ** ÐÞ¸ÄÈË:
 154      =2  ** ÈÕ¡¡ÆÚ:
 155      =2  **-------------------------------------------------------------------------------------------------------
 156      =2  ********************************************************************************************************/
 157      =2  
 158      =2  extern void OSTimeDly(uint8 ticks)     small;
 159      =2  /*********************************************************************************************************
 160      =2  ** º¯ÊýÃû³Æ: OSTimeDly
 161      =2  ** ¹¦ÄÜÃèÊö: ÏµÍ³µÈ´ýº¯Êý,ÈÎÎñµ÷ÓÃ´Ëº¯Êý¿ÉÒÔµÈ´ýÒ»¶¨Ê±¼ä
 162      =2  ** Êä¡¡Èë:  ticks : µÈ´ý³¬Ê±Ê±µÄÏµÍ³àÖàªÊý
 163      =2  ** Êä¡¡³ö : ÎÞ
 164      =2  **
 165      =2  ** È«¾Ö±äÁ¿: OSWaitTick
 166      =2  ** µ÷ÓÃÄ£¿é: OSIntTaskResume,OSSched
 167      =2  ********************************************************************************************************/
 168      =2  
 169      =2  extern void OSTimeDlyResume(uint8 TaskID)    small;
 170      =2  /*********************************************************************************************************
 171      =2  ** º¯ÊýÃû³Æ: OSTimeDlyResume
 172      =2  ** ¹¦ÄÜÃèÊö: ÈÃ´¦ÔÚÑÓÊ±ÆÚµÄÈÎÎñ½áÊøÑÓÊ±
 173      =2  ** Êä¡¡Èë:  TaskID : ÈÎÎñID
 174      =2  ** Êä¡¡³ö : ÎÞ
 175      =2  ** È«¾Ö±äÁ¿: OSWaitTick
 176      =2  ** µ÷ÓÃÄ£¿é: OSTaskResume
 177      =2  ********************************************************************************************************/
 178      =2  
 179      =2  extern void  OSTimeTick (void)  small;
 180      =2  /*********************************************************************************************************
 181      =2  ** º¯ÊýÃû³Æ: OSTimeTick
 182      =2  ** ¹¦ÄÜÃèÊö: ÏµÍ³Ê±ÖÓ´¦Àíº¯Êý,´¦Àí¸÷¸öÈÎÎñµÄÑÓÊ±
 183      =2  ** Êä¡¡Èë: ÎÞ
 184      =2  ** Êä¡¡³ö: ÎÞ
 185      =2  ** È«¾Ö±äÁ¿: OSWaitTick
 186      =2  ** µ÷ÓÃÄ£¿é: OSIntSendSignal
 187      =2  ********************************************************************************************************/
 188      =2  
 189      =2  extern uint8 OSWait (uint8 typ, uint8 ticks)    small;
 190      =2  /*********************************************************************************************************
 191      =2  ** º¯ÊýÃû³Æ: OSWait
 192      =2  ** ¹¦ÄÜÃèÊö: ÏµÍ³µÈ´ýº¯Êý,ÈÎÎñµ÷ÓÃ´Ëº¯Êý¿ÉÒÔµÈ´ýÒ»¶¨Ê±¼ä»òÐÅºÅ
 193      =2  ** Êä¡¡Èë: typ: µÈ´ýÊÂ¼þÀàÐÍ,Ä¿Ç°¿ÉÒÔÈ¡ÒÔÏÂÖµ,»òÊÇÆäÖÐÈÎÒâ¸öÖµµÄ°´Î»»ò
 194      =2  **             K_SIG: µÈ´ýÐÅºÅ
 195      =2  **             K_TMO: µÈ´ý³¬Ê±
 196      =2  **        ticks : µÈ´ý³¬Ê±Ê±µÄÏµÍ³àÖàªÊý
 197      =2  ** Êä¡¡³ö : NOT_OK : ²ÎÊý´íÎó
 198      =2  **         TMO_EVENT : ³¬Ê±µ½
 199      =2  **         SIG_EVENT : ÓÐÐÅºÅ
 200      =2  ** È«¾Ö±äÁ¿: OSWaitTick
 201      =2  ** µ÷ÓÃÄ£¿é: OSTaskSuspend,OSTimeDly,OS_ENTER_CRITICAL,OS_EXIT_CRITICAL
 202      =2  ********************************************************************************************************/
 203      =2  
C51 COMPILER V8.08   SINGLEBUS                                                             02/22/2013 13:09:18 PAGE 27  

 204      =2  extern uint8 OSIntExit (void)    small;
 205      =2  /*********************************************************************************************************
 206      =2  ** º¯ÊýÃû³Æ: OSIntExit
 207      =2  ** ¹¦ÄÜÃèÊö: ÖÐ¶ÏÍË³ö´¦Àíº¯Êý,ÔÚ´Ë½øÐÐÖÐ¶ÏºóµÄÈÎÎñÇÐ»»
 208      =2  ** Êä¡¡Èë: ÎÞ
 209      =2  ** Êä¡¡³ö: 0:ÎÞÐèÈÎÎñÇÐ»»
 210      =2  **         1:ÐèÒªÈÎÎñÇÐ»»
 211      =2  ** È«¾Ö±äÁ¿: OSIntNesting,OSNextTaskID
 212      =2  ** µ÷ÓÃÄ£¿é: OSIntCtxSw
 213      =2  ********************************************************************************************************/
 214      =2  
 215      =2  extern void OSSched (void)  small;
 216      =2  /*********************************************************************************************************
 217      =2  ** º¯ÊýÃû³Æ: OSSched
 218      =2  ** ¹¦ÄÜÃèÊö: ·ÇÖÐ¶ÏµÄÈÎÎñÇÐ»»º¯Êý
 219      =2  ** Êä¡¡Èë: ÎÞ
 220      =2  ** Êä¡¡³ö: ÎÞ
 221      =2  ** È«¾Ö±äÁ¿: OSIntNesting,OSNextTaskID
 222      =2  ** µ÷ÓÃÄ£¿é: OS_TASK_SW
 223      =2  ********************************************************************************************************/
 224      =2  
 225      =2  extern void OSFindNextRunningTask(void) small;
 226      =2  /*********************************************************************************************************
 227      =2  ** º¯ÊýÃû³Æ: OSFindNextRunningTask
 228      =2  ** ¹¦ÄÜÃèÊö: ²éÕÒÏÂÒ»¸öÓÅÏÈ¼¶×î¸ßµÄ¾ÍÐ÷ÈÎÎñ
 229      =2  ** Êä¡¡Èë: ÎÞ
 230      =2  ** Êä¡¡³ö: OSNextTaskID:´æ´¢²éÕÒ½á¹û
 231      =2  ** È«¾Ö±äÁ¿: OSTaskRuning,OSTaskCreated
 232      =2  ** µ÷ÓÃÄ£¿é: ÎÞ
 233      =2  **
 234      =2  ** ×÷¡¡Õß: ³ÂÃ÷¼Æ
 235      =2  ** ÈÕ¡¡ÆÚ: 2002Äê6ÔÂ20ÈÕ
 236      =2  **-------------------------------------------------------------------------------------------------------
 237      =2  ** ÐÞ¸ÄÈË:
 238      =2  ** ÈÕ¡¡ÆÚ:
 239      =2  **-------------------------------------------------------------------------------------------------------
 240      =2  ********************************************************************************************************/
 241      =2  #endif
 242      =2  
 243      =2  /*********************************************************************************************************
 244      =2  **                            End Of File
 245      =2  ********************************************************************************************************/
  76      =1  #include "..\os\OS_Q.h"
   1      =2  /*********************************************************************************************************
   2      =2  **                                                             Small RTOS(51)
   3      =2  **                                   The Real-Time Kernel(For Keil c51)
   4      =2  **
   5      =2  **                                  (c) Copyright 2002-2003, chenmingji
   6      =2  **                                           All Rights Reserved
   7      =2  **
   8      =2  **                                                  V1.20.0
   9      =2  **
  10      =2  **
  11      =2  **--------------ÎÄ¼þÐÅÏ¢--------------------------------------------------------------------------------
  12      =2  **ÎÄ   ¼þ   Ãû: OS_Q.h
  13      =2  **´´   ½¨   ÈË: ³ÂÃ÷¼Æ
  14      =2  **×îºóÐÞ¸ÄÈÕÆÚ:  2003Äê8ÔÂ3ÈÕ
  15      =2  ** Ãè¡¡Êö: Small RTOS(51)ÏûÏ¢¶ÓÁÐÍ·ÎÄ¼þ£¬¶¨ÒåÒ»Ð©ºêºÍÉùÃ÷Ò»Ð©º¯Êý
  16      =2  **
  17      =2  **--------------ÀúÊ·°æ±¾ÐÅÏ¢----------------------------------------------------------------------------
  18      =2  ** ´´½¨ÈË: ³ÂÃ÷¼Æ
  19      =2  ** °æ  ±¾: V1.10~V1.12.0
C51 COMPILER V8.08   SINGLEBUS                                                             02/22/2013 13:09:18 PAGE 28  

  20      =2  ** ÈÕ¡¡ÆÚ: 2002Äê6ÔÂ20ÈÕ~2002Äê12ÔÂ30ÈÕ
  21      =2  ** Ãè¡¡Êö: ÍêÉÆÏûÏ¢¶ÓÁÐ´úÂë
  22      =2  **
  23      =2  **------------------------------------------------------------------------------------------------------
  24      =2  ** ÐÞ¸ÄÈË: ³ÂÃ÷¼Æ
  25      =2  ** °æ  ±¾: V1.20.0
  26      =2  ** ÈÕ¡¡ÆÚ: 2003Äê8ÔÂ3ÈÕ
  27      =2  ** Ãè¡¡Êö: É¾³ýOSInt*º¯Êý£¬¸ù¾ÝÐÂ°æ±¾ÒªÇó¸Ä±äÒ»Ð©´úÂë
  28      =2  **
  29      =2  **--------------µ±Ç°°æ±¾ÐÞ¶©-----------------------------------------------------------------------------
  30      =2  ** ÐÞ¸ÄÈË:
  31      =2  ** ÈÕ¡¡ÆÚ:
  32      =2  ** Ãè¡¡Êö:
  33      =2  **
  34      =2  **------------------------------------------------------------------------------------------------------
  35      =2  ********************************************************************************************************/
  36      =2  
  37      =2  
  38      =2  #ifndef NOT_OK
           =2 #define NOT_OK      255                                 /* ²ÎÊý´íÎó                                     */
           =2 #endif
  41      =2  
  42      =2  #define OS_Q_FULL   8                                   /* ¶ÓÁÐÂú                                       */
  43      =2  #define OS_Q_NOT_OK 4                                   /* ÎÞÏûÏ¢                                       */
  44      =2  #define OS_Q_TMO    2                                   /* ³¬Ê±µ½                                       */
  45      =2  #define OS_Q_OK     1                                   /* ²Ù×÷³É¹¦                                     */
  46      =2  
  47      =2  #ifndef IN_OS_Q
  48      =2  extern uint8 OSQCreate(uint8 OS_Q_MEM_SEL *Buf, uint8 SizeOfBuf);
  49      =2  /*********************************************************************************************************
  50      =2  ** º¯ÊýÃû³Æ: OSQCreate
  51      =2  ** ¹¦ÄÜÃèÊö: ³õÊ¼»¯ÏûÏ¢¶ÓÁÐ
  52      =2  ** Êä¡¡Èë: Buf:Îª¶ÓÁÐ·ÖÅäµÄ´æ´¢¿Õ¼äµØÖ·
  53      =2  **         SizeOfBuf:Îª¶ÓÁÐ·ÖÅäµÄ´æ´¢¿Õ¼ä´óÐ¡
  54      =2  ** Êä¡¡³ö: NOT_OK:²ÎÊý´íÎó
  55      =2  **         OS_Q_OK:³É¹¦
  56      =2  ** È«¾Ö±äÁ¿: ÎÞ
  57      =2  ** µ÷ÓÃÄ£¿é: ÎÞ
  58      =2  ********************************************************************************************************/
  59      =2  extern uint8 OSQPend(uint8 data *Ret, uint8 OS_Q_MEM_SEL *Buf, uint8 Tick);
  60      =2  /*********************************************************************************************************
  61      =2  ** º¯ÊýÃû³Æ: OSQPend
  62      =2  ** ¹¦ÄÜÃèÊö: µÈ´ýÏûÏ¢¶ÓÁÐÖÐµÄÏûÏ¢
  63      =2  ** Êä¡¡Èë: Ret:·µ»ØµÄÏûÏ¢
  64      =2  **         Buf:Ö¸Ïò¶ÓÁÐµÄÖ¸Õë
  65      =2  **         Tick:µÈ´ýÊ±¼ä
  66      =2  ** Êä¡¡³ö: NOT_OK:²ÎÊý´íÎó
  67      =2  **         OS_Q_OK:ÊÕµ½ÏûÏ¢
  68      =2  **         OS_Q_TMO:³¬Ê±µ½
  69      =2  **         OS_Q_NOT_OK:ÎÞÏûÏ¢
  70      =2  ** È«¾Ö±äÁ¿: ÎÞ
  71      =2  ** µ÷ÓÃÄ£¿é: OSRunningTaskID,OSClearSignal,OSSched,OS_ENTER_CRITICAL,OS_EXIT_CRITICAL
  72      =2  ********************************************************************************************************/
  73      =2  extern uint8 OSQAccept(uint8 data *Ret, uint8 OS_Q_MEM_SEL *Buf);
  74      =2  /*********************************************************************************************************
  75      =2  ** º¯ÊýÃû³Æ: OSQAccept
  76      =2  ** ¹¦ÄÜÃèÊö: ÎÞµÈ´ý´ÓÏûÏ¢¶ÓÁÐÖÐÈ¡µÃÏûÏ¢
  77      =2  ** Êä¡¡Èë: Ret:·µ»ØµÄÏûÏ¢
  78      =2  **         Buf:Ö¸Ïò¶ÓÁÐµÄÖ¸Õë
  79      =2  ** Êä¡¡³ö: NOT_OK:²ÎÊý´íÎó
  80      =2  **         OS_Q_OK:ÊÕµ½ÏûÏ¢
  81      =2  **         OS_Q_TMO:³¬Ê±µ½
C51 COMPILER V8.08   SINGLEBUS                                                             02/22/2013 13:09:18 PAGE 29  

  82      =2  **         OS_Q_NOT_OK:ÎÞÏûÏ¢
  83      =2  ** È«¾Ö±äÁ¿: ÎÞ
  84      =2  ** µ÷ÓÃÄ£¿é: OSClearSignal,OSSched,OS_ENTER_CRITICAL,OS_EXIT_CRITICAL
  85      =2  ********************************************************************************************************/
  86      =2  extern uint8 OSQPost(uint8 OS_Q_MEM_SEL *Buf, uint8 Data);
  87      =2  /*********************************************************************************************************
  88      =2  ** º¯ÊýÃû³Æ: OSQPost
  89      =2  ** ¹¦ÄÜÃèÊö: FIFO·½Ê½·¢ËÍÏûÏ¢
  90      =2  ** Êä¡¡Èë: Buf:Ö¸Ïò¶ÓÁÐµÄÖ¸Õë
  91      =2  **         Data:ÏûÏ¢Êý¾Ý
  92      =2  ** Êä¡¡³ö: OS_Q_FULL:¶ÓÁÐÂú
  93      =2  **         OS_Q_OK:·¢ËÍ³É¹¦
  94      =2  ** È«¾Ö±äÁ¿: ÎÞ
  95      =2  ** µ÷ÓÃÄ£¿é: OSQIntPost,OSSched
  96      =2  ********************************************************************************************************/
  97      =2  extern uint8 OSQPostFront(uint8 OS_Q_MEM_SEL *Buf, uint8 Data);
  98      =2  /*********************************************************************************************************
  99      =2  ** º¯ÊýÃû³Æ: OSQPostFront
 100      =2  ** ¹¦ÄÜÃèÊö: LIFO·½Ê½·¢ËÍÏûÏ¢
 101      =2  ** Êä¡¡Èë: Buf:Ö¸Ïò¶ÓÁÐµÄÖ¸Õë
 102      =2  **         Data:ÏûÏ¢Êý¾Ý
 103      =2  ** Êä¡¡³ö: OS_Q_FULL:¶ÓÁÐÂú
 104      =2  **         OS_Q_OK:·¢ËÍ³É¹¦
 105      =2  ** È«¾Ö±äÁ¿: ÎÞ
 106      =2  ** µ÷ÓÃÄ£¿é: OSQIntPostFront,OSSched
 107      =2  ********************************************************************************************************/
 108      =2  /* ¼æÈÝV1.12.1µÄºê */
 109      =2  #define OSQIntPost(Buf, Data) OSQPost(Buf, Data)
 110      =2  #define OSQIntPostFront(Buf, Data) OSQPostFront(Buf, Data)
 111      =2  
 112      =2  extern uint8 OSQNMsgs(uint8 OS_Q_MEM_SEL *Buf);
 113      =2  /*********************************************************************************************************
 114      =2  ** º¯ÊýÃû³Æ: OSQNMsgs
 115      =2  ** ¹¦ÄÜÃèÊö: È¡µÃÏûÏ¢¶ÓÁÐÖÐÏûÏ¢Êý
 116      =2  ** Êä¡¡Èë: Buf:Ö¸Ïò¶ÓÁÐµÄÖ¸Õë
 117      =2  ** Êä¡¡³ö: ÏûÏ¢Êý
 118      =2  ** È«¾Ö±äÁ¿: ÎÞ
 119      =2  ** µ÷ÓÃÄ£¿é: OS_ENTER_CRITICAL,OS_EXIT_CRITICAL
 120      =2  ********************************************************************************************************/
 121      =2  extern uint8 OSQSize(uint8 OS_Q_MEM_SEL *Buf);
 122      =2  /*********************************************************************************************************
 123      =2  ** º¯ÊýÃû³Æ: OSQSize
 124      =2  ** ¹¦ÄÜÃèÊö: È¡µÃÏûÏ¢¶ÓÁÐ×ÜÈÝÁ¿
 125      =2  ** Êä¡¡Èë: Buf:Ö¸Ïò¶ÓÁÐµÄÖ¸Õë
 126      =2  ** Êä¡¡³ö: ÏûÏ¢¶ÓÁÐ×ÜÈÝÁ¿
 127      =2  ** È«¾Ö±äÁ¿: ÎÞ
 128      =2  ** µ÷ÓÃÄ£¿é: OS_ENTER_CRITICAL,OS_EXIT_CRITICAL
 129      =2  ********************************************************************************************************/
 130      =2  extern void OSQFlush (uint8 OS_Q_MEM_SEL *Buf);
 131      =2  /*********************************************************************************************************
 132      =2  ** º¯ÊýÃû³Æ: OSQFlush
 133      =2  ** ¹¦ÄÜÃèÊö: Çå¿Õ¶ÓÁÐ
 134      =2  ** Êä¡¡Èë: Buf:Ö¸Ïò¶ÓÁÐµÄÖ¸Õë
 135      =2  ** Êä¡¡³ö: ÎÞ
 136      =2  ** È«¾Ö±äÁ¿: ÎÞ
 137      =2  ** µ÷ÓÃÄ£¿é: OS_ENTER_CRITICAL,OS_EXIT_CRITICAL
 138      =2  **
 139      =2  ** ×÷¡¡Õß: ³ÂÃ÷¼Æ
 140      =2  ** ÈÕ¡¡ÆÚ: 2002Äê9ÔÂ1ÈÕ
 141      =2  **-------------------------------------------------------------------------------------------------------
 142      =2  ** ÐÞ¸ÄÈË: ³ÂÃ÷¼Æ
 143      =2  ** ÈÕ¡¡ÆÚ: 2002Äê10ÔÂ26ÈÕ
C51 COMPILER V8.08   SINGLEBUS                                                             02/22/2013 13:09:18 PAGE 30  

 144      =2  **-------------------------------------------------------------------------------------------------------
 145      =2  ** ÐÞ¸ÄÈË:
 146      =2  ** ÈÕ¡¡ÆÚ:
 147      =2  **-------------------------------------------------------------------------------------------------------
 148      =2  ********************************************************************************************************/
 149      =2  #endif
 150      =2  /*********************************************************************************************************
 151      =2  **                            End Of File
 152      =2  ********************************************************************************************************/
  77      =1  #include "..\os\OS_SEM.h" 
   1      =2  /*********************************************************************************************************
   2      =2  **                                                             Small RTOS(51)
   3      =2  **                                   The Real-Time Kernel(For Keil c51)
   4      =2  **
   5      =2  **                                  (c) Copyright 2002-2003, chenmingji
   6      =2  **                                           All Rights Reserved
   7      =2  **
   8      =2  **                                                  V1.20.0
   9      =2  **
  10      =2  **
  11      =2  **--------------ÎÄ¼þÐÅÏ¢--------------------------------------------------------------------------------
  12      =2  **ÎÄ   ¼þ   Ãû: OS_sem.h
  13      =2  **´´   ½¨   ÈË: ³ÂÃ÷¼Æ
  14      =2  **×îºóÐÞ¸ÄÈÕÆÚ:  2002Äê12ÔÂ2ÈÕ
  15      =2  ** Ãè¡¡Êö: Small RTOS(51)ÐÅºÅÁ¿Í·ÎÄ¼þ£¬¶¨ÒåÒ»Ð©ºêºÍÉùÃ÷Ò»Ð©º¯Êý
  16      =2  **
  17      =2  **--------------ÀúÊ·°æ±¾ÐÅÏ¢----------------------------------------------------------------------------
  18      =2  ** ´´½¨ÈË: ³ÂÃ÷¼Æ
  19      =2  ** °æ  ±¾: V1.10~V1.12.0
  20      =2  ** ÈÕ¡¡ÆÚ: 2002Äê9ÔÂ1ÈÕ~2002Äê12ÔÂ30ÈÕ
  21      =2  ** Ãè¡¡Êö: ÍêÉÆÐÅºÅÁ¿´úÂë
  22      =2  **
  23      =2  **------------------------------------------------------------------------------------------------------
  24      =2  ** ÐÞ¸ÄÈË: ³ÂÃ÷¼Æ
  25      =2  ** °æ  ±¾: V1.20.0
  26      =2  ** ÈÕ¡¡ÆÚ: 2003Äê8ÔÂ3ÈÕ
  27      =2  ** Ãè¡¡Êö: É¾³ýOSInt*º¯Êý£¬¸ù¾ÝÐÂ°æ±¾ÒªÇó¸Ä±äÒ»Ð©´úÂë
  28      =2  **
  29      =2  **--------------µ±Ç°°æ±¾ÐÞ¶©-----------------------------------------------------------------------------
  30      =2  ** ÐÞ¸ÄÈË:
  31      =2  ** ÈÕ¡¡ÆÚ:
  32      =2  ** Ãè¡¡Êö:
  33      =2  **
  34      =2  **------------------------------------------------------------------------------------------------------
  35      =2  ********************************************************************************************************/
  36      =2  
  37      =2  
  38      =2  #ifndef NOT_OK
           =2 #define NOT_OK      255                                 /* ²ÎÊý´íÎó                                     */
           =2 #endif
  41      =2  
  42      =2  #define OS_SEM_NOT_OK 4                                 /* ÎÞÐÅºÅ                                       */
  43      =2  #define OS_SEM_TMO    2                                 /* ³¬Ê±µ½                                       */
  44      =2  #define OS_SEM_OK     1                                 /* ²Ù×÷³É¹¦                                     */
  45      =2  
  46      =2  #ifndef IN_OS_SEM
  47      =2  extern uint8 OSSemCreate(uint8 Index,uint8 Data);
  48      =2  /*********************************************************************************************************
  49      =2  ** º¯ÊýÃû³Æ: OSSemCreate
  50      =2  ** ¹¦ÄÜÃèÊö: ³õÊ¼»¯ÏûÏ¢¶ÓÁÐ
  51      =2  ** Êä¡¡Èë: Index:ÐÅºÅÁ¿Ë÷Òý
  52      =2  **         data:ÐÅºÅÁ¿³õÊ¼Öµ
C51 COMPILER V8.08   SINGLEBUS                                                             02/22/2013 13:09:18 PAGE 31  

  53      =2  ** Êä¡¡³ö: NOT_OK:Ã»ÓÐÕâ¸öÐÅºÅÁ¿
  54      =2  **         OS_SEM_OK:³É¹¦
  55      =2  ** È«¾Ö±äÁ¿: ÎÞ
  56      =2  ** µ÷ÓÃÄ£¿é: ÎÞ
  57      =2  ********************************************************************************************************/
  58      =2  extern uint8 OSSemPend(uint8 Index, uint8 Tick);
  59      =2  /*********************************************************************************************************
  60      =2  ** º¯ÊýÃû³Æ: OSSemPend
  61      =2  ** ¹¦ÄÜÃèÊö: µÈ´ýÒ»¸öÐÅºÅÁ¿
  62      =2  ** Êä¡¡Èë: Index:ÐÅºÅÁ¿Ë÷Òý
  63      =2  **         Tick:µÈ´ýÊ±¼ä
  64      =2  ** Êä¡¡³ö: NOT_OK:²ÎÊý´íÎó
  65      =2  **         OS_SEM_OK:µÃµ½ÐÅºÅÁ¿
  66      =2  **         OS_SEM_TMO:³¬Ê±µ½
  67      =2  **         OS_SEM_NOT_OK:Ã»ÓÐµÃµ½ÐÅºÅÁ¿
  68      =2  ** È«¾Ö±äÁ¿: ÎÞ
  69      =2  ** µ÷ÓÃÄ£¿é: OSRunningTaskID,OSClearSignal,OSSched,OS_ENTER_CRITICAL,OS_EXIT_CRITICAL
  70      =2  ********************************************************************************************************/
  71      =2  extern uint8 OSSemAccept(uint8 Index);
  72      =2  /*********************************************************************************************************
  73      =2  ** º¯ÊýÃû³Æ: OSSemAccept
  74      =2  ** ¹¦ÄÜÃèÊö: ÎÞµÈ´ýÇëÇóÐÅºÅÁ¿
  75      =2  ** Êä¡¡Èë: Index:ÐÅºÅÁ¿Ë÷Òý
  76      =2  ** Êä¡¡³ö: NOT_OK:²ÎÊý´íÎó
  77      =2  **         OS_SEM_OK:µÃµ½ÐÅºÅÁ¿
  78      =2  **         OS_SEM_TMO:³¬Ê±µ½
  79      =2  **         OS_SEM_NOT_OK:Ã»ÓÐµÃµ½ÐÅºÅÁ¿
  80      =2  ** È«¾Ö±äÁ¿: ÎÞ
  81      =2  ** µ÷ÓÃÄ£¿é: OSClearSignal,OSSched,OS_ENTER_CRITICAL,OS_EXIT_CRITICAL
  82      =2  ********************************************************************************************************/
  83      =2  
  84      =2  #define OSSemIntPost(Index) OSSemPost(Index)
  85      =2  
  86      =2  extern uint8 OSSemPost(uint8 Index);
  87      =2  /*********************************************************************************************************
  88      =2  ** º¯ÊýÃû³Æ: OSSemPost
  89      =2  ** ¹¦ÄÜÃèÊö: ·¢ËÍÒ»¸öÐÅºÅÁ¿
  90      =2  ** Êä¡¡Èë: Index:ÐÅºÅÁ¿Ë÷Òý
  91      =2  ** Êä¡¡³ö: NOT_OK:²ÎÊý´íÎó
  92      =2  **         OS_SEM_OK:·¢ËÍ³É¹¦
  93      =2  ** È«¾Ö±äÁ¿: ÎÞ
  94      =2  ** µ÷ÓÃÄ£¿é: OSSemIntPost,OSSched
  95      =2  ********************************************************************************************************/
  96      =2  extern uint8 OSSemQuery(uint8 Index);
  97      =2  /*********************************************************************************************************
  98      =2  ** º¯ÊýÃû³Æ: OSSemQuery
  99      =2  ** ¹¦ÄÜÃèÊö: ²éÑ¯ÐÅºÅÁ¿
 100      =2  ** Êä¡¡Èë: Index:ÐÅºÅÁ¿Ë÷Òý
 101      =2  ** Êä¡¡³ö: ÐÅºÅÁ¿µÄÖµ
 102      =2  ** È«¾Ö±äÁ¿: ÎÞ
 103      =2  ** µ÷ÓÃÄ£¿é: OS_ENTER_CRITICAL,OS_EXIT_CRITICAL
 104      =2  ********************************************************************************************************/
 105      =2  #endif
 106      =2  /*********************************************************************************************************
 107      =2  **                            End Of File
 108      =2  ********************************************************************************************************/
  78      =1  #include "SingleBus.h"
   1      =2  /*
   2      =2  **********************************Copyright (c) ****************************
   3      =2  *                                                       cwg
   4      =2  *                              All Rights Reserved
   5      =2  *                                       QQ:7084394
C51 COMPILER V8.08   SINGLEBUS                                                             02/22/2013 13:09:18 PAGE 32  

   6      =2  *
   7      =2  *---------------------------------File Info---------------------------------
   8      =2  *File Name              :SingleBus.h
   9      =2  *Descriptor             :µ¥×ÜÏßÍ·ÎÄ¼þ
  10      =2  *Create By              :³ÂÎÀ¹ú
  11      =2  *Create Date            :2008-8-8
  12      =2  *Version                :V1.0
  13      =2  *Note                   :
  14      =2  *
  15      =2  *---------------------------------------------------------------------------
  16      =2  *Modified By            :
  17      =2  *Modified Date          :
  18      =2  *Version                :
  19      =2  *Note                   :
  20      =2  *
  21      =2  ****************************************************************************
  22      =2  */
  23      =2  //×ÜÏß0ºê¶¨Òå
  24      =2  #define         BUS0_FREQ_SIZE          7
  25      =2  #define         BUS0_FREQ_SIZE_HI       (BUS0_FREQ_SIZE << 4)
  26      =2  #define         BUS0_TX_Q_ZISE          (BUS0_FREQ_SIZE*20 + 1)
  27      =2  #define         DisableBus0RecInt()     {EX1 = 0;} 
  28      =2  #define         EnableBus0RecInt()      {IE1 = 0;EX1 = 1;}
  29      =2  #define         BUS0_SEND_CON           0x3c
  30      =2  #define         BUS0_CAN_SEND           0x0c 
  31      =2  #define         BUS0_ON_REC                     0x03
  32      =2  #define         BUS0_REQ_SEND           0x28
  33      =2  #define         BUS0_SEND_FINISH        0x0c 
  34      =2  #define         BUS0_ON_WORK            0x23
  35      =2  //µ¥×ÜÏß×Ô¶¯ÖØÔØÊ±¼ä
  36      =2  //#define               TIMER0_COUNT            ((256-(Fbus*9375/12/1000000))) 
  37      =2  
  38      =2  //300us
  39      =2  //#define TIMER0_H  0xfe
  40      =2  //#define TIMER0_L  0x34
  41      =2  
  42      =2  //100uS
  43      =2  #define TIMER0_H  0xff
  44      =2  #define TIMER0_L  0x67
  45      =2  
  46      =2  
  47      =2  /*Êý¾ÝÖ¡¸ñÊ½
  48      =2  ×Ö½Ú1£º·¢ËÍ·½ÇøµØÖ·£¨Ò»¸ö×Ö½Ú£©
  49      =2  ×Ö½Ú2£º·¢ËÍ·½·¿µØÖ·£¨Ò»¸ö×Ö½Ú£©
  50      =2  ×Ö½Ú3£º·¢ËÍ·½´²µØÖ·£¨Ò»¸ö×Ö½Ú£©
  51      =2  ×Ö½Ú4£ºÃüÁî´úÂë£¨Ò»¸ö×Ö½Ú£©
  52      =2  ×Ö½Ú5£º½ÓÊÕ·½ÇøµØÖ·£¨Ò»¸ö×Ö½Ú£©
  53      =2  ×Ö½Ú6£º½ÓÊÕ·½·¿µØÖ·£¨Ò»¸ö×Ö½Ú£©
  54      =2  ×Ö½Ú7£º½ÓÊÕ·½´²µØÖ·£¨Ò»¸ö×Ö½Ú£©
  55      =2  ×¢:Êý¾ÝèåÔÚ²»Í¬µÄÃüÁîÖÐ¿ÉÄÜÓÐ²»Í¬º¬Òå
  56      =2  */
  57      =2  /*µ¥×ÜÏßÐ­Òé
  58      =2    ÃüÁî´úÂë:Ò»×Ö½Ú
  59      =2    Êý¾Ý´úÂë:6×Ö½Ú(¸ù¾ÝÃüÁîµÄ²»Í¬Êý¾Ý¸ñÊ½)
  60      =2  */
  61      =2  typedef struct
  62      =2  {
  63      =2          uint8 bySndSecAddr;                     /*Ö÷¶¯·¢ËÍ·½ÇøµØÖ·*/
  64      =2          uint8 bySndRoomAddr;            /*Ö÷¶¯·¢ËÍ·½·¿µØÖ·*/
  65      =2          uint8 bySndBedAddr;                     /*Ö÷¶¯·¢ËÍ·½´²µØÖ·*/
  66      =2          uint8 byCmd;                            /*ÃüÁî*/
  67      =2          uint8 byRecSecAddr;                     /*½ÓÊÕ·½ÇøµØÖ·*/
C51 COMPILER V8.08   SINGLEBUS                                                             02/22/2013 13:09:18 PAGE 33  

  68      =2          uint8 byRecRoomAddr;            /*½ÓÊÕ·½·¿µØÖ·*/
  69      =2          uint8 byRecBedAddr;                     /*½ÓÊÕ·½´²µØÖ·*/        
  70      =2  } STBusFreq, *pSTBusFreq;       
  71      =2  /*************************ÃüÁî¶¨Òå**********************/
  72      =2  #define CMD_QUEST                               0x01    /*²éÑ¯ÃüÁî*/
  73      =2  #define CMD_ANSWER                              0x02    /*Ó¦´ðÃüÁî*/
  74      =2  #define CMD_LANDING                             0x03    /*µÇ¼ÇÃüÁî*/                    /*ºóÃæÁ½¸ö×Ö½ÚÎªÓÅÏÈ¼¶ºÍ0x00*/
  75      =2  #define CMD_ENTER                               0x04    /*È·ÈÏÃüÁî*/                    /*Ö»ÄÜÎªÖ÷»ú¶Ô´Ó»ú·¢ËÍ*/
  76      =2  /*****************************************************************/
  77      =2  #define CMD_COMM_CALL                   0x05    /*ÆÕÍ¨ºô½ÐÃüÁî*/                /*ºóÃæÁ½¸ö×Ö½ÚÎªÓÅÏÈ¼¶ºÍÖ÷·½×´Ì¬*/
  78      =2  #define CMD_INFUSION_CALL               0x06    /*ÊäÒººô½ÐÃüÁî*/
  79      =2  #define CMD_SERVICE_CALL                0x07    /*·þÎñºô½ÐÃüÁî*/
  80      =2  #define CMD_EMERGENCY_CALL              0x08    /*½ô¼±ºô½ÐÃüÁî*/
  81      =2  #define CMD_HELP_CALL                   0x09    /*ÇóÔ®ºô½ÐÃüÁî*/                /* ±ØÐëµÃµ½Ö÷»úµÄÈ·ÈÏÃüÁî*/
  82      =2  #define CMD_INSPECTOR_CALL              0x0a    /*²é·¿ºô½ÐÃüÁî*/                /* ±ØÐëµÃµ½Ö÷»úµÄÈ·ÈÏÃüÁî*/
  83      =2  /*****************************************************************/
  84      =2  #define CMD_COMM_ANSWER                 0x0b    /*ÆÕÍ¨Ó¦´ðÃüÁî*/                
  85      =2  #define CMD_INFUSION_ANSWER             0x0c    /*´¦ÀíÊäÒºÃüÁî*/
  86      =2  #define CMD_SERVICE_ANSWER              0x0d    /*´¦Àí·þÎñÃüÁî*/
  87      =2  #define CMD_EMERGENCY_ANSWER    0x0e    /*´¦Àí½ô¼±ÃüÁî*/
  88      =2  #define CMD_HELP_ANSWER                 0x0f    /*´¦ÀíÇóÔ®ÃüÁî*/
  89      =2  /*****************************************************************/
  90      =2  #define CMD_INFUSION_CLEAR              0x10    /*Çå³ýÊäÒºÃüÁî*/                /* ¶ÔÓ¦µÄÇå³ýÃüÁî*/
  91      =2  #define CMD_SERVICE_CLEAR               0x11    /*Çå³ý·þÎñÃüÁî*/
  92      =2  #define CMD_EMERGENCY_CLEAR             0x12    /*Çå³ý½ô¼±ÃüÁî*/
  93      =2  #define CMD_HELP_CLEAR                  0x13    /*Çå³ýÇóÔ®ÃüÁî*/
  94      =2  /*****************************************************************/
  95      =2  #define CMD_BROADCAST1                  0x14    /*1Àà¹ã²¥ºô½ÐÃüÁî*/
  96      =2  #define CMD_BROADCAST2                  0x15    /*2Àà¹ã²¥ºô½ÐÃüÁî*/
  97      =2  #define CMD_CALL_LISTEN                 0x16    /*½ÓÌýºô½ÐÃüÁî*/
  98      =2  #define CMD_PRIORITY_SET                0x17    /*ÓÅÏÈ¼¶Ö¸¶¨ÃüÁî*/              /*ÏµÍ³ÃüÁî£ºµÚÒ»¸ö×Ö½Ú¸ß3Î»ÎªÓÅÏÈ¼¶£¬½ÓÊÕ·½µØÖ·*/
  99      =2  #define CMD_SYSTERM_RESET               0x18    /*ÏµÍ³¸´Î»ÃüÁî*/
 100      =2  /*****************************************************************/
 101      =2  #define CMD_DATA_SEND                   0x19    /*ÈÕÆÚ·¢ËÍÃüÁî*/                /*Ç°Á½¸ö×Ö½Ú£¬Äê£º4Î»BCDÂë£¬ºóÃæÁ½¸ö×Ö½Ú£ºÔÂºÍÈÕÆÚ£º4Î»BCDÂ
             -ë*/
 102      =2  #define CMD_TIME_SEND                   0x1a    /*Ê±¼ä·¢ËÍÃüÁî*/
 103      =2  #define CMD_SCHEDULE_SEND               0x1b    /*Ò»ÀÀ±í·¢ËÍÃüÁî*/
 104      =2  #define CMD_NUMBER_SET                  0x1c    /*ÐÞ¸Ä±àºÅÃüÁî*/                /*ÐÂµÄµØÖ·ÔÚÇ°2¸ö×Ö½Ú£¬±»ÐÞ¸ÄµØÖ·ÔÚºóÁ½¸ö×Ö½Ú*/
 105      =2  #define CMD_LAMP_CONTROL                0x1d    /*µÆ¿ØÃüÁî*/
 106      =2  /*****************************************************************/
 107      =2  #define CMD_CONTROL_SEND                0x1e    /*¿ØÖÆ×Ö´«µÝÃüÁî*/
 108      =2  #define CMD_FLOOR_SET                   0x1f    /*ÐÞ¸ÄÂ¥²ãºÅÃüÁî*/
 109      =2  #define CMD_BROADCAST3                  0x20    /*3Àà¹ã²¥ºô½ÐÃüÁî*/
 110      =2  #define CMD_INFUSION_ENTER              0x21    /*È·ÈÏÊäÒºÃüÁî*/
 111      =2  #define CMD_SERVICE_ENTER               0x22    /*È·ÈÏ·þÎñÃüÁî*/
 112      =2  #define CMD_HELP_ENTER                  0x23    /*È·ÈÏÇóÔ®ÃüÁî*/
 113      =2  #define CMD_EMERGENCY_ENTER             0x24    /*È·ÈÏ½ô¼±ÃüÁî*/
 114      =2  /*****************************************************************/
 115      =2  #define CMD_CLEAR_INSPERCTOR    0x25    /*Çå³ý²é·¿ÃüÁî*/
 116      =2  #define CMD_START_VOICE                 0x26    /*Æô¶¯²¥ÒôÃüÁî*/
 117      =2  #define CMD_STOP_VOICE                  0x27    /*Í£Ö¹²¥ÒôÃüÁî*/
 118      =2  #define CMD_MUSIC_PLAY                  0x28    /*±³¾°ÒôÀÖÃüÁî*/
 119      =2  #define CMD_REQUEST_INFO                0x29    /*ÇëÇó·¢ËÍÐÅÏ¢ÃüÁî*/
 120      =2  /*****************************************************************/
 121      =2  #define CMD_CHANNEL_CHANGE              0x2a    /*ÇÐ»»Í¨»°Í¨µÀ*/
 122      =2  #define CMD_CHANNEL_CLOSE               0x2b    /*¹Ø±ÕÍ¨»°Í¨µÀ*/
 123      =2  #define CMD_POWER_ON                    0x2c    /*ÉÏµç¸´Î»ÃüÁî*/
 124      =2  #define CMD_INSPERCTOR_ENTER    0x2d    /*È·ÈÏ²é·¿ÃüÁî*/
 125      =2  #define CMD_STOP_INDICATION             0x2e    /*ÖÕÖ¹ÐÅÏ¢Ö¸Ê¾*/
 126      =2  #define CMD_INFO_INDICATION             0x2f    /*ÐÅÏ¢Ö¸Ê¾ÃüÁî*/
 127      =2  /*Ö÷¶¯ºô½Ð·½µØÖ·ÔÚÇ°Á½¸ö×Ö½Ú£¬ºóÃæÁ½¸ö×Ö½ÚÎªºô½ÐÀàÐÍ£º¸ß3Î»ÓÅÏÈ¼¶£¬µÍ5Î»ÎªÀà±ð*/
 128      =2  /*****************************************************************/
C51 COMPILER V8.08   SINGLEBUS                                                             02/22/2013 13:09:18 PAGE 34  

 129      =2  #define CMD_MUSIC                               0x30    /*ÒôÀÖÃüÁî*/
 130      =2  #define CMD_INCREACE_VOL                0x31    /*ÒôÁ¿Ôö¼ÓÃüÁî*/
 131      =2  #define CMD_DECREACE_VOL                0x32    /*ÒôÁ¿¼õÐ¡ÃüÁî*/
 132      =2  #define CMD_OPEN_LCD                    0x3e    /*´ò¿ªÏÔÊ¾ÃüÁî*/
 133      =2  #define CMD_CLOSE_LCD                   0x3f    /*¹Ø±ÕÏÔÊ¾ÃüÁî*/
 134      =2  /*****************************************************************/
 135      =2  #define CMD_OPEN_485BUS_OUT             0x40    /*´ò¿ª485Êä³ö*/
 136      =2  #define CMD_OPEN_485BUS_IN              0x41    /*´ò¿ª485ÊäÈëÃüÁî*/
 137      =2  #define CMD_CLOSE_485BUS                0x42    /*¹Ø±Õ485ÃüÁî*/
 138      =2  /*****************************************************************/
 139      =2  #define CMD_KEY_AVALID                  0x44    /*°´¼üÓÐÐ§ÃüÁî*/
 140      =2  #define CMD_KEY_INVALID                 0x45    /*°´¼üÊ§Ð§ÃüÁî*/
 141      =2  #define CMD_KEY_DOWN                    0x46    /*°´¼üÑ¹ÏÂÃüÁî*/
 142      =2  #define CMD_KEY_UP                              0x47    /*°´¼üÊÍ·ÅÃüÁî*/
 143      =2  #define CMD_ERROR_REPORT                0x48    /*¹ÊÕÏ±¨¸æÃüÁî*/
 144      =2  #define CMD_CLEAR_LCD                   0x49    /*Çå³ýÒº¾§ÐÅÏ¢ÃüÁî*/
 145      =2  #define CMD_RECEIVE_INFO                0x4a    /*ÊÕµ½ÐÅÏ¢ÃüÁî*/
 146      =2  #define CMD_SELECT_INFO                 0x4b    /*Ñ¡ÔñÐÅÏ¢ÃüÁî*/
 147      =2  #define CMD_NO_BUG                              0x4c    /*ÇëÎð´òÈÅÃüÁî*/
 148      =2  #define CMD_NO_BUG_AVALID               0x4d    /*ÇëÎð´òÈÅÓÐÐ§ÃüÁî*/
 149      =2  #define CMD_BUG_END                             0x4e    /*½áÊø´òÈÅÃüÁî*/
 150      =2  
 151      =2  
 152      =2  #define  CMD_STOP_VOICE_PLAY    0x90    //ÓïÒô±¨ºÅ½áÊøÃüÁî
 153      =2  
 154      =2  
 155      =2  #define CMD_VOICE_MAINTAIN      0x98    //ÏµÍ³Î¬»¤ÓïÒô   SndSecAddr  0x01:¿ªÊ¼²¥·Å   0X00:½áÊø²¥·Å
 156      =2  #define CMD_VOICE_WAITE                 0X99    //¡°ÇëÉÔºò£¬»¤Ê¿ÂíÉÏ¾ÍÀ´¡±ÓïÒô  0x01:¿ªÊ¼²¥·Å  0X00:½áÊø²¥·Å
 157      =2  
 158      =2  /*****************************************************************/  
 159      =2  #ifdef _IN_SINGLE_BUS_
 160      =2  //Éè±¸×´Ì¬¶¨Òå
 161      =2  uint8   bdata   byDevState1;
 162      =2  sbit    bLanding        =       byDevState1^0;                          //ÉÏµçµÇ¼Ç×´Ì¬  
 163      =2  #else
           =2 extern  uint8   byDevState1;
           =2 extern  bit             bLanding;
           =2 extern bit bPlayVoiceMaintain;
           =2 extern bit bPlayVoiceWait;
           =2 
           =2 
           =2 void SingleBusInit(void); 
           =2 void ReadParameter(void);       
           =2 void InitParameter(void);
           =2 void Bus0OutputData(uint8* pbyData);  
           =2 void MakeCH0TimerOut(uint8 byTimerOut, uint8 byTimerOutCount);
           =2 void Bus0RecDeal(void);
           =2 void Bus0SendDeal(void);
           =2 void Bus0Manage(void); 
           =2 void TimerOutDeal(void);
           =2 void TimerOutManager(void);
           =2 #endif
  79      =1  #include "Key.h"
   1      =2  /*
   2      =2  ************************Copyright(c)************************
   3      =2  *                                  ºþÄÏÒ»ÌØµç×Ó¹É·ÝÓÐÏÞ¹«Ë¾
   4      =2  *                               All Rights Reserved
   5      =2  *                                        
   6      =2  *
   7      =2  *-----------------------ÎÄ¼þÐÅÏ¢---------------------------
   8      =2  *ÎÄ¼þÃû³Æ               :Key.h
   9      =2  *ÎÄ¼þÃèÊö               :°´¼üÇý¶¯³ÌÐòÍ·ÎÄ¼þ
C51 COMPILER V8.08   SINGLEBUS                                                             02/22/2013 13:09:18 PAGE 35  

  10      =2  *´´½¨ÈË                 :ÒüÔËÍ¬
  11      =2  *´´½¨ÈÕÆÚ               :2008-9-22
  12      =2  *°æ±¾ºÅ                 :V1.0
  13      =2  *×¢ÊÍ                   :²ÉÓÃ°´¼üÓëµÆÏÔÊ¾¿ØÖÆ¹²ÓÃÒ»¸öI/O¿ÚµÄ·½Ê½                                        
  14      =2  *----------------------------------------------------------
  15      =2  *ÐÞ¸ÄÈË                         :
  16      =2  *ÐÞ¸ÄÈÕÆÚ                       :
  17      =2  *°æ±¾ºÅ                 :
  18      =2  *×¢ÊÍ                   :
  19      =2  ***********************************************************
  20      =2  */
  21      =2  #ifndef KEY_H
  22      =2  #define KEY_H
  23      =2  
  24      =2  #define         KEY_DELAY                       100                                                     //ÉèÖÃ³¤°´¼üÊ±¼ä
  25      =2  //°´¼ü¶¨Òå
  26      =2  #define COPY_KEY_VAL                    0x01                                                    //Êý¾Ý¿½±´¼ü
  27      =2  #define NO_KEY_VAL                      0xff                                                            //ÎÞ¼ü°´ÏÂ
  28      =2  
  29      =2  #ifndef _IN_KEY_
  30      =2  #define _IN_KEY_
  31      =2  extern bit bPrgState;
  32      =2                                          
  33      =2  extern void SetLedState(uint8 byState);
  34      =2  extern void KeyDownDeal(uint8 byKey);
  35      =2  extern void KeyUpDeal(uint8 byKey);
  36      =2  extern void KeyAlwaysDeal(uint8 byKey);
  37      =2  extern void KeyManager(void);
  38      =2  
  39      =2  #endif
  40      =2  
  41      =2  #endif
  80      =1  #include "IAP.h"
   1      =2  /*
   2      =2  ************************Copyright(c)************************
   3      =2  *                                  ºþÄÏÒ»ÌØµç×Ó¹É·ÝÓÐÏÞ¹«Ë¾
   4      =2  *                               All Rights Reserved
   5      =2  *                                        
   6      =2  *
   7      =2  *-----------------------ÎÄ¼þÐÅÏ¢---------------------------
   8      =2  *ÎÄ¼þÃû³Æ               :IAP.h
   9      =2  *ÎÄ¼þÃèÊö               :Ð´FlashÇý¶¯Í·ÎÄ¼þ
  10      =2  *´´½¨ÈË                 :ÒüÔËÍ¬
  11      =2  *´´½¨ÈÕÆÚ               :2008-9-22
  12      =2  *°æ±¾ºÅ                 :V1.0
  13      =2  *×¢ÊÍ                   :²ÉÓÃSTCÏµÁÐCPU,¸ÃÀàÐÍCPU½«ÄÚ²¿Flash×÷
  14      =2                                       EEPromÊ¹ÓÃ,²Á³ýÐèÒÔÉÈÇøÎªµ¥Î»,ÔÚ½øÐÐ
  15      =2                                       IAP²Ù×÷¹ý³ÌÖÐ,CPU°´ÕÕÉè¶¨µÄÊ±¼ä¹ÒÆð,
  16      =2                                       ´ËÊ±CPU²»ÄÜ¹»½øÐÐÈÎºÎ¹¤×÷
  17      =2  *----------------------------------------------------------
  18      =2  *ÐÞ¸ÄÈË                         :
  19      =2  *ÐÞ¸ÄÈÕÆÚ                       :
  20      =2  *°æ±¾ºÅ                 :
  21      =2  *×¢ÊÍ                   :
  22      =2  ***********************************************************
  23      =2  */
  24      =2  #define         IAP_READ                        0x01                                            //IAP¶ÁÃüÁî
  25      =2  #define         IAP_WRITE                       0x02                                            //IAPÐ´ÃüÁî
  26      =2  #define         IAP_ERASE                       0x03                                            //IAP²Á³ýÃüÁî
  27      =2  #define         IAP_WAIT_TIME           0x02                                            //IAPµÈ´ýÊ±¼ä 20MÒÔÏÂ
  28      =2  //#define               IAP_WAIT_TIME           0x03                                            //IAPµÈ´ýÊ±¼ä   12MÒÔÏÂ
  29      =2  
C51 COMPILER V8.08   SINGLEBUS                                                             02/22/2013 13:09:18 PAGE 36  

  30      =2  //#define       ISP_DATA        IAP_DATA        
  31      =2  //#define       ISP_CONTR       IAP_CONTR       
  32      =2  //#define       ISP_CMD         IAP_CMD         
  33      =2  //#define       ISP_ADDRH       IAP_ADDRH       
  34      =2  //#define       ISP_ADDRL       IAP_ADDRL       
  35      =2  //#define       ISP_TRIG        IAP_TRIG        
  36      =2  
  37      =2  
  38      =2  #ifndef _IN_IAP_
  39      =2  #define _IN_IAP_
  40      =2  void EnableIAP(uint8 byCmd);
  41      =2  void DisableIAP(void);
  42      =2  uint8 IapReadByte(uint16 uiAddr);
  43      =2  void IapWriteByte(uint16 uiAddr, uint8 byData);
  44      =2  void IapErase(uint16 uiAddr);
  45      =2  #endif
  81      =1  #include "VS10XX.h"
   1      =2  /** \file vs10xx.h
   2      =2   * Headers for interfacing with the mp3 player chip.
   3      =2   * Interfacing the New Way, not handling BSYNC -> not compatible with VS1001.
   4      =2   */
   5      =2  
   6      =2  
   7      =2  #ifndef VS10XX_H
   8      =2  #define VS10XX_H
   9      =2  
  10      =2  
  11      =2  /** VS10xx SCI Write Command byte is 0x02 */
  12      =2  #define VS_WRITE_COMMAND 0x02
  13      =2  
  14      =2  /** VS10xx SCI Read Command byte is 0x03 */
  15      =2  #define VS_READ_COMMAND 0x03
  16      =2  
  17      =2  
  18      =2  #define SPI_MODE        0x0   /**< VS10xx register */
  19      =2  #define SPI_STATUS      0x1   /**< VS10xx register */
  20      =2  #define SPI_BASS        0x2   /**< VS10xx register */
  21      =2  #define SPI_CLOCKF      0x3   /**< VS10xx register */
  22      =2  #define SPI_DECODE_TIME 0x4   /**< VS10xx register */
  23      =2  #define SPI_AUDATA      0x5   /**< VS10xx register */
  24      =2  #define SPI_WRAM        0x6   /**< VS10xx register */
  25      =2  #define SPI_WRAMADDR    0x7   /**< VS10xx register */
  26      =2  #define SPI_HDAT0       0x8   /**< VS10xx register */
  27      =2  #define SPI_HDAT1       0x9   /**< VS10xx register */
  28      =2  #define SPI_AIADDR      0xa   /**< VS10xx register */
  29      =2  #define SPI_VOL         0xb   /**< VS10xx register */
  30      =2  #define SPI_AICTRL0     0xc   /**< VS10xx register */
  31      =2  #define SPI_AICTRL1     0xd   /**< VS10xx register */
  32      =2  #define SPI_AICTRL2     0xe   /**< VS10xx register */
  33      =2  #define SPI_AICTRL3     0xf   /**< VS10xx register */
  34      =2  
  35      =2  #define SM_DIFF         0x01   /**< VS10xx register */
  36      =2  #define SM_JUMP         0x02   /**< VS10xx register */
  37      =2  #define SM_RESET        0x04   /**< VS10xx register */
  38      =2  #define SM_OUTOFWAV     0x08   /**< VS10xx register */
  39      =2  #define SM_PDOWN        0x10   /**< VS10xx register */
  40      =2  #define SM_TESTS        0x20   /**< VS10xx register */
  41      =2  #define SM_STREAM       0x40   /**< VS10xx register */
  42      =2  #define SM_PLUSV        0x80   /**< VS10xx register */
  43      =2  #define SM_DACT         0x100   /**< VS10xx register */
  44      =2  #define SM_SDIORD       0x200   /**< VS10xx register */
  45      =2  #define SM_SDISHARE     0x400   /**< VS10xx register */
C51 COMPILER V8.08   SINGLEBUS                                                             02/22/2013 13:09:18 PAGE 37  

  46      =2  #define SM_SDINEW       0x800   /**< VS10xx register */
  47      =2  #define SM_ADPCM        0x1000   /**< VS10xx register */
  48      =2  #define SM_ADPCM_HP     0x2000   /**< VS10xx register */
  49      =2  
  50      =2  
  51      =2  
  52      =2  /** Put the MP3 player chip in reset */
  53      =2  #define Mp3PutInReset(){MP3_XRESET=0;}
  54      =2  
  55      =2  /** Release the MP3 player chip from reset */
  56      =2  #define Mp3ReleaseFromReset(){MP3_XRESET=1;}
  57      =2  
  58      =2  
  59      =2  /** Pull the VS10xx Control Chip Select line Low */
  60      =2  #define Mp3SelectControl(){MP3_XCS=0;}
  61      =2  
  62      =2  /** Pull the VS10xx Control Chip Select line High */
  63      =2  #define Mp3DeselectControl(){MP3_XCS=1;}
  64      =2  
  65      =2  /** Pull the VS10xx Data Chip Select line Low */
  66      =2  #define Mp3SelectData(){MP3_XDCS=0;}
  67      =2  
  68      =2  /** Pull the VS10xx Data Chip Select line High */
  69      =2  #define Mp3DeselectData(){MP3_XDCS=1;}
  70      =2  
  71      =2  
  72      =2  #ifndef _IN_VS10XX_
  73      =2  extern void Mp3WriteRegister(uint8 addressbyte,uint8 highbyte,uint8 lowbyte);
  74      =2  extern void Mp3SetVolume(uint8 leftchannel,uint8 rightchannel);
  75      =2  extern unsigned int Mp3ReadRegister (unsigned char addressbyte);
  76      =2  extern void VS1003Init(void);
  77      =2  extern void VsSineTest();
  78      =2  extern void VS1003SendDat(uint8 dat);
  79      =2  extern void VS1003FlushBuffer(void);
  80      =2  extern void Mp3SoftReset(void);
  81      =2  
  82      =2  #endif
  83      =2  
  84      =2  #endif
  82      =1  #include "SPI.h"
   1      =2  /*
   2      =2  ************************Copyright(c)************************
   3      =2  *                                  ºþÄÏÒ»ÌØµç×Ó¹É·ÝÓÐÏÞ¹«Ë¾
   4      =2  *                               All Rights Reserved
   5      =2  *                                        
   6      =2  *
   7      =2  *-----------------------ÎÄ¼þÐÅÏ¢---------------------------
   8      =2  *ÎÄ¼þÃû³Æ               :SPI.h
   9      =2  *ÎÄ¼þÃèÊö               :SPI Çý¶¯³ÌÐòÍ·ÎÄ¼þ
  10      =2  *´´½¨ÈË                 :ÒüÔËÍ¬
  11      =2  *´´½¨ÈÕÆÚ               :2008-9-22
  12      =2  *°æ±¾ºÅ                 :V1.0
  13      =2  *×¢ÊÍ                   :                                       
  14      =2  *----------------------------------------------------------
  15      =2  *ÐÞ¸ÄÈË                         :
  16      =2  *ÐÞ¸ÄÈÕÆÚ                       :
  17      =2  *°æ±¾ºÅ                 :
  18      =2  *×¢ÊÍ                   :
  19      =2  ***********************************************************
  20      =2  */
  21      =2  /* SPI macros */
  22      =2          
C51 COMPILER V8.08   SINGLEBUS                                                             02/22/2013 13:09:18 PAGE 38  

  23      =2          /** switch to fast SPI Clock */
  24      =2  #define SPISetFastClock(){SPCTL=0x71;}  /* 0x73 is much slower*/
  25      =2          
  26      =2          
  27      =2          /** SPI data return register */
  28      =2  #define SPI_RESULT_BYTE SPDAT
  29      =2  
  30      =2  #ifndef _IN_SPI_
  31      =2  #define _IN_SPI_
  32      =2  
  33      =2  extern void SpiInit(void);
  34      =2  extern uint8 SPI_WriteByte(unsigned char dat);
  35      =2  extern unsigned char SPIGetChar();
  36      =2  extern void SPI8Clocks(unsigned char nClocks);
  37      =2  extern void Vs1003SpiInit(void);
  38      =2  
  39      =2  #endif
  40      =2  
  83      =1  #include "SST25VF.h"
   1      =2  /*
   2      =2  ************************Copyright(c)************************
   3      =2  *                                  ºþÄÏÒ»ÌØµç×Ó¹É·ÝÓÐÏÞ¹«Ë¾
   4      =2  *                               All Rights Reserved
   5      =2  *                                        
   6      =2  *
   7      =2  *-----------------------ÎÄ¼þÐÅÏ¢---------------------------
   8      =2  *ÎÄ¼þÃû³Æ               :MB85RS256.h
   9      =2  *ÎÄ¼þÃèÊö               :MB85RS256Ìúµç´æ´¢Æ÷Í·ÎÄ¼þ
  10      =2  *´´½¨ÈË                 :ÒüÔËÍ¬
  11      =2  *´´½¨ÈÕÆÚ               :2008-9-22
  12      =2  *°æ±¾ºÅ                 :V1.0
  13      =2  *×¢ÊÍ                   :
  14      =2  *----------------------------------------------------------
  15      =2  *ÐÞ¸ÄÈË                         :
  16      =2  *ÐÞ¸ÄÈÕÆÚ                       :
  17      =2  *°æ±¾ºÅ                 :
  18      =2  *×¢ÊÍ                   :
  19      =2  ***********************************************************
  20      =2  */
  21      =2  
  22      =2  
  23      =2  /*#define WREN    0x06
  24      =2  #define WRITE   0x02
  25      =2  #define READ    0x03
  26      =2  #define RDSR    0x05
  27      =2  #define EWSR    0X50
  28      =2  #define WRSR    0x01
  29      =2  #define WRDI    0x04
  30      =2  #define SECTOR_ERASE  0X20
  31      =2  #define BLOCK_ERASE   0X52
  32      =2  #define CHIP_ERASE    0X60
  33      =2  #define AAI_WRITE         0XAF
  34      =2  #define READ_ID1      0X90
  35      =2  #define READ_ID2      0XAB*/
  36      =2  
  37      =2  
  38      =2  #ifndef _IN_SST25VF_
  39      =2  #define _IN_SST25VF_
  40      =2  
  41      =2  extern unsigned char xdata FRAM_BUFF[];
  42      =2  
  43      =2  extern void SST25VF_Init();
C51 COMPILER V8.08   SINGLEBUS                                                             02/22/2013 13:09:18 PAGE 39  

  44      =2  extern void Send_Byte(unsigned char out);
  45      =2  extern unsigned char Get_Byte();
  46      =2  extern void Poll_SO();
  47      =2  extern void CE_High();
  48      =2  extern void CE_Low();
  49      =2  extern void Hold_Low();
  50      =2  extern void Unhold();
  51      =2  extern void WP_Low();
  52      =2  extern void UnWP();
  53      =2  extern unsigned char Read_Status_Register();
  54      =2  extern void EWSR();
  55      =2  extern void WRSR(byte);
  56      =2  extern void WREN();
  57      =2  extern void WRDI();
  58      =2  extern void EBSY();
  59      =2  extern void DBSY();
  60      =2  extern unsigned char Read_ID(ID_addr);
  61      =2  extern unsigned long Jedec_ID_Read(); 
  62      =2  extern unsigned char Read(unsigned long Dst);
  63      =2  extern void Read_Cont(unsigned long Dst, unsigned long no_bytes,uint8 *pBuffer);
  64      =2  extern unsigned char HighSpeed_Read(unsigned long Dst); 
  65      =2  extern void HighSpeed_Read_Cont(unsigned long Dst, unsigned long no_bytes,uint8 *pBuffer);
  66      =2  extern void Byte_Program(unsigned long Dst, unsigned char byte);
  67      =2  extern void Auto_Add_IncA(unsigned long Dst, unsigned char byte1, unsigned char byte2);
  68      =2  extern void Auto_Add_IncB(unsigned char byte1, unsigned char byte2);
  69      =2  extern void Auto_Add_IncA_EBSY(unsigned long Dst, unsigned char byte1, unsigned char byte2);
  70      =2  extern void Auto_Add_IncB_EBSY(unsigned char byte1, unsigned char byte2);
  71      =2  extern void Chip_Erase();
  72      =2  extern void Sector_Erase(unsigned long Dst);
  73      =2  extern void Block_Erase_32K(unsigned long Dst);
  74      =2  extern void Block_Erase_64K(unsigned long Dst);
  75      =2  extern void Wait_Busy();
  76      =2  extern void Wait_Busy_AAI();
  77      =2  extern void WREN_Check();
  78      =2  extern void WREN_AAI_Check();
  79      =2  
  80      =2  extern void Verify(unsigned char byte, unsigned char cor_byte);
  81      =2  extern void Byte_Write(unsigned long Dst, unsigned char byte);
  82      =2  extern void AAI_Write(unsigned long Dst, uint8 *p,uint8 no_bytes);
  83      =2  extern void Byte_Write1(unsigned long Dst, unsigned char byte);
  84      =2  extern void AAI_Write1(unsigned long Dst, uint8 *p,uint8 no_bytes);
  85      =2  extern void FRAM_TEST(void);
  86      =2  
  87      =2  
  88      =2  
  89      =2  #endif
  90      =2  
  84      =1  #include "player.h"
   1      =2  
   2      =2  #ifndef PLAYER_H
   3      =2  #define PLAYER_H
   4      =2  
   5      =2  
   6      =2  /*
   7      =2  0       0.mp3£º0x00000000
   8      =2  1       1.mp3£º0x000028c9
   9      =2  2       2.mp3£º0x00004f6e
  10      =2  3       3.mp3£º0x00007613
  11      =2  4       4.mp3£º0x00009e25
  12      =2  5       5.mp3£º0x0000c580
  13      =2  6       6.mp3£º0x0000ed92
  14      =2  7       7.mp3£º0x0001115b
C51 COMPILER V8.08   SINGLEBUS                                                             02/22/2013 13:09:18 PAGE 40  

  15      =2  8       8.mp3£º0x0001396d
  16      =2  9       9.mp3£º0x00015ded
  17      =2  10      ¹©Ñõ.mp3£º0x00018548
  18      =2  11  ¼Ó.mp3
  19      =2  12      Ê®.mp3£º0x0001f61c
  20      =2  13      ÎÀÉú¼ä.mp3£º0x00021e2e
  21      =2  14      ºÅ.mp3£º0x00024a89
  22      =2  15      ºô½Ð.mp3£º0x00025dd2
  23      =2  16      Íê±Ï.mp3£º0x000288c0
  24      =2  17      ´².mp3£º0x0002f994
  25      =2  18      ¿ªÊ¼.mp3£º0x00030e4b
  26      =2  19      ·¿.mp3£º0x00037f1f
  27      =2  20      °Ù.mp3£º0x00039c7a
  28      =2  21      ÊäÒº.mp3£º0x0003b131
  29      =2  22  ÇëÉÔºò.mp3
  30      =2  23  ÏµÍ³·þÎñ.mp3
  31      =2  */
  32      =2  
  33      =2  
  34      =2  #define ZERO_VOICE      0
  35      =2  #define ONE_VOICE       1
  36      =2  #define TOW_VOICE       2
  37      =2  #define THREE_VOICE     3
  38      =2  #define FOUR_VOICE      4
  39      =2  #define FIVE_VOICE      5
  40      =2  #define SIX_VOICE       6
  41      =2  #define SEVEN_VOICE     7
  42      =2  #define EIGHT_VOICE     8
  43      =2  #define NINE_VOICE      9
  44      =2  #define OX_SUPPLY_VOICE 10
  45      =2  #define ADD_VOICE       11
  46      =2  #define TEN_VOICE       12
  47      =2  #define TOILET_VOICE    13
  48      =2  #define NUM_VOICE       14
  49      =2  #define CALL_VOICE      15
  50      =2  #define END_VOICE       16
  51      =2  #define BED_VOICE       17
  52      =2  #define START_VOICE     18
  53      =2  #define ROOM_VOICE      19
  54      =2  #define HUNDRED_VOICE 20
  55      =2  #define INFUSION_VOICE 21
  56      =2  #define WAIT_VOICE   22
  57      =2  #define MAINTAIN_VOICE 23
  58      =2  
  59      =2  
  60      =2  
  61      =2  //ISD1700×´Ì¬¿ØÖÆ×Ö
  62      =2  #define         ISD_PLAYING             0x01                                                            //ÓïÒôÐ¾Æ¬ÕýÔÚ²¥Òô
  63      =2  #define         ISD_REPLAY              0x02                                                            //ÓïÒôÐ¾Æ¬ÖØ²¥Òô
  64      =2  #define         ISD_TIME_OVER   0x04                                                            //Ò»ÂÖ²¥ÒôÊ±¼äµ½ÁË
  65      =2  
  66      =2  #ifndef _IN_PLAYER_
  67      =2  extern uint32 code ulVoiceDataAddr[19][2];
  68      =2  extern void SetPlay(uint8 byPos);
  69      =2  extern void PlayManager(void);
  70      =2  #endif
  71      =2  
  72      =2  #endif
  85      =1  
  86      =1           
  87      =1  //Éè±¸ÅäÖÃ×Ö¶¨Òå
  88      =1  typedef struct
C51 COMPILER V8.08   SINGLEBUS                                                             02/22/2013 13:09:18 PAGE 41  

  89      =1  {
  90      =1          uint8   byInitFlag;                                                                     //³õÊ¼»¯²ÎÊý±êÖ¾
  91      =1          
  92      =1  } STEepromCfgData, *pSTEepromCfgData;
  93      =1  
  94      =1  
  95      =1  #define         VOICE_DATA_SIZE         16
  96      =1  
  97      =1  //ÓïÒô±¨ºÅ¿ØÖÆÌå
  98      =1  typedef struct _STVoicePlay 
  99      =1  {
 100      =1      uint8  byVoiceData[VOICE_DATA_SIZE];                                        //ÐèÒª²¥·ÅµÄÓïÒôÊý¾Ý
 101      =1      uint8  byVoicePosition;                                                                     //²¥·ÅÓïÒôÎ»ÖÃ
 102      =1      uint8  byVoiceSize;                                                                         //ÐèÒª²¥·ÅµÄÓïÒô³¤¶È   
 103      =1      uint8  byVS1003State;
 104      =1          uint8  byVoiceTimes;                                                                    //ÓïÒô±¨ºÅµÄ±éÊý
 105      =1  } STVoicePlay, *pSTVoicePlay;
 106      =1  
 107      =1  //³¬Ê±¿ØÖÆ½á¹¹Ìå
 108      =1  typedef struct
 109      =1  {
 110      =1          uint8                           byTimerOutSet;                                          //Ò»´Î³¬Ê±Ê±¼äÉèÖÃ(20msµ¥Î»)
 111      =1          uint8                           byTimerOut;                                                     //Ò»´Î³¬Ê±Ê±¼ä(20msµ¥Î»)
 112      =1          uint8                           byTimerOutCount;                                        //ÔÊÐí³¬Ê±´ÎÊý 
 113      =1  } STTimerOut, *pSTTimerOut;             
 114      =1  
 115      =1  //ÐÅÏ¢Ö¸Ê¾·½½á¹¹Ìå
 116      =1  typedef struct _STIndicationData
 117      =1  {
 118      =1      uint8  byIndicationSecAddr;                                                         //Ö¸Ê¾·½ÇøµØÖ·
 119      =1      uint8  byIndicationRoomAddr;                                                        //Ö¸Ê¾·½·¿µØÖ·  
 120      =1      uint8  byIndicationBedAddr;                                                         //Ö¸Ê¾·½´²µØÖ· 
 121      =1      uint8  byCallCmd;                                                                           //Ö¸Ê¾µÄÃüÁî
 122      =1      uint8  byState;                                                                                     //¸Ãºô½ÐÐÅÏ¢µÄ×´Ì¬
 123      =1  } STIndicationData, *pSTIndicationData;
 124      =1  
 125      =1  
 126      =1  //È«¾Ö¿ØÖÆ½á¹¹Ìå
 127      =1  typedef struct
 128      =1  {
 129      =1          uint8                           byChar1;                                                        //×Ö½ÚÊý¾Ý1     
 130      =1          uint16                          uiShortType;                                            //¶ÌÕûÐÍÊý¾Ý    
 131      =1          uint8                           xdata* pbyData;                                         //Êý¾ÝÖ¸Õë
 132      =1          STBusFreq                       stBusDealFreq;                                          //µ¥×ÜÏß´¦Àí½á¹¹Ìå
 133      =1          STVoicePlay             stVoicePlay;                                            //ÓïÒô²¥·Å¿ØÖÆ  
 134      =1          STTimerOut                      stCH0TimerOut;                                          //Éè±¸µ±Ç°×´Ì¬³¬Ê±¿ØÖÆ½á¹¹Ìå
 135      =1          STEepromCfgData         stEepromCfgData;                                        //ÏµÍ³ÅäÖÃ×Ö                    
 136      =1  } STLocalControl, *pSTLocalControl;             
 137      =1  
 138      =1  //5msPCAÖÐ¶Ï¼ÆÊ±´ÎÊý£¬Fosc=18.432MHz,·ÖÆµÏµÊýÎª2 
 139      =1  #define Fosc                            18432000
 140      =1  #define Fbus                            184320
 141      =1          
 142      =1                          
 143      =1  #define ISR_INC_COUNT           (Fosc/2/OS_TICKS_PER_SEC)
 144      =1  #define IAP_ADDR                        0x0000          //STC12C5624ÄÚµÄE2Ö»ÄÜÊÇÊý¾ÝE2
 145      =1  #define INIT_FLAG           0x5a
 146      =1  
 147      =1  
 148      =1  #ifndef _IN_MAIN_
 149      =1  extern void Send_Data(uint8 *Databuf,uint8 l);
 150      =1  extern void Send_Data_Byte(uint8 SndData);
C51 COMPILER V8.08   SINGLEBUS                                                             02/22/2013 13:09:18 PAGE 42  

 151      =1  extern void delay_nus(uint16 i);
 152      =1  extern void delay_nms(uint16 ms);
 153      =1  
 154      =1  
 155      =1  extern uint16   xdata uiIsrTimerCount ;                                 //ÏµÍ³Ê±ÖÓ¶¨Ê±Öµ
 156      =1  extern uint8    OS_Q_MEM_SEL    byMainCmdQ[];                                           //Ö÷Ïß³ÌÏûÏ¢¶ÓÁÐ
 157      =1  extern STLocalControl   xdata stLocalControl;                                           //È«¾Ö±äÁ¿½á¹¹Ìå
 158      =1  extern uint8    data volumn;
 159      =1  extern uint32   xdata SST25VFAddr;
 160      =1  extern int32  xdata VoiceDataLen;
 161      =1  extern uint8 xdata i;
 162      =1  
 163      =1  extern void ConsoleWrite(char code *str);
 164      =1  
 165      =1  
 166      =1  #endif
  23          
  24          
  25          //×ÜÏß0±äÁ¿¶¨Òå
  26          uint8 bdata byBus0State0        = 0;                                                    //µ¥×ÜÏß0×´Ì¬×Ö1
  27          sbit  bBus0StartRec                     = byBus0State0^0;                               //µ¥×ÜÏß0¿ªÊ¼½ÓÊÕÆðÊ¼Î»±êÖ¾
  28          sbit  bBus0OnRec                        = byBus0State0^1;                               //µ¥×ÜÏß0¿ªÊ¼½ÓÊÕÊý¾ÝÎ»±êÖ¾
  29          sbit  bBus0Enable                       = byBus0State0^2;                               //µ¥×ÜÏß0ÔÊÐí·¢ËÍ±êÖ¾
  30          sbit  bBus0ReqSend                      = byBus0State0^3;                               //µ¥×ÜÏß0ÇëÇó·¢ËÍ±êÖ¾
  31          sbit  bBus0OnSendBit            = byBus0State0^4;                               //µ¥×ÜÏß0ÕýÔÚ·¢ËÍÒ»¸öÊý¾ÝÎ»±êÖ¾
  32          sbit  bBus0OnSendFreq           = byBus0State0^5;                               //µ¥×ÜÏß0ÕýÔÚ·¢ËÍÒ»¸öÊý¾ÝÖ¡±êÖ¾
  33          sbit  bBus0SendError            = byBus0State0^6;                               //µ¥×ÜÏß0·¢ËÍ´íÎó±êÖ¾
  34          sbit  bBus0Error                        = byBus0State0^7;                               //µ¥×ÜÏß0¹ÊÕÏ±êÖ¾
  35          uint8 bdata byBus0State1        = 0;                                                    //µ¥×ÜÏß0×´Ì¬×Ö2
  36          sbit  bBus0RecFinish            = byBus0State1^0;                               //µ¥×ÜÏß0½ÓÊÕÍê³É±êÖ¾
  37          sbit  bBus0RecBit9                      = byBus0State1^1;                               //µ¥×ÜÏß0½ÓÊÕ×Ö½ÚÊý¾ÝµÄµÚ9Î»
  38          sbit  bBus0SendFinish           = byBus0State1^2;                               //µ¥×ÜÏß0·¢ËÍÍê³É±êÖ¾
  39          sbit  bBus0Disable                      = byBus0State1^3;                               //µ¥×ÜÏß0½ûÖ¹·¢ËÍ±êÖ¾
  40          sbit  bBus0SendBit                      = byBus0State1^4;                               //µ¥×ÜÏß0ÕýÔÚ·¢ËÍµÄÊý¾ÝÎ»
  41          sbit  bBus0RecBit                       = byBus0State1^5;                               //µ¥×ÜÏß0ÕýÔÚ½ÓÊÕµÄÊý¾ÝÎ»
  42          uint8 data byBus0RecCount = 0;                                                          //¸ß4Î»ÊÇ×ÜÏß0½ÓÊÕ¶¨Ê±ÖÐ¶Ï¼ÆÊý£¬µÍ4Î»ÊÇ½ÓÊÕµ½µÄÎ»¼ÆÊý
  43          uint8 data byBus0RecBuf;                                                                        //×ÜÏß0½ÓÊÕ»º³åµ¥Ôª
  44          uint8 data byBus0SendBuf;                                                                       //×ÜÏß0·¢ËÍ»º³åµ¥Ôª     
  45          uint8 xdata byBus0RecData[BUS0_FREQ_SIZE];                                      //×ÜÏß0½ÓÊÕ»º³åÇø
  46          uint8 xdata byBus0SendData[BUS0_FREQ_SIZE];                                     //×ÜÏß0·¢ËÍ»º³åÇø
  47          uint8 data byBus0SendCount = 0;                                                         //¸ß4Î»ÊÇ×ÜÏß0·¢ËÍ¶¨Ê±ÖÐ¶Ï¼ÆÊý£¬µÍ4Î»ÊÇ·¢ËÍµÄÎ»¼ÆÊý
  48          uint8 data byBus0RecSendCount = 0;                                                      //¸ß4Î»ÊÇ×ÜÏß0½ÓÊÕµ½µÄ×Ö½Ú¼ÆÊý£¬µÍ4Î»ÊÇ×ÜÏß0·¢ËÍÍêµÄ×Ö½Ú¼ÆÊý
  49          uint8 data byBus0SendStopCount;                                                         //×ÜÏß0Í£Ö¹Ê±¼ä¼ÆÊý
  50          uint8 data byBus0RecTimeOut = 0;                                                        //×ÜÏß0½ÓÊÕ³¬Ê±¼ÆÊý
  51          uint8 data byBus0DisableCount = 0;                                                      //×ÜÏß0½ûÖ¹¼ÆÊý  
  52          uint8 xdata byBus0TxQ[BUS0_TX_Q_ZISE];                                          //×ÜÏß0·¢ËÍ¶ÓÁÐ                                                 
  53          uint8 data byBus0TxHead = 0;                                                            //µ¥×ÜÏß0·¢ËÍ¶ÓÁÐÍ·Ö¸Õë
  54          uint8 data byBus0TxTail = 0;                                                            //µ¥×ÜÏß0·¢ËÍ¶ÓÁÐÎ²Ö¸Õë
  55          #define IncBus0TxPtr(addr)    {addr=(addr+1)%BUS0_TX_Q_ZISE;}
  56          #define Bus0TxBuffLen()       ((byBus0TxTail+BUS0_TX_Q_ZISE-byBus0TxHead)%BUS0_TX_Q_ZISE)
  57          //·¢ËÍºÍ½ÓÊÕÒý½Å¶¨Òå
  58          sbit  Bus0RecPin        = P3^3;                                                                 //µ¥×ÜÏß0½ÓÊÕÒý½Å¶¨Òå
  59          sbit  Bus0SendPin       = P3^4;                                                                 //µ¥×ÜÏß0·¢ËÍÒý½Å¶¨Òå
  60          
  61          
  62          bit bPlayVoiceMaintain=0;                               //²¥·ÅÏµÍ³Î¬»¤ÓïÒô±êÖ¾
  63          bit bPlayVoiceWait=0;                                   //²¥·ÅÇëÉÔºòÓïÒô±êÖ¾
  64          
  65          /**********************************************************
  66          *º¯ÊýÃû³Æ                       :SingleBusInit  
  67          *º¯ÊýÃèÊö               :µ¥×ÜÏß³õÊ¼»¯
  68          *ÊäÈë²ÎÊý               :
C51 COMPILER V8.08   SINGLEBUS                                                             02/22/2013 13:09:18 PAGE 43  

  69          *·µ»ØÖµ                         :       
  70          *È«¾Ö±äÁ¿                       :
  71          *µ÷ÓÃÄ£¿é                       :
  72          ***********************************************************
  73          *´´½¨ÈË                 :³ÂÎÀ¹ú
  74          *´´½¨ÈÕÆÚ                       :2008-9-22
  75          ***********************************************************
  76          *ÐÞ¸ÄÈË                         :
  77          *ÐÞ¸ÄÈÕÆÚ               :
  78          *×¢ÊÍ                   :
  79          **********************************************************/
  80          void SingleBusInit(void)
  81          {
  82   1              //tx:Ç¿ÍÆÍìÊä³ö
  83   1      //      P3M0 &= (~(Bin(0,0,0,1,0,0,0,0)));
  84   1      //      P3M1 |= Bin(0,0,0,1,0,0,0,0);
  85   1      
  86   1              //P3^3,¸ß×èÊäÈë
  87   1              P3M0 |=   Bin(0,0,0,0,1,0,0,0);
  88   1              P3M1 &= (~Bin(0,0,0,0,1,0,0,0));
  89   1      
  90   1              //P3^4¿ªÂ©Êä³ö
  91   1              P3M0 |=   Bin(0,0,0,1,0,0,0,0);
  92   1              P3M1 |=   Bin(0,0,0,1,0,0,0,0);
  93   1      
  94   1              
  95   1              //×ÜÏßµçÆ½ÉèÖÃ
  96   1              Bus0SendPin = 1;
  97   1              Bus0RecPin = 1; 
  98   1              //¶¨Ê±Æ÷0³õÊ¼»¯:×Ô¶¯ÖØÔØ·½Ê½,¶¨Ê±93.75us
  99   1         // TMOD |= 0x02;
 100   1      //      TL0 = 0;
 101   1      //      TH0 = TIMER0_COUNT;
 102   1      
 103   1          TMOD&= 0xf0;         //  ;t1×÷²¨ÌØÂÊ·¢ÉúÆ÷(²»±ä)£¬
 104   1          TMOD|=0X01; //t0×÷·½Ê½1£¨16Î»)¶¨Ê±Æ÷
 105   1              
 106   1              TL0 = TIMER0_L;
 107   1              TH0 = TIMER0_H;
 108   1              
 109   1              TF0 = 0;                                                                                                //Çå³ýÖÐ¶Ï±êÖ¾
 110   1              AUXR &= 0x7f;                                                                                   //´«Í³12·ÖÆµËÙ¶È  
 111   1              ET0 = 1;                                                                                                //ÔÊÐí¶¨Ê±Æ÷0ÖÐ¶Ï 
 112   1              TR0 = 1;                                                                                                //Æô¶¯¶¨Ê±Æ÷
 113   1              //ÆäËü¿ØÖÆÉèÖÃ
 114   1              byBus0SendStopCount = 230;                                                              //ÉÏµç×ÜÏß0½ûÖ¹·¢ËÍÊ±¼äÉèÖÃ
 115   1              IT1 = 1;                                                                                                //Íâ²¿ÖÐ¶Ï1ÎªÏÂ½µÑØ´¥·¢Ä£Ê½                     
 116   1              if(Bus0RecPin)
 117   1              {       //Èç¹û×ÜÏßÕý³£,¿ªÖÐ¶Ï                   
 118   2                      EX1 = 1;
 119   2              }
 120   1              else
 121   1              {       //Èç¹û×ÜÏß²»Õý³£,ÖÃ×ÜÏß¹ÊÕÏ±êÖ¾                 
 122   2                      bBus0Error = 1;
 123   2              }       
 124   1      }
 125          
 126          /**********************************************************
 127          *º¯ÊýÃû³Æ                       :Bus0RecInt     
 128          *º¯ÊýÃèÊö               :Íâ²¿ÖÐ¶Ï1º¯Êý,µ¥×ÜÏß1½ÓÊÕÖÐ¶Ï
 129          *ÊäÈë²ÎÊý               :
 130          *·µ»ØÖµ                         :       
C51 COMPILER V8.08   SINGLEBUS                                                             02/22/2013 13:09:18 PAGE 44  

 131          *È«¾Ö±äÁ¿                       :
 132          *µ÷ÓÃÄ£¿é                       :
 133          ***********************************************************
 134          *´´½¨ÈË                 :³ÂÎÀ¹ú
 135          *´´½¨ÈÕÆÚ                       :2008-9-22
 136          ***********************************************************
 137          *ÐÞ¸ÄÈË                         :
 138          *ÐÞ¸ÄÈÕÆÚ               :
 139          *×¢ÊÍ                   :
 140          **********************************************************/
 141          #pragma disable
 142          void Bus0RecInt(void) interrupt 2
 143          { 
 144   1              DisableBus0RecInt();                                                                    //½ûÖ¹ÔÙ´ÎÏÂ½µÑØÖÐ¶Ï
 145   1              bBus0StartRec = 1;                                                                              //Æô¶¯ÆðÊ¼Î»ÑØ¼ì²â
 146   1              bBus0Enable = 0;                                                                                //½ûÖ¹×ÜÏß·¢ËÍ                                                  
 147   1              byBus0RecCount = 0;                                                                             //Çå½ÓÊÕ¼Ä´æÆ÷  
 148   1      }
 149          /**********************************************************
 150          *º¯ÊýÃû³Æ                       :Timer0Int      
 151          *º¯ÊýÃèÊö               :¶¨Ê±Æ÷0Òç³öÖÐ¶Ï,¶¨Ê±Æ÷Ã¿93.75usÖÐ¶ÏÒ»´Î
 152                                                   ³ÌÐò¼ä¸ô¼ì²é×ÜÏß0Óë×ÜÏß1µÄ½ÓÊÕºÍ·¢ËÍ
 153          *ÊäÈë²ÎÊý               :
 154          *·µ»ØÖµ                         :       
 155          *È«¾Ö±äÁ¿                       :
 156          *µ÷ÓÃÄ£¿é                       :
 157          ***********************************************************
 158          *´´½¨ÈË                 :³ÂÎÀ¹ú
 159          *´´½¨ÈÕÆÚ                       :2008-9-22
 160          ***********************************************************
 161          *ÐÞ¸ÄÈË                         :
 162          *ÐÞ¸ÄÈÕÆÚ               :
 163          *×¢ÊÍ                   :
 164          **********************************************************/
 165          #pragma disable
 166          void Timer0Int(void) interrupt 1
 167          { 
 168   1      
 169   1              TR0=0;
 170   1              TH0=TIMER0_H;
 171   1              TL0=TIMER0_L;
 172   1              TR0=1;
 173   1      
 174   1              bBus0RecBit = Bus0RecPin;       
 175   1              /*******************************×ÜÏß0½ÓÊÕ´¦Àí***********************************/
 176   1              if(bBus0StartRec)                                                                               //ÅÐ¶Ï×ÜÏßËù´¦µÄ×´Ì¬£¬½ÓÊÕµ½ÆðÊ¼Î»
 177   1              {                       
 178   2                      byBus0RecCount += 0x10;                                                         //Ôö¼Ó¶¨Ê±ÖÐ¶Ï¼ÆÊý´ÎÊý
 179   2                      if(0x50 == (byBus0RecCount & 0xf0))                                     //µ½×ÜÏßÆðÊ¼Î»¼ì²âÊ±¼ä
 180   2                      {                       
 181   3                              bBus0StartRec = 0;
 182   3                              byBus0RecCount = 0x00;                                                  //ÖØÐÂ¿ªÊ¼¼ÆÊý                  
 183   3                              if(bBus0RecBit)                 
 184   3                              {       //ÎÞÐ§ÆðÊ¼Î»                                                                                                                                            
 185   4                                      if((!bBus0SendError)&&bBus0OnSendFreq)
 186   4                                      {       //Ã»ÓÐ·¢Éú¹ý×ÜÏß·¢ËÍ´íÎó,ÇÒÓÐÒ»Ö¡Êý¾ÝÕýÔÚ·¢ËÍ,Í£Ö¹Ö¡Êý¾Ý·¢ËÍ,ÖÃ·¢ËÍ´íÎó±êÖ¾                                             
 187   5                                              byBus0State0 &= (~BUS0_SEND_CON);
 188   5                                              bBus0SendError = 1;
 189   5                                              Bus0SendPin = 1;                                                //ÊÍ·Å×ÜÏß                                      
 190   5                                      }                               
 191   4                                      byBus0SendStopCount = 240;                                      
 192   4                                      byBus0RecSendCount = 0x00;                                      //½ÓÊÕ³ö´í,ÖØÖÃ½ÓÊÕ·¢ËÍ¼ÆÊýÖµ
C51 COMPILER V8.08   SINGLEBUS                                                             02/22/2013 13:09:18 PAGE 45  

 193   4                                      EnableBus0RecInt();                             
 194   4                              }
 195   3                              else                                                            
 196   3                              {       //ÓÐÐ§ÆðÊ¼Î»
 197   4                                      bBus0OnRec = 1;                                                         //¿ªÊ¼½ÓÊÕÊý¾ÝÎ»                                                                                        
 198   4                              }
 199   3                      }
 200   2              }
 201   1              else if(bBus0OnRec)
 202   1              {               
 203   2                      byBus0RecCount += 0x10;                                                         //Ôö¼Ó¶¨Ê±ÖÐ¶Ï¼ÆÊý´ÎÊý                  
 204   2                      if(0xa0 == (byBus0RecCount & 0xf0))
 205   2                      {
 206   3                              byBus0RecCount &= 0x0f;                                                 //Çå³ý¶¨Ê±ÖÐ¶Ï¼ÆÊý´ÎÊý
 207   3                              byBus0RecCount += 0x01;
 208   3                              if(0x0a == (byBus0RecCount & 0x0f))     
 209   3                              {       //ÊÕµ½µÚ10Î»,½áÊøÎ»                                     
 210   4                                      bBus0OnRec = 0;                                                         //Í£Ö¹Êý¾Ý½ÓÊÕ                                  
 211   4                                      if(bBus0RecBit)
 212   4                                      {       //ÓÐÐ§µÄ½áÊøÎ»                                                  
 213   5                                              if(((bit)(byBus0RecSendCount & 0xf0) == bBus0RecBit9)) 
 214   5                                              {       //Êý¾Ýèå´íÎó
 215   6                                                      byBus0RecTimeOut = 0;
 216   6                                                      byBus0RecSendCount &= 0x0f;                                                                                     
 217   6                                              }
 218   5                                              else 
 219   5                                              {       //Êý¾ÝèåÕýÈ·                                    
 220   6                                                      byBus0RecTimeOut = 230;                         //ÉèÖÃÏÂÒ»¸ö×Ö½ÚÊý¾Ý½ÓÊÕ³¬Ê±Ê±¼ä
 221   6                                                      byBus0RecData[byBus0RecSendCount>>4] = byBus0RecBuf;
 222   6                                                      byBus0RecSendCount += 0x10;                                                                                                                                                                     
 223   6                                                      if((byBus0RecSendCount & 0xf0) >= BUS0_FREQ_SIZE_HI)
 224   6                                                      {                                                                                                                                                                               
 225   7                                                              byBus0RecSendCount &= 0x0f;                                                     
 226   7                                                              if(!((bBus0OnSendFreq == 1)&&(bBus0ReqSend == 0)))
 227   7                                                              {       //Èç¹û½ÓÊÕµ½µÄÕâÖ¡Êý¾ÝÊÇ×Ô¼º·¢ËÍµÄ²»ÖÃ±êÖ¾                                                      
 228   8                                                                      bBus0RecFinish = 1;                                                                                                                                                                                                                                                                                                             
 229   8                                                              }                                                                                                                                               
 230   7                                                              byBus0RecTimeOut = 0;
 231   7                                                              byBus0DisableCount = 10;
 232   7                                                              bBus0Disable = 1;                               //½ûÖ¹×ÜÏßÊ¹ÓÃ                                                  
 233   7                                                      }       
 234   6                                              }                               
 235   5                                              byBus0SendStopCount = 240;
 236   5                                              EnableBus0RecInt();                                             
 237   5                                      }
 238   4                                      else                                                    
 239   4                                      {       //ÎÞÐ§½áÊøÎ»
 240   5                                              bBus0Error = 1;                                                                         
 241   5                                              if((!bBus0SendError) && bBus0OnSendFreq)
 242   5                                              {       //Ã»ÓÐ·¢Éú¹ý×ÜÏß·¢ËÍ´íÎó,ÇÒÓÐÒ»Ö¡Êý¾ÝÕýÔÚ·¢ËÍ,Í£Ö¹Ö¡Êý¾Ý·¢ËÍ,ÖÃ·¢ËÍ´íÎó±êÖ¾
 243   6                                                      byBus0State0 &= (~BUS0_SEND_CON);
 244   6                                                      bBus0SendError = 1;                                                     
 245   6                                                      Bus0SendPin = 1;                                        //ÊÍ·Å×ÜÏß
 246   6                                              }
 247   5                                              byBus0RecSendCount = 0x00;                              //½ÓÊÕ³ö´í,ÖØÖÃ½ÓÊÕ·¢ËÍ¼ÆÊýÖµ                                   
 248   5                                      }
 249   4                              }
 250   3                              else if(0x09 == (byBus0RecCount & 0x0f))
 251   3                              {       //µÚ9Î»Êý¾Ý
 252   4                                      bBus0RecBit9 = bBus0RecBit;                                     
 253   4                              }
 254   3                              else                                                                                    
C51 COMPILER V8.08   SINGLEBUS                                                             02/22/2013 13:09:18 PAGE 46  

 255   3                              {       //ÓÐÐ§Êý¾ÝÎ»
 256   4                                      byBus0RecBuf >>= 1;
 257   4                                      if(bBus0RecBit)
 258   4                                      {       //Îª¸ßµçÆ½
 259   5                                              byBus0RecBuf |= 0x80;
 260   5                                      }       
 261   4                              }
 262   3                      }
 263   2              }
 264   1              /*******************************×ÜÏß0·¢ËÍ´¦Àí***********************************/
 265   1              if((byBus0State0 & BUS0_CAN_SEND) == BUS0_CAN_SEND)
 266   1              {       //×ÜÏß0ÉÏÓÐÊý¾Ý·¢ËÍÇëÇó,ÇÒ×ÜÏßÔÊÐí·¢ËÍ          
 267   2                      if(bBus0RecBit)
 268   2                      {       //×ÜÏßÕý³£,¿ÉÒÔ·¢ËÍ
 269   3                              Bus0SendPin = 0;
 270   3                              bBus0SendBit = 0;                                                               //·¢ËÍÆðÊ¼Î»Êý¾Ý                        
 271   3                              byBus0SendCount = 0;
 272   3                              byBus0State0 &= (~BUS0_CAN_SEND);
 273   3                              byBus0SendBuf = byBus0SendData[byBus0RecSendCount & 0x0f];
 274   3                              bBus0OnSendBit = 1;                                                             //È¡³ö´ý·¢ËÍµÄÊý¾Ý²¢ÖÃÕýÔÚ·¢ËÍ±êÖ¾              
 275   3                      }
 276   2                      else
 277   2                      {       //×ÜÏß²»Õý³£,Í£Ö¹·¢ËÍ
 278   3                              byBus0State0 &= (~BUS0_SEND_CON);
 279   3                              bBus0SendError = 1;                     
 280   3                              byBus0RecSendCount &= 0xf0;
 281   3                              Bus0SendPin = 1;
 282   3                              byBus0SendStopCount = 240;
 283   3                      }
 284   2              }
 285   1              else if(bBus0OnSendBit)
 286   1              {       //ÓÐÊý¾ÝÎ»ÕýÔÚ·¢ËÍ,Ê×ÏÈ·¢ËÍµÄÊÇÆðÊ¼Î»                   
 287   2                      if(bBus0SendBit == bBus0RecBit)                 
 288   2                      {       //·¢ËÍµÄÊý¾ÝºÍ½ÓÊÕµÄÊý¾ÝÏàÍ¬
 289   3                              byBus0SendCount += 0x10;
 290   3                              if(0xa0 == (byBus0SendCount & 0xf0))
 291   3                              {       //Ò»Î»Êý¾Ý·¢ËÍÍê±Ï,Ê×ÏÈ·¢ËÍµÄÊÇÆðÊ¼Î»
 292   4                                      byBus0SendCount &= 0x0f;
 293   4                                      byBus0SendCount += 0x01;                                
 294   4                                      if(0x09 == (byBus0SendCount & 0x0f))
 295   4                                      {       //·¢ËÍµ½µÚ9Î»ÁË
 296   5                                              bBus0SendBit = !(bit)(byBus0RecSendCount & 0x0f);
 297   5                                              Bus0SendPin = bBus0SendBit;                                             
 298   5                                      }
 299   4                                      else if(0x0a == (byBus0SendCount & 0x0f))
 300   4                                      {       //·¢ËÍµ½½áÊøÎ»ÁË
 301   5                                              bBus0SendBit = 1;
 302   5                                              Bus0SendPin = 1;        
 303   5                                      }
 304   4                                      else if(0x0b == (byBus0SendCount & 0x0f))
 305   4                                      {       //ÒÑ¾­·¢ËÍÍê½áÊøÎ»ÁË
 306   5                                              bBus0OnSendBit = 0;                                             
 307   5                                              byBus0RecSendCount += 0x01;                                                                     
 308   5                                              if((byBus0RecSendCount & 0x0f) >= BUS0_FREQ_SIZE)
 309   5                                              {       //·¢ËÍÍêÒ»Ö¡Êý¾Ý                                                                                                
 310   6                                                      byBus0RecSendCount &= 0xf0;                     //ÖØÐÂ½øÈëÊý¾ÝÖ¡µÄ·¢ËÍ½×¶Î
 311   6                                                      byBus0State0 &= (~BUS0_SEND_CON);
 312   6                                                      byBus0SendStopCount = 240;
 313   6                                                      byBus0State1 |= BUS0_SEND_FINISH;                                                               
 314   6                                                      byBus0DisableCount = 10;                                                
 315   6                                              }
 316   5                                              else
C51 COMPILER V8.08   SINGLEBUS                                                             02/22/2013 13:09:18 PAGE 47  

 317   5                                              {                                               
 318   6                                                      byBus0SendStopCount = 10;
 319   6                                                      bBus0ReqSend = 1;
 320   6                                              }
 321   5                                              EnableBus0RecInt();                                             //ÔÙ´ÎÊ¹ÄÜ½ÓÊÕÖÐ¶Ï
 322   5                                      }
 323   4                                      else
 324   4                                      {
 325   5                                              if(byBus0SendBuf & 0x01)
 326   5                                              {       //·¢ËÍ¸ßµçÆ½
 327   6                                                      bBus0SendBit = 1;
 328   6                                                      Bus0SendPin = 1;                                        
 329   6                                              }
 330   5                                              else
 331   5                                              {       //·¢ËÍµÍµçÆ½
 332   6                                                      bBus0SendBit = 0;
 333   6                                                      Bus0SendPin = 0;
 334   6                                              }
 335   5                                              byBus0SendBuf >>= 1;                                    //·¢ËÍÊý¾ÝÎ»ÒÆÎ»²Ù×÷
 336   5                                      }
 337   4                              }
 338   3                      }
 339   2                      else
 340   2                      {       //²»ÏàÍ¬,·¢ËÍÊ§°Ü                                                               
 341   3                              byBus0State0 &= ~BUS0_SEND_CON;
 342   3                              byBus0RecSendCount &= 0xf0;
 343   3                              bBus0SendError = 1;                                     
 344   3                              Bus0SendPin = 1; 
 345   3                              byBus0SendStopCount = 240;
 346   3                      }
 347   2              }       
 348   1              /*******************************×ÜÏß0¿ØÖÆ´¦Àí***********************************/
 349   1              if(0 == (byBus0State0 & BUS0_ON_REC))
 350   1              {       
 351   2                      if(byBus0SendStopCount != 0)
 352   2                      {
 353   3                              if((--byBus0SendStopCount) == 0)
 354   3                              {                               
 355   4                                      bBus0Enable = 1;                                                                
 356   4                              }
 357   3                      }               
 358   2                      if(bBus0Error)
 359   2                      {                                                               
 360   3                              bBus0Enable = 0;                        
 361   3                              if(bBus0RecBit)
 362   3                              {                               
 363   4                                      bBus0Error = 0;
 364   4                                      EnableBus0RecInt();
 365   4                                      byBus0SendStopCount = 240;
 366   4                              }
 367   3                      }
 368   2              }       
 369   1              /*******************************×ÜÏß0³¬Ê±´¦Àí***********************************/
 370   1              if(byBus0RecTimeOut != 0)
 371   1              {
 372   2                      if(--byBus0RecTimeOut == 0)                                                     
 373   2                      {       //½ÓÊÕ³¬Ê±µ½
 374   3                              byBus0RecSendCount &= 0x0f;                     
 375   3                      }
 376   2              }
 377   1              if(byBus0DisableCount != 0)
 378   1              {
C51 COMPILER V8.08   SINGLEBUS                                                             02/22/2013 13:09:18 PAGE 48  

 379   2                      if(--byBus0DisableCount == 0)                                           
 380   2                      {       //½ûÖ¹³¬Ê±µ½            
 381   3                              bBus0Disable = 0;
 382   3                      }
 383   2              }       
 384   1              /***********×ÜÏß0×Ô¶¯·¢ËÍ¹ÜÀí**********/         
 385   1              if((byBus0State0 & BUS0_ON_WORK) == 0x00)                               
 386   1              {       //×ÜÏß0Ã»ÓÐ¹¤×÷                         
 387   2                      if(bBus0SendError)                                              
 388   2                      {       //²úÉúÁË·¢ËÍ´íÎó,×Ô¶¯ÖØ·¢                                                               
 389   3                              bBus0SendError = 0;                             
 390   3                              byBus0State0 |= BUS0_REQ_SEND;          
 391   3                      }
 392   2                      else                                                                    
 393   2                      {       //×ÜÏß0ÎÞ·¢ËÍ´íÎó               
 394   3                              if(!(bBus0SendFinish|bBus0Disable))
 395   3                              {       //×ÜÏß0Ã»ÓÐ½ûÖ¹Ê¹ÓÃ,ÇÒ·¢ËÍ½áÊø´¦ÀíÒÑ¾­Íê³É
 396   4                                      if(Bus0TxBuffLen() >= BUS0_FREQ_SIZE)
 397   4                                      {       //ÓÐÒ»Ö¡ÍêÕûµÄÊý¾ÝÔÚ·¢ËÍ¶ÓÁÐÖÐ                                                                                                                                          
 398   5                                              byBus0SendData[0] = byBus0TxQ[byBus0TxHead];
 399   5                                              IncBus0TxPtr(byBus0TxHead);
 400   5                                              byBus0SendData[1] = byBus0TxQ[byBus0TxHead];
 401   5                                              IncBus0TxPtr(byBus0TxHead);
 402   5                                              byBus0SendData[2] = byBus0TxQ[byBus0TxHead];
 403   5                                              IncBus0TxPtr(byBus0TxHead);
 404   5                                              byBus0SendData[3] = byBus0TxQ[byBus0TxHead];
 405   5                                              IncBus0TxPtr(byBus0TxHead);
 406   5                                              byBus0SendData[4] = byBus0TxQ[byBus0TxHead];
 407   5                                              IncBus0TxPtr(byBus0TxHead);
 408   5                                              byBus0SendData[5] = byBus0TxQ[byBus0TxHead];
 409   5                                              IncBus0TxPtr(byBus0TxHead);
 410   5                                              byBus0SendData[6] = byBus0TxQ[byBus0TxHead];
 411   5                                              IncBus0TxPtr(byBus0TxHead);     
 412   5                                              byBus0State0 |= BUS0_REQ_SEND;                                          
 413   5                                      }
 414   4                                      else
 415   4                                      {       //Ã»ÓÐÒ»Ö¡ÍêÕûµÄÊý¾ÝÔÚ·¢ËÍ¶ÓÁÐÖÐÁË
 416   5                                              byBus0TxHead = byBus0TxTail = 0;
 417   5                                      }                                                               
 418   4                              }
 419   3                      }
 420   2              }       
 421   1      } 
 422          /**********************************************************
 423          *º¯ÊýÃû³Æ                       :Bus0OutputData 
 424          *º¯ÊýÃèÊö               :µ¥×ÜÏß0½«´ý·¢ËÍÊý¾Ý·ÅÈë»º³åÇø
 425          *ÊäÈë²ÎÊý               :pbyData:´ý·¢ËÍµÄÊý¾ÝÖ¸Õë
 426          *·µ»ØÖµ                         :TRUE:·¢ËÍ³É¹¦,FALSE:¶ÓÁÐÂú,·¢ËÍÊ§°Ü    
 427          *È«¾Ö±äÁ¿                       :
 428          *µ÷ÓÃÄ£¿é                       :
 429          ***********************************************************
 430          *´´½¨ÈË                 :³ÂÎÀ¹ú
 431          *´´½¨ÈÕÆÚ                       :2008-9-22
 432          ***********************************************************
 433          *ÐÞ¸ÄÈË                         :
 434          *ÐÞ¸ÄÈÕÆÚ               :
 435          *×¢ÊÍ                   :
 436          **********************************************************/
 437          uint8 Bus0OutputData(uint8* pbyData)
 438          {
 439   1              uint8 byTemp = BUS0_FREQ_SIZE;
 440   1      
C51 COMPILER V8.08   SINGLEBUS                                                             02/22/2013 13:09:18 PAGE 49  

 441   1              OS_ENTER_CRITICAL();
 442   1              if(Bus0TxBuffLen() >= (BUS0_TX_Q_ZISE - 1))
 443   1              {       //Ã»ÓÐ¿Õ¼ä´æ´¢ÁË,Ê§°Ü   
 444   2                      OS_EXIT_CRITICAL();
 445   2                      return(FALSE);
 446   2              }       
 447   1              while(byTemp--)
 448   1              {       //Êý¾ÝÈë·¢ËÍ¶ÓÁÐ
 449   2                      byBus0TxQ[byBus0TxTail] = *pbyData++;
 450   2                      IncBus0TxPtr(byBus0TxTail);
 451   2              }
 452   1              OS_EXIT_CRITICAL();     
 453   1              return(TRUE);   
 454   1      }
 455          /**********************************************************
 456          *º¯ÊýÃû³Æ                       :AddrCompare    
 457          *º¯ÊýÃèÊö               :±È½ÏµØÖ·(º¬¹ã²¥µØÖ·)
 458          *ÊäÈë²ÎÊý               :pstBusFreq:´ý±È½ÏµÄÊý¾ÝÖ¡Ö¸Õë
 459          *·µ»ØÖµ                         :1:·¢ËÍµ½±¾»úµÄÊý¾Ý,0:²»ÊÇ·¢ËÍµ½±¾»úµÄÊý¾Ý      
 460          *È«¾Ö±äÁ¿                       :
 461          *µ÷ÓÃÄ£¿é                       :
 462          ***********************************************************
 463          *´´½¨ÈË                 :³ÂÎÀ¹ú
 464          *´´½¨ÈÕÆÚ                       :2008-9-22
 465          ***********************************************************
 466          *ÐÞ¸ÄÈË                         :
 467          *ÐÞ¸ÄÈÕÆÚ               :
 468          *×¢ÊÍ                   :
 469          **********************************************************/
 470          bit AddrCompare(pSTBusFreq pstBusFreq)
 471          {
 472   1      /*      if((pstBusFreq->byRecSecAddr != 0xff) && (pstBusFreq->byRecSecAddr != stLocalControl.stEepromCfgData.by
             -SelfSecAddr))
 473   1              {       
 474   1                      return(0);
 475   1              } 
 476   1              if((pstBusFreq->byRecRoomAddr != 0xff) && (pstBusFreq->byRecRoomAddr != stLocalControl.stEepromCfgData.by
             -SelfRoomAddr))
 477   1              {       
 478   1                      return(0);
 479   1              }
 480   1              if((pstBusFreq->byRecBedAddr != 0xff) && (pstBusFreq->byRecBedAddr != stLocalControl.stEepromCfgData.bySe
             -lfBedAddr))
 481   1              {       
 482   1                      return(0);
 483   1              }
 484   1              return(1); 
 485   1      */
 486   1              pstBusFreq=pstBusFreq;
 487   1              return(1);
 488   1      }
 489          /**********************************************************
 490          *º¯ÊýÃû³Æ                       :MakeCH0TimerOut        
 491          *º¯ÊýÃèÊö               :ÉèÖÃÍ¨µÀ0³¬Ê±²ÎÊý
 492          *ÊäÈë²ÎÊý               :byTimerOut:³¬Ê±Ê±¼ä,byTimerOutCount:³¬Ê±´ÎÊý
 493          *·µ»ØÖµ                         :
 494          *È«¾Ö±äÁ¿                       :stLocalControl
 495          *µ÷ÓÃÄ£¿é                       :
 496          ***********************************************************
 497          *´´½¨ÈË                 :³ÂÎÀ¹ú
 498          *´´½¨ÈÕÆÚ                       :2008-9-22
 499          ***********************************************************
C51 COMPILER V8.08   SINGLEBUS                                                             02/22/2013 13:09:18 PAGE 50  

 500          *ÐÞ¸ÄÈË                         :
 501          *ÐÞ¸ÄÈÕÆÚ               :
 502          *×¢ÊÍ                   :
 503          **********************************************************/  
 504          void MakeCH0TimerOut(uint8 byTimerOut, uint8 byTimerOutCount)
 505          {
 506   1              stLocalControl.stCH0TimerOut.byTimerOutSet = byTimerOut;
 507   1              stLocalControl.stCH0TimerOut.byTimerOut = byTimerOut;
 508   1              stLocalControl.stCH0TimerOut.byTimerOutCount = byTimerOutCount; 
 509   1      }
 510          
 511          /**********************************************************
 512          *º¯ÊýÃû³Æ                       :SaveParameter  
 513          *º¯ÊýÃèÊö               :´æ´¢ÅäÖÃ²ÎÊý,´æ´¢²ÎÊýÇ°ÏÈ²Á³ýÕû¸öÉÈÇø,
 514                                                   È»ºó½«ËùÓÐ²ÎÊýÖØÐÂÐ´ÈëÉÈÇø
 515          *ÊäÈë²ÎÊý               :
 516          *·µ»ØÖµ                         :
 517          *È«¾Ö±äÁ¿                       :stLocalControl
 518          *µ÷ÓÃÄ£¿é                       :EnableIAP,IapErase,IapWriteByte,DisableIAP
 519          ***********************************************************
 520          *´´½¨ÈË                 :ÒüÔËÍ¬
 521          *´´½¨ÈÕÆÚ                       :2008-9-22
 522          ***********************************************************
 523          *ÐÞ¸ÄÈË                         :
 524          *ÐÞ¸ÄÈÕÆÚ               :
 525          *×¢ÊÍ                   :
 526          **********************************************************/
 527          void SaveParameter(void)
 528          {  
 529   1              stLocalControl.uiShortType = IAP_ADDR;  
 530   1              stLocalControl.pbyData = &(stLocalControl.stEepromCfgData.byInitFlag);
 531   1              stLocalControl.byChar1 = sizeof(STEepromCfgData);
 532   1              EnableIAP(IAP_ERASE);
 533   1              IapErase(IAP_ADDR);     
 534   1              EnableIAP(IAP_WRITE); 
 535   1              while(stLocalControl.byChar1--)
 536   1              {
 537   2                      IapWriteByte(stLocalControl.uiShortType++, *stLocalControl.pbyData++);
 538   2              }
 539   1              DisableIAP();
 540   1      }
 541          
 542          /**********************************************************
 543          *º¯ÊýÃû³Æ                       :ReadParameter  
 544          *º¯ÊýÃèÊö               :½«FlashÖÐµÄÅäÖÃÊý¾Ý¶ÁÈëµ½ÄÚ´æÖÐ
 545          *ÊäÈë²ÎÊý               :
 546          *·µ»ØÖµ                         :
 547          *È«¾Ö±äÁ¿                       :stLocalControl
 548          *µ÷ÓÃÄ£¿é                       :EnableIAP,IapReadByte,DisableIAP
 549          ***********************************************************
 550          *´´½¨ÈË                 :ÒüÔËÍ¬
 551          *´´½¨ÈÕÆÚ                       :2008-9-22
 552          ***********************************************************
 553          *ÐÞ¸ÄÈË                         :
 554          *ÐÞ¸ÄÈÕÆÚ               :
 555          *×¢ÊÍ                   :
 556          **********************************************************/
 557          void ReadParameter(void)
 558          {
 559   1      
 560   1              stLocalControl.uiShortType = IAP_ADDR;  
 561   1              stLocalControl.pbyData = &(stLocalControl.stEepromCfgData.byInitFlag);
C51 COMPILER V8.08   SINGLEBUS                                                             02/22/2013 13:09:18 PAGE 51  

 562   1              stLocalControl.byChar1 = sizeof(STEepromCfgData);
 563   1              
 564   1              EnableIAP(IAP_READ); 
 565   1              while(stLocalControl.byChar1--)
 566   1              {               
 567   2                      *stLocalControl.pbyData++ = IapReadByte(stLocalControl.uiShortType++);          
 568   2              }
 569   1              DisableIAP();
 570   1              
 571   1      }
 572          /**********************************************************
 573          *º¯ÊýÃû³Æ                       :InitParameter  
 574          *º¯ÊýÃèÊö               :³õÊ¼»¯FlashÖÐµÄÅäÖÃÊý¾Ý
 575          *ÊäÈë²ÎÊý               :
 576          *·µ»ØÖµ                         :
 577          *È«¾Ö±äÁ¿                       :stLocalControl
 578          *µ÷ÓÃÄ£¿é                       :EnableIAP,IapReadByte,DisableIAP
 579          ***********************************************************
 580          *´´½¨ÈË                 :ÒüÔËÍ¬
 581          *´´½¨ÈÕÆÚ                       :2008-9-22
 582          ***********************************************************
 583          *ÐÞ¸ÄÈË                         :
 584          *ÐÞ¸ÄÈÕÆÚ               :
 585          *×¢ÊÍ                   :
 586          **********************************************************/
 587          void InitParameter(void)
 588          {
 589   1              EnableIAP(IAP_READ);
 590   1              if(IapReadByte(IAP_ADDR) == INIT_FLAG)
 591   1              {//Êý¾ÝÒÑ¾­³õÊ¼»¯Íê±ÏÁË,¶ÁÈ¡Êý¾Ý²ÎÊý
 592   2                      ReadParameter();
 593   2      
 594   2              }
 595   1              else
 596   1              {       //Ã»ÓÐ³õÊ¼»¯,³õÊ¼»¯²ÎÊý
 597   2                      stLocalControl.stEepromCfgData.byInitFlag = INIT_FLAG;          
 598   2                      SaveParameter();
 599   2              }
 600   1      }
 601          
 602          
 603          /**********************************************************
 604          *º¯ÊýÃû³Æ                       :MakeCallVoiceData      
 605          *º¯ÊýÃèÊö               :¸ù¾ÝÐÅÏ¢Ö¸Ê¾µÄÄÚÈÝ¹¹½¨ÓïÒô±¨ºÅµÄÄÚÈÝ
 606          *ÊäÈë²ÎÊý               :pstIndicationData:ÐÅÏ¢Ö¸Ê¾Ö¸Õë
 607          *·µ»ØÖµ                         :
 608          *È«¾Ö±äÁ¿                       :stLocalControl
 609          *µ÷ÓÃÄ£¿é                       :
 610          ***********************************************************
 611          *´´½¨ÈË                 :ÒüÔËÍ¬
 612          *´´½¨ÈÕÆÚ                       :2009-4-6
 613          ***********************************************************
 614          *ÐÞ¸ÄÈË                         :
 615          *ÐÞ¸ÄÈÕÆÚ               :
 616          *×¢ÊÍ                   :
 617          **********************************************************/
 618          void MakeCallVoiceData(pSTBusFreq pstBusDealFreq)
 619          {       
 620   1              uint8 byPosition = 0;
 621   1              uint8 byTemp1;
 622   1              uint8 byTemp2;
 623   1      
C51 COMPILER V8.08   SINGLEBUS                                                             02/22/2013 13:09:18 PAGE 52  

 624   1      
 625   1              if(pstBusDealFreq->bySndRoomAddr == ADD_FJ_ADDR)
 626   1              {//ÊÇ¼Ó´²·Ö»ú
 627   2                      if((pstBusDealFreq->byRecSecAddr& 0x1f) == CMD_INFUSION_CALL)
 628   2                      {//ÆÕÍ¨ºô½Ð
 629   3                              stLocalControl.stVoicePlay.byVoiceData[byPosition++] = ADD_VOICE;       //"¼Ó"
 630   3                              byTemp1 = pstBusDealFreq->bySndBedAddr;
 631   3                              byTemp2 = byTemp1 / 100;
 632   3                              byTemp1 %= 100;
 633   3                              if(byTemp2)
 634   3                              {       //ÓÐ°ÙÎ»Êý¾Ý
 635   4                                      stLocalControl.stVoicePlay.byVoiceData[byPosition++] = byTemp2;
 636   4                                      stLocalControl.stVoicePlay.byVoiceData[byPosition++] = HUNDRED_VOICE;           //"°Ù"ÒôµÄÐòºÅ
 637   4                                      if(byTemp1)
 638   4                                      {       //Ê£ÏÂµÄÊý¾ÝÈÔÈ»ÓÐ
 639   5                                              byTemp2 = byTemp1 / 10;
 640   5                                              byTemp1 %= 10;
 641   5                                              stLocalControl.stVoicePlay.byVoiceData[byPosition++] = byTemp2;
 642   5                                              if(byTemp2)
 643   5                                              {       //ÓÐÊ®Î»Êý¾Ý,±¨Ê®
 644   6                                                      stLocalControl.stVoicePlay.byVoiceData[byPosition++] = TEN_VOICE;       //"Ê®"ÒôµÄÐòºÅ
 645   6                                              }
 646   5                                              if(byTemp1)
 647   5                                              {       //ÓÐ¸öÎ»Êý¾Ý,±¨ºÅ
 648   6                                                      stLocalControl.stVoicePlay.byVoiceData[byPosition++] = byTemp1;
 649   6                                              }
 650   5                                      }
 651   4                                      //´²
 652   4                                      stLocalControl.stVoicePlay.byVoiceData[byPosition++] = BED_VOICE;
 653   4                              }
 654   3                              else
 655   3                              {       //Ã»ÓÐ°ÙÎ»Êý¾Ý
 656   4                                      byTemp2 = byTemp1 / 10;
 657   4                                      byTemp1 %= 10;
 658   4                                      if(byTemp2)
 659   4                                      {       //ÓÐÊ®Î»Êý¾Ý
 660   5                                              if(byTemp2 != 1)
 661   5                                              {       //ÐèÒª´æ´¢Ê®Î»Êý¾Ý
 662   6                                                      stLocalControl.stVoicePlay.byVoiceData[byPosition++] = byTemp2;
 663   6                                              }
 664   5                                              stLocalControl.stVoicePlay.byVoiceData[byPosition++] = TEN_VOICE; //"Ê®"ÒôµÄÐòºÅ
 665   5                                              if(byTemp1)
 666   5                                              {       //ÓÐ¸öÎ»Êý¾Ý
 667   6                                                      stLocalControl.stVoicePlay.byVoiceData[byPosition++] = byTemp1;
 668   6                                              }
 669   5                                              //´²
 670   5                                              stLocalControl.stVoicePlay.byVoiceData[byPosition++] = BED_VOICE;
 671   5                                      }
 672   4                                      else
 673   4                                      {       //Ã»ÓÐÊ®Î»Êý¾Ý
 674   5                                              stLocalControl.stVoicePlay.byVoiceData[byPosition++] = byTemp1;
 675   5                                              //´²
 676   5                                              stLocalControl.stVoicePlay.byVoiceData[byPosition++] = BED_VOICE;
 677   5                                      }
 678   4                              }
 679   3                              //ºô½Ð
 680   3                              stLocalControl.stVoicePlay.byVoiceData[byPosition++] = CALL_VOICE;      
 681   3                              stLocalControl.stVoicePlay.byVoiceSize = byPosition;                                    
 682   3                      }
 683   2                      return;
 684   2              }
 685   1      #if SPK_ROOM==0
C51 COMPILER V8.08   SINGLEBUS                                                             02/22/2013 13:09:18 PAGE 53  

 686   1              switch(pstBusDealFreq->byRecSecAddr& 0x1f)
 687   1              {
 688   2                      case CMD_INFUSION_CALL:                 //ÊäÒººô½ÐÃüÁî
 689   2                              byTemp1 = pstBusDealFreq->bySndBedAddr;
 690   2                              byTemp2 = byTemp1 / 100;
 691   2                              byTemp1 %= 100;
 692   2                              if(byTemp2)
 693   2                              {       //ÓÐ°ÙÎ»Êý¾Ý
 694   3                                      stLocalControl.stVoicePlay.byVoiceData[byPosition++] = byTemp2;
 695   3                                      stLocalControl.stVoicePlay.byVoiceData[byPosition++] = HUNDRED_VOICE;           //"°Ù"ÒôµÄÐòºÅ
 696   3                                      if(byTemp1)
 697   3                                      {       //Ê£ÏÂµÄÊý¾ÝÈÔÈ»ÓÐ
 698   4                                              byTemp2 = byTemp1 / 10;
 699   4                                              byTemp1 %= 10;
 700   4                                              stLocalControl.stVoicePlay.byVoiceData[byPosition++] = byTemp2;
 701   4                                              if(byTemp2)
 702   4                                              {       //ÓÐÊ®Î»Êý¾Ý,±¨Ê®
 703   5                                                      stLocalControl.stVoicePlay.byVoiceData[byPosition++] = TEN_VOICE;       //"Ê®"ÒôµÄÐòºÅ
 704   5                                              }
 705   4                                              if(byTemp1)
 706   4                                              {       //ÓÐ¸öÎ»Êý¾Ý,±¨ºÅ
 707   5                                                      stLocalControl.stVoicePlay.byVoiceData[byPosition++] = byTemp1;
 708   5                                              }
 709   4                                      }
 710   3                                      //´²
 711   3                                      stLocalControl.stVoicePlay.byVoiceData[byPosition++] = BED_VOICE;
 712   3                              }
 713   2                              else
 714   2                              {       //Ã»ÓÐ°ÙÎ»Êý¾Ý
 715   3                                      byTemp2 = byTemp1 / 10;
 716   3                                      byTemp1 %= 10;
 717   3                                      if(byTemp2)
 718   3                                      {       //ÓÐÊ®Î»Êý¾Ý
 719   4                                              if(byTemp2 != 1)
 720   4                                              {       //ÐèÒª´æ´¢Ê®Î»Êý¾Ý
 721   5                                                      stLocalControl.stVoicePlay.byVoiceData[byPosition++] = byTemp2;
 722   5                                              }
 723   4                                              stLocalControl.stVoicePlay.byVoiceData[byPosition++] = TEN_VOICE; //"Ê®"ÒôµÄÐòºÅ
 724   4                                              if(byTemp1)
 725   4                                              {       //ÓÐ¸öÎ»Êý¾Ý
 726   5                                                      stLocalControl.stVoicePlay.byVoiceData[byPosition++] = byTemp1;
 727   5                                              }
 728   4                                              //´²
 729   4                                              stLocalControl.stVoicePlay.byVoiceData[byPosition++] = BED_VOICE;
 730   4                                      }
 731   3                                      else
 732   3                                      {       //Ã»ÓÐÊ®Î»Êý¾Ý
 733   4                                              stLocalControl.stVoicePlay.byVoiceData[byPosition++] = byTemp1;
 734   4                                              //´²
 735   4                                              stLocalControl.stVoicePlay.byVoiceData[byPosition++] = BED_VOICE;
 736   4                                      }
 737   3                              }
 738   2                              //ºô½Ð
 739   2                              stLocalControl.stVoicePlay.byVoiceData[byPosition++] = CALL_VOICE;      
 740   2                              stLocalControl.stVoicePlay.byVoiceSize = byPosition;                    
 741   2                              break;
 742   2                      case CMD_SERVICE_CALL:                  //ÊµÖÊÎªÊäÒºÍê±Ïºô½ÐÃüÁî
 743   2                              byTemp1 = pstBusDealFreq->bySndBedAddr;
 744   2                              byTemp2 = byTemp1 / 100;
 745   2                              byTemp1 %= 100;
 746   2                              if(byTemp2)
 747   2                              {       //ÓÐ°ÙÎ»Êý¾Ý
C51 COMPILER V8.08   SINGLEBUS                                                             02/22/2013 13:09:18 PAGE 54  

 748   3                                      stLocalControl.stVoicePlay.byVoiceData[byPosition++] = byTemp2;
 749   3                                      stLocalControl.stVoicePlay.byVoiceData[byPosition++] = HUNDRED_VOICE;           //"°Ù"ÒôµÄÐòºÅ
 750   3                                      if(byTemp1)
 751   3                                      {       //Ê£ÏÂµÄÊý¾ÝÈÔÈ»ÓÐ
 752   4                                              byTemp2 = byTemp1 / 10;
 753   4                                              byTemp1 %= 10;
 754   4                                              stLocalControl.stVoicePlay.byVoiceData[byPosition++] = byTemp2;
 755   4                                              if(byTemp2)
 756   4                                              {       //ÓÐÊ®Î»Êý¾Ý,±¨Ê®
 757   5                                                      stLocalControl.stVoicePlay.byVoiceData[byPosition++] = TEN_VOICE;       //"Ê®"ÒôµÄÐòºÅ
 758   5                                              }
 759   4                                              if(byTemp1)
 760   4                                              {       //ÓÐ¸öÎ»Êý¾Ý,±¨ºÅ
 761   5                                                      stLocalControl.stVoicePlay.byVoiceData[byPosition++] = byTemp1;
 762   5                                              }
 763   4                                      }
 764   3                                      //´²
 765   3                                      stLocalControl.stVoicePlay.byVoiceData[byPosition++] = BED_VOICE;
 766   3                              }
 767   2                              else
 768   2                              {       //Ã»ÓÐ°ÙÎ»Êý¾Ý
 769   3                                      byTemp2 = byTemp1 / 10;
 770   3                                      byTemp1 %= 10;
 771   3                                      if(byTemp2)
 772   3                                      {       //ÓÐÊ®Î»Êý¾Ý
 773   4                                              if(byTemp2 != 1)
 774   4                                              {       //ÐèÒª´æ´¢Ê®Î»Êý¾Ý
 775   5                                                      stLocalControl.stVoicePlay.byVoiceData[byPosition++] = byTemp2;
 776   5                                              }
 777   4                                              stLocalControl.stVoicePlay.byVoiceData[byPosition++] = TEN_VOICE;//"Ê®"ÒôµÄÐòºÅ
 778   4                                              if(byTemp1)
 779   4                                              {       //ÓÐ¸öÎ»Êý¾Ý
 780   5                                                      stLocalControl.stVoicePlay.byVoiceData[byPosition++] = byTemp1;
 781   5                                              }
 782   4                                              //´²
 783   4                                              stLocalControl.stVoicePlay.byVoiceData[byPosition++] = BED_VOICE;
 784   4                                      }
 785   3                                      else
 786   3                                      {       //Ã»ÓÐÊ®Î»Êý¾Ý
 787   4                                              stLocalControl.stVoicePlay.byVoiceData[byPosition++] = byTemp1;
 788   4                                              //´²
 789   4                                              stLocalControl.stVoicePlay.byVoiceData[byPosition++] = BED_VOICE;
 790   4                                      }
 791   3                              }
 792   2                              //ÊäÒºÍê±Ï
 793   2                              stLocalControl.stVoicePlay.byVoiceData[byPosition++] = INFUSION_VOICE;
 794   2                              stLocalControl.stVoicePlay.byVoiceData[byPosition++] = END_VOICE;
 795   2                              stLocalControl.stVoicePlay.byVoiceSize = byPosition;                    
 796   2                              break;                  
 797   2                      case CMD_EMERGENCY_CALL:                        //ÎÀÉú¼ä½ô¼±ºô½ÐÃüÁî
 798   2                              //±¨·¿ÐÅÏ¢
 799   2                              byTemp1 = (pstBusDealFreq->bySndRoomAddr&0x7f); 
 800   2                              byTemp2 = byTemp1 / 100;
 801   2                              byTemp1 %= 100;
 802   2                              if(byTemp2)
 803   2                              {       //ÓÐ°ÙÎ»Êý¾Ý
 804   3                                      stLocalControl.stVoicePlay.byVoiceData[byPosition++] = byTemp2;
 805   3                                      stLocalControl.stVoicePlay.byVoiceData[byPosition++] = HUNDRED_VOICE;   //"°Ù"ÒôµÄÐòºÅ
 806   3                                      if(byTemp1)
 807   3                                      {       //Ê£ÏÂµÄÊý¾ÝÈÔÈ»ÓÐ
 808   4                                              byTemp2 = byTemp1 / 10;
 809   4                                              byTemp1 %= 10;
C51 COMPILER V8.08   SINGLEBUS                                                             02/22/2013 13:09:18 PAGE 55  

 810   4                                              stLocalControl.stVoicePlay.byVoiceData[byPosition++] = byTemp2;
 811   4                                              if(byTemp2)
 812   4                                              {       //ÓÐÊ®Î»Êý¾Ý,±¨Ê®
 813   5                                                      stLocalControl.stVoicePlay.byVoiceData[byPosition++] = TEN_VOICE;
 814   5                                              }
 815   4                                              if(byTemp1)
 816   4                                              {       //ÓÐ¸öÎ»Êý¾Ý,±¨ºÅ
 817   5                                                      stLocalControl.stVoicePlay.byVoiceData[byPosition++] = byTemp1;
 818   5                                              }
 819   4                                      }
 820   3                                      //·¿
 821   3                                      stLocalControl.stVoicePlay.byVoiceData[byPosition++] = ROOM_VOICE;
 822   3                              }
 823   2                              else
 824   2                              {       //Ã»ÓÐ°ÙÎ»Êý¾Ý
 825   3                                      byTemp2 = byTemp1 / 10;
 826   3                                      byTemp1 %= 10;
 827   3                                      if(byTemp2)
 828   3                                      {       //ÓÐÊ®Î»Êý¾Ý
 829   4                                              if(byTemp2 != 1)
 830   4                                              {       //ÐèÒª´æ´¢Ê®Î»Êý¾Ý
 831   5                                                      stLocalControl.stVoicePlay.byVoiceData[byPosition++] = byTemp2;
 832   5                                              }
 833   4                                              stLocalControl.stVoicePlay.byVoiceData[byPosition++] = TEN_VOICE;
 834   4                                              if(byTemp1)
 835   4                                              {       //ÓÐ¸öÎ»Êý¾Ý
 836   5                                                      stLocalControl.stVoicePlay.byVoiceData[byPosition++] = byTemp1;
 837   5                                              }
 838   4                                              //·¿
 839   4                                              stLocalControl.stVoicePlay.byVoiceData[byPosition++] = ROOM_VOICE;
 840   4                                      }
 841   3                                      else
 842   3                                      {       //Ã»ÓÐÊ®Î»Êý¾Ý
 843   4                                              stLocalControl.stVoicePlay.byVoiceData[byPosition++] = byTemp1;
 844   4                                              //·¿
 845   4                                              stLocalControl.stVoicePlay.byVoiceData[byPosition++] = ROOM_VOICE;
 846   4                                      }
 847   3                              }
 848   2                              //±¨ÎÀÉú¼äºÅÐÅÏ¢
 849   2                              byTemp1 = pstBusDealFreq->bySndBedAddr & 0x0f;
 850   2                              if(byTemp1 == 0x00)
 851   2                              {       //¸Ã·¿¼äÖ»ÓÐÒ»¸öÎÀÉú¼ä£¬Ö±½Ó±¨ÎÀÉú¼äºô½Ð
 852   3                                      stLocalControl.stVoicePlay.byVoiceData[byPosition++] = TOILET_VOICE;                    //ÎÀÉú¼ä
 853   3                                      //ºô½Ð
 854   3                                      stLocalControl.stVoicePlay.byVoiceData[byPosition++] = CALL_VOICE;      
 855   3                                      stLocalControl.stVoicePlay.byVoiceSize = byPosition;                            
 856   3                                      break;
 857   3                              }                                               
 858   2                              //Ã»ÓÐ°ÙÎ»Êý¾Ý
 859   2                              byTemp2 = byTemp1 / 10;
 860   2                              byTemp1 %= 10;
 861   2                              if(byTemp2)
 862   2                              {       //ÓÐÊ®Î»Êý¾Ý
 863   3                                      if(byTemp2 != 1)
 864   3                                      {       //ÐèÒª´æ´¢Ê®Î»Êý¾Ý
 865   4                                              stLocalControl.stVoicePlay.byVoiceData[byPosition++] = byTemp2;
 866   4                                      }
 867   3                                      stLocalControl.stVoicePlay.byVoiceData[byPosition++] = TEN_VOICE;
 868   3                                      if(byTemp1)
 869   3                                      {       //ÓÐ¸öÎ»Êý¾Ý
 870   4                                              stLocalControl.stVoicePlay.byVoiceData[byPosition++] = byTemp1;
 871   4                                      }
C51 COMPILER V8.08   SINGLEBUS                                                             02/22/2013 13:09:18 PAGE 56  

 872   3                                      //ºÅ
 873   3                                      stLocalControl.stVoicePlay.byVoiceData[byPosition++] = NUM_VOICE;
 874   3                                      //ÎÀÉú¼ä                                
 875   3                                      stLocalControl.stVoicePlay.byVoiceData[byPosition++] = TOILET_VOICE;
 876   3                              }
 877   2                              else
 878   2                              {       //Ã»ÓÐÊ®Î»Êý¾Ý
 879   3                                      stLocalControl.stVoicePlay.byVoiceData[byPosition++] = byTemp1;
 880   3                                      //ºÅ
 881   3                                      stLocalControl.stVoicePlay.byVoiceData[byPosition++] = NUM_VOICE;
 882   3                                      //ÎÀÉú¼ä
 883   3                                      stLocalControl.stVoicePlay.byVoiceData[byPosition++] = TOILET_VOICE;
 884   3                              }       
 885   2                              //ºô½Ð
 886   2                              stLocalControl.stVoicePlay.byVoiceData[byPosition++] = CALL_VOICE;
 887   2                              stLocalControl.stVoicePlay.byVoiceSize = byPosition;                    
 888   2                              break;
 889   2              }
 890   1              
 891   1      #else
                      //¹¹½¨·¿ÐÅÏ¢,±¨·¿ºÅºÍ´²ºÅ
                      byTemp1 = (pstBusDealFreq->bySndRoomAddr&0x7f); 
                      byTemp2 = byTemp1 / 100;
                      byTemp1 %= 100;
                      if(byTemp2)
                      {       //ÓÐ°ÙÎ»Êý¾Ý
                              stLocalControl.stVoicePlay.byVoiceData[byPosition++] = byTemp2;
                              stLocalControl.stVoicePlay.byVoiceData[byPosition++] = HUNDRED_VOICE;//"°Ù"ÒôµÄÐòºÅ
                              if(byTemp1)
                              {       //Ê£ÏÂµÄÊý¾ÝÈÔÈ»ÓÐ
                                      byTemp2 = byTemp1 / 10;
                                      byTemp1 %= 10;
                                      stLocalControl.stVoicePlay.byVoiceData[byPosition++] = byTemp2;
                                      if(byTemp2)
                                      {       //ÓÐÊ®Î»Êý¾Ý,±¨Ê®
                                              stLocalControl.stVoicePlay.byVoiceData[byPosition++] = TEN_VOICE;
                                      }
                                      if(byTemp1)
                                      {       //ÓÐ¸öÎ»Êý¾Ý,±¨ºÅ
                                              stLocalControl.stVoicePlay.byVoiceData[byPosition++] = byTemp1;
                                      }
                              }
                              //·¿
                              stLocalControl.stVoicePlay.byVoiceData[byPosition++] = ROOM_VOICE;
                      }
                      else
                      {       //Ã»ÓÐ°ÙÎ»Êý¾Ý
                              byTemp2 = byTemp1 / 10;
                              byTemp1 %= 10;
                              if(byTemp2)
                              {       //ÓÐÊ®Î»Êý¾Ý
                                      if(byTemp2 != 1)
                                      {       //ÐèÒª´æ´¢Ê®Î»Êý¾Ý
                                              stLocalControl.stVoicePlay.byVoiceData[byPosition++] = byTemp2;
                                      }
                                      stLocalControl.stVoicePlay.byVoiceData[byPosition++] = TEN_VOICE;
                                      if(byTemp1)
                                      {       //ÓÐ¸öÎ»Êý¾Ý
                                              stLocalControl.stVoicePlay.byVoiceData[byPosition++] = byTemp1;
                                      }
                                      //·¿
                                      stLocalControl.stVoicePlay.byVoiceData[byPosition++] = ROOM_VOICE;
C51 COMPILER V8.08   SINGLEBUS                                                             02/22/2013 13:09:18 PAGE 57  

                              }
                              else
                              {       //Ã»ÓÐÊ®Î»Êý¾Ý
                                      stLocalControl.stVoicePlay.byVoiceData[byPosition++] = byTemp1;
                                      //·¿
                                      stLocalControl.stVoicePlay.byVoiceData[byPosition++] = ROOM_VOICE;
                              }
                      }
                      switch(pstBusDealFreq->byRecSecAddr & 0x1f)
                      {       
                              case CMD_INFUSION_CALL:                 //ÊäÒººô½ÐÃüÁî
                                      //¹¹½¨´²ÐÅÏ¢
                                      byTemp1 = pstBusDealFreq->bySndBedAddr;
                                      byTemp2 = byTemp1 / 100;
                                      byTemp1 %= 100;
                                      if(byTemp2)
                                      {       //ÓÐ°ÙÎ»Êý¾Ý
                                              stLocalControl.stVoicePlay.byVoiceData[byPosition++] = byTemp2;
                                              stLocalControl.stVoicePlay.byVoiceData[byPosition++] = HUNDRED_VOICE;   //"°Ù"ÒôµÄÐòºÅ
                                              if(byTemp1)
                                              {       //Ê£ÏÂµÄÊý¾ÝÈÔÈ»ÓÐ
                                                      byTemp2 = byTemp1 / 10;
                                                      byTemp1 %= 10;
                                                      stLocalControl.stVoicePlay.byVoiceData[byPosition++] = byTemp2;
                                                      if(byTemp2)
                                                      {       //ÓÐÊ®Î»Êý¾Ý,±¨Ê®
                                                              stLocalControl.stVoicePlay.byVoiceData[byPosition++] = TEN_VOICE;
                                                      }
                                                      if(byTemp1)
                                                      {       //ÓÐ¸öÎ»Êý¾Ý,±¨ºÅ
                                                              stLocalControl.stVoicePlay.byVoiceData[byPosition++] = byTemp1;
                                                      }
                                              }
                                              //´²
                                              stLocalControl.stVoicePlay.byVoiceData[byPosition++] = BED_VOICE;
                                      }
                                      else
                                      {       //Ã»ÓÐ°ÙÎ»Êý¾Ý
                                              byTemp2 = byTemp1 / 10;
                                              byTemp1 %= 10;
                                              if(byTemp2)
                                              {       //ÓÐÊ®Î»Êý¾Ý
                                                      if(byTemp2 != 1)
                                                      {       //ÐèÒª´æ´¢Ê®Î»Êý¾Ý
                                                              stLocalControl.stVoicePlay.byVoiceData[byPosition++] = byTemp2;
                                                      }
                                                      stLocalControl.stVoicePlay.byVoiceData[byPosition++] = TEN_VOICE;
                                                      if(byTemp1)
                                                      {       //ÓÐ¸öÎ»Êý¾Ý
                                                              stLocalControl.stVoicePlay.byVoiceData[byPosition++] = byTemp1;
                                                      }
                                                      //´²
                                                      stLocalControl.stVoicePlay.byVoiceData[byPosition++] = BED_VOICE;
                                              }
                                              else
                                              {       //Ã»ÓÐÊ®Î»Êý¾Ý
                                                      stLocalControl.stVoicePlay.byVoiceData[byPosition++] = byTemp1;
                                                      //´²
                                                      stLocalControl.stVoicePlay.byVoiceData[byPosition++] = BED_VOICE;
                                              }
                                      }
                                      //ºô½Ð
C51 COMPILER V8.08   SINGLEBUS                                                             02/22/2013 13:09:18 PAGE 58  

                                      stLocalControl.stVoicePlay.byVoiceData[byPosition++] = CALL_VOICE;      
                                      stLocalControl.stVoicePlay.byVoiceSize = byPosition;                    
                                      break;
                              case CMD_SERVICE_CALL:                  //ÊµÖÊÎªÊäÒºÍê±Ïºô½ÐÃüÁî
                                      //¹¹½¨´²ÐÅÏ¢
                                      byTemp1 = pstBusDealFreq->bySndBedAddr;
                                      byTemp2 = byTemp1 / 100;
                                      byTemp1 %= 100;
                                      if(byTemp2)
                                      {       //ÓÐ°ÙÎ»Êý¾Ý
                                              stLocalControl.stVoicePlay.byVoiceData[byPosition++] = byTemp2;
                                              stLocalControl.stVoicePlay.byVoiceData[byPosition++] = HUNDRED_VOICE;   //"°Ù"ÒôµÄÐòºÅ
                                              if(byTemp1)
                                              {       //Ê£ÏÂµÄÊý¾ÝÈÔÈ»ÓÐ
                                                      byTemp2 = byTemp1 / 10;
                                                      byTemp1 %= 10;
                                                      stLocalControl.stVoicePlay.byVoiceData[byPosition++] = byTemp2;
                                                      if(byTemp2)
                                                      {       //ÓÐÊ®Î»Êý¾Ý,±¨Ê®
                                                              stLocalControl.stVoicePlay.byVoiceData[byPosition++] = TEN_VOICE;
                                                      }
                                                      if(byTemp1)
                                                      {       //ÓÐ¸öÎ»Êý¾Ý,±¨ºÅ
                                                              stLocalControl.stVoicePlay.byVoiceData[byPosition++] = byTemp1;
                                                      }
                                              }
                                              //´²
                                              stLocalControl.stVoicePlay.byVoiceData[byPosition++] = BED_VOICE;
                                      }
                                      else
                                      {       //Ã»ÓÐ°ÙÎ»Êý¾Ý
                                              byTemp2 = byTemp1 / 10;
                                              byTemp1 %= 10;
                                              if(byTemp2)
                                              {       //ÓÐÊ®Î»Êý¾Ý
                                                      if(byTemp2 != 1)
                                                      {       //ÐèÒª´æ´¢Ê®Î»Êý¾Ý
                                                              stLocalControl.stVoicePlay.byVoiceData[byPosition++] = byTemp2;
                                                      }
                                                      stLocalControl.stVoicePlay.byVoiceData[byPosition++] = TEN_VOICE;
                                                      if(byTemp1)
                                                      {       //ÓÐ¸öÎ»Êý¾Ý
                                                              stLocalControl.stVoicePlay.byVoiceData[byPosition++] = byTemp1;
                                                      }
                                                      //´²
                                                      stLocalControl.stVoicePlay.byVoiceData[byPosition++] = BED_VOICE;
                                              }
                                              else
                                              {       //Ã»ÓÐÊ®Î»Êý¾Ý
                                                      stLocalControl.stVoicePlay.byVoiceData[byPosition++] = byTemp1;
                                                      //´²
                                                      stLocalControl.stVoicePlay.byVoiceData[byPosition++] = BED_VOICE;
                                              }
                                      }
                                      //ÊäÒºÍê±Ï
                                      stLocalControl.stVoicePlay.byVoiceData[byPosition++] = INFUSION_VOICE;
                                      stLocalControl.stVoicePlay.byVoiceData[byPosition++] = END_VOICE;
                                      stLocalControl.stVoicePlay.byVoiceSize = byPosition;                    
                                      break;                  
                              case CMD_EMERGENCY_CALL:                        //ÎÀÉú¼ä½ô¼±ºô½ÐÃüÁî
                                      //¹¹½¨ÎÀÉú¼äÐÅÏ¢
                                      byTemp1 = pstBusDealFreq->bySndBedAddr & 0x0f;
C51 COMPILER V8.08   SINGLEBUS                                                             02/22/2013 13:09:18 PAGE 59  

                                      if(byTemp1 == 0x00)
                                      {       //¸Ã·¿¼äÖ»ÓÐÒ»¸öÎÀÉú¼ä£¬Ö±½Ó±¨ÎÀÉú¼äºô½Ð
                                              stLocalControl.stVoicePlay.byVoiceData[byPosition++] = TOILET_VOICE;
                                              //ºô½Ð
                                              stLocalControl.stVoicePlay.byVoiceData[byPosition++] = CALL_VOICE;      
                                              stLocalControl.stVoicePlay.byVoiceSize = byPosition;                            
                                              break;
                                      }                                               
                                      //Ã»ÓÐ°ÙÎ»Êý¾Ý
                                      byTemp2 = byTemp1 / 10;
                                      byTemp1 %= 10;
                                      if(byTemp2)
                                      {       //ÓÐÊ®Î»Êý¾Ý
                                              if(byTemp2 != 1)
                                              {       //ÐèÒª´æ´¢Ê®Î»Êý¾Ý
                                                      stLocalControl.stVoicePlay.byVoiceData[byPosition++] = byTemp2;
                                              }
                                              stLocalControl.stVoicePlay.byVoiceData[byPosition++] = TEN_VOICE;
                                              if(byTemp1)
                                              {       //ÓÐ¸öÎ»Êý¾Ý
                                                      stLocalControl.stVoicePlay.byVoiceData[byPosition++] = byTemp1;
                                              }
                                              //ºÅ
                                              stLocalControl.stVoicePlay.byVoiceData[byPosition++] = NUM_VOICE;
                                              //ÎÀÉú¼ä                                
                                              stLocalControl.stVoicePlay.byVoiceData[byPosition++] = TOILET_VOICE;
                                      }
                                      else
                                      {       //Ã»ÓÐÊ®Î»Êý¾Ý
                                              stLocalControl.stVoicePlay.byVoiceData[byPosition++] = byTemp1;
                                              //ºÅ
                                              stLocalControl.stVoicePlay.byVoiceData[byPosition++] = NUM_VOICE;
                                              //ÎÀÉú¼ä
                                              stLocalControl.stVoicePlay.byVoiceData[byPosition++] = TOILET_VOICE;
                                      }       
                                      //ºô½Ð
                                      stLocalControl.stVoicePlay.byVoiceData[byPosition++] = CALL_VOICE;      
                                      stLocalControl.stVoicePlay.byVoiceSize = byPosition;                    
                                      break;
                      }
              #endif  
1099   1      //Send_Data(stLocalControl.stVoicePlay.byVoiceData,byPosition);
1100   1      }
1101          
1102          /**********************************************************
1103          *º¯ÊýÃû³Æ                       :StopVoicePlay  
1104          *º¯ÊýÃèÊö               :Í£Ö¹ÕñÁå
1105          *ÊäÈë²ÎÊý               :
1106          *·µ»ØÖµ                         :
1107          *È«¾Ö±äÁ¿                       :
1108          *µ÷ÓÃÄ£¿é                       :
1109          ***********************************************************
1110          *´´½¨ÈË                 :ÒüÔËÍ¬
1111          *´´½¨ÈÕÆÚ                       :2009-4-6
1112          ***********************************************************
1113          *ÐÞ¸ÄÈË                         :
1114          *ÐÞ¸ÄÈÕÆÚ               :
1115          *×¢ÊÍ                   :
1116          **********************************************************/
1117          void StopVoicePlay(void)
1118          {       
1119   1              stLocalControl.stVoicePlay.byVS1003State &= ~(ISD_REPLAY|ISD_PLAYING);
C51 COMPILER V8.08   SINGLEBUS                                                             02/22/2013 13:09:18 PAGE 60  

1120   1              stLocalControl.stVoicePlay.byVoiceTimes = 0;
1121   1      }
1122          /**********************************************************
1123          *º¯ÊýÃû³Æ                       :StartVoicePlay 
1124          *º¯ÊýÃèÊö               :¿ªÊ¼ÓïÒô±¨ºÅ
1125          *ÊäÈë²ÎÊý               :
1126          *·µ»ØÖµ                         :
1127          *È«¾Ö±äÁ¿                       :
1128          *µ÷ÓÃÄ£¿é                       :
1129          ***********************************************************
1130          *´´½¨ÈË                 :ÒüÔËÍ¬
1131          *´´½¨ÈÕÆÚ                       :2009-4-6
1132          ***********************************************************
1133          *ÐÞ¸ÄÈË                         :
1134          *ÐÞ¸ÄÈÕÆÚ               :
1135          *×¢ÊÍ                   :
1136          **********************************************************/
1137          void StartVoicePlay(void)
1138          {
1139   1              stLocalControl.stVoicePlay.byVS1003State &= ~ISD_TIME_OVER;
1140   1              stLocalControl.stVoicePlay.byVS1003State |= ISD_REPLAY;
1141   1              stLocalControl.stVoicePlay.byVoiceTimes = 4;    // 1ÂÖ±¨ºÅ4±é
1142   1      }
1143          
1144          /**********************************************************
1145          *º¯ÊýÃû³Æ                       :Bus0RecDeal    
1146          *º¯ÊýÃèÊö               :µ¥×ÜÏß0ÊÕµ½Ò»Ö¡Êý¾Ý´¦Àíº¯Êý,¸Ãº¯ÊýÊ×ÏÈ
1147                                                   È¡³öÊÕµ½µÄÊý¾Ý,Õë¶ÔÃ¿ÌõÃüÁîÖ´ÐÐ¶ÔÓ¦µÄ¿Ø
1148                                                   ÖÆ¶¯×÷
1149          *ÊäÈë²ÎÊý               :
1150          *·µ»ØÖµ                         :
1151          *È«¾Ö±äÁ¿                       :stLocalControl
1152          *µ÷ÓÃÄ£¿é                       :
1153          ***********************************************************
1154          *´´½¨ÈË                 :³ÂÎÀ¹ú
1155          *´´½¨ÈÕÆÚ                       :2008-9-22
1156          ***********************************************************
1157          *ÐÞ¸ÄÈË                         :
1158          *ÐÞ¸ÄÈÕÆÚ               :
1159          *×¢ÊÍ                   :
1160          **********************************************************/
1161          void Bus0RecDeal(void)
1162          {
1163   1              //È¡³öÊÕµ½µÄÊý¾ÝÖ¡                      
1164   1              OS_ENTER_CRITICAL();
1165   1              memcpy(&(stLocalControl.stBusDealFreq), byBus0RecData, sizeof(STBusFreq));
1166   1              bBus0RecFinish = 0;     
1167   1              OS_EXIT_CRITICAL();     
1168   1              
1169   1              Send_Data(&(stLocalControl.stBusDealFreq.bySndSecAddr),7);      //½«½ÓÊÕµ½µÄÊý¾Ý·¢¸øPC»ú
1170   1              
1171   1              switch(stLocalControl.stBusDealFreq.byCmd)
1172   1              {
1173   2                      case CMD_INFO_INDICATION:                                                                               //ÏûÏ¢Ö¸Ê¾ÃüÁî
1174   2                              MakeCallVoiceData(&(stLocalControl.stBusDealFreq));
1175   2                              //²¥·ÅÓïÒô
1176   2                              if(stLocalControl.stVoicePlay.byVoiceSize)
1177   2                              {
1178   3      /*                              for(i=0;i<30;i++)
1179   3                                      {
1180   3                                              if(stLocalControl.stVoicePlay.byVoiceTimes==0) break;   //ÒÑ±¨Íê,ÂíÉÏÍË³ö
1181   3                                              OSWait(K_TMO,200); //ÑÓÊ±1S
C51 COMPILER V8.08   SINGLEBUS                                                             02/22/2013 13:09:18 PAGE 61  

1182   3                                      }
1183   3                                      */
1184   3                                      StartVoicePlay();
1185   3                                      
1186   3                              }
1187   2                              break ;
1188   2                      case CMD_STOP_VOICE_PLAY:
1189   2                              //Í£Ö¹±¨ºÅ                      
1190   2                              StopVoicePlay();
1191   2                              break;
1192   2      
1193   2                      case CMD_VOICE_MAINTAIN:
1194   2                              if(stLocalControl.stBusDealFreq.bySndSecAddr ==0x01)    //¿ªÊ¼²¥·ÅÏµÍ³Î¬»¤ÓïÒô
1195   2                              {
1196   3                                      stLocalControl.stVoicePlay.byVoiceData[0] = MAINTAIN_VOICE;     
1197   3                                      stLocalControl.stVoicePlay.byVoiceSize = 1;     
1198   3                                      stLocalControl.stVoicePlay.byVS1003State &= ~ISD_TIME_OVER;
1199   3                                      stLocalControl.stVoicePlay.byVS1003State |= ISD_REPLAY;
1200   3                                      stLocalControl.stVoicePlay.byVoiceTimes = 1;    // 1ÂÖ±¨ºÅ1±é
1201   3                                      bPlayVoiceMaintain =1;
1202   3      
1203   3                              }
1204   2                              break;
1205   2              case CMD_VOICE_WAITE:
1206   2                              if(stLocalControl.stBusDealFreq.bySndSecAddr ==0x01)    //¿ªÊ¼²¥·ÅÏµÍ³Î¬»¤ÓïÒô
1207   2                              {
1208   3                                      stLocalControl.stVoicePlay.byVoiceData[0] = WAIT_VOICE; 
1209   3                                      stLocalControl.stVoicePlay.byVoiceSize = 1;     
1210   3                                      stLocalControl.stVoicePlay.byVS1003State &= ~ISD_TIME_OVER;
1211   3                                      stLocalControl.stVoicePlay.byVS1003State |= ISD_REPLAY;
1212   3                                      stLocalControl.stVoicePlay.byVoiceTimes = 1;    // 1ÂÖ±¨ºÅ1±é
1213   3                                      bPlayVoiceWait =1;
1214   3      
1215   3                              }
1216   2                              break;
1217   2                      default:
1218   2                              break;
1219   2                      
1220   2              }               
1221   1      }
1222          /**********************************************************
1223          *º¯ÊýÃû³Æ                       :Bus0SendDeal   
1224          *º¯ÊýÃèÊö               :µ¥×ÜÏß0·¢ËÍÍêÒ»Ö¡Êý¾Ý´¦Àíº¯Êý,¸Ãº¯ÊýÊ×ÏÈ
1225                                                   È¡³öÊÕµ½µÄÊý¾Ý,Õë¶ÔÃ¿ÌõÃüÁîÖ´ÐÐ¶ÔÓ¦µÄ¿Ø
1226                                                   ÖÆ¶¯×÷
1227          *ÊäÈë²ÎÊý               :
1228          *·µ»ØÖµ                         :
1229          *È«¾Ö±äÁ¿                       :stLocalControl
1230          *µ÷ÓÃÄ£¿é                       :
1231          ***********************************************************
1232          *´´½¨ÈË                 :³ÂÎÀ¹ú
1233          *´´½¨ÈÕÆÚ                       :2008-9-22
1234          ***********************************************************
1235          *ÐÞ¸ÄÈË                         :
1236          *ÐÞ¸ÄÈÕÆÚ               :
1237          *×¢ÊÍ                   :
1238          **********************************************************/
1239          void Bus0SendDeal(void)
1240          {
1241   1              //È¡³ö·¢ËÍÍê³ÉµÄÊý¾ÝÖ¡
1242   1              OS_ENTER_CRITICAL();
1243   1              memcpy(&(stLocalControl.stBusDealFreq), byBus0SendData, sizeof(STBusFreq));             
C51 COMPILER V8.08   SINGLEBUS                                                             02/22/2013 13:09:18 PAGE 62  

1244   1              bBus0SendFinish = 0;                                                                            
1245   1              OS_EXIT_CRITICAL();     
1246   1      
1247   1      //      Send_Data(&(stLocalControl.stBusDealFreq.bySndSecAddr),7);      //½«½ÓÊÕµ½µÄÊý¾Ý·¢¸øPC»ú
1248   1              
1249   1              switch(stLocalControl.stBusDealFreq.byCmd)
1250   1              {
1251   2                      case CMD_LANDING:                                                                       //µÇ¼ÇÃüÁî
1252   2                              
1253   2                              break;
1254   2              }               
1255   1      }
1256          /**********************************************************
1257          *º¯ÊýÃû³Æ                       :Bus0Manage     
1258          *º¯ÊýÃèÊö               :µ¥×ÜÏß0¹ÜÀíÏß³Ì
1259          *ÊäÈë²ÎÊý               :
1260          *·µ»ØÖµ                         :
1261          *È«¾Ö±äÁ¿                       :byMainCmdQ
1262          *µ÷ÓÃÄ£¿é                       :OSQPost
1263          ***********************************************************
1264          *´´½¨ÈË                 :³ÂÎÀ¹ú
1265          *´´½¨ÈÕÆÚ                       :2008-9-22
1266          ***********************************************************
1267          *ÐÞ¸ÄÈË                         :
1268          *ÐÞ¸ÄÈÕÆÚ               :
1269          *×¢ÊÍ                   :
1270          **********************************************************/
1271          void Bus0Manage(void)
1272          {       
1273   1              while(TRUE)
1274   1              {               
1275   2                      if(bBus0RecFinish)                                                                      //×ÜÏß0ÊÕµ½Êý¾Ý
1276   2                      {                       
1277   3                              OSQPost(byMainCmdQ, BUS0_REC);                          
1278   3                      }
1279   2                      if(bBus0SendFinish)                                                                     //×ÜÏß0·¢ËÍÍêÊý¾ÝÖ¡
1280   2                      {
1281   3                              OSQPost(byMainCmdQ, BUS0_SND);                  
1282   3                      } 
1283   2                      OSWait(K_TMO, 1);                                       
1284   2              }
1285   1      }
1286          /**********************************************************
1287          *º¯ÊýÃû³Æ                       :TimerOutDeal   
1288          *º¯ÊýÃèÊö               :³¬Ê±´¦Àíº¯Êý
1289          *ÊäÈë²ÎÊý               :
1290          *·µ»ØÖµ                         :
1291          *È«¾Ö±äÁ¿                       :stLocalControl
1292          *µ÷ÓÃÄ£¿é                       :Bus0OutputData                                  
1293          ***********************************************************
1294          *´´½¨ÈË                 :³ÂÎÀ¹ú
1295          *´´½¨ÈÕÆÚ                       :2008-9-22
1296          ***********************************************************
1297          *ÐÞ¸ÄÈË                         :
1298          *ÐÞ¸ÄÈÕÆÚ               :
1299          *×¢ÊÍ                   :
1300          **********************************************************/
1301          void TimerOutDeal(void)
1302          {       
1303   1              if(stLocalControl.stCH0TimerOut.byTimerOut != 0)
1304   1              {       //ÓÐ³¬Ê±ÉèÖÃ´æÔÚ
1305   2                      stLocalControl.stCH0TimerOut.byTimerOut--;
C51 COMPILER V8.08   SINGLEBUS                                                             02/22/2013 13:09:18 PAGE 63  

1306   2                      if(stLocalControl.stCH0TimerOut.byTimerOut == 0)
1307   2                      {       //³¬Ê±Ò»´Îµ½ÁË
1308   3                              if(stLocalControl.stCH0TimerOut.byTimerOutCount == 0x00)
1309   3                              {       //ËùÓÐ³¬Ê±Íê³É
1310   4                                              
1311   4                              }
1312   3                              else
1313   3                              {       //³¬Ê±´ÎÊýÃ»ÓÐÍê
1314   4                                      stLocalControl.stCH0TimerOut.byTimerOutCount--;
1315   4                                      if(stLocalControl.stCH0TimerOut.byTimerOutCount == 0x00)
1316   4                                      {       //ËùÓÐ³¬Ê±Íê³É
1317   5      
1318   5                                      }                       
1319   4                              }
1320   3                      }
1321   2              }
1322   1      }
1323          /**********************************************************
1324          *º¯ÊýÃû³Æ                       :TimerOutManager        
1325          *º¯ÊýÃèÊö               :³¬Ê±¹ÜÀíÏß³Ì
1326          *ÊäÈë²ÎÊý               :
1327          *·µ»ØÖµ                         :
1328          *È«¾Ö±äÁ¿                       :stLocalControl,byMainCmdQ
1329          *µ÷ÓÃÄ£¿é                       :OSQPost                                
1330          ***********************************************************
1331          *´´½¨ÈË                 :³ÂÎÀ¹ú
1332          *´´½¨ÈÕÆÚ                       :2008-9-22
1333          ***********************************************************
1334          *ÐÞ¸ÄÈË                         :
1335          *ÐÞ¸ÄÈÕÆÚ               :
1336          *×¢ÊÍ                   :
1337          **********************************************************/             
1338          void TimerOutManager(void)       
1339          {       
1340   1              while(1)
1341   1              {       
1342   2                      OSWait(K_TMO, 4);                                                                       //ÑÓÊ±20ms                                                              
1343   2                      if(stLocalControl.stCH0TimerOut.byTimerOut)
1344   2                      {       
1345   3                              OSQPost(byMainCmdQ, TIMER_OUT);                         
1346   3                      }
1347   2                      else
1348   2                      {               
1349   3                              OSQPost(byMainCmdQ, TIMER_OUT); 
1350   3                      }                       
1351   2              }
1352   1      } 
1353                    
C51 COMPILER V8.08   SINGLEBUS                                                             02/22/2013 13:09:18 PAGE 64  

ASSEMBLY LISTING OF GENERATED OBJECT CODE


             ; FUNCTION SingleBusInit (BEGIN)
                                           ; SOURCE LINE # 80
                                           ; SOURCE LINE # 81
                                           ; SOURCE LINE # 87
0000 43B108            ORL     P3M0,#08H
                                           ; SOURCE LINE # 88
0003 53B2F7            ANL     P3M1,#0F7H
                                           ; SOURCE LINE # 91
0006 43B110            ORL     P3M0,#010H
                                           ; SOURCE LINE # 92
0009 43B210            ORL     P3M1,#010H
                                           ; SOURCE LINE # 96
000C D2B4              SETB    Bus0SendPin
                                           ; SOURCE LINE # 97
000E D2B3              SETB    Bus0RecPin
                                           ; SOURCE LINE # 103
0010 5389F0            ANL     TMOD,#0F0H
                                           ; SOURCE LINE # 104
0013 438901            ORL     TMOD,#01H
                                           ; SOURCE LINE # 106
0016 758A67            MOV     TL0,#067H
                                           ; SOURCE LINE # 107
0019 758CFF            MOV     TH0,#0FFH
                                           ; SOURCE LINE # 109
001C C28D              CLR     TF0
                                           ; SOURCE LINE # 110
001E 538E7F            ANL     AUXR,#07FH
                                           ; SOURCE LINE # 111
0021 D2A9              SETB    ET0
                                           ; SOURCE LINE # 112
0023 D28C              SETB    TR0
                                           ; SOURCE LINE # 114
0025 7500E6      R     MOV     byBus0SendStopCount,#0E6H
                                           ; SOURCE LINE # 115
0028 D28A              SETB    IT1
                                           ; SOURCE LINE # 116
002A 30B303            JNB     Bus0RecPin,?C0001
                                           ; SOURCE LINE # 117
                                           ; SOURCE LINE # 118
002D D2AA              SETB    EX1
                                           ; SOURCE LINE # 119
002F 22                RET     
0030         ?C0001:
                                           ; SOURCE LINE # 121
                                           ; SOURCE LINE # 122
0030 D200        R     SETB    bBus0Error
                                           ; SOURCE LINE # 123
                                           ; SOURCE LINE # 124
0032         ?C0003:
0032 22                RET     
             ; FUNCTION SingleBusInit (END)

             ; FUNCTION Bus0RecInt (BEGIN)
0000 C2AF              CLR     EA
                                           ; SOURCE LINE # 142
                                           ; SOURCE LINE # 144
0002 C2AA              CLR     EX1
                                           ; SOURCE LINE # 145
0004 D200        R     SETB    bBus0StartRec
C51 COMPILER V8.08   SINGLEBUS                                                             02/22/2013 13:09:18 PAGE 65  

                                           ; SOURCE LINE # 146
0006 C200        R     CLR     bBus0Enable
                                           ; SOURCE LINE # 147
0008 750000      R     MOV     byBus0RecCount,#00H
                                           ; SOURCE LINE # 148
000B D2AF              SETB    EA
000D 32                RETI    
             ; FUNCTION Bus0RecInt (END)

             ; FUNCTION Timer0Int (BEGIN)
0000 C2AF              CLR     EA
0002 C0E0              PUSH    ACC
0004 C0F0              PUSH    B
0006 C083              PUSH    DPH
0008 C082              PUSH    DPL
000A C0D0              PUSH    PSW
000C 75D000            MOV     PSW,#00H
000F C000              PUSH    AR0
0011 C002              PUSH    AR2
0013 C003              PUSH    AR3
0015 C004              PUSH    AR4
0017 C005              PUSH    AR5
0019 C006              PUSH    AR6
001B C007              PUSH    AR7
                                           ; SOURCE LINE # 166
                                           ; SOURCE LINE # 169
001D C28C              CLR     TR0
                                           ; SOURCE LINE # 170
001F 758CFF            MOV     TH0,#0FFH
                                           ; SOURCE LINE # 171
0022 758A67            MOV     TL0,#067H
                                           ; SOURCE LINE # 172
0025 D28C              SETB    TR0
                                           ; SOURCE LINE # 174
0027 A2B3              MOV     C,Bus0RecPin
0029 9200        R     MOV     bBus0RecBit,C
                                           ; SOURCE LINE # 176
002B 300030      R     JNB     bBus0StartRec,?C0005
                                           ; SOURCE LINE # 177
                                           ; SOURCE LINE # 178
002E 7410              MOV     A,#010H
0030 2500        R     ADD     A,byBus0RecCount
0032 F500        R     MOV     byBus0RecCount,A
                                           ; SOURCE LINE # 179
0034 54F0              ANL     A,#0F0H
0036 6450              XRL     A,#050H
0038 6003              JZ      $ + 5H
003A 020000      R     LJMP    ?C0010
                                           ; SOURCE LINE # 180
                                           ; SOURCE LINE # 181
003D C200        R     CLR     bBus0StartRec
                                           ; SOURCE LINE # 182
003F F500        R     MOV     byBus0RecCount,A
                                           ; SOURCE LINE # 183
0041 300015      R     JNB     bBus0RecBit,?C0007
                                           ; SOURCE LINE # 184
                                           ; SOURCE LINE # 185
0044 20000A      R     JB      bBus0SendError,?C0008
0047 300007      R     JNB     bBus0OnSendFreq,?C0008
                                           ; SOURCE LINE # 186
                                           ; SOURCE LINE # 187
004A 5300C3      R     ANL     byBus0State0,#0C3H
C51 COMPILER V8.08   SINGLEBUS                                                             02/22/2013 13:09:18 PAGE 66  

                                           ; SOURCE LINE # 188
004D D200        R     SETB    bBus0SendError
                                           ; SOURCE LINE # 189
004F D2B4              SETB    Bus0SendPin
                                           ; SOURCE LINE # 190
0051         ?C0008:
                                           ; SOURCE LINE # 191
0051 7500F0      R     MOV     byBus0SendStopCount,#0F0H
                                           ; SOURCE LINE # 192
0054 750000      R     MOV     byBus0RecSendCount,#00H
                                           ; SOURCE LINE # 193
                                           ; SOURCE LINE # 194
0057 8078              SJMP    ?C0160
0059         ?C0007:
                                           ; SOURCE LINE # 196
                                           ; SOURCE LINE # 197
0059 D200        R     SETB    bBus0OnRec
                                           ; SOURCE LINE # 198
                                           ; SOURCE LINE # 199
                                           ; SOURCE LINE # 200
005B 020000      R     LJMP    ?C0010
005E         ?C0005:
                                           ; SOURCE LINE # 201
005E 200003      R     JB      bBus0OnRec,$ + 6H
0061 020000      R     LJMP    ?C0010
                                           ; SOURCE LINE # 202
                                           ; SOURCE LINE # 203
0064 7410              MOV     A,#010H
0066 2500        R     ADD     A,byBus0RecCount
0068 F500        R     MOV     byBus0RecCount,A
                                           ; SOURCE LINE # 204
006A 54F0              ANL     A,#0F0H
006C 64A0              XRL     A,#0A0H
006E 6003              JZ      $ + 5H
0070 020000      R     LJMP    ?C0010
                                           ; SOURCE LINE # 205
                                           ; SOURCE LINE # 206
0073 53000F      R     ANL     byBus0RecCount,#0FH
                                           ; SOURCE LINE # 207
0076 0500        R     INC     byBus0RecCount
                                           ; SOURCE LINE # 208
0078 E500        R     MOV     A,byBus0RecCount
007A 540F              ANL     A,#0FH
007C FF                MOV     R7,A
007D 640A              XRL     A,#0AH
007F 706A              JNZ     ?C0013
                                           ; SOURCE LINE # 209
                                           ; SOURCE LINE # 210
0081 C200        R     CLR     bBus0OnRec
                                           ; SOURCE LINE # 211
0083 300051      R     JNB     bBus0RecBit,?C0014
                                           ; SOURCE LINE # 212
                                           ; SOURCE LINE # 213
0086 E500        R     MOV     A,byBus0RecSendCount
0088 54F0              ANL     A,#0F0H
008A 24FF              ADD     A,#0FFH
008C 300001      R     JNB     bBus0RecBit9,?C0158
008F B3                CPL     C
0090         ?C0158:
0090 4008              JC      ?C0015
                                           ; SOURCE LINE # 214
                                           ; SOURCE LINE # 215
C51 COMPILER V8.08   SINGLEBUS                                                             02/22/2013 13:09:18 PAGE 67  

0092 750000      R     MOV     byBus0RecTimeOut,#00H
                                           ; SOURCE LINE # 216
0095 53000F      R     ANL     byBus0RecSendCount,#0FH
                                           ; SOURCE LINE # 217
0098 8034              SJMP    ?C0016
009A         ?C0015:
                                           ; SOURCE LINE # 219
                                           ; SOURCE LINE # 220
009A 7500E6      R     MOV     byBus0RecTimeOut,#0E6H
                                           ; SOURCE LINE # 221
009D E500        R     MOV     A,byBus0RecSendCount
009F C4                SWAP    A
00A0 540F              ANL     A,#0FH
00A2 2400        R     ADD     A,#LOW byBus0RecData
00A4 F582              MOV     DPL,A
00A6 E4                CLR     A
00A7 3400        R     ADDC    A,#HIGH byBus0RecData
00A9 F583              MOV     DPH,A
00AB E500        R     MOV     A,byBus0RecBuf
00AD F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 222
00AE 7410              MOV     A,#010H
00B0 2500        R     ADD     A,byBus0RecSendCount
00B2 F500        R     MOV     byBus0RecSendCount,A
                                           ; SOURCE LINE # 223
00B4 54F0              ANL     A,#0F0H
00B6 C3                CLR     C
00B7 9470              SUBB    A,#070H
00B9 4013              JC      ?C0016
                                           ; SOURCE LINE # 224
                                           ; SOURCE LINE # 225
00BB 53000F      R     ANL     byBus0RecSendCount,#0FH
                                           ; SOURCE LINE # 226
00BE 300003      R     JNB     bBus0OnSendFreq,?C0019
00C1 300002      R     JNB     bBus0ReqSend,?C0018
00C4         ?C0019:
                                           ; SOURCE LINE # 227
                                           ; SOURCE LINE # 228
00C4 D200        R     SETB    bBus0RecFinish
                                           ; SOURCE LINE # 229
00C6         ?C0018:
                                           ; SOURCE LINE # 230
00C6 750000      R     MOV     byBus0RecTimeOut,#00H
                                           ; SOURCE LINE # 231
00C9 75000A      R     MOV     byBus0DisableCount,#0AH
                                           ; SOURCE LINE # 232
00CC D200        R     SETB    bBus0Disable
                                           ; SOURCE LINE # 233
                                           ; SOURCE LINE # 234
00CE         ?C0016:
                                           ; SOURCE LINE # 235
00CE 7500F0      R     MOV     byBus0SendStopCount,#0F0H
                                           ; SOURCE LINE # 236
00D1         ?C0160:
00D1 C28B              CLR     IE1
00D3 D2AA              SETB    EX1
                                           ; SOURCE LINE # 237
00D5 8029              SJMP    ?C0010
00D7         ?C0014:
                                           ; SOURCE LINE # 239
                                           ; SOURCE LINE # 240
00D7 D200        R     SETB    bBus0Error
C51 COMPILER V8.08   SINGLEBUS                                                             02/22/2013 13:09:18 PAGE 68  

                                           ; SOURCE LINE # 241
00D9 20000A      R     JB      bBus0SendError,?C0021
00DC 300007      R     JNB     bBus0OnSendFreq,?C0021
                                           ; SOURCE LINE # 242
                                           ; SOURCE LINE # 243
00DF 5300C3      R     ANL     byBus0State0,#0C3H
                                           ; SOURCE LINE # 244
00E2 D200        R     SETB    bBus0SendError
                                           ; SOURCE LINE # 245
00E4 D2B4              SETB    Bus0SendPin
                                           ; SOURCE LINE # 246
00E6         ?C0021:
                                           ; SOURCE LINE # 247
00E6 750000      R     MOV     byBus0RecSendCount,#00H
                                           ; SOURCE LINE # 248
                                           ; SOURCE LINE # 249
00E9 8015              SJMP    ?C0010
00EB         ?C0013:
                                           ; SOURCE LINE # 250
00EB BF0906            CJNE    R7,#09H,?C0023
                                           ; SOURCE LINE # 251
                                           ; SOURCE LINE # 252
00EE A200        R     MOV     C,bBus0RecBit
00F0 9200        R     MOV     bBus0RecBit9,C
                                           ; SOURCE LINE # 253
00F2 800C              SJMP    ?C0010
00F4         ?C0023:
                                           ; SOURCE LINE # 255
                                           ; SOURCE LINE # 256
00F4 E500        R     MOV     A,byBus0RecBuf
00F6 C3                CLR     C
00F7 13                RRC     A
00F8 F500        R     MOV     byBus0RecBuf,A
                                           ; SOURCE LINE # 257
00FA 300003      R     JNB     bBus0RecBit,?C0010
                                           ; SOURCE LINE # 258
                                           ; SOURCE LINE # 259
00FD 430080      R     ORL     byBus0RecBuf,#080H
                                           ; SOURCE LINE # 260
                                           ; SOURCE LINE # 261
                                           ; SOURCE LINE # 262
                                           ; SOURCE LINE # 263
0100         ?C0010:
                                           ; SOURCE LINE # 265
0100 E500        R     MOV     A,byBus0State0
0102 540C              ANL     A,#0CH
0104 640C              XRL     A,#0CH
0106 702C              JNZ     ?C0026
                                           ; SOURCE LINE # 266
                                           ; SOURCE LINE # 267
0108 30001E      R     JNB     bBus0RecBit,?C0027
                                           ; SOURCE LINE # 268
                                           ; SOURCE LINE # 269
010B C2B4              CLR     Bus0SendPin
                                           ; SOURCE LINE # 270
010D C200        R     CLR     bBus0SendBit
                                           ; SOURCE LINE # 271
010F F500        R     MOV     byBus0SendCount,A
                                           ; SOURCE LINE # 272
0111 5300F3      R     ANL     byBus0State0,#0F3H
                                           ; SOURCE LINE # 273
0114 E500        R     MOV     A,byBus0RecSendCount
C51 COMPILER V8.08   SINGLEBUS                                                             02/22/2013 13:09:18 PAGE 69  

0116 540F              ANL     A,#0FH
0118 2400        R     ADD     A,#LOW byBus0SendData
011A F582              MOV     DPL,A
011C E4                CLR     A
011D 3400        R     ADDC    A,#HIGH byBus0SendData
011F F583              MOV     DPH,A
0121 E0                MOVX    A,@DPTR
0122 F500        R     MOV     byBus0SendBuf,A
                                           ; SOURCE LINE # 274
0124 D200        R     SETB    bBus0OnSendBit
                                           ; SOURCE LINE # 275
0126 020000      R     LJMP    ?C0029
0129         ?C0027:
                                           ; SOURCE LINE # 277
                                           ; SOURCE LINE # 278
0129 5300C3      R     ANL     byBus0State0,#0C3H
                                           ; SOURCE LINE # 279
012C D200        R     SETB    bBus0SendError
                                           ; SOURCE LINE # 280
012E 5300F0      R     ANL     byBus0RecSendCount,#0F0H
                                           ; SOURCE LINE # 281
                                           ; SOURCE LINE # 282
                                           ; SOURCE LINE # 283
                                           ; SOURCE LINE # 284
0131 020000      R     LJMP    ?C0161
0134         ?C0026:
                                           ; SOURCE LINE # 285
0134 200003      R     JB      bBus0OnSendBit,$ + 6H
0137 020000      R     LJMP    ?C0029
                                           ; SOURCE LINE # 286
                                           ; SOURCE LINE # 287
013A A200        R     MOV     C,bBus0SendBit
013C 300001      R     JNB     bBus0RecBit,?C0159
013F B3                CPL     C
0140         ?C0159:
0140 4079              JC      ?C0031
                                           ; SOURCE LINE # 288
                                           ; SOURCE LINE # 289
0142 7410              MOV     A,#010H
0144 2500        R     ADD     A,byBus0SendCount
0146 F500        R     MOV     byBus0SendCount,A
                                           ; SOURCE LINE # 290
0148 54F0              ANL     A,#0F0H
014A 64A0              XRL     A,#0A0H
014C 707A              JNZ     ?C0029
                                           ; SOURCE LINE # 291
                                           ; SOURCE LINE # 292
014E 53000F      R     ANL     byBus0SendCount,#0FH
                                           ; SOURCE LINE # 293
0151 0500        R     INC     byBus0SendCount
                                           ; SOURCE LINE # 294
0153 E500        R     MOV     A,byBus0SendCount
0155 540F              ANL     A,#0FH
0157 FF                MOV     R7,A
0158 BF090F            CJNE    R7,#09H,?C0033
                                           ; SOURCE LINE # 295
                                           ; SOURCE LINE # 296
015B E500        R     MOV     A,byBus0RecSendCount
015D 540F              ANL     A,#0FH
015F 24FF              ADD     A,#0FFH
0161 B3                CPL     C
0162 9200        R     MOV     bBus0SendBit,C
C51 COMPILER V8.08   SINGLEBUS                                                             02/22/2013 13:09:18 PAGE 70  

                                           ; SOURCE LINE # 297
0164 A200        R     MOV     C,bBus0SendBit
0166 92B4              MOV     Bus0SendPin,C
                                           ; SOURCE LINE # 298
0168 805E              SJMP    ?C0029
016A         ?C0033:
                                           ; SOURCE LINE # 299
016A BF0A06            CJNE    R7,#0AH,?C0035
                                           ; SOURCE LINE # 300
                                           ; SOURCE LINE # 301
016D D200        R     SETB    bBus0SendBit
                                           ; SOURCE LINE # 302
016F D2B4              SETB    Bus0SendPin
                                           ; SOURCE LINE # 303
0171 8055              SJMP    ?C0029
0173         ?C0035:
                                           ; SOURCE LINE # 304
0173 E500        R     MOV     A,byBus0SendCount
0175 540F              ANL     A,#0FH
0177 640B              XRL     A,#0BH
0179 7029              JNZ     ?C0037
                                           ; SOURCE LINE # 305
                                           ; SOURCE LINE # 306
017B C200        R     CLR     bBus0OnSendBit
                                           ; SOURCE LINE # 307
017D 0500        R     INC     byBus0RecSendCount
                                           ; SOURCE LINE # 308
017F E500        R     MOV     A,byBus0RecSendCount
0181 540F              ANL     A,#0FH
0183 C3                CLR     C
0184 9407              SUBB    A,#07H
0186 4011              JC      ?C0038
                                           ; SOURCE LINE # 309
                                           ; SOURCE LINE # 310
0188 5300F0      R     ANL     byBus0RecSendCount,#0F0H
                                           ; SOURCE LINE # 311
018B 5300C3      R     ANL     byBus0State0,#0C3H
                                           ; SOURCE LINE # 312
018E 7500F0      R     MOV     byBus0SendStopCount,#0F0H
                                           ; SOURCE LINE # 313
0191 43000C      R     ORL     byBus0State1,#0CH
                                           ; SOURCE LINE # 314
0194 75000A      R     MOV     byBus0DisableCount,#0AH
                                           ; SOURCE LINE # 315
0197 8005              SJMP    ?C0039
0199         ?C0038:
                                           ; SOURCE LINE # 317
                                           ; SOURCE LINE # 318
0199 75000A      R     MOV     byBus0SendStopCount,#0AH
                                           ; SOURCE LINE # 319
019C D200        R     SETB    bBus0ReqSend
                                           ; SOURCE LINE # 320
019E         ?C0039:
                                           ; SOURCE LINE # 321
019E C28B              CLR     IE1
01A0 D2AA              SETB    EX1
                                           ; SOURCE LINE # 322
01A2 8024              SJMP    ?C0029
01A4         ?C0037:
                                           ; SOURCE LINE # 324
                                           ; SOURCE LINE # 325
01A4 E500        R     MOV     A,byBus0SendBuf
C51 COMPILER V8.08   SINGLEBUS                                                             02/22/2013 13:09:18 PAGE 71  

01A6 30E006            JNB     ACC.0,?C0041
                                           ; SOURCE LINE # 326
                                           ; SOURCE LINE # 327
01A9 D200        R     SETB    bBus0SendBit
                                           ; SOURCE LINE # 328
01AB D2B4              SETB    Bus0SendPin
                                           ; SOURCE LINE # 329
01AD 8004              SJMP    ?C0042
01AF         ?C0041:
                                           ; SOURCE LINE # 331
                                           ; SOURCE LINE # 332
01AF C200        R     CLR     bBus0SendBit
                                           ; SOURCE LINE # 333
01B1 C2B4              CLR     Bus0SendPin
                                           ; SOURCE LINE # 334
01B3         ?C0042:
                                           ; SOURCE LINE # 335
01B3 E500        R     MOV     A,byBus0SendBuf
01B5 C3                CLR     C
01B6 13                RRC     A
01B7 F500        R     MOV     byBus0SendBuf,A
                                           ; SOURCE LINE # 336
                                           ; SOURCE LINE # 337
                                           ; SOURCE LINE # 338
01B9 800D              SJMP    ?C0029
01BB         ?C0031:
                                           ; SOURCE LINE # 340
                                           ; SOURCE LINE # 341
01BB 5300C3      R     ANL     byBus0State0,#0C3H
                                           ; SOURCE LINE # 342
01BE 5300F0      R     ANL     byBus0RecSendCount,#0F0H
                                           ; SOURCE LINE # 343
01C1 D200        R     SETB    bBus0SendError
                                           ; SOURCE LINE # 344
01C3         ?C0161:
01C3 D2B4              SETB    Bus0SendPin
                                           ; SOURCE LINE # 345
01C5 7500F0      R     MOV     byBus0SendStopCount,#0F0H
                                           ; SOURCE LINE # 346
                                           ; SOURCE LINE # 347
01C8         ?C0029:
                                           ; SOURCE LINE # 349
01C8 E500        R     MOV     A,byBus0State0
01CA 5403              ANL     A,#03H
01CC 701A              JNZ     ?C0044
                                           ; SOURCE LINE # 350
                                           ; SOURCE LINE # 351
01CE E500        R     MOV     A,byBus0SendStopCount
01D0 6005              JZ      ?C0045
                                           ; SOURCE LINE # 352
                                           ; SOURCE LINE # 353
01D2 D50002      R     DJNZ    byBus0SendStopCount,?C0045
                                           ; SOURCE LINE # 354
                                           ; SOURCE LINE # 355
01D5 D200        R     SETB    bBus0Enable
                                           ; SOURCE LINE # 356
                                           ; SOURCE LINE # 357
01D7         ?C0045:
                                           ; SOURCE LINE # 358
01D7 30000E      R     JNB     bBus0Error,?C0044
                                           ; SOURCE LINE # 359
                                           ; SOURCE LINE # 360
C51 COMPILER V8.08   SINGLEBUS                                                             02/22/2013 13:09:18 PAGE 72  

01DA C200        R     CLR     bBus0Enable
                                           ; SOURCE LINE # 361
01DC 300009      R     JNB     bBus0RecBit,?C0044
                                           ; SOURCE LINE # 362
                                           ; SOURCE LINE # 363
01DF C200        R     CLR     bBus0Error
                                           ; SOURCE LINE # 364
01E1 C28B              CLR     IE1
01E3 D2AA              SETB    EX1
                                           ; SOURCE LINE # 365
01E5 7500F0      R     MOV     byBus0SendStopCount,#0F0H
                                           ; SOURCE LINE # 366
                                           ; SOURCE LINE # 367
                                           ; SOURCE LINE # 368
01E8         ?C0044:
                                           ; SOURCE LINE # 370
01E8 E500        R     MOV     A,byBus0RecTimeOut
01EA 6006              JZ      ?C0049
                                           ; SOURCE LINE # 371
                                           ; SOURCE LINE # 372
01EC D50003      R     DJNZ    byBus0RecTimeOut,?C0049
                                           ; SOURCE LINE # 373
                                           ; SOURCE LINE # 374
01EF 53000F      R     ANL     byBus0RecSendCount,#0FH
                                           ; SOURCE LINE # 375
                                           ; SOURCE LINE # 376
01F2         ?C0049:
                                           ; SOURCE LINE # 377
01F2 E500        R     MOV     A,byBus0DisableCount
01F4 6005              JZ      ?C0051
                                           ; SOURCE LINE # 378
                                           ; SOURCE LINE # 379
01F6 D50002      R     DJNZ    byBus0DisableCount,?C0051
                                           ; SOURCE LINE # 380
                                           ; SOURCE LINE # 381
01F9 C200        R     CLR     bBus0Disable
                                           ; SOURCE LINE # 382
                                           ; SOURCE LINE # 383
01FB         ?C0051:
                                           ; SOURCE LINE # 385
01FB E500        R     MOV     A,byBus0State0
01FD 5423              ANL     A,#023H
01FF 6003              JZ      $ + 5H
0201 020000      R     LJMP    ?C0059
                                           ; SOURCE LINE # 386
                                           ; SOURCE LINE # 387
0204 300005      R     JNB     bBus0SendError,?C0054
                                           ; SOURCE LINE # 388
                                           ; SOURCE LINE # 389
0207 C200        R     CLR     bBus0SendError
                                           ; SOURCE LINE # 390
                                           ; SOURCE LINE # 391
0209 020000      R     LJMP    ?C0162
020C         ?C0054:
                                           ; SOURCE LINE # 393
                                           ; SOURCE LINE # 394
020C A200        R     MOV     C,bBus0Disable
020E 7200        R     ORL     C,bBus0SendFinish
0210 5003              JNC     $ + 5H
0212 020000      R     LJMP    ?C0059
                                           ; SOURCE LINE # 395
                                           ; SOURCE LINE # 396
C51 COMPILER V8.08   SINGLEBUS                                                             02/22/2013 13:09:18 PAGE 73  

0215 E500        R     MOV     A,byBus0TxTail
0217 248D              ADD     A,#08DH
0219 FF                MOV     R7,A
021A E4                CLR     A
021B 33                RLC     A
021C FE                MOV     R6,A
021D E500        R     MOV     A,byBus0TxHead
021F FB                MOV     R3,A
0220 7A00              MOV     R2,#00H
0222 C3                CLR     C
0223 EF                MOV     A,R7
0224 9B                SUBB    A,R3
0225 FF                MOV     R7,A
0226 EE                MOV     A,R6
0227 9A                SUBB    A,R2
0228 FE                MOV     R6,A
0229 7C00              MOV     R4,#00H
022B 7D8D              MOV     R5,#08DH
022D 120000      E     LCALL   ?C?UIDIV
0230 ED                MOV     A,R5
0231 C3                CLR     C
0232 9407              SUBB    A,#07H
0234 5003              JNC     $ + 5H
0236 020000      R     LJMP    ?C0057
                                           ; SOURCE LINE # 397
                                           ; SOURCE LINE # 398
0239 7400        R     MOV     A,#LOW byBus0TxQ
023B 2500        R     ADD     A,byBus0TxHead
023D F582              MOV     DPL,A
023F E4                CLR     A
0240 3400        R     ADDC    A,#HIGH byBus0TxQ
0242 F583              MOV     DPH,A
0244 E0                MOVX    A,@DPTR
0245 900000      R     MOV     DPTR,#byBus0SendData
0248 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 399
0249 EB                MOV     A,R3
024A 2401              ADD     A,#01H
024C FF                MOV     R7,A
024D EA                MOV     A,R2
024E 33                RLC     A
024F FE                MOV     R6,A
0250 7C00              MOV     R4,#00H
0252 7D8D              MOV     R5,#08DH
0254 120000      E     LCALL   ?C?UIDIV
0257 8D00        R     MOV     byBus0TxHead,R5
                                           ; SOURCE LINE # 400
0259 7400        R     MOV     A,#LOW byBus0TxQ
025B 2500        R     ADD     A,byBus0TxHead
025D F582              MOV     DPL,A
025F E4                CLR     A
0260 3400        R     ADDC    A,#HIGH byBus0TxQ
0262 F583              MOV     DPH,A
0264 E0                MOVX    A,@DPTR
0265 900000      R     MOV     DPTR,#byBus0SendData+01H
0268 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 401
0269 E500        R     MOV     A,byBus0TxHead
026B 2401              ADD     A,#01H
026D FF                MOV     R7,A
026E E4                CLR     A
026F 33                RLC     A
C51 COMPILER V8.08   SINGLEBUS                                                             02/22/2013 13:09:18 PAGE 74  

0270 FE                MOV     R6,A
0271 7C00              MOV     R4,#00H
0273 7D8D              MOV     R5,#08DH
0275 120000      E     LCALL   ?C?UIDIV
0278 8D00        R     MOV     byBus0TxHead,R5
                                           ; SOURCE LINE # 402
027A 7400        R     MOV     A,#LOW byBus0TxQ
027C 2500        R     ADD     A,byBus0TxHead
027E F582              MOV     DPL,A
0280 E4                CLR     A
0281 3400        R     ADDC    A,#HIGH byBus0TxQ
0283 F583              MOV     DPH,A
0285 E0                MOVX    A,@DPTR
0286 900000      R     MOV     DPTR,#byBus0SendData+02H
0289 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 403
028A E500        R     MOV     A,byBus0TxHead
028C 2401              ADD     A,#01H
028E FF                MOV     R7,A
028F E4                CLR     A
0290 33                RLC     A
0291 FE                MOV     R6,A
0292 7C00              MOV     R4,#00H
0294 7D8D              MOV     R5,#08DH
0296 120000      E     LCALL   ?C?UIDIV
0299 8D00        R     MOV     byBus0TxHead,R5
                                           ; SOURCE LINE # 404
029B 7400        R     MOV     A,#LOW byBus0TxQ
029D 2500        R     ADD     A,byBus0TxHead
029F F582              MOV     DPL,A
02A1 E4                CLR     A
02A2 3400        R     ADDC    A,#HIGH byBus0TxQ
02A4 F583              MOV     DPH,A
02A6 E0                MOVX    A,@DPTR
02A7 900000      R     MOV     DPTR,#byBus0SendData+03H
02AA F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 405
02AB E500        R     MOV     A,byBus0TxHead
02AD 2401              ADD     A,#01H
02AF FF                MOV     R7,A
02B0 E4                CLR     A
02B1 33                RLC     A
02B2 FE                MOV     R6,A
02B3 7C00              MOV     R4,#00H
02B5 7D8D              MOV     R5,#08DH
02B7 120000      E     LCALL   ?C?UIDIV
02BA 8D00        R     MOV     byBus0TxHead,R5
                                           ; SOURCE LINE # 406
02BC 7400        R     MOV     A,#LOW byBus0TxQ
02BE 2500        R     ADD     A,byBus0TxHead
02C0 F582              MOV     DPL,A
02C2 E4                CLR     A
02C3 3400        R     ADDC    A,#HIGH byBus0TxQ
02C5 F583              MOV     DPH,A
02C7 E0                MOVX    A,@DPTR
02C8 900000      R     MOV     DPTR,#byBus0SendData+04H
02CB F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 407
02CC E500        R     MOV     A,byBus0TxHead
02CE 2401              ADD     A,#01H
02D0 FF                MOV     R7,A
02D1 E4                CLR     A
C51 COMPILER V8.08   SINGLEBUS                                                             02/22/2013 13:09:18 PAGE 75  

02D2 33                RLC     A
02D3 FE                MOV     R6,A
02D4 7C00              MOV     R4,#00H
02D6 7D8D              MOV     R5,#08DH
02D8 120000      E     LCALL   ?C?UIDIV
02DB 8D00        R     MOV     byBus0TxHead,R5
                                           ; SOURCE LINE # 408
02DD 7400        R     MOV     A,#LOW byBus0TxQ
02DF 2500        R     ADD     A,byBus0TxHead
02E1 F582              MOV     DPL,A
02E3 E4                CLR     A
02E4 3400        R     ADDC    A,#HIGH byBus0TxQ
02E6 F583              MOV     DPH,A
02E8 E0                MOVX    A,@DPTR
02E9 900000      R     MOV     DPTR,#byBus0SendData+05H
02EC F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 409
02ED E500        R     MOV     A,byBus0TxHead
02EF 2401              ADD     A,#01H
02F1 FF                MOV     R7,A
02F2 E4                CLR     A
02F3 33                RLC     A
02F4 FE                MOV     R6,A
02F5 7C00              MOV     R4,#00H
02F7 7D8D              MOV     R5,#08DH
02F9 120000      E     LCALL   ?C?UIDIV
02FC 8D00        R     MOV     byBus0TxHead,R5
                                           ; SOURCE LINE # 410
02FE 7400        R     MOV     A,#LOW byBus0TxQ
0300 2500        R     ADD     A,byBus0TxHead
0302 F582              MOV     DPL,A
0304 E4                CLR     A
0305 3400        R     ADDC    A,#HIGH byBus0TxQ
0307 F583              MOV     DPH,A
0309 E0                MOVX    A,@DPTR
030A 900000      R     MOV     DPTR,#byBus0SendData+06H
030D F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 411
030E E500        R     MOV     A,byBus0TxHead
0310 2401              ADD     A,#01H
0312 FF                MOV     R7,A
0313 E4                CLR     A
0314 33                RLC     A
0315 FE                MOV     R6,A
0316 7C00              MOV     R4,#00H
0318 7D8D              MOV     R5,#08DH
031A 120000      E     LCALL   ?C?UIDIV
031D 8D00        R     MOV     byBus0TxHead,R5
                                           ; SOURCE LINE # 412
031F         ?C0162:
031F 430028      R     ORL     byBus0State0,#028H
                                           ; SOURCE LINE # 413
0322 8006              SJMP    ?C0059
0324         ?C0057:
                                           ; SOURCE LINE # 415
                                           ; SOURCE LINE # 416
0324 750000      R     MOV     byBus0TxTail,#00H
0327 750000      R     MOV     byBus0TxHead,#00H
                                           ; SOURCE LINE # 417
                                           ; SOURCE LINE # 418
                                           ; SOURCE LINE # 419
                                           ; SOURCE LINE # 420
C51 COMPILER V8.08   SINGLEBUS                                                             02/22/2013 13:09:18 PAGE 76  

                                           ; SOURCE LINE # 421
032A         ?C0059:
032A D007              POP     AR7
032C D006              POP     AR6
032E D005              POP     AR5
0330 D004              POP     AR4
0332 D003              POP     AR3
0334 D002              POP     AR2
0336 D000              POP     AR0
0338 D0D0              POP     PSW
033A D082              POP     DPL
033C D083              POP     DPH
033E D0F0              POP     B
0340 D0E0              POP     ACC
0342 D2AF              SETB    EA
0344 32                RETI    
             ; FUNCTION Timer0Int (END)

             ; FUNCTION _Bus0OutputData (BEGIN)
                                           ; SOURCE LINE # 437
0000 900000      R     MOV     DPTR,#pbyData
0003 EB                MOV     A,R3
0004 F0                MOVX    @DPTR,A
0005 A3                INC     DPTR
0006 EA                MOV     A,R2
0007 F0                MOVX    @DPTR,A
0008 A3                INC     DPTR
0009 E9                MOV     A,R1
000A F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 438
                                           ; SOURCE LINE # 439
000B A3                INC     DPTR
000C 7407              MOV     A,#07H
000E F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 441
000F C2AF              CLR     EA
0011 0500        E     INC     Os_Enter_Sum
                                           ; SOURCE LINE # 442
0013 E500        R     MOV     A,byBus0TxTail
0015 248D              ADD     A,#08DH
0017 FF                MOV     R7,A
0018 E4                CLR     A
0019 33                RLC     A
001A FE                MOV     R6,A
001B C3                CLR     C
001C EF                MOV     A,R7
001D 9500        R     SUBB    A,byBus0TxHead
001F FF                MOV     R7,A
0020 EE                MOV     A,R6
0021 9400              SUBB    A,#00H
0023 FE                MOV     R6,A
0024 7C00              MOV     R4,#00H
0026 7D8D              MOV     R5,#08DH
0028 120000      E     LCALL   ?C?UIDIV
002B ED                MOV     A,R5
002C C3                CLR     C
002D 948C              SUBB    A,#08CH
002F 4008              JC      ?C0063
                                           ; SOURCE LINE # 443
                                           ; SOURCE LINE # 444
0031 D50002      E     DJNZ    Os_Enter_Sum,?C0061
0034 D2AF              SETB    EA
C51 COMPILER V8.08   SINGLEBUS                                                             02/22/2013 13:09:18 PAGE 77  

0036         ?C0061:
                                           ; SOURCE LINE # 445
0036 7F00              MOV     R7,#00H
0038 22                RET     
                                           ; SOURCE LINE # 446
0039         ?C0063:
                                           ; SOURCE LINE # 447
0039 900000      R     MOV     DPTR,#byTemp
003C E0                MOVX    A,@DPTR
003D FF                MOV     R7,A
003E 14                DEC     A
003F F0                MOVX    @DPTR,A
0040 EF                MOV     A,R7
0041 6034              JZ      ?C0064
                                           ; SOURCE LINE # 448
                                           ; SOURCE LINE # 449
0043 900000      R     MOV     DPTR,#pbyData
0046 E0                MOVX    A,@DPTR
0047 FB                MOV     R3,A
0048 A3                INC     DPTR
0049 E4                CLR     A
004A 75F001            MOV     B,#01H
004D 120000      E     LCALL   ?C?ILDIX
0050 A9F0              MOV     R1,B
0052 FA                MOV     R2,A
0053 120000      E     LCALL   ?C?CLDPTR
0056 FF                MOV     R7,A
0057 7400        R     MOV     A,#LOW byBus0TxQ
0059 2500        R     ADD     A,byBus0TxTail
005B F582              MOV     DPL,A
005D E4                CLR     A
005E 3400        R     ADDC    A,#HIGH byBus0TxQ
0060 F583              MOV     DPH,A
0062 EF                MOV     A,R7
0063 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 450
0064 E500        R     MOV     A,byBus0TxTail
0066 2401              ADD     A,#01H
0068 FF                MOV     R7,A
0069 E4                CLR     A
006A 33                RLC     A
006B FE                MOV     R6,A
006C 7C00              MOV     R4,#00H
006E 7D8D              MOV     R5,#08DH
0070 120000      E     LCALL   ?C?UIDIV
0073 8D00        R     MOV     byBus0TxTail,R5
                                           ; SOURCE LINE # 451
0075 80C2              SJMP    ?C0063
0077         ?C0064:
                                           ; SOURCE LINE # 452
0077 D50002      E     DJNZ    Os_Enter_Sum,?C0065
007A D2AF              SETB    EA
007C         ?C0065:
                                           ; SOURCE LINE # 453
007C 7F01              MOV     R7,#01H
                                           ; SOURCE LINE # 454
007E         ?C0062:
007E 22                RET     
             ; FUNCTION _Bus0OutputData (END)

             ; FUNCTION _AddrCompare (BEGIN)
                                           ; SOURCE LINE # 470
C51 COMPILER V8.08   SINGLEBUS                                                             02/22/2013 13:09:18 PAGE 78  

                                           ; SOURCE LINE # 471
                                           ; SOURCE LINE # 486
                                           ; SOURCE LINE # 487
0000 D3                SETB    C
                                           ; SOURCE LINE # 488
0001         ?C0066:
0001 22                RET     
             ; FUNCTION _AddrCompare (END)

             ; FUNCTION _MakeCH0TimerOut (BEGIN)
                                           ; SOURCE LINE # 504
;---- Variable 'byTimerOut' assigned to Register 'R7' ----
;---- Variable 'byTimerOutCount' assigned to Register 'R5' ----
                                           ; SOURCE LINE # 505
                                           ; SOURCE LINE # 506
0000 900000      E     MOV     DPTR,#stLocalControl+020H
0003 EF                MOV     A,R7
0004 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 507
0005 A3                INC     DPTR
0006 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 508
0007 A3                INC     DPTR
0008 ED                MOV     A,R5
0009 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 509
000A 22                RET     
             ; FUNCTION _MakeCH0TimerOut (END)

             ; FUNCTION SaveParameter (BEGIN)
                                           ; SOURCE LINE # 527
                                           ; SOURCE LINE # 528
                                           ; SOURCE LINE # 529
0000 E4                CLR     A
0001 900000      E     MOV     DPTR,#stLocalControl+01H
0004 F0                MOVX    @DPTR,A
0005 A3                INC     DPTR
0006 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 530
0007 A3                INC     DPTR
0008 7400        E     MOV     A,#HIGH stLocalControl+023H
000A F0                MOVX    @DPTR,A
000B A3                INC     DPTR
000C 7400        E     MOV     A,#LOW stLocalControl+023H
000E F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 531
000F 900000      E     MOV     DPTR,#stLocalControl
0012 7401              MOV     A,#01H
0014 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 532
0015 7F03              MOV     R7,#03H
0017 120000      E     LCALL   _EnableIAP
                                           ; SOURCE LINE # 533
001A E4                CLR     A
001B FF                MOV     R7,A
001C FE                MOV     R6,A
001D 120000      E     LCALL   _IapErase
                                           ; SOURCE LINE # 534
0020 7F02              MOV     R7,#02H
0022 120000      E     LCALL   _EnableIAP
0025         ?C0068:
                                           ; SOURCE LINE # 535
C51 COMPILER V8.08   SINGLEBUS                                                             02/22/2013 13:09:18 PAGE 79  

0025 900000      E     MOV     DPTR,#stLocalControl
0028 E0                MOVX    A,@DPTR
0029 FF                MOV     R7,A
002A 14                DEC     A
002B F0                MOVX    @DPTR,A
002C EF                MOV     A,R7
002D 6021              JZ      ?C0069
                                           ; SOURCE LINE # 536
                                           ; SOURCE LINE # 537
002F A3                INC     DPTR
0030 E4                CLR     A
0031 75F001            MOV     B,#01H
0034 120000      E     LCALL   ?C?ILDIX
0037 AFF0              MOV     R7,B
0039 FE                MOV     R6,A
003A 900000      E     MOV     DPTR,#stLocalControl+03H
003D E4                CLR     A
003E 75F001            MOV     B,#01H
0041 120000      E     LCALL   ?C?ILDIX
0044 85F082            MOV     DPL,B
0047 F583              MOV     DPH,A
0049 E0                MOVX    A,@DPTR
004A FD                MOV     R5,A
004B 120000      E     LCALL   _IapWriteByte
                                           ; SOURCE LINE # 538
004E 80D5              SJMP    ?C0068
0050         ?C0069:
                                           ; SOURCE LINE # 539
0050 020000      E     LJMP    DisableIAP
             ; FUNCTION SaveParameter (END)

             ; FUNCTION ReadParameter (BEGIN)
                                           ; SOURCE LINE # 557
                                           ; SOURCE LINE # 558
                                           ; SOURCE LINE # 560
0000 E4                CLR     A
0001 900000      E     MOV     DPTR,#stLocalControl+01H
0004 F0                MOVX    @DPTR,A
0005 A3                INC     DPTR
0006 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 561
0007 A3                INC     DPTR
0008 7400        E     MOV     A,#HIGH stLocalControl+023H
000A F0                MOVX    @DPTR,A
000B A3                INC     DPTR
000C 7400        E     MOV     A,#LOW stLocalControl+023H
000E F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 562
000F 900000      E     MOV     DPTR,#stLocalControl
0012 7401              MOV     A,#01H
0014 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 564
0015 FF                MOV     R7,A
0016 120000      E     LCALL   _EnableIAP
0019         ?C0071:
                                           ; SOURCE LINE # 565
0019 900000      E     MOV     DPTR,#stLocalControl
001C E0                MOVX    A,@DPTR
001D FF                MOV     R7,A
001E 14                DEC     A
001F F0                MOVX    @DPTR,A
0020 EF                MOV     A,R7
C51 COMPILER V8.08   SINGLEBUS                                                             02/22/2013 13:09:18 PAGE 80  

0021 6021              JZ      ?C0072
                                           ; SOURCE LINE # 566
                                           ; SOURCE LINE # 567
0023 A3                INC     DPTR
0024 E4                CLR     A
0025 75F001            MOV     B,#01H
0028 120000      E     LCALL   ?C?ILDIX
002B AFF0              MOV     R7,B
002D FE                MOV     R6,A
002E 120000      E     LCALL   _IapReadByte
0031 900000      E     MOV     DPTR,#stLocalControl+03H
0034 E4                CLR     A
0035 75F001            MOV     B,#01H
0038 120000      E     LCALL   ?C?ILDIX
003B 85F082            MOV     DPL,B
003E F583              MOV     DPH,A
0040 EF                MOV     A,R7
0041 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 568
0042 80D5              SJMP    ?C0071
0044         ?C0072:
                                           ; SOURCE LINE # 569
0044 020000      E     LJMP    DisableIAP
             ; FUNCTION ReadParameter (END)

             ; FUNCTION InitParameter (BEGIN)
                                           ; SOURCE LINE # 587
                                           ; SOURCE LINE # 588
                                           ; SOURCE LINE # 589
0000 7F01              MOV     R7,#01H
0002 120000      E     LCALL   _EnableIAP
                                           ; SOURCE LINE # 590
0005 E4                CLR     A
0006 FF                MOV     R7,A
0007 FE                MOV     R6,A
0008 120000      E     LCALL   _IapReadByte
000B BF5A03            CJNE    R7,#05AH,?C0074
                                           ; SOURCE LINE # 591
                                           ; SOURCE LINE # 592
000E 020000      R     LJMP    ReadParameter
                                           ; SOURCE LINE # 594
0011         ?C0074:
                                           ; SOURCE LINE # 596
                                           ; SOURCE LINE # 597
0011 900000      E     MOV     DPTR,#stLocalControl+023H
0014 745A              MOV     A,#05AH
0016 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 598
0017 120000      R     LCALL   SaveParameter
                                           ; SOURCE LINE # 599
                                           ; SOURCE LINE # 600
001A         ?C0076:
001A 22                RET     
             ; FUNCTION InitParameter (END)

             ; FUNCTION _MakeCallVoiceData (BEGIN)
                                           ; SOURCE LINE # 618
;---- Variable 'pstBusDealFreq' assigned to Register 'R1/R2/R3' ----
                                           ; SOURCE LINE # 619
                                           ; SOURCE LINE # 620
;---- Variable 'byPosition' assigned to Register 'R7' ----
0000 E4                CLR     A
C51 COMPILER V8.08   SINGLEBUS                                                             02/22/2013 13:09:18 PAGE 81  

0001 FF                MOV     R7,A
                                           ; SOURCE LINE # 625
0002 900001            MOV     DPTR,#01H
0005 120000      E     LCALL   ?C?CLDOPTR
0008 64FA              XRL     A,#0FAH
000A 6003              JZ      $ + 5H
000C 020000      R     LJMP    ?C0077
                                           ; SOURCE LINE # 626
                                           ; SOURCE LINE # 627
000F 900004            MOV     DPTR,#04H
0012 120000      E     LCALL   ?C?CLDOPTR
0015 541F              ANL     A,#01FH
0017 6406              XRL     A,#06H
0019 6003              JZ      $ + 5H
001B 020000      R     LJMP    ?C0088
                                           ; SOURCE LINE # 628
                                           ; SOURCE LINE # 629
001E 0F                INC     R7
001F 2400        E     ADD     A,#LOW stLocalControl+0CH
0021 F582              MOV     DPL,A
0023 E4                CLR     A
0024 3400        E     ADDC    A,#HIGH stLocalControl+0CH
0026 F583              MOV     DPH,A
0028 740B              MOV     A,#0BH
002A F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 630
002B 900002            MOV     DPTR,#02H
002E 120000      E     LCALL   ?C?CLDOPTR
0031 900000      R     MOV     DPTR,#byTemp1
0034 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 631
0035 E0                MOVX    A,@DPTR
0036 FE                MOV     R6,A
0037 75F064            MOV     B,#064H
003A 84                DIV     AB
003B FD                MOV     R5,A
003C A3                INC     DPTR
003D F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 632
003E EE                MOV     A,R6
003F 75F064            MOV     B,#064H
0042 84                DIV     AB
0043 900000      R     MOV     DPTR,#byTemp1
0046 E5F0              MOV     A,B
0048 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 633
0049 ED                MOV     A,R5
004A 6073              JZ      ?C0079
                                           ; SOURCE LINE # 634
                                           ; SOURCE LINE # 635
004C A3                INC     DPTR
004D E0                MOVX    A,@DPTR
004E FE                MOV     R6,A
004F 0F                INC     R7
0050 7400        E     MOV     A,#LOW stLocalControl+0CH
0052 2401              ADD     A,#01H
0054 F582              MOV     DPL,A
0056 E4                CLR     A
0057 3400        E     ADDC    A,#HIGH stLocalControl+0CH
0059 F583              MOV     DPH,A
005B EE                MOV     A,R6
005C F0                MOVX    @DPTR,A
C51 COMPILER V8.08   SINGLEBUS                                                             02/22/2013 13:09:18 PAGE 82  

                                           ; SOURCE LINE # 636
005D 0F                INC     R7
005E 7400        E     MOV     A,#LOW stLocalControl+0CH
0060 2402              ADD     A,#02H
0062 F582              MOV     DPL,A
0064 E4                CLR     A
0065 3400        E     ADDC    A,#HIGH stLocalControl+0CH
0067 F583              MOV     DPH,A
0069 7414              MOV     A,#014H
006B F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 637
006C 900000      R     MOV     DPTR,#byTemp1
006F E0                MOVX    A,@DPTR
0070 FE                MOV     R6,A
0071 604A              JZ      ?C0080
                                           ; SOURCE LINE # 638
                                           ; SOURCE LINE # 639
0073 75F00A            MOV     B,#0AH
0076 84                DIV     AB
0077 A3                INC     DPTR
0078 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 640
0079 EE                MOV     A,R6
007A 75F00A            MOV     B,#0AH
007D 84                DIV     AB
007E 900000      R     MOV     DPTR,#byTemp1
0081 E5F0              MOV     A,B
0083 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 641
0084 A3                INC     DPTR
0085 E0                MOVX    A,@DPTR
0086 FE                MOV     R6,A
0087 0F                INC     R7
0088 7400        E     MOV     A,#LOW stLocalControl+0CH
008A 2403              ADD     A,#03H
008C F582              MOV     DPL,A
008E E4                CLR     A
008F 3400        E     ADDC    A,#HIGH stLocalControl+0CH
0091 F583              MOV     DPH,A
0093 EE                MOV     A,R6
0094 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 642
0095 EE                MOV     A,R6
0096 600F              JZ      ?C0081
                                           ; SOURCE LINE # 643
                                           ; SOURCE LINE # 644
0098 0F                INC     R7
0099 7400        E     MOV     A,#LOW stLocalControl+0CH
009B 2404              ADD     A,#04H
009D F582              MOV     DPL,A
009F E4                CLR     A
00A0 3400        E     ADDC    A,#HIGH stLocalControl+0CH
00A2 F583              MOV     DPH,A
00A4 740C              MOV     A,#0CH
00A6 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 645
00A7         ?C0081:
                                           ; SOURCE LINE # 646
00A7 900000      R     MOV     DPTR,#byTemp1
00AA E0                MOVX    A,@DPTR
00AB FE                MOV     R6,A
00AC 607D              JZ      ?C0164
C51 COMPILER V8.08   SINGLEBUS                                                             02/22/2013 13:09:18 PAGE 83  

                                           ; SOURCE LINE # 647
                                           ; SOURCE LINE # 648
00AE AD07              MOV     R5,AR7
00B0 0F                INC     R7
00B1 7400        E     MOV     A,#LOW stLocalControl+0CH
00B3 2D                ADD     A,R5
00B4 F582              MOV     DPL,A
00B6 E4                CLR     A
00B7 3400        E     ADDC    A,#HIGH stLocalControl+0CH
00B9 F583              MOV     DPH,A
00BB EE                MOV     A,R6
00BC F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 649
                                           ; SOURCE LINE # 650
00BD         ?C0080:
                                           ; SOURCE LINE # 652
                                           ; SOURCE LINE # 653
00BD 806C              SJMP    ?C0164
00BF         ?C0079:
                                           ; SOURCE LINE # 655
                                           ; SOURCE LINE # 656
00BF 900000      R     MOV     DPTR,#byTemp1
00C2 E0                MOVX    A,@DPTR
00C3 FE                MOV     R6,A
00C4 75F00A            MOV     B,#0AH
00C7 84                DIV     AB
00C8 FD                MOV     R5,A
00C9 A3                INC     DPTR
00CA F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 657
00CB EE                MOV     A,R6
00CC 75F00A            MOV     B,#0AH
00CF 84                DIV     AB
00D0 900000      R     MOV     DPTR,#byTemp1
00D3 E5F0              MOV     A,B
00D5 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 658
00D6 ED                MOV     A,R5
00D7 603E              JZ      ?C0084
                                           ; SOURCE LINE # 659
                                           ; SOURCE LINE # 660
00D9 A3                INC     DPTR
00DA E0                MOVX    A,@DPTR
00DB FE                MOV     R6,A
00DC 6401              XRL     A,#01H
00DE 600F              JZ      ?C0085
                                           ; SOURCE LINE # 661
                                           ; SOURCE LINE # 662
00E0 AD07              MOV     R5,AR7
00E2 0F                INC     R7
00E3 7400        E     MOV     A,#LOW stLocalControl+0CH
00E5 2D                ADD     A,R5
00E6 F582              MOV     DPL,A
00E8 E4                CLR     A
00E9 3400        E     ADDC    A,#HIGH stLocalControl+0CH
00EB F583              MOV     DPH,A
00ED EE                MOV     A,R6
00EE F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 663
00EF         ?C0085:
                                           ; SOURCE LINE # 664
00EF AE07              MOV     R6,AR7
C51 COMPILER V8.08   SINGLEBUS                                                             02/22/2013 13:09:18 PAGE 84  

00F1 0F                INC     R7
00F2 7400        E     MOV     A,#LOW stLocalControl+0CH
00F4 2E                ADD     A,R6
00F5 F582              MOV     DPL,A
00F7 E4                CLR     A
00F8 3400        E     ADDC    A,#HIGH stLocalControl+0CH
00FA F583              MOV     DPH,A
00FC 740C              MOV     A,#0CH
00FE F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 665
00FF 900000      R     MOV     DPTR,#byTemp1
0102 E0                MOVX    A,@DPTR
0103 FE                MOV     R6,A
0104 600F              JZ      ?C0086
                                           ; SOURCE LINE # 666
                                           ; SOURCE LINE # 667
0106 AD07              MOV     R5,AR7
0108 0F                INC     R7
0109 7400        E     MOV     A,#LOW stLocalControl+0CH
010B 2D                ADD     A,R5
010C F582              MOV     DPL,A
010E E4                CLR     A
010F 3400        E     ADDC    A,#HIGH stLocalControl+0CH
0111 F583              MOV     DPH,A
0113 EE                MOV     A,R6
0114 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 668
0115         ?C0086:
                                           ; SOURCE LINE # 670
0115         ?C0163:
                                           ; SOURCE LINE # 671
0115 8014              SJMP    ?C0164
0117         ?C0084:
                                           ; SOURCE LINE # 673
                                           ; SOURCE LINE # 674
0117 900000      R     MOV     DPTR,#byTemp1
011A E0                MOVX    A,@DPTR
011B FE                MOV     R6,A
011C AD07              MOV     R5,AR7
011E 0F                INC     R7
011F 7400        E     MOV     A,#LOW stLocalControl+0CH
0121 2D                ADD     A,R5
0122 F582              MOV     DPL,A
0124 E4                CLR     A
0125 3400        E     ADDC    A,#HIGH stLocalControl+0CH
0127 F583              MOV     DPH,A
0129 EE                MOV     A,R6
012A F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 676
012B         ?C0164:
012B AE07              MOV     R6,AR7
012D 0F                INC     R7
012E 7400        E     MOV     A,#LOW stLocalControl+0CH
0130 2E                ADD     A,R6
0131 F582              MOV     DPL,A
0133 E4                CLR     A
0134 3400        E     ADDC    A,#HIGH stLocalControl+0CH
0136 F583              MOV     DPH,A
0138 7411              MOV     A,#011H
013A F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 677
                                           ; SOURCE LINE # 678
C51 COMPILER V8.08   SINGLEBUS                                                             02/22/2013 13:09:18 PAGE 85  

013B         ?C0083:
                                           ; SOURCE LINE # 680
                                           ; SOURCE LINE # 681
                                           ; SOURCE LINE # 682
013B 020000      R     LJMP    ?C0168
                                           ; SOURCE LINE # 684
013E         ?C0077:
                                           ; SOURCE LINE # 686
013E 900004            MOV     DPTR,#04H
0141 120000      E     LCALL   ?C?CLDOPTR
0144 541F              ANL     A,#01FH
0146 24F9              ADD     A,#0F9H
0148 7003              JNZ     $ + 5H
014A 020000      R     LJMP    ?C0100
014D 14                DEC     A
014E 7003              JNZ     $ + 5H
0150 020000      R     LJMP    ?C0110
0153 2402              ADD     A,#02H
0155 6003              JZ      $ + 5H
0157 020000      R     LJMP    ?C0088
                                           ; SOURCE LINE # 687
                                           ; SOURCE LINE # 688
015A         ?C0090:
                                           ; SOURCE LINE # 689
015A 900002            MOV     DPTR,#02H
015D 120000      E     LCALL   ?C?CLDOPTR
0160 900000      R     MOV     DPTR,#byTemp1
0163 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 690
0164 E0                MOVX    A,@DPTR
0165 FE                MOV     R6,A
0166 75F064            MOV     B,#064H
0169 84                DIV     AB
016A FD                MOV     R5,A
016B A3                INC     DPTR
016C F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 691
016D EE                MOV     A,R6
016E 75F064            MOV     B,#064H
0171 84                DIV     AB
0172 900000      R     MOV     DPTR,#byTemp1
0175 E5F0              MOV     A,B
0177 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 692
0178 ED                MOV     A,R5
0179 6077              JZ      ?C0091
                                           ; SOURCE LINE # 693
                                           ; SOURCE LINE # 694
017B A3                INC     DPTR
017C E0                MOVX    A,@DPTR
017D FE                MOV     R6,A
017E AD07              MOV     R5,AR7
0180 0F                INC     R7
0181 7400        E     MOV     A,#LOW stLocalControl+0CH
0183 2D                ADD     A,R5
0184 F582              MOV     DPL,A
0186 E4                CLR     A
0187 3400        E     ADDC    A,#HIGH stLocalControl+0CH
0189 F583              MOV     DPH,A
018B EE                MOV     A,R6
018C F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 695
C51 COMPILER V8.08   SINGLEBUS                                                             02/22/2013 13:09:18 PAGE 86  

018D AE07              MOV     R6,AR7
018F 0F                INC     R7
0190 7400        E     MOV     A,#LOW stLocalControl+0CH
0192 2E                ADD     A,R6
0193 F582              MOV     DPL,A
0195 E4                CLR     A
0196 3400        E     ADDC    A,#HIGH stLocalControl+0CH
0198 F583              MOV     DPH,A
019A 7414              MOV     A,#014H
019C F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 696
019D 900000      R     MOV     DPTR,#byTemp1
01A0 E0                MOVX    A,@DPTR
01A1 FE                MOV     R6,A
01A2 604C              JZ      ?C0092
                                           ; SOURCE LINE # 697
                                           ; SOURCE LINE # 698
01A4 75F00A            MOV     B,#0AH
01A7 84                DIV     AB
01A8 A3                INC     DPTR
01A9 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 699
01AA EE                MOV     A,R6
01AB 75F00A            MOV     B,#0AH
01AE 84                DIV     AB
01AF 900000      R     MOV     DPTR,#byTemp1
01B2 E5F0              MOV     A,B
01B4 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 700
01B5 A3                INC     DPTR
01B6 E0                MOVX    A,@DPTR
01B7 FE                MOV     R6,A
01B8 AD07              MOV     R5,AR7
01BA 0F                INC     R7
01BB 7400        E     MOV     A,#LOW stLocalControl+0CH
01BD 2D                ADD     A,R5
01BE F582              MOV     DPL,A
01C0 E4                CLR     A
01C1 3400        E     ADDC    A,#HIGH stLocalControl+0CH
01C3 F583              MOV     DPH,A
01C5 EE                MOV     A,R6
01C6 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 701
01C7 EE                MOV     A,R6
01C8 6010              JZ      ?C0093
                                           ; SOURCE LINE # 702
                                           ; SOURCE LINE # 703
01CA AE07              MOV     R6,AR7
01CC 0F                INC     R7
01CD 7400        E     MOV     A,#LOW stLocalControl+0CH
01CF 2E                ADD     A,R6
01D0 F582              MOV     DPL,A
01D2 E4                CLR     A
01D3 3400        E     ADDC    A,#HIGH stLocalControl+0CH
01D5 F583              MOV     DPH,A
01D7 740C              MOV     A,#0CH
01D9 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 704
01DA         ?C0093:
                                           ; SOURCE LINE # 705
01DA 900000      R     MOV     DPTR,#byTemp1
01DD E0                MOVX    A,@DPTR
C51 COMPILER V8.08   SINGLEBUS                                                             02/22/2013 13:09:18 PAGE 87  

01DE FE                MOV     R6,A
01DF 607D              JZ      ?C0167
                                           ; SOURCE LINE # 706
                                           ; SOURCE LINE # 707
01E1 AD07              MOV     R5,AR7
01E3 0F                INC     R7
01E4 7400        E     MOV     A,#LOW stLocalControl+0CH
01E6 2D                ADD     A,R5
01E7 F582              MOV     DPL,A
01E9 E4                CLR     A
01EA 3400        E     ADDC    A,#HIGH stLocalControl+0CH
01EC F583              MOV     DPH,A
01EE EE                MOV     A,R6
01EF F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 708
                                           ; SOURCE LINE # 709
01F0         ?C0092:
                                           ; SOURCE LINE # 711
                                           ; SOURCE LINE # 712
01F0 806C              SJMP    ?C0167
01F2         ?C0091:
                                           ; SOURCE LINE # 714
                                           ; SOURCE LINE # 715
01F2 900000      R     MOV     DPTR,#byTemp1
01F5 E0                MOVX    A,@DPTR
01F6 FE                MOV     R6,A
01F7 75F00A            MOV     B,#0AH
01FA 84                DIV     AB
01FB FD                MOV     R5,A
01FC A3                INC     DPTR
01FD F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 716
01FE EE                MOV     A,R6
01FF 75F00A            MOV     B,#0AH
0202 84                DIV     AB
0203 900000      R     MOV     DPTR,#byTemp1
0206 E5F0              MOV     A,B
0208 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 717
0209 ED                MOV     A,R5
020A 603E              JZ      ?C0096
                                           ; SOURCE LINE # 718
                                           ; SOURCE LINE # 719
020C A3                INC     DPTR
020D E0                MOVX    A,@DPTR
020E FE                MOV     R6,A
020F 6401              XRL     A,#01H
0211 600F              JZ      ?C0097
                                           ; SOURCE LINE # 720
                                           ; SOURCE LINE # 721
0213 AD07              MOV     R5,AR7
0215 0F                INC     R7
0216 7400        E     MOV     A,#LOW stLocalControl+0CH
0218 2D                ADD     A,R5
0219 F582              MOV     DPL,A
021B E4                CLR     A
021C 3400        E     ADDC    A,#HIGH stLocalControl+0CH
021E F583              MOV     DPH,A
0220 EE                MOV     A,R6
0221 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 722
0222         ?C0097:
C51 COMPILER V8.08   SINGLEBUS                                                             02/22/2013 13:09:18 PAGE 88  

                                           ; SOURCE LINE # 723
0222 AE07              MOV     R6,AR7
0224 0F                INC     R7
0225 7400        E     MOV     A,#LOW stLocalControl+0CH
0227 2E                ADD     A,R6
0228 F582              MOV     DPL,A
022A E4                CLR     A
022B 3400        E     ADDC    A,#HIGH stLocalControl+0CH
022D F583              MOV     DPH,A
022F 740C              MOV     A,#0CH
0231 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 724
0232 900000      R     MOV     DPTR,#byTemp1
0235 E0                MOVX    A,@DPTR
0236 FE                MOV     R6,A
0237 600F              JZ      ?C0098
                                           ; SOURCE LINE # 725
                                           ; SOURCE LINE # 726
0239 AD07              MOV     R5,AR7
023B 0F                INC     R7
023C 7400        E     MOV     A,#LOW stLocalControl+0CH
023E 2D                ADD     A,R5
023F F582              MOV     DPL,A
0241 E4                CLR     A
0242 3400        E     ADDC    A,#HIGH stLocalControl+0CH
0244 F583              MOV     DPH,A
0246 EE                MOV     A,R6
0247 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 727
0248         ?C0098:
                                           ; SOURCE LINE # 729
0248         ?C0166:
                                           ; SOURCE LINE # 730
0248 8014              SJMP    ?C0167
024A         ?C0096:
                                           ; SOURCE LINE # 732
                                           ; SOURCE LINE # 733
024A 900000      R     MOV     DPTR,#byTemp1
024D E0                MOVX    A,@DPTR
024E FE                MOV     R6,A
024F AD07              MOV     R5,AR7
0251 0F                INC     R7
0252 7400        E     MOV     A,#LOW stLocalControl+0CH
0254 2D                ADD     A,R5
0255 F582              MOV     DPL,A
0257 E4                CLR     A
0258 3400        E     ADDC    A,#HIGH stLocalControl+0CH
025A F583              MOV     DPH,A
025C EE                MOV     A,R6
025D F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 735
025E         ?C0167:
025E AE07              MOV     R6,AR7
0260 0F                INC     R7
0261 7400        E     MOV     A,#LOW stLocalControl+0CH
0263 2E                ADD     A,R6
0264 F582              MOV     DPL,A
0266 E4                CLR     A
0267 3400        E     ADDC    A,#HIGH stLocalControl+0CH
0269 F583              MOV     DPH,A
026B 7411              MOV     A,#011H
026D F0                MOVX    @DPTR,A
C51 COMPILER V8.08   SINGLEBUS                                                             02/22/2013 13:09:18 PAGE 89  

                                           ; SOURCE LINE # 736
                                           ; SOURCE LINE # 737
026E         ?C0095:
                                           ; SOURCE LINE # 739
026E         ?C0165:
                                           ; SOURCE LINE # 740
                                           ; SOURCE LINE # 741
026E 020000      R     LJMP    ?C0168
                                           ; SOURCE LINE # 742
0271         ?C0100:
                                           ; SOURCE LINE # 743
0271 900002            MOV     DPTR,#02H
0274 120000      E     LCALL   ?C?CLDOPTR
0277 900000      R     MOV     DPTR,#byTemp1
027A F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 744
027B E0                MOVX    A,@DPTR
027C FE                MOV     R6,A
027D 75F064            MOV     B,#064H
0280 84                DIV     AB
0281 FD                MOV     R5,A
0282 A3                INC     DPTR
0283 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 745
0284 EE                MOV     A,R6
0285 75F064            MOV     B,#064H
0288 84                DIV     AB
0289 900000      R     MOV     DPTR,#byTemp1
028C E5F0              MOV     A,B
028E F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 746
028F ED                MOV     A,R5
0290 6077              JZ      ?C0101
                                           ; SOURCE LINE # 747
                                           ; SOURCE LINE # 748
0292 A3                INC     DPTR
0293 E0                MOVX    A,@DPTR
0294 FE                MOV     R6,A
0295 AD07              MOV     R5,AR7
0297 0F                INC     R7
0298 7400        E     MOV     A,#LOW stLocalControl+0CH
029A 2D                ADD     A,R5
029B F582              MOV     DPL,A
029D E4                CLR     A
029E 3400        E     ADDC    A,#HIGH stLocalControl+0CH
02A0 F583              MOV     DPH,A
02A2 EE                MOV     A,R6
02A3 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 749
02A4 AE07              MOV     R6,AR7
02A6 0F                INC     R7
02A7 7400        E     MOV     A,#LOW stLocalControl+0CH
02A9 2E                ADD     A,R6
02AA F582              MOV     DPL,A
02AC E4                CLR     A
02AD 3400        E     ADDC    A,#HIGH stLocalControl+0CH
02AF F583              MOV     DPH,A
02B1 7414              MOV     A,#014H
02B3 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 750
02B4 900000      R     MOV     DPTR,#byTemp1
02B7 E0                MOVX    A,@DPTR
C51 COMPILER V8.08   SINGLEBUS                                                             02/22/2013 13:09:18 PAGE 90  

02B8 FE                MOV     R6,A
02B9 604C              JZ      ?C0102
                                           ; SOURCE LINE # 751
                                           ; SOURCE LINE # 752
02BB 75F00A            MOV     B,#0AH
02BE 84                DIV     AB
02BF A3                INC     DPTR
02C0 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 753
02C1 EE                MOV     A,R6
02C2 75F00A            MOV     B,#0AH
02C5 84                DIV     AB
02C6 900000      R     MOV     DPTR,#byTemp1
02C9 E5F0              MOV     A,B
02CB F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 754
02CC A3                INC     DPTR
02CD E0                MOVX    A,@DPTR
02CE FE                MOV     R6,A
02CF AD07              MOV     R5,AR7
02D1 0F                INC     R7
02D2 7400        E     MOV     A,#LOW stLocalControl+0CH
02D4 2D                ADD     A,R5
02D5 F582              MOV     DPL,A
02D7 E4                CLR     A
02D8 3400        E     ADDC    A,#HIGH stLocalControl+0CH
02DA F583              MOV     DPH,A
02DC EE                MOV     A,R6
02DD F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 755
02DE EE                MOV     A,R6
02DF 6010              JZ      ?C0103
                                           ; SOURCE LINE # 756
                                           ; SOURCE LINE # 757
02E1 AE07              MOV     R6,AR7
02E3 0F                INC     R7
02E4 7400        E     MOV     A,#LOW stLocalControl+0CH
02E6 2E                ADD     A,R6
02E7 F582              MOV     DPL,A
02E9 E4                CLR     A
02EA 3400        E     ADDC    A,#HIGH stLocalControl+0CH
02EC F583              MOV     DPH,A
02EE 740C              MOV     A,#0CH
02F0 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 758
02F1         ?C0103:
                                           ; SOURCE LINE # 759
02F1 900000      R     MOV     DPTR,#byTemp1
02F4 E0                MOVX    A,@DPTR
02F5 FE                MOV     R6,A
02F6 6067              JZ      ?C0169
                                           ; SOURCE LINE # 760
                                           ; SOURCE LINE # 761
02F8 AD07              MOV     R5,AR7
02FA 0F                INC     R7
02FB 7400        E     MOV     A,#LOW stLocalControl+0CH
02FD 2D                ADD     A,R5
02FE F582              MOV     DPL,A
0300 E4                CLR     A
0301 3400        E     ADDC    A,#HIGH stLocalControl+0CH
0303 F583              MOV     DPH,A
0305 EE                MOV     A,R6
C51 COMPILER V8.08   SINGLEBUS                                                             02/22/2013 13:09:18 PAGE 91  

0306 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 762
                                           ; SOURCE LINE # 763
0307         ?C0102:
                                           ; SOURCE LINE # 765
                                           ; SOURCE LINE # 766
0307 806C              SJMP    ?C0170
0309         ?C0101:
                                           ; SOURCE LINE # 768
                                           ; SOURCE LINE # 769
0309 900000      R     MOV     DPTR,#byTemp1
030C E0                MOVX    A,@DPTR
030D FE                MOV     R6,A
030E 75F00A            MOV     B,#0AH
0311 84                DIV     AB
0312 FD                MOV     R5,A
0313 A3                INC     DPTR
0314 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 770
0315 EE                MOV     A,R6
0316 75F00A            MOV     B,#0AH
0319 84                DIV     AB
031A 900000      R     MOV     DPTR,#byTemp1
031D E5F0              MOV     A,B
031F F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 771
0320 ED                MOV     A,R5
0321 603E              JZ      ?C0106
                                           ; SOURCE LINE # 772
                                           ; SOURCE LINE # 773
0323 A3                INC     DPTR
0324 E0                MOVX    A,@DPTR
0325 FE                MOV     R6,A
0326 6401              XRL     A,#01H
0328 600F              JZ      ?C0107
                                           ; SOURCE LINE # 774
                                           ; SOURCE LINE # 775
032A AD07              MOV     R5,AR7
032C 0F                INC     R7
032D 7400        E     MOV     A,#LOW stLocalControl+0CH
032F 2D                ADD     A,R5
0330 F582              MOV     DPL,A
0332 E4                CLR     A
0333 3400        E     ADDC    A,#HIGH stLocalControl+0CH
0335 F583              MOV     DPH,A
0337 EE                MOV     A,R6
0338 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 776
0339         ?C0107:
                                           ; SOURCE LINE # 777
0339 AE07              MOV     R6,AR7
033B 0F                INC     R7
033C 7400        E     MOV     A,#LOW stLocalControl+0CH
033E 2E                ADD     A,R6
033F F582              MOV     DPL,A
0341 E4                CLR     A
0342 3400        E     ADDC    A,#HIGH stLocalControl+0CH
0344 F583              MOV     DPH,A
0346 740C              MOV     A,#0CH
0348 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 778
0349 900000      R     MOV     DPTR,#byTemp1
C51 COMPILER V8.08   SINGLEBUS                                                             02/22/2013 13:09:18 PAGE 92  

034C E0                MOVX    A,@DPTR
034D FE                MOV     R6,A
034E 600F              JZ      ?C0108
                                           ; SOURCE LINE # 779
                                           ; SOURCE LINE # 780
0350 AD07              MOV     R5,AR7
0352 0F                INC     R7
0353 7400        E     MOV     A,#LOW stLocalControl+0CH
0355 2D                ADD     A,R5
0356 F582              MOV     DPL,A
0358 E4                CLR     A
0359 3400        E     ADDC    A,#HIGH stLocalControl+0CH
035B F583              MOV     DPH,A
035D EE                MOV     A,R6
035E F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 781
035F         ?C0108:
                                           ; SOURCE LINE # 783
035F         ?C0169:
                                           ; SOURCE LINE # 784
035F 8014              SJMP    ?C0170
0361         ?C0106:
                                           ; SOURCE LINE # 786
                                           ; SOURCE LINE # 787
0361 900000      R     MOV     DPTR,#byTemp1
0364 E0                MOVX    A,@DPTR
0365 FE                MOV     R6,A
0366 AD07              MOV     R5,AR7
0368 0F                INC     R7
0369 7400        E     MOV     A,#LOW stLocalControl+0CH
036B 2D                ADD     A,R5
036C F582              MOV     DPL,A
036E E4                CLR     A
036F 3400        E     ADDC    A,#HIGH stLocalControl+0CH
0371 F583              MOV     DPH,A
0373 EE                MOV     A,R6
0374 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 789
0375         ?C0170:
0375 AE07              MOV     R6,AR7
0377 0F                INC     R7
0378 7400        E     MOV     A,#LOW stLocalControl+0CH
037A 2E                ADD     A,R6
037B F582              MOV     DPL,A
037D E4                CLR     A
037E 3400        E     ADDC    A,#HIGH stLocalControl+0CH
0380 F583              MOV     DPH,A
0382 7411              MOV     A,#011H
0384 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 790
                                           ; SOURCE LINE # 791
0385         ?C0105:
                                           ; SOURCE LINE # 793
0385 AE07              MOV     R6,AR7
0387 0F                INC     R7
0388 7400        E     MOV     A,#LOW stLocalControl+0CH
038A 2E                ADD     A,R6
038B F582              MOV     DPL,A
038D E4                CLR     A
038E 3400        E     ADDC    A,#HIGH stLocalControl+0CH
0390 F583              MOV     DPH,A
0392 7415              MOV     A,#015H
C51 COMPILER V8.08   SINGLEBUS                                                             02/22/2013 13:09:18 PAGE 93  

0394 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 794
0395 AE07              MOV     R6,AR7
0397 0F                INC     R7
0398 7400        E     MOV     A,#LOW stLocalControl+0CH
039A 2E                ADD     A,R6
039B F582              MOV     DPL,A
039D E4                CLR     A
039E 3400        E     ADDC    A,#HIGH stLocalControl+0CH
03A0 F583              MOV     DPH,A
03A2 7410              MOV     A,#010H
                                           ; SOURCE LINE # 795
                                           ; SOURCE LINE # 796
03A4 020000      R     LJMP    ?C0174
                                           ; SOURCE LINE # 797
03A7         ?C0110:
                                           ; SOURCE LINE # 799
03A7 900001            MOV     DPTR,#01H
03AA 120000      E     LCALL   ?C?CLDOPTR
03AD 547F              ANL     A,#07FH
03AF 900000      R     MOV     DPTR,#byTemp1
03B2 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 800
03B3 E0                MOVX    A,@DPTR
03B4 FE                MOV     R6,A
03B5 75F064            MOV     B,#064H
03B8 84                DIV     AB
03B9 FD                MOV     R5,A
03BA A3                INC     DPTR
03BB F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 801
03BC EE                MOV     A,R6
03BD 75F064            MOV     B,#064H
03C0 84                DIV     AB
03C1 900000      R     MOV     DPTR,#byTemp1
03C4 E5F0              MOV     A,B
03C6 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 802
03C7 ED                MOV     A,R5
03C8 607A              JZ      ?C0111
                                           ; SOURCE LINE # 803
                                           ; SOURCE LINE # 804
03CA A3                INC     DPTR
03CB E0                MOVX    A,@DPTR
03CC FE                MOV     R6,A
03CD AD07              MOV     R5,AR7
03CF 0F                INC     R7
03D0 7400        E     MOV     A,#LOW stLocalControl+0CH
03D2 2D                ADD     A,R5
03D3 F582              MOV     DPL,A
03D5 E4                CLR     A
03D6 3400        E     ADDC    A,#HIGH stLocalControl+0CH
03D8 F583              MOV     DPH,A
03DA EE                MOV     A,R6
03DB F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 805
03DC AE07              MOV     R6,AR7
03DE 0F                INC     R7
03DF 7400        E     MOV     A,#LOW stLocalControl+0CH
03E1 2E                ADD     A,R6
03E2 F582              MOV     DPL,A
03E4 E4                CLR     A
C51 COMPILER V8.08   SINGLEBUS                                                             02/22/2013 13:09:18 PAGE 94  

03E5 3400        E     ADDC    A,#HIGH stLocalControl+0CH
03E7 F583              MOV     DPH,A
03E9 7414              MOV     A,#014H
03EB F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 806
03EC 900000      R     MOV     DPTR,#byTemp1
03EF E0                MOVX    A,@DPTR
03F0 FE                MOV     R6,A
03F1 7003              JNZ     $ + 5H
03F3 020000      R     LJMP    ?C0173
                                           ; SOURCE LINE # 807
                                           ; SOURCE LINE # 808
03F6 75F00A            MOV     B,#0AH
03F9 84                DIV     AB
03FA A3                INC     DPTR
03FB F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 809
03FC EE                MOV     A,R6
03FD 75F00A            MOV     B,#0AH
0400 84                DIV     AB
0401 900000      R     MOV     DPTR,#byTemp1
0404 E5F0              MOV     A,B
0406 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 810
0407 A3                INC     DPTR
0408 E0                MOVX    A,@DPTR
0409 FE                MOV     R6,A
040A AD07              MOV     R5,AR7
040C 0F                INC     R7
040D 7400        E     MOV     A,#LOW stLocalControl+0CH
040F 2D                ADD     A,R5
0410 F582              MOV     DPL,A
0412 E4                CLR     A
0413 3400        E     ADDC    A,#HIGH stLocalControl+0CH
0415 F583              MOV     DPH,A
0417 EE                MOV     A,R6
0418 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 811
0419 EE                MOV     A,R6
041A 6010              JZ      ?C0113
                                           ; SOURCE LINE # 812
                                           ; SOURCE LINE # 813
041C AE07              MOV     R6,AR7
041E 0F                INC     R7
041F 7400        E     MOV     A,#LOW stLocalControl+0CH
0421 2E                ADD     A,R6
0422 F582              MOV     DPL,A
0424 E4                CLR     A
0425 3400        E     ADDC    A,#HIGH stLocalControl+0CH
0427 F583              MOV     DPH,A
0429 740C              MOV     A,#0CH
042B F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 814
042C         ?C0113:
                                           ; SOURCE LINE # 815
042C 900000      R     MOV     DPTR,#byTemp1
042F E0                MOVX    A,@DPTR
0430 FE                MOV     R6,A
0431 6067              JZ      ?C0172
                                           ; SOURCE LINE # 816
                                           ; SOURCE LINE # 817
0433 AD07              MOV     R5,AR7
C51 COMPILER V8.08   SINGLEBUS                                                             02/22/2013 13:09:18 PAGE 95  

0435 0F                INC     R7
0436 7400        E     MOV     A,#LOW stLocalControl+0CH
0438 2D                ADD     A,R5
0439 F582              MOV     DPL,A
043B E4                CLR     A
043C 3400        E     ADDC    A,#HIGH stLocalControl+0CH
043E F583              MOV     DPH,A
0440 EE                MOV     A,R6
0441 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 818
                                           ; SOURCE LINE # 819
0442         ?C0112:
                                           ; SOURCE LINE # 821
                                           ; SOURCE LINE # 822
0442 806C              SJMP    ?C0173
0444         ?C0111:
                                           ; SOURCE LINE # 824
                                           ; SOURCE LINE # 825
0444 900000      R     MOV     DPTR,#byTemp1
0447 E0                MOVX    A,@DPTR
0448 FE                MOV     R6,A
0449 75F00A            MOV     B,#0AH
044C 84                DIV     AB
044D FD                MOV     R5,A
044E A3                INC     DPTR
044F F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 826
0450 EE                MOV     A,R6
0451 75F00A            MOV     B,#0AH
0454 84                DIV     AB
0455 900000      R     MOV     DPTR,#byTemp1
0458 E5F0              MOV     A,B
045A F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 827
045B ED                MOV     A,R5
045C 603E              JZ      ?C0116
                                           ; SOURCE LINE # 828
                                           ; SOURCE LINE # 829
045E A3                INC     DPTR
045F E0                MOVX    A,@DPTR
0460 FE                MOV     R6,A
0461 6401              XRL     A,#01H
0463 600F              JZ      ?C0117
                                           ; SOURCE LINE # 830
                                           ; SOURCE LINE # 831
0465 AD07              MOV     R5,AR7
0467 0F                INC     R7
0468 7400        E     MOV     A,#LOW stLocalControl+0CH
046A 2D                ADD     A,R5
046B F582              MOV     DPL,A
046D E4                CLR     A
046E 3400        E     ADDC    A,#HIGH stLocalControl+0CH
0470 F583              MOV     DPH,A
0472 EE                MOV     A,R6
0473 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 832
0474         ?C0117:
                                           ; SOURCE LINE # 833
0474 AE07              MOV     R6,AR7
0476 0F                INC     R7
0477 7400        E     MOV     A,#LOW stLocalControl+0CH
0479 2E                ADD     A,R6
C51 COMPILER V8.08   SINGLEBUS                                                             02/22/2013 13:09:18 PAGE 96  

047A F582              MOV     DPL,A
047C E4                CLR     A
047D 3400        E     ADDC    A,#HIGH stLocalControl+0CH
047F F583              MOV     DPH,A
0481 740C              MOV     A,#0CH
0483 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 834
0484 900000      R     MOV     DPTR,#byTemp1
0487 E0                MOVX    A,@DPTR
0488 FE                MOV     R6,A
0489 600F              JZ      ?C0118
                                           ; SOURCE LINE # 835
                                           ; SOURCE LINE # 836
048B AD07              MOV     R5,AR7
048D 0F                INC     R7
048E 7400        E     MOV     A,#LOW stLocalControl+0CH
0490 2D                ADD     A,R5
0491 F582              MOV     DPL,A
0493 E4                CLR     A
0494 3400        E     ADDC    A,#HIGH stLocalControl+0CH
0496 F583              MOV     DPH,A
0498 EE                MOV     A,R6
0499 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 837
049A         ?C0118:
                                           ; SOURCE LINE # 839
049A         ?C0172:
                                           ; SOURCE LINE # 840
049A 8014              SJMP    ?C0173
049C         ?C0116:
                                           ; SOURCE LINE # 842
                                           ; SOURCE LINE # 843
049C 900000      R     MOV     DPTR,#byTemp1
049F E0                MOVX    A,@DPTR
04A0 FE                MOV     R6,A
04A1 AD07              MOV     R5,AR7
04A3 0F                INC     R7
04A4 7400        E     MOV     A,#LOW stLocalControl+0CH
04A6 2D                ADD     A,R5
04A7 F582              MOV     DPL,A
04A9 E4                CLR     A
04AA 3400        E     ADDC    A,#HIGH stLocalControl+0CH
04AC F583              MOV     DPH,A
04AE EE                MOV     A,R6
04AF F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 845
04B0         ?C0173:
04B0 AE07              MOV     R6,AR7
04B2 0F                INC     R7
04B3 7400        E     MOV     A,#LOW stLocalControl+0CH
04B5 2E                ADD     A,R6
04B6 F582              MOV     DPL,A
04B8 E4                CLR     A
04B9 3400        E     ADDC    A,#HIGH stLocalControl+0CH
04BB F583              MOV     DPH,A
04BD 7413              MOV     A,#013H
04BF F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 846
                                           ; SOURCE LINE # 847
04C0         ?C0115:
                                           ; SOURCE LINE # 849
04C0 900002            MOV     DPTR,#02H
C51 COMPILER V8.08   SINGLEBUS                                                             02/22/2013 13:09:18 PAGE 97  

04C3 120000      E     LCALL   ?C?CLDOPTR
04C6 540F              ANL     A,#0FH
04C8 900000      R     MOV     DPTR,#byTemp1
04CB F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 850
04CC 7022              JNZ     ?C0120
                                           ; SOURCE LINE # 851
                                           ; SOURCE LINE # 852
04CE AE07              MOV     R6,AR7
04D0 0F                INC     R7
04D1 7400        E     MOV     A,#LOW stLocalControl+0CH
04D3 2E                ADD     A,R6
04D4 F582              MOV     DPL,A
04D6 E4                CLR     A
04D7 3400        E     ADDC    A,#HIGH stLocalControl+0CH
04D9 F583              MOV     DPH,A
04DB 740D              MOV     A,#0DH
04DD F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 854
04DE AE07              MOV     R6,AR7
04E0 0F                INC     R7
04E1 7400        E     MOV     A,#LOW stLocalControl+0CH
04E3 2E                ADD     A,R6
04E4 F582              MOV     DPL,A
04E6 E4                CLR     A
04E7 3400        E     ADDC    A,#HIGH stLocalControl+0CH
04E9 F583              MOV     DPH,A
04EB 740F              MOV     A,#0FH
04ED         ?C0171:
                                           ; SOURCE LINE # 855
                                           ; SOURCE LINE # 856
04ED 020000      R     LJMP    ?C0174
                                           ; SOURCE LINE # 857
04F0         ?C0120:
                                           ; SOURCE LINE # 859
04F0 900000      R     MOV     DPTR,#byTemp1
04F3 E0                MOVX    A,@DPTR
04F4 FE                MOV     R6,A
04F5 75F00A            MOV     B,#0AH
04F8 84                DIV     AB
04F9 FD                MOV     R5,A
04FA A3                INC     DPTR
04FB F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 860
04FC EE                MOV     A,R6
04FD 75F00A            MOV     B,#0AH
0500 84                DIV     AB
0501 900000      R     MOV     DPTR,#byTemp1
0504 E5F0              MOV     A,B
0506 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 861
0507 ED                MOV     A,R5
0508 603E              JZ      ?C0121
                                           ; SOURCE LINE # 862
                                           ; SOURCE LINE # 863
050A A3                INC     DPTR
050B E0                MOVX    A,@DPTR
050C FE                MOV     R6,A
050D 6401              XRL     A,#01H
050F 600F              JZ      ?C0122
                                           ; SOURCE LINE # 864
                                           ; SOURCE LINE # 865
C51 COMPILER V8.08   SINGLEBUS                                                             02/22/2013 13:09:18 PAGE 98  

0511 AD07              MOV     R5,AR7
0513 0F                INC     R7
0514 7400        E     MOV     A,#LOW stLocalControl+0CH
0516 2D                ADD     A,R5
0517 F582              MOV     DPL,A
0519 E4                CLR     A
051A 3400        E     ADDC    A,#HIGH stLocalControl+0CH
051C F583              MOV     DPH,A
051E EE                MOV     A,R6
051F F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 866
0520         ?C0122:
                                           ; SOURCE LINE # 867
0520 AE07              MOV     R6,AR7
0522 0F                INC     R7
0523 7400        E     MOV     A,#LOW stLocalControl+0CH
0525 2E                ADD     A,R6
0526 F582              MOV     DPL,A
0528 E4                CLR     A
0529 3400        E     ADDC    A,#HIGH stLocalControl+0CH
052B F583              MOV     DPH,A
052D 740C              MOV     A,#0CH
052F F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 868
0530 900000      R     MOV     DPTR,#byTemp1
0533 E0                MOVX    A,@DPTR
0534 FE                MOV     R6,A
0535 6025              JZ      ?C0175
                                           ; SOURCE LINE # 869
                                           ; SOURCE LINE # 870
0537 AD07              MOV     R5,AR7
0539 0F                INC     R7
053A 7400        E     MOV     A,#LOW stLocalControl+0CH
053C 2D                ADD     A,R5
053D F582              MOV     DPL,A
053F E4                CLR     A
0540 3400        E     ADDC    A,#HIGH stLocalControl+0CH
0542 F583              MOV     DPH,A
0544 EE                MOV     A,R6
0545 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 871
0546         ?C0123:
                                           ; SOURCE LINE # 873
                                           ; SOURCE LINE # 875
                                           ; SOURCE LINE # 876
0546 8014              SJMP    ?C0175
0548         ?C0121:
                                           ; SOURCE LINE # 878
                                           ; SOURCE LINE # 879
0548 900000      R     MOV     DPTR,#byTemp1
054B E0                MOVX    A,@DPTR
054C FE                MOV     R6,A
054D AD07              MOV     R5,AR7
054F 0F                INC     R7
0550 7400        E     MOV     A,#LOW stLocalControl+0CH
0552 2D                ADD     A,R5
0553 F582              MOV     DPL,A
0555 E4                CLR     A
0556 3400        E     ADDC    A,#HIGH stLocalControl+0CH
0558 F583              MOV     DPH,A
055A EE                MOV     A,R6
055B F0                MOVX    @DPTR,A
C51 COMPILER V8.08   SINGLEBUS                                                             02/22/2013 13:09:18 PAGE 99  

                                           ; SOURCE LINE # 881
055C         ?C0175:
055C AE07              MOV     R6,AR7
055E 0F                INC     R7
055F 7400        E     MOV     A,#LOW stLocalControl+0CH
0561 2E                ADD     A,R6
0562 F582              MOV     DPL,A
0564 E4                CLR     A
0565 3400        E     ADDC    A,#HIGH stLocalControl+0CH
0567 F583              MOV     DPH,A
0569 740E              MOV     A,#0EH
056B F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 883
056C AE07              MOV     R6,AR7
056E 0F                INC     R7
056F 7400        E     MOV     A,#LOW stLocalControl+0CH
0571 2E                ADD     A,R6
0572 F582              MOV     DPL,A
0574 E4                CLR     A
0575 3400        E     ADDC    A,#HIGH stLocalControl+0CH
0577 F583              MOV     DPH,A
0579 740D              MOV     A,#0DH
057B F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 884
057C         ?C0124:
                                           ; SOURCE LINE # 886
057C         ?C0168:
057C AE07              MOV     R6,AR7
057E 0F                INC     R7
057F 7400        E     MOV     A,#LOW stLocalControl+0CH
0581 2E                ADD     A,R6
0582 F582              MOV     DPL,A
0584 E4                CLR     A
0585 3400        E     ADDC    A,#HIGH stLocalControl+0CH
0587 F583              MOV     DPH,A
0589 740F              MOV     A,#0FH
058B         ?C0174:
058B F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 887
058C 900000      E     MOV     DPTR,#stLocalControl+01DH
058F EF                MOV     A,R7
0590 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 888
                                           ; SOURCE LINE # 889
                                           ; SOURCE LINE # 1100
0591         ?C0088:
0591 22                RET     
             ; FUNCTION _MakeCallVoiceData (END)

             ; FUNCTION StopVoicePlay (BEGIN)
                                           ; SOURCE LINE # 1117
                                           ; SOURCE LINE # 1118
                                           ; SOURCE LINE # 1119
0000 900000      E     MOV     DPTR,#stLocalControl+01EH
0003 E0                MOVX    A,@DPTR
0004 54FC              ANL     A,#0FCH
0006 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1120
0007 E4                CLR     A
0008 A3                INC     DPTR
0009 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1121
C51 COMPILER V8.08   SINGLEBUS                                                             02/22/2013 13:09:18 PAGE 100 

000A 22                RET     
             ; FUNCTION StopVoicePlay (END)

             ; FUNCTION StartVoicePlay (BEGIN)
                                           ; SOURCE LINE # 1137
                                           ; SOURCE LINE # 1138
                                           ; SOURCE LINE # 1139
0000 900000      E     MOV     DPTR,#stLocalControl+01EH
0003 E0                MOVX    A,@DPTR
0004 54FB              ANL     A,#0FBH
0006 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1140
0007 4402              ORL     A,#02H
0009 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1141
000A A3                INC     DPTR
000B 7404              MOV     A,#04H
000D F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1142
000E 22                RET     
             ; FUNCTION StartVoicePlay (END)

             ; FUNCTION Bus0RecDeal (BEGIN)
                                           ; SOURCE LINE # 1161
                                           ; SOURCE LINE # 1162
                                           ; SOURCE LINE # 1164
0000 C2AF              CLR     EA
0002 0500        E     INC     Os_Enter_Sum
                                           ; SOURCE LINE # 1165
0004 7800        E     MOV     R0,#LOW stLocalControl+05H
0006 7C00        E     MOV     R4,#HIGH stLocalControl+05H
0008 7D01              MOV     R5,#01H
000A 7B01              MOV     R3,#01H
000C 7A00        R     MOV     R2,#HIGH byBus0RecData
000E 7900        R     MOV     R1,#LOW byBus0RecData
0010 7E00              MOV     R6,#00H
0012 7F07              MOV     R7,#07H
0014 120000      E     LCALL   ?C?COPY
                                           ; SOURCE LINE # 1166
0017 C200        R     CLR     bBus0RecFinish
                                           ; SOURCE LINE # 1167
0019 D50002      E     DJNZ    Os_Enter_Sum,?C0127
001C D2AF              SETB    EA
001E         ?C0127:
                                           ; SOURCE LINE # 1169
001E 7B01              MOV     R3,#01H
0020 7A00        E     MOV     R2,#HIGH stLocalControl+05H
0022 7900        E     MOV     R1,#LOW stLocalControl+05H
0024 7D07              MOV     R5,#07H
0026 120000      E     LCALL   _Send_Data
                                           ; SOURCE LINE # 1171
0029 900000      E     MOV     DPTR,#stLocalControl+08H
002C E0                MOVX    A,@DPTR
002D 2470              ADD     A,#070H
002F 601D              JZ      ?C0131
0031 24F8              ADD     A,#0F8H
0033 601C              JZ      ?C0132
0035 14                DEC     A
0036 603C              JZ      ?C0134
0038 246A              ADD     A,#06AH
003A 7059              JNZ     ?C0137
                                           ; SOURCE LINE # 1172
C51 COMPILER V8.08   SINGLEBUS                                                             02/22/2013 13:09:18 PAGE 101 

                                           ; SOURCE LINE # 1173
003C         ?C0129:
                                           ; SOURCE LINE # 1174
003C 7B01              MOV     R3,#01H
003E 7A00        E     MOV     R2,#HIGH stLocalControl+05H
0040 7900        E     MOV     R1,#LOW stLocalControl+05H
0042 120000      R     LCALL   _MakeCallVoiceData
                                           ; SOURCE LINE # 1176
0045 900000      E     MOV     DPTR,#stLocalControl+01DH
0048 E0                MOVX    A,@DPTR
0049 604A              JZ      ?C0137
                                           ; SOURCE LINE # 1177
                                           ; SOURCE LINE # 1184
004B 020000      R     LJMP    StartVoicePlay
                                           ; SOURCE LINE # 1186
                                           ; SOURCE LINE # 1187
                                           ; SOURCE LINE # 1188
004E         ?C0131:
                                           ; SOURCE LINE # 1190
004E 020000      R     LJMP    StopVoicePlay
                                           ; SOURCE LINE # 1191
                                           ; SOURCE LINE # 1193
0051         ?C0132:
                                           ; SOURCE LINE # 1194
0051 900000      E     MOV     DPTR,#stLocalControl+05H
0054 E0                MOVX    A,@DPTR
0055 6401              XRL     A,#01H
0057 703C              JNZ     ?C0137
                                           ; SOURCE LINE # 1195
                                           ; SOURCE LINE # 1196
0059 900000      E     MOV     DPTR,#stLocalControl+0CH
005C 7417              MOV     A,#017H
005E F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1197
005F 900000      E     MOV     DPTR,#stLocalControl+01DH
0062 7401              MOV     A,#01H
0064 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1198
0065 A3                INC     DPTR
0066 E0                MOVX    A,@DPTR
0067 54FB              ANL     A,#0FBH
0069 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1199
006A 4402              ORL     A,#02H
006C F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1200
006D A3                INC     DPTR
006E 7401              MOV     A,#01H
0070 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1201
0071 D200        R     SETB    bPlayVoiceMaintain
                                           ; SOURCE LINE # 1203
                                           ; SOURCE LINE # 1204
0073 22                RET     
                                           ; SOURCE LINE # 1205
0074         ?C0134:
                                           ; SOURCE LINE # 1206
0074 900000      E     MOV     DPTR,#stLocalControl+05H
0077 E0                MOVX    A,@DPTR
0078 B4011A            CJNE    A,#01H,?C0137
                                           ; SOURCE LINE # 1207
                                           ; SOURCE LINE # 1208
C51 COMPILER V8.08   SINGLEBUS                                                             02/22/2013 13:09:18 PAGE 102 

007B 900000      E     MOV     DPTR,#stLocalControl+0CH
007E 7416              MOV     A,#016H
0080 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1209
0081 900000      E     MOV     DPTR,#stLocalControl+01DH
0084 7401              MOV     A,#01H
0086 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1210
0087 A3                INC     DPTR
0088 E0                MOVX    A,@DPTR
0089 54FB              ANL     A,#0FBH
008B F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1211
008C 4402              ORL     A,#02H
008E F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1212
008F A3                INC     DPTR
0090 7401              MOV     A,#01H
0092 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1213
0093 D200        R     SETB    bPlayVoiceWait
                                           ; SOURCE LINE # 1215
                                           ; SOURCE LINE # 1216
                                           ; SOURCE LINE # 1217
                                           ; SOURCE LINE # 1218
                                           ; SOURCE LINE # 1220
                                           ; SOURCE LINE # 1221
0095         ?C0137:
0095 22                RET     
             ; FUNCTION Bus0RecDeal (END)

             ; FUNCTION Bus0SendDeal (BEGIN)
                                           ; SOURCE LINE # 1239
                                           ; SOURCE LINE # 1240
                                           ; SOURCE LINE # 1242
0000 C2AF              CLR     EA
0002 0500        E     INC     Os_Enter_Sum
                                           ; SOURCE LINE # 1243
0004 7800        E     MOV     R0,#LOW stLocalControl+05H
0006 7C00        E     MOV     R4,#HIGH stLocalControl+05H
0008 7D01              MOV     R5,#01H
000A 7B01              MOV     R3,#01H
000C 7A00        R     MOV     R2,#HIGH byBus0SendData
000E 7900        R     MOV     R1,#LOW byBus0SendData
0010 7E00              MOV     R6,#00H
0012 7F07              MOV     R7,#07H
0014 120000      E     LCALL   ?C?COPY
                                           ; SOURCE LINE # 1244
0017 C200        R     CLR     bBus0SendFinish
                                           ; SOURCE LINE # 1245
0019 D50002      E     DJNZ    Os_Enter_Sum,?C0138
001C D2AF              SETB    EA
001E         ?C0138:
                                           ; SOURCE LINE # 1249
                                           ; SOURCE LINE # 1250
                                           ; SOURCE LINE # 1251
                                           ; SOURCE LINE # 1253
                                           ; SOURCE LINE # 1254
                                           ; SOURCE LINE # 1255
001E         ?C0141:
001E 22                RET     
             ; FUNCTION Bus0SendDeal (END)
C51 COMPILER V8.08   SINGLEBUS                                                             02/22/2013 13:09:18 PAGE 103 


             ; FUNCTION Bus0Manage (BEGIN)
                                           ; SOURCE LINE # 1271
                                           ; SOURCE LINE # 1272
0000         ?C0142:
                                           ; SOURCE LINE # 1273
                                           ; SOURCE LINE # 1274
                                           ; SOURCE LINE # 1275
0000 300007      R     JNB     bBus0RecFinish,?C0144
                                           ; SOURCE LINE # 1276
                                           ; SOURCE LINE # 1277
0003 7F00        E     MOV     R7,#LOW byMainCmdQ
0005 7D20              MOV     R5,#020H
0007 120000      E     LCALL   _OSQPost
                                           ; SOURCE LINE # 1278
000A         ?C0144:
                                           ; SOURCE LINE # 1279
000A 300007      R     JNB     bBus0SendFinish,?C0145
                                           ; SOURCE LINE # 1280
                                           ; SOURCE LINE # 1281
000D 7F00        E     MOV     R7,#LOW byMainCmdQ
000F 7D40              MOV     R5,#040H
0011 120000      E     LCALL   _OSQPost
                                           ; SOURCE LINE # 1282
0014         ?C0145:
                                           ; SOURCE LINE # 1283
0014 7D01              MOV     R5,#01H
0016 7F02              MOV     R7,#02H
0018 120000      E     LCALL   _OSWait
                                           ; SOURCE LINE # 1284
001B 80E3              SJMP    ?C0142
             ; FUNCTION Bus0Manage (END)

             ; FUNCTION TimerOutDeal (BEGIN)
                                           ; SOURCE LINE # 1301
                                           ; SOURCE LINE # 1302
                                           ; SOURCE LINE # 1303
0000 900000      E     MOV     DPTR,#stLocalControl+021H
0003 E0                MOVX    A,@DPTR
0004 600F              JZ      ?C0152
                                           ; SOURCE LINE # 1304
                                           ; SOURCE LINE # 1305
0006 14                DEC     A
0007 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1306
0008 E0                MOVX    A,@DPTR
0009 700A              JNZ     ?C0152
                                           ; SOURCE LINE # 1307
                                           ; SOURCE LINE # 1308
000B A3                INC     DPTR
000C E0                MOVX    A,@DPTR
000D 6006              JZ      ?C0152
                                           ; SOURCE LINE # 1309
                                           ; SOURCE LINE # 1311
000F         ?C0149:
                                           ; SOURCE LINE # 1313
                                           ; SOURCE LINE # 1314
000F 900000      E     MOV     DPTR,#stLocalControl+022H
0012 E0                MOVX    A,@DPTR
0013 14                DEC     A
0014 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1315
C51 COMPILER V8.08   SINGLEBUS                                                             02/22/2013 13:09:18 PAGE 104 

                                           ; SOURCE LINE # 1316
                                           ; SOURCE LINE # 1318
                                           ; SOURCE LINE # 1319
                                           ; SOURCE LINE # 1320
                                           ; SOURCE LINE # 1321
                                           ; SOURCE LINE # 1322
0015         ?C0152:
0015 22                RET     
             ; FUNCTION TimerOutDeal (END)

             ; FUNCTION TimerOutManager (BEGIN)
                                           ; SOURCE LINE # 1338
                                           ; SOURCE LINE # 1339
0000         ?C0153:
                                           ; SOURCE LINE # 1340
                                           ; SOURCE LINE # 1341
                                           ; SOURCE LINE # 1342
0000 7D04              MOV     R5,#04H
0002 7F02              MOV     R7,#02H
0004 120000      E     LCALL   _OSWait
                                           ; SOURCE LINE # 1343
0007 900000      E     MOV     DPTR,#stLocalControl+021H
000A E0                MOVX    A,@DPTR
000B 6009              JZ      ?C0155
                                           ; SOURCE LINE # 1344
                                           ; SOURCE LINE # 1345
000D 7F00        E     MOV     R7,#LOW byMainCmdQ
000F 7DA0              MOV     R5,#0A0H
0011 120000      E     LCALL   _OSQPost
                                           ; SOURCE LINE # 1346
0014 80EA              SJMP    ?C0153
0016         ?C0155:
                                           ; SOURCE LINE # 1348
                                           ; SOURCE LINE # 1349
0016 7F00        E     MOV     R7,#LOW byMainCmdQ
0018 7DA0              MOV     R5,#0A0H
001A 120000      E     LCALL   _OSQPost
                                           ; SOURCE LINE # 1350
                                           ; SOURCE LINE # 1351
001D 80E1              SJMP    ?C0153
             ; FUNCTION TimerOutManager (END)

C51 COMPILER V8.08   SINGLEBUS                                                             02/22/2013 13:09:18 PAGE 105 

NAME                                    CLASS   MSPACE  TYPE    OFFSET  SIZE
====                                    =====   ======  ====    ======  ====


TimerOutManager. . . . . . . . . . . .  PUBLIC   CODE   PROC     0000H  -----
byBus0DisableCount . . . . . . . . . .  PUBLIC   DATA   U_CHAR   0000H  1
P0 . . . . . . . . . . . . . . . . . .  SFR      DATA   U_CHAR   0080H  1
P3M0 . . . . . . . . . . . . . . . . .  SFR      DATA   U_CHAR   00B1H  1
P1 . . . . . . . . . . . . . . . . . .  SFR      DATA   U_CHAR   0090H  1
P3M1 . . . . . . . . . . . . . . . . .  SFR      DATA   U_CHAR   00B2H  1
P2 . . . . . . . . . . . . . . . . . .  SFR      DATA   U_CHAR   00A0H  1
P3 . . . . . . . . . . . . . . . . . .  SFR      DATA   U_CHAR   00B0H  1
int8 . . . . . . . . . . . . . . . . .  TYPEDEF  -----  CHAR     -----  1
EA . . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      00AFH  1
bBus0Enable. . . . . . . . . . . . . .  ABSBIT   -----  BIT      0002H  1
bPlayVoiceWait . . . . . . . . . . . .  PUBLIC   DATA   BIT      0000H  1
_STIndicationData. . . . . . . . . . .  * TAG *  -----  STRUCT   -----  5
  byIndicationSecAddr. . . . . . . . .  MEMBER   -----  U_CHAR   0000H  1
  byIndicationRoomAddr . . . . . . . .  MEMBER   -----  U_CHAR   0001H  1
  byIndicationBedAddr. . . . . . . . .  MEMBER   -----  U_CHAR   0002H  1
  byCallCmd. . . . . . . . . . . . . .  MEMBER   -----  U_CHAR   0003H  1
  byState. . . . . . . . . . . . . . .  MEMBER   -----  U_CHAR   0004H  1
IE . . . . . . . . . . . . . . . . . .  SFR      DATA   U_CHAR   00A8H  1
_IapErase. . . . . . . . . . . . . . .  EXTERN   CODE   PROC     -----  -----
Bus0SendPin. . . . . . . . . . . . . .  ABSBIT   -----  BIT      00B4H  1
size_t . . . . . . . . . . . . . . . .  TYPEDEF  -----  U_INT    -----  2
byBus0TxTail . . . . . . . . . . . . .  PUBLIC   DATA   U_CHAR   0001H  1
pSTEepromCfgData . . . . . . . . . . .  TYPEDEF  -----  PTR      -----  3
DisableIAP . . . . . . . . . . . . . .  EXTERN   CODE   PROC     -----  -----
bBus0OnRec . . . . . . . . . . . . . .  ABSBIT   -----  BIT      0001H  1
IP . . . . . . . . . . . . . . . . . .  SFR      DATA   U_CHAR   00B8H  1
_STVoicePlay . . . . . . . . . . . . .  * TAG *  -----  STRUCT   -----  20
  byVoiceData. . . . . . . . . . . . .  MEMBER   -----  ARRAY    0000H  16
  byVoicePosition. . . . . . . . . . .  MEMBER   -----  U_CHAR   0010H  1
  byVoiceSize. . . . . . . . . . . . .  MEMBER   -----  U_CHAR   0011H  1
  byVS1003State. . . . . . . . . . . .  MEMBER   -----  U_CHAR   0012H  1
  byVoiceTimes . . . . . . . . . . . .  MEMBER   -----  U_CHAR   0013H  1
bBus0OnSendFreq. . . . . . . . . . . .  ABSBIT   -----  BIT      0005H  1
_OSQPost . . . . . . . . . . . . . . .  EXTERN   CODE   PROC     -----  -----
pSTIndicationData. . . . . . . . . . .  TYPEDEF  -----  PTR      -----  3
Bus0RecPin . . . . . . . . . . . . . .  ABSBIT   -----  BIT      00B3H  1
byBus0RecTimeOut . . . . . . . . . . .  PUBLIC   DATA   U_CHAR   0002H  1
STEepromCfgData. . . . . . . . . . . .  TYPEDEF  -----  STRUCT   -----  1
  byInitFlag . . . . . . . . . . . . .  MEMBER   -----  U_CHAR   0000H  1
StartVoicePlay . . . . . . . . . . . .  PUBLIC   CODE   PROC     0000H  -----
bLanding . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      0008H  1
CCON . . . . . . . . . . . . . . . . .  SFR      DATA   U_CHAR   00D8H  1
Bus0RecInt . . . . . . . . . . . . . .  PUBLIC   CODE   PROC     0000H  -----
ReadParameter. . . . . . . . . . . . .  PUBLIC   CODE   PROC     0000H  -----
_EnableIAP . . . . . . . . . . . . . .  EXTERN   CODE   PROC     -----  -----
uint32 . . . . . . . . . . . . . . . .  TYPEDEF  -----  U_LONG   -----  4
Bus0Manage . . . . . . . . . . . . . .  PUBLIC   CODE   PROC     0000H  -----
SingleBusInit. . . . . . . . . . . . .  PUBLIC   CODE   PROC     0000H  -----
uint16 . . . . . . . . . . . . . . . .  TYPEDEF  -----  U_INT    -----  2
bBus0OnSendBit . . . . . . . . . . . .  ABSBIT   -----  BIT      0004H  1
pSTVoicePlay . . . . . . . . . . . . .  TYPEDEF  -----  PTR      -----  3
bPlayVoiceMaintain . . . . . . . . . .  PUBLIC   DATA   BIT      0001H  1
STIndicationData . . . . . . . . . . .  TYPEDEF  -----  STRUCT   -----  5
  byIndicationSecAddr. . . . . . . . .  MEMBER   -----  U_CHAR   0000H  1
  byIndicationRoomAddr . . . . . . . .  MEMBER   -----  U_CHAR   0001H  1
  byIndicationBedAddr. . . . . . . . .  MEMBER   -----  U_CHAR   0002H  1
C51 COMPILER V8.08   SINGLEBUS                                                             02/22/2013 13:09:18 PAGE 106 

NAME                                    CLASS   MSPACE  TYPE    OFFSET  SIZE
====                                    =====   ======  ====    ======  ====


  byCallCmd. . . . . . . . . . . . . .  MEMBER   -----  U_CHAR   0003H  1
  byState. . . . . . . . . . . . . . .  MEMBER   -----  U_CHAR   0004H  1
bBus0SendFinish. . . . . . . . . . . .  ABSBIT   -----  BIT      0012H  1
_IapReadByte . . . . . . . . . . . . .  EXTERN   CODE   PROC     -----  -----
int32. . . . . . . . . . . . . . . . .  TYPEDEF  -----  LONG     -----  4
byDevState1. . . . . . . . . . . . . .  PUBLIC   DATA   U_CHAR   0001H  1
int16. . . . . . . . . . . . . . . . .  TYPEDEF  -----  INT      -----  2
SCON . . . . . . . . . . . . . . . . .  SFR      DATA   U_CHAR   0098H  1
bBus0RecBit9 . . . . . . . . . . . . .  ABSBIT   -----  BIT      0011H  1
TMOD . . . . . . . . . . . . . . . . .  SFR      DATA   U_CHAR   0089H  1
TCON . . . . . . . . . . . . . . . . .  SFR      DATA   U_CHAR   0088H  1
TimerOutDeal . . . . . . . . . . . . .  PUBLIC   CODE   PROC     0000H  -----
SaveParameter. . . . . . . . . . . . .  PUBLIC   CODE   PROC     0000H  -----
STVoicePlay. . . . . . . . . . . . . .  TYPEDEF  -----  STRUCT   -----  20
  byVoiceData. . . . . . . . . . . . .  MEMBER   -----  ARRAY    0000H  16
  byVoicePosition. . . . . . . . . . .  MEMBER   -----  U_CHAR   0010H  1
  byVoiceSize. . . . . . . . . . . . .  MEMBER   -----  U_CHAR   0011H  1
  byVS1003State. . . . . . . . . . . .  MEMBER   -----  U_CHAR   0012H  1
  byVoiceTimes . . . . . . . . . . . .  MEMBER   -----  U_CHAR   0013H  1
_OSWait. . . . . . . . . . . . . . . .  EXTERN   CODE   PROC     -----  -----
StopVoicePlay. . . . . . . . . . . . .  PUBLIC   CODE   PROC     0000H  -----
Os_Enter_Sum . . . . . . . . . . . . .  EXTERN   DATA   U_CHAR   -----  1
stLocalControl . . . . . . . . . . . .  EXTERN   XDATA  STRUCT   -----  36
InitParameter. . . . . . . . . . . . .  PUBLIC   CODE   PROC     0000H  -----
IE1. . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      008BH  1
bBus0RecFinish . . . . . . . . . . . .  ABSBIT   -----  BIT      0010H  1
_IapWriteByte. . . . . . . . . . . . .  EXTERN   CODE   PROC     -----  -----
AUXR . . . . . . . . . . . . . . . . .  SFR      DATA   U_CHAR   008EH  1
byBus0SendData . . . . . . . . . . . .  PUBLIC   XDATA  ARRAY    0000H  7
ACC. . . . . . . . . . . . . . . . . .  SFR      DATA   U_CHAR   00E0H  1
_AddrCompare . . . . . . . . . . . . .  PUBLIC   CODE   PROC     0000H  -----
  pstBusFreq . . . . . . . . . . . . .  * REG *  XDATA  PTR      0000H  3
ET0. . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      00A9H  1
TF0. . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      008DH  1
byMainCmdQ . . . . . . . . . . . . . .  EXTERN   IDATA  ARRAY    -----  -----
bBus0Error . . . . . . . . . . . . . .  ABSBIT   -----  BIT      0007H  1
TH0. . . . . . . . . . . . . . . . . .  SFR      DATA   U_CHAR   008CH  1
IT1. . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      008AH  1
EX1. . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      00AAH  1
TL0. . . . . . . . . . . . . . . . . .  SFR      DATA   U_CHAR   008AH  1
byBus0RecData. . . . . . . . . . . . .  PUBLIC   XDATA  ARRAY    0007H  7
byBus0SendCount. . . . . . . . . . . .  PUBLIC   DATA   U_CHAR   0003H  1
pSTBusFreq . . . . . . . . . . . . . .  TYPEDEF  -----  PTR      -----  3
TR0. . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      008CH  1
byBus0TxQ. . . . . . . . . . . . . . .  PUBLIC   XDATA  ARRAY    000EH  141
pSTTimerOut. . . . . . . . . . . . . .  TYPEDEF  -----  PTR      -----  3
bBus0SendError . . . . . . . . . . . .  ABSBIT   -----  BIT      0006H  1
Bus0SendDeal . . . . . . . . . . . . .  PUBLIC   CODE   PROC     0000H  -----
Timer0Int. . . . . . . . . . . . . . .  PUBLIC   CODE   PROC     0000H  -----
byBus0RecCount . . . . . . . . . . . .  PUBLIC   DATA   U_CHAR   0004H  1
byBus0SendBuf. . . . . . . . . . . . .  PUBLIC   DATA   U_CHAR   0005H  1
STBusFreq. . . . . . . . . . . . . . .  TYPEDEF  -----  STRUCT   -----  7
  bySndSecAddr . . . . . . . . . . . .  MEMBER   -----  U_CHAR   0000H  1
  bySndRoomAddr. . . . . . . . . . . .  MEMBER   -----  U_CHAR   0001H  1
  bySndBedAddr . . . . . . . . . . . .  MEMBER   -----  U_CHAR   0002H  1
  byCmd. . . . . . . . . . . . . . . .  MEMBER   -----  U_CHAR   0003H  1
  byRecSecAddr . . . . . . . . . . . .  MEMBER   -----  U_CHAR   0004H  1
C51 COMPILER V8.08   SINGLEBUS                                                             02/22/2013 13:09:18 PAGE 107 

NAME                                    CLASS   MSPACE  TYPE    OFFSET  SIZE
====                                    =====   ======  ====    ======  ====


  byRecRoomAddr. . . . . . . . . . . .  MEMBER   -----  U_CHAR   0005H  1
  byRecBedAddr . . . . . . . . . . . .  MEMBER   -----  U_CHAR   0006H  1
STTimerOut . . . . . . . . . . . . . .  TYPEDEF  -----  STRUCT   -----  3
  byTimerOutSet. . . . . . . . . . . .  MEMBER   -----  U_CHAR   0000H  1
  byTimerOut . . . . . . . . . . . . .  MEMBER   -----  U_CHAR   0001H  1
  byTimerOutCount. . . . . . . . . . .  MEMBER   -----  U_CHAR   0002H  1
_Send_Data . . . . . . . . . . . . . .  EXTERN   CODE   PROC     -----  -----
bBus0SendBit . . . . . . . . . . . . .  ABSBIT   -----  BIT      0014H  1
bBus0StartRec. . . . . . . . . . . . .  ABSBIT   -----  BIT      0000H  1
byBus0State0 . . . . . . . . . . . . .  PUBLIC   DATA   U_CHAR   0000H  1
pSTLocalControl. . . . . . . . . . . .  TYPEDEF  -----  PTR      -----  3
_Bus0OutputData. . . . . . . . . . . .  PUBLIC   CODE   PROC     0000H  -----
  pbyData. . . . . . . . . . . . . . .  AUTO     XDATA  PTR      0000H  3
  byTemp . . . . . . . . . . . . . . .  AUTO     XDATA  U_CHAR   0003H  1
byBus0RecSendCount . . . . . . . . . .  PUBLIC   DATA   U_CHAR   0006H  1
byBus0State1 . . . . . . . . . . . . .  PUBLIC   DATA   U_CHAR   0002H  1
Bus0RecDeal. . . . . . . . . . . . . .  PUBLIC   CODE   PROC     0000H  -----
byBus0RecBuf . . . . . . . . . . . . .  PUBLIC   DATA   U_CHAR   0007H  1
_MakeCallVoiceData . . . . . . . . . .  PUBLIC   CODE   PROC     0000H  -----
  pstBusDealFreq . . . . . . . . . . .  * REG *  DATA   PTR      0001H  3
  byPosition . . . . . . . . . . . . .  * REG *  DATA   U_CHAR   0007H  1
  byTemp1. . . . . . . . . . . . . . .  AUTO     XDATA  U_CHAR   0000H  1
  byTemp2. . . . . . . . . . . . . . .  AUTO     XDATA  U_CHAR   0001H  1
bBus0ReqSend . . . . . . . . . . . . .  ABSBIT   -----  BIT      0003H  1
bBus0Disable . . . . . . . . . . . . .  ABSBIT   -----  BIT      0013H  1
byBus0TxHead . . . . . . . . . . . . .  PUBLIC   DATA   U_CHAR   0008H  1
uint8. . . . . . . . . . . . . . . . .  TYPEDEF  -----  U_CHAR   -----  1
PSW. . . . . . . . . . . . . . . . . .  SFR      DATA   U_CHAR   00D0H  1
_MakeCH0TimerOut . . . . . . . . . . .  PUBLIC   CODE   PROC     0000H  -----
  byTimerOut . . . . . . . . . . . . .  * REG *  DATA   U_CHAR   0007H  1
  byTimerOutCount. . . . . . . . . . .  * REG *  DATA   U_CHAR   0005H  1
byBus0SendStopCount. . . . . . . . . .  PUBLIC   DATA   U_CHAR   0009H  1
bBus0RecBit. . . . . . . . . . . . . .  ABSBIT   -----  BIT      0015H  1
STLocalControl . . . . . . . . . . . .  TYPEDEF  -----  STRUCT   -----  36
  byChar1. . . . . . . . . . . . . . .  MEMBER   -----  U_CHAR   0000H  1
  uiShortType. . . . . . . . . . . . .  MEMBER   -----  U_INT    0001H  2
  pbyData. . . . . . . . . . . . . . .  MEMBER   -----  PTR      0003H  2
  stBusDealFreq. . . . . . . . . . . .  MEMBER   -----  STRUCT   0005H  7
  stVoicePlay. . . . . . . . . . . . .  MEMBER   -----  STRUCT   000CH  20
  stCH0TimerOut. . . . . . . . . . . .  MEMBER   -----  STRUCT   0020H  3
  stEepromCfgData. . . . . . . . . . .  MEMBER   -----  STRUCT   0023H  1


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   2938    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =    155       6
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     13    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =      2    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
